/*
 LeapJS v0.6.4                                                  
 http://github.com/leapmotion/leapjs/                                        

 Copyright 2013 LeapMotion, Inc. and other contributors                      
 Released under the Apache-2.0 license                                     
 http://github.com/leapmotion/leapjs/blob/master/LICENSE.txt                 
*/
'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(c){var h=0;return function(){return h<c.length?{done:!1,value:c[h++]}:{done:!0}}};$jscomp.arrayIterator=function(c){return{next:$jscomp.arrayIteratorImpl(c)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,h,n){if(c==Array.prototype||c==Object.prototype)return c;c[h]=n.value;return c};$jscomp.getGlobal=function(c){c=["object"==typeof globalThis&&globalThis,c,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var h=0;h<c.length;++h){var n=c[h];if(n&&n.Math==Math)return n}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(c,h){var n=$jscomp.propertyToPolyfillSymbol[h];if(null==n)return c[h];n=c[n];return void 0!==n?n:c[h]};
$jscomp.polyfill=function(c,h,n,f){h&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(c,h,n,f):$jscomp.polyfillUnisolated(c,h,n,f))};$jscomp.polyfillUnisolated=function(c,h,n,f){n=$jscomp.global;c=c.split(".");for(f=0;f<c.length-1;f++){var q=c[f];if(!(q in n))return;n=n[q]}c=c[c.length-1];f=n[c];h=h(f);h!=f&&null!=h&&$jscomp.defineProperty(n,c,{configurable:!0,writable:!0,value:h})};
$jscomp.polyfillIsolated=function(c,h,n,f){var q=c.split(".");c=1===q.length;f=q[0];f=!c&&f in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var l=0;l<q.length-1;l++){var k=q[l];if(!(k in f))return;f=f[k]}q=q[q.length-1];n=$jscomp.IS_SYMBOL_NATIVE&&"es6"===n?f[q]:null;h=h(n);null!=h&&(c?$jscomp.defineProperty($jscomp.polyfills,q,{configurable:!0,writable:!0,value:h}):h!==n&&($jscomp.propertyToPolyfillSymbol[q]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(q):$jscomp.POLYFILL_PREFIX+q,q=
$jscomp.propertyToPolyfillSymbol[q],$jscomp.defineProperty(f,q,{configurable:!0,writable:!0,value:h})))};$jscomp.initSymbol=function(){};$jscomp.initSymbolIterator=function(){};$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(c){c={next:c};c[Symbol.iterator]=function(){return this};return c};
$jscomp.iteratorFromArray=function(c,h){c instanceof String&&(c+="");var n=0,f={next:function(){if(n<c.length){var q=n++;return{value:h(q,c[q]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(h,n){return n})}},"es8","es3");$jscomp.owns=function(c,h){return Object.prototype.hasOwnProperty.call(c,h)};
$jscomp.polyfill("Object.values",function(c){return c?c:function(h){var n=[],f;for(f in h)$jscomp.owns(h,f)&&n.push(h[f]);return n}},"es8","es3");$jscomp.polyfill("Array.prototype.includes",function(c){return c?c:function(h,n){var f=this;f instanceof String&&(f=String(f));var q=f.length;n=n||0;for(0>n&&(n=Math.max(n+q,0));n<q;n++){var l=f[n];if(l===h||Object.is(l,h))return!0}return!1}},"es7","es3");
(function(c,h){"object"===typeof exports&&"undefined"!==typeof module?h(exports):"function"===typeof define&&define.amd?define(["exports"],h):h(c.THREE=c.THREE||{})})(this,function(c){function h(){}function n(a,b){this.x=a||0;this.y=b||0}function f(a,b,d,g,t,w,y,F,K,M){Object.defineProperty(this,"id",{value:Tf++});this.uuid=c.Math.generateUUID();this.sourceFile=this.name="";this.image=void 0!==a?a:f.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:f.DEFAULT_MAPPING;this.wrapS=void 0!==d?d:
1001;this.wrapT=void 0!==g?g:1001;this.magFilter=void 0!==t?t:1006;this.minFilter=void 0!==w?w:1008;this.anisotropy=void 0!==K?K:1;this.format=void 0!==y?y:1023;this.type=void 0!==F?F:1009;this.offset=new n(0,0);this.repeat=new n(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==M?M:3E3;this.version=0;this.onUpdate=null}function q(a,b,d,g){this.x=a||0;this.y=b||0;this.z=d||0;this.w=void 0!==g?g:1}function l(a,b,d){this.uuid=c.Math.generateUUID();
this.width=a;this.height=b;this.scissor=new q(0,0,a,b);this.scissorTest=!1;this.viewport=new q(0,0,a,b);d=d||{};void 0===d.minFilter&&(d.minFilter=1006);this.texture=new f(void 0,void 0,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.encoding);this.depthBuffer=void 0!==d.depthBuffer?d.depthBuffer:!0;this.stencilBuffer=void 0!==d.stencilBuffer?d.stencilBuffer:!0;this.depthTexture=void 0!==d.depthTexture?d.depthTexture:null}function k(a,b,d){l.call(this,a,b,d);this.activeMipMapLevel=
this.activeCubeFace=0}function u(a,b,d,g){this._x=a||0;this._y=b||0;this._z=d||0;this._w=void 0!==g?g:1}function r(a,b,d){this.x=a||0;this.y=b||0;this.z=d||0}function z(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function C(a,b,d,g,t,w,y,F,K,M){a=void 0!==a?a:[];f.call(this,a,void 0!==b?b:301,d,g,t,w,y,F,K,M);this.flipY=!1}function E(a,b,d){var g=a[0];if(0>=g||
0<g)return a;var t=b*d,w=Uf[t];void 0===w&&(w=new Float32Array(t),Uf[t]=w);if(0!==b)for(g.toArray(w,0),g=1,t=0;g!==b;++g)t+=d,a[g].toArray(w,t);return w}function A(a,b){var d=Vf[b];void 0===d&&(d=new Int32Array(b),Vf[b]=d);for(var g=0;g!==b;++g)d[g]=a.allocTextureUnit();return d}function H(a,b){a.uniform1f(this.addr,b)}function J(a,b){a.uniform1i(this.addr,b)}function N(a,b){void 0===b.x?a.uniform2fv(this.addr,b):a.uniform2f(this.addr,b.x,b.y)}function U(a,b){void 0!==b.x?a.uniform3f(this.addr,b.x,
b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)}function p(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)}function x(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)}function G(a,b){a.uniformMatrix3fv(this.addr,!1,b.elements||b)}function e(a,b){a.uniformMatrix4fv(this.addr,!1,b.elements||b)}function m(a,b,d){var g=d.allocTextureUnit();a.uniform1i(this.addr,g);d.setTexture2D(b||Wf,g)}function v(a,b,d){var g=d.allocTextureUnit();
a.uniform1i(this.addr,g);d.setTextureCube(b||Xf,g)}function D(a,b){a.uniform2iv(this.addr,b)}function B(a,b){a.uniform3iv(this.addr,b)}function I(a,b){a.uniform4iv(this.addr,b)}function L(a){switch(a){case 5126:return H;case 35664:return N;case 35665:return U;case 35666:return p;case 35674:return x;case 35675:return G;case 35676:return e;case 35678:return m;case 35680:return v;case 5124:case 35670:return J;case 35667:case 35671:return D;case 35668:case 35672:return B;case 35669:case 35673:return I}}
function S(a,b){a.uniform1fv(this.addr,b)}function R(a,b){a.uniform1iv(this.addr,b)}function W(a,b){a.uniform2fv(this.addr,E(b,this.size,2))}function X(a,b){a.uniform3fv(this.addr,E(b,this.size,3))}function V(a,b){a.uniform4fv(this.addr,E(b,this.size,4))}function la(a,b){a.uniformMatrix2fv(this.addr,!1,E(b,this.size,4))}function fa(a,b){a.uniformMatrix3fv(this.addr,!1,E(b,this.size,9))}function ha(a,b){a.uniformMatrix4fv(this.addr,!1,E(b,this.size,16))}function ba(a,b,d){var g=b.length,t=A(d,g);a.uniform1iv(this.addr,
t);for(a=0;a!==g;++a)d.setTexture2D(b[a]||Wf,t[a])}function ea(a,b,d){var g=b.length,t=A(d,g);a.uniform1iv(this.addr,t);for(a=0;a!==g;++a)d.setTextureCube(b[a]||Xf,t[a])}function ka(a){switch(a){case 5126:return S;case 35664:return W;case 35665:return X;case 35666:return V;case 35674:return la;case 35675:return fa;case 35676:return ha;case 35678:return ba;case 35680:return ea;case 5124:case 35670:return R;case 35667:case 35671:return D;case 35668:case 35672:return B;case 35669:case 35673:return I}}
function O(a,b,d){this.id=a;this.addr=d;this.setValue=L(b.type)}function Y(a,b,d){this.id=a;this.addr=d;this.size=b.size;this.setValue=ka(b.type)}function da(a){this.id=a;this.seq=[];this.map={}}function pa(a,b,d){this.seq=[];this.map={};this.renderer=d;d=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var g=0;g!==d;++g){var t=a.getActiveUniform(b,g),w=a.getUniformLocation(b,t.name),y=this,F=t.name,K=F.length;for(tf.lastIndex=0;;){var M=tf.exec(F),T=tf.lastIndex,Q=M[1],P=M[3];"]"===M[2]&&(Q|=0);if(void 0===
P||"["===P&&T+2===K){F=y;t=void 0===P?new O(Q,t,w):new Y(Q,t,w);F.seq.push(t);F.map[t.id]=t;break}else P=y.map[Q],void 0===P&&(P=new da(Q),Q=y,y=P,Q.seq.push(y),Q.map[y.id]=y),y=P}}}function ma(a,b,d){return void 0===b&&void 0===d?this.set(a):this.setRGB(a,b,d)}function wa(a,b){this.min=void 0!==a?a:new n(Infinity,Infinity);this.max=void 0!==b?b:new n(-Infinity,-Infinity)}function Ca(a,b){var d,g,t,w,y,F,K,M,T,Q,P=a.context,Z=a.state,ca,ja,oa,ra,aa,qa;this.render=function(na,ua,ta){if(0!==b.length){na=
new r;var Aa=ta.w/ta.z,Ka=.5*ta.z,Ia=.5*ta.w,Oa=16/ta.w,Ta=new n(Oa*Aa,Oa),Na=new r(1,1,0),Ua=new n(1,1),ab=new wa;ab.min.set(0,0);ab.max.set(ta.z-16,ta.w-16);if(void 0===ra){Oa=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var Pa=new Uint16Array([0,1,2,0,2,3]);ca=P.createBuffer();ja=P.createBuffer();P.bindBuffer(P.ARRAY_BUFFER,ca);P.bufferData(P.ARRAY_BUFFER,Oa,P.STATIC_DRAW);P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,ja);P.bufferData(P.ELEMENT_ARRAY_BUFFER,Pa,P.STATIC_DRAW);aa=P.createTexture();
qa=P.createTexture();Z.bindTexture(P.TEXTURE_2D,aa);P.texImage2D(P.TEXTURE_2D,0,P.RGB,16,16,0,P.RGB,P.UNSIGNED_BYTE,null);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.NEAREST);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.NEAREST);Z.bindTexture(P.TEXTURE_2D,qa);P.texImage2D(P.TEXTURE_2D,0,P.RGBA,16,16,0,P.RGBA,P.UNSIGNED_BYTE,null);P.texParameteri(P.TEXTURE_2D,
P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.NEAREST);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.NEAREST);Oa=oa={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"};Pa=P.createProgram();var Ma=P.createShader(P.FRAGMENT_SHADER),
Wa=P.createShader(P.VERTEX_SHADER),Ja="precision "+a.getPrecision()+" float;\n";P.shaderSource(Ma,Ja+Oa.fragmentShader);P.shaderSource(Wa,Ja+Oa.vertexShader);P.compileShader(Ma);P.compileShader(Wa);P.attachShader(Pa,Ma);P.attachShader(Pa,Wa);P.linkProgram(Pa);ra=Pa;T=P.getAttribLocation(ra,"position");Q=P.getAttribLocation(ra,"uv");d=P.getUniformLocation(ra,"renderType");g=P.getUniformLocation(ra,"map");t=P.getUniformLocation(ra,"occlusionMap");w=P.getUniformLocation(ra,"opacity");y=P.getUniformLocation(ra,
"color");F=P.getUniformLocation(ra,"scale");K=P.getUniformLocation(ra,"rotation");M=P.getUniformLocation(ra,"screenPosition")}P.useProgram(ra);Z.initAttributes();Z.enableAttribute(T);Z.enableAttribute(Q);Z.disableUnusedAttributes();P.uniform1i(t,0);P.uniform1i(g,1);P.bindBuffer(P.ARRAY_BUFFER,ca);P.vertexAttribPointer(T,2,P.FLOAT,!1,16,0);P.vertexAttribPointer(Q,2,P.FLOAT,!1,16,8);P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,ja);Z.disable(P.CULL_FACE);Z.setDepthWrite(!1);Pa=0;for(Ma=b.length;Pa<Ma;Pa++)if(Oa=
16/ta.w,Ta.set(Oa*Aa,Oa),Wa=b[Pa],na.set(Wa.matrixWorld.elements[12],Wa.matrixWorld.elements[13],Wa.matrixWorld.elements[14]),na.applyMatrix4(ua.matrixWorldInverse),na.applyProjection(ua.projectionMatrix),Na.copy(na),Ua.x=ta.x+Na.x*Ka+Ka-8,Ua.y=ta.y+Na.y*Ia+Ia-8,!0===ab.containsPoint(Ua)){Z.activeTexture(P.TEXTURE0);Z.bindTexture(P.TEXTURE_2D,null);Z.activeTexture(P.TEXTURE1);Z.bindTexture(P.TEXTURE_2D,aa);P.copyTexImage2D(P.TEXTURE_2D,0,P.RGB,Ua.x,Ua.y,16,16,0);P.uniform1i(d,0);P.uniform2f(F,Ta.x,
Ta.y);P.uniform3f(M,Na.x,Na.y,Na.z);Z.disable(P.BLEND);Z.enable(P.DEPTH_TEST);P.drawElements(P.TRIANGLES,6,P.UNSIGNED_SHORT,0);Z.activeTexture(P.TEXTURE0);Z.bindTexture(P.TEXTURE_2D,qa);P.copyTexImage2D(P.TEXTURE_2D,0,P.RGBA,Ua.x,Ua.y,16,16,0);P.uniform1i(d,1);Z.disable(P.DEPTH_TEST);Z.activeTexture(P.TEXTURE1);Z.bindTexture(P.TEXTURE_2D,aa);P.drawElements(P.TRIANGLES,6,P.UNSIGNED_SHORT,0);Wa.positionScreen.copy(Na);Wa.customUpdateCallback?Wa.customUpdateCallback(Wa):Wa.updateLensFlares();P.uniform1i(d,
2);Z.enable(P.BLEND);Ja=0;for(var eb=Wa.lensFlares.length;Ja<eb;Ja++){var Za=Wa.lensFlares[Ja];.001<Za.opacity&&.001<Za.scale&&(Na.x=Za.x,Na.y=Za.y,Na.z=Za.z,Oa=Za.size*Za.scale/ta.w,Ta.x=Oa*Aa,Ta.y=Oa,P.uniform3f(M,Na.x,Na.y,Na.z),P.uniform2f(F,Ta.x,Ta.y),P.uniform1f(K,Za.rotation),P.uniform1f(w,Za.opacity),P.uniform3f(y,Za.color.r,Za.color.g,Za.color.b),Z.setBlending(Za.blending,Za.blendEquation,Za.blendSrc,Za.blendDst),a.setTexture2D(Za.texture,1),P.drawElements(P.TRIANGLES,6,P.UNSIGNED_SHORT,
0))}}Z.enable(P.CULL_FACE);Z.enable(P.DEPTH_TEST);Z.setDepthWrite(!0);a.resetGLState()}}}function ya(a,b){var d,g,t,w,y,F,K,M,T,Q,P,Z,ca,ja,oa,ra,aa;function qa(Ua,ab){return Ua.renderOrder!==ab.renderOrder?Ua.renderOrder-ab.renderOrder:Ua.z!==ab.z?ab.z-Ua.z:ab.id-Ua.id}var na=a.context,ua=a.state,ta,Aa,Ka,Ia,Oa=new r,Ta=new u,Na=new r;this.render=function(Ua,ab){if(0!==b.length){if(void 0===Ka){var Pa=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),Ma=new Uint16Array([0,1,2,0,2,3]);
ta=na.createBuffer();Aa=na.createBuffer();na.bindBuffer(na.ARRAY_BUFFER,ta);na.bufferData(na.ARRAY_BUFFER,Pa,na.STATIC_DRAW);na.bindBuffer(na.ELEMENT_ARRAY_BUFFER,Aa);na.bufferData(na.ELEMENT_ARRAY_BUFFER,Ma,na.STATIC_DRAW);Pa=na.createProgram();Ma=na.createShader(na.VERTEX_SHADER);var Wa=na.createShader(na.FRAGMENT_SHADER);na.shaderSource(Ma,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
na.shaderSource(Wa,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
na.compileShader(Ma);na.compileShader(Wa);na.attachShader(Pa,Ma);na.attachShader(Pa,Wa);na.linkProgram(Pa);Ka=Pa;ra=na.getAttribLocation(Ka,"position");aa=na.getAttribLocation(Ka,"uv");d=na.getUniformLocation(Ka,"uvOffset");g=na.getUniformLocation(Ka,"uvScale");t=na.getUniformLocation(Ka,"rotation");w=na.getUniformLocation(Ka,"scale");y=na.getUniformLocation(Ka,"color");F=na.getUniformLocation(Ka,"map");K=na.getUniformLocation(Ka,"opacity");M=na.getUniformLocation(Ka,"modelViewMatrix");T=na.getUniformLocation(Ka,
"projectionMatrix");Q=na.getUniformLocation(Ka,"fogType");P=na.getUniformLocation(Ka,"fogDensity");Z=na.getUniformLocation(Ka,"fogNear");ca=na.getUniformLocation(Ka,"fogFar");ja=na.getUniformLocation(Ka,"fogColor");oa=na.getUniformLocation(Ka,"alphaTest");Pa=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");Pa.width=8;Pa.height=8;Ma=Pa.getContext("2d");Ma.fillStyle="white";Ma.fillRect(0,0,8,8);Ia=new f(Pa);Ia.needsUpdate=!0}na.useProgram(Ka);ua.initAttributes();ua.enableAttribute(ra);
ua.enableAttribute(aa);ua.disableUnusedAttributes();ua.disable(na.CULL_FACE);ua.enable(na.BLEND);na.bindBuffer(na.ARRAY_BUFFER,ta);na.vertexAttribPointer(ra,2,na.FLOAT,!1,16,0);na.vertexAttribPointer(aa,2,na.FLOAT,!1,16,8);na.bindBuffer(na.ELEMENT_ARRAY_BUFFER,Aa);na.uniformMatrix4fv(T,!1,ab.projectionMatrix.elements);ua.activeTexture(na.TEXTURE0);na.uniform1i(F,0);Ma=Pa=0;(Wa=Ua.fog)?(na.uniform3f(ja,Wa.color.r,Wa.color.g,Wa.color.b),Wa&&Wa.isFog?(na.uniform1f(Z,Wa.near),na.uniform1f(ca,Wa.far),
na.uniform1i(Q,1),Ma=Pa=1):Wa&&Wa.isFogExp2&&(na.uniform1f(P,Wa.density),na.uniform1i(Q,2),Ma=Pa=2)):(na.uniform1i(Q,0),Ma=Pa=0);Wa=0;for(var Ja=b.length;Wa<Ja;Wa++){var eb=b[Wa];eb.modelViewMatrix.multiplyMatrices(ab.matrixWorldInverse,eb.matrixWorld);eb.z=-eb.modelViewMatrix.elements[14]}b.sort(qa);ab=[];Wa=0;for(Ja=b.length;Wa<Ja;Wa++){eb=b[Wa];var Za=eb.material;!1!==Za.visible&&(na.uniform1f(oa,Za.alphaTest),na.uniformMatrix4fv(M,!1,eb.modelViewMatrix.elements),eb.matrixWorld.decompose(Oa,Ta,
Na),ab[0]=Na.x,ab[1]=Na.y,eb=0,Ua.fog&&Za.fog&&(eb=Ma),Pa!==eb&&(na.uniform1i(Q,eb),Pa=eb),null!==Za.map?(na.uniform2f(d,Za.map.offset.x,Za.map.offset.y),na.uniform2f(g,Za.map.repeat.x,Za.map.repeat.y)):(na.uniform2f(d,0,0),na.uniform2f(g,1,1)),na.uniform1f(K,Za.opacity),na.uniform3f(y,Za.color.r,Za.color.g,Za.color.b),na.uniform1f(t,Za.rotation),na.uniform2fv(w,ab),ua.setBlending(Za.blending,Za.blendEquation,Za.blendSrc,Za.blendDst),ua.setDepthTest(Za.depthTest),ua.setDepthWrite(Za.depthWrite),Za.map?
a.setTexture2D(Za.map,0):a.setTexture2D(Ia,0),na.drawElements(na.TRIANGLES,6,na.UNSIGNED_SHORT,0))}ua.enable(na.CULL_FACE);a.resetGLState()}}}function za(){Object.defineProperty(this,"id",{value:Yf++});this.uuid=c.Math.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.shading=2;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=
null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0}function ob(a){za.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";
this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),
this.setValues(a))}function nb(a){za.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)}function Ab(a,b){this.min=void 0!==a?a:new r(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new r(-Infinity,-Infinity,-Infinity)}function rb(a,b){this.center=void 0!==a?a:new r;this.radius=
void 0!==b?b:0}function Mb(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function Nb(a,b){this.normal=void 0!==a?a:new r(1,0,0);this.constant=void 0!==b?b:0}function jc(a,b,d,g,t,w){this.planes=[void 0!==a?a:new Nb,void 0!==b?b:new Nb,void 0!==d?d:new Nb,void 0!==g?g:new Nb,void 0!==t?t:new Nb,void 0!==w?w:new Nb]}function yd(a,b,d,g){function t(Na,Ua,ab,Pa){var Ma=Na.geometry;
var Wa=oa;var Ja=Na.customDepthMaterial;ab&&(Wa=ra,Ja=Na.customDistanceMaterial);Ja?Wa=Ja:(Ja=!1,Ua.morphTargets&&(Ma&&Ma.isBufferGeometry?Ja=Ma.morphAttributes&&Ma.morphAttributes.position&&0<Ma.morphAttributes.position.length:Ma&&Ma.isGeometry&&(Ja=Ma.morphTargets&&0<Ma.morphTargets.length)),Na=Na.isSkinnedMesh&&Ua.skinning,Ma=0,Ja&&(Ma|=1),Na&&(Ma|=2),Wa=Wa[Ma]);a.localClippingEnabled&&!0===Ua.clipShadows&&0!==Ua.clippingPlanes.length&&(Ma=Wa.uuid,Ja=Ua.uuid,Na=aa[Ma],void 0===Na&&(Na={},aa[Ma]=
Na),Ma=Na[Ja],void 0===Ma&&(Ma=Wa.clone(),Na[Ja]=Ma),Wa=Ma);Wa.visible=Ua.visible;Wa.wireframe=Ua.wireframe;Ja=Ua.side;Ta.renderSingleSided&&2==Ja&&(Ja=0);Ta.renderReverseSided&&(0===Ja?Ja=1:1===Ja&&(Ja=0));Wa.side=Ja;Wa.clipShadows=Ua.clipShadows;Wa.clippingPlanes=Ua.clippingPlanes;Wa.wireframeLinewidth=Ua.wireframeLinewidth;Wa.linewidth=Ua.linewidth;ab&&void 0!==Wa.uniforms.lightPos&&Wa.uniforms.lightPos.value.copy(Pa);return Wa}function w(Na,Ua,ab){if(!1!==Na.visible){0!==(Na.layers.mask&Ua.layers.mask)&&
(Na.isMesh||Na.isLine||Na.isPoints)&&Na.castShadow&&(!1===Na.frustumCulled||!0===K.intersectsObject(Na))&&!0===Na.material.visible&&(Na.modelViewMatrix.multiplyMatrices(ab.matrixWorldInverse,Na.matrixWorld),ja.push(Na));Na=Na.children;for(var Pa=0,Ma=Na.length;Pa<Ma;Pa++)w(Na[Pa],Ua,ab)}}var y=a.context,F=a.state,K=new jc,M=new z,T=b.shadows,Q=new n,P=new n(g.maxTextureSize,g.maxTextureSize),Z=new r,ca=new r,ja=[],oa=Array(4),ra=Array(4),aa={},qa=[new r(1,0,0),new r(-1,0,0),new r(0,0,1),new r(0,0,
-1),new r(0,1,0),new r(0,-1,0)],na=[new r(0,1,0),new r(0,1,0),new r(0,1,0),new r(0,1,0),new r(0,0,1),new r(0,0,-1)],ua=[new q,new q,new q,new q,new q,new q];b=new nb;b.depthPacking=3201;b.clipping=!0;g=zd.distanceRGBA;for(var ta=c.UniformsUtils.clone(g.uniforms),Aa=0;4!==Aa;++Aa){var Ka=0!==(Aa&1),Ia=0!==(Aa&2),Oa=b.clone();Oa.morphTargets=Ka;Oa.skinning=Ia;oa[Aa]=Oa;Ka=new ob({defines:{USE_SHADOWMAP:""},uniforms:ta,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,morphTargets:Ka,skinning:Ia,
clipping:!0});ra[Aa]=Ka}var Ta=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(Na,Ua){if(!1!==Ta.enabled&&(!1!==Ta.autoUpdate||!1!==Ta.needsUpdate)&&0!==T.length){F.clearColor(1,1,1,1);F.disable(y.BLEND);F.setDepthTest(!0);F.setScissorTest(!1);for(var ab,Pa,Ma=0,Wa=T.length;Ma<Wa;Ma++){var Ja=T[Ma],eb=Ja.shadow;if(void 0===eb)console.warn("THREE.WebGLShadowMap:",Ja,"has no shadow.");else{var Za=eb.camera;
Q.copy(eb.mapSize);Q.min(P);if(Ja&&Ja.isPointLight){ab=6;Pa=!0;var tb=Q.x,ub=Q.y;ua[0].set(2*tb,ub,tb,ub);ua[1].set(0,ub,tb,ub);ua[2].set(3*tb,ub,tb,ub);ua[3].set(tb,ub,tb,ub);ua[4].set(3*tb,0,tb,ub);ua[5].set(tb,0,tb,ub);Q.x*=4;Q.y*=2}else ab=1,Pa=!1;null===eb.map&&(eb.map=new l(Q.x,Q.y,{minFilter:1003,magFilter:1003,format:1023}),Za.updateProjectionMatrix());eb&&eb.isSpotLightShadow&&eb.update(Ja);tb=eb.map;eb=eb.matrix;ca.setFromMatrixPosition(Ja.matrixWorld);Za.position.copy(ca);a.setRenderTarget(tb);
a.clear();for(tb=0;tb<ab;tb++){Pa?(Z.copy(Za.position),Z.add(qa[tb]),Za.up.copy(na[tb]),Za.lookAt(Z),F.viewport(ua[tb])):(Z.setFromMatrixPosition(Ja.target.matrixWorld),Za.lookAt(Z));Za.updateMatrixWorld();Za.matrixWorldInverse.getInverse(Za.matrixWorld);eb.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);eb.multiply(Za.projectionMatrix);eb.multiply(Za.matrixWorldInverse);M.multiplyMatrices(Za.projectionMatrix,Za.matrixWorldInverse);K.setFromMatrix(M);ja.length=0;w(Na,Ua,Za);ub=0;for(var Db=ja.length;ub<
Db;ub++){var mb=ja[ub],Hb=d.update(mb),Kb=mb.material;if(Kb&&Kb.isMultiMaterial){var Ba=Hb.groups;Kb=Kb.materials;for(var db=0,hb=Ba.length;db<hb;db++){var vb=Ba[db],lb=Kb[vb.materialIndex];!0===lb.visible&&(lb=t(mb,lb,Pa,ca),a.renderBufferDirect(Za,null,Hb,lb,mb,vb))}}else lb=t(mb,Kb,Pa,ca),a.renderBufferDirect(Za,null,Hb,lb,mb,null)}}}}Na=a.getClearColor();Ua=a.getClearAlpha();a.setClearColor(Na,Ua);Ta.needsUpdate=!1}}}function sc(a,b){this.origin=void 0!==a?a:new r;this.direction=void 0!==b?b:
new r}function tc(a,b,d,g){this._x=a||0;this._y=b||0;this._z=d||0;this._order=g||tc.DefaultOrder}function Oc(){this.mask=1}function jb(){Object.defineProperty(this,"id",{value:Zf++});this.uuid=c.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=jb.DefaultUp.clone();var a=new r,b=new tc,d=new u,g=new r(1,1,1);b.onChange(function(){d.setFromEuler(b,!1)});d.onChange(function(){b.setFromQuaternion(d,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,
value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:d},scale:{enumerable:!0,value:g},modelViewMatrix:{value:new z},normalMatrix:{value:new Mb}});this.matrix=new z;this.matrixWorld=new z;this.matrixAutoUpdate=jb.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new Oc;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={};this.onBeforeRender=function(){};this.onAfterRender=function(){}}function Pc(a,b){this.start=
void 0!==a?a:new r;this.end=void 0!==b?b:new r}function uc(a,b,d){this.a=void 0!==a?a:new r;this.b=void 0!==b?b:new r;this.c=void 0!==d?d:new r}function Pb(a,b,d,g,t,w){this.a=a;this.b=b;this.c=d;this.normal=g&&g.isVector3?g:new r;this.vertexNormals=Array.isArray(g)?g:[];this.color=t&&t.isColor?t:new ma;this.vertexColors=Array.isArray(t)?t:[];this.materialIndex=void 0!==w?w:0}function bc(a){za.call(this);this.type="MeshBasicMaterial";this.color=new ma(16777215);this.aoMap=this.map=null;this.aoMapIntensity=
1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)}function gb(a,b,d){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=c.Math.generateUUID();this.array=a;this.itemSize=b;this.count=void 0!==a?a.length/b:0;this.normalized=!0===
d;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0}function be(a,b){return new gb(new Uint16Array(a),b)}function Ad(a,b){return new gb(new Uint32Array(a),b)}function Qb(a,b){return new gb(new Float32Array(a),b)}function pb(){Object.defineProperty(this,"id",{value:Oe++});this.uuid=c.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=
[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function ce(){Object.defineProperty(this,"id",{value:Oe++});this.uuid=c.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=
[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function qb(){Object.defineProperty(this,"id",{value:Oe++});this.uuid=c.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}}function Rb(a,b){jb.call(this);this.type=
"Mesh";this.geometry=void 0!==a?a:new qb;this.material=void 0!==b?b:new bc({color:16777215*Math.random()});this.drawMode=0;this.updateMorphTargets()}function Jc(a,b,d,g,t,w){function y(qa,na,ua,ta,Aa,Ka,Ia,Oa,Ta,Na,Ua){var ab=Ka/Ta,Pa=Ia/Na,Ma=Ka/2,Wa=Ia/2,Ja=Oa/2;Ia=Ta+1;for(var eb=Na+1,Za=Ka=0,tb=new r,ub=0;ub<eb;ub++)for(var Db=ub*Pa-Wa,mb=0;mb<Ia;mb++)tb[qa]=(mb*ab-Ma)*ta,tb[na]=Db*Aa,tb[ua]=Ja,Q[ca]=tb.x,Q[ca+1]=tb.y,Q[ca+2]=tb.z,tb[qa]=0,tb[na]=0,tb[ua]=0<Oa?1:-1,P[ca]=tb.x,P[ca+1]=tb.y,P[ca+
2]=tb.z,Z[ja]=mb/Ta,Z[ja+1]=1-ub/Na,ca+=3,ja+=2,Ka+=1;for(ub=0;ub<Na;ub++)for(mb=0;mb<Ta;mb++)qa=ra+mb+Ia*(ub+1),na=ra+(mb+1)+Ia*(ub+1),ua=ra+(mb+1)+Ia*ub,T[oa]=ra+mb+Ia*ub,T[oa+1]=qa,T[oa+2]=ua,T[oa+3]=qa,T[oa+4]=na,T[oa+5]=ua,oa+=6,Za+=6;F.addGroup(aa,Za,Ua);aa+=Za;ra+=Ka}qb.call(this);this.type="BoxBufferGeometry";this.parameters={width:a,height:b,depth:d,widthSegments:g,heightSegments:t,depthSegments:w};var F=this;g=Math.floor(g)||1;t=Math.floor(t)||1;w=Math.floor(w)||1;var K=function(qa,na,ua){return qa=
(qa+1)*(na+1)*2+(qa+1)*(ua+1)*2+(ua+1)*(na+1)*2}(g,t,w),M=function(qa,na,ua){qa=qa*na*2+qa*ua*2+ua*na*2;return 6*qa}(g,t,w),T=new (65535<M?Uint32Array:Uint16Array)(M),Q=new Float32Array(3*K),P=new Float32Array(3*K),Z=new Float32Array(2*K),ca=0,ja=0,oa=0,ra=0,aa=0;y("z","y","x",-1,-1,d,b,a,w,t,0);y("z","y","x",1,-1,d,b,-a,w,t,1);y("x","z","y",1,1,a,d,b,g,w,2);y("x","z","y",1,-1,a,d,-b,g,w,3);y("x","y","z",1,-1,a,b,d,g,t,4);y("x","y","z",-1,-1,a,b,-d,g,t,5);this.setIndex(new gb(T,1));this.addAttribute("position",
new gb(Q,3));this.addAttribute("normal",new gb(P,3));this.addAttribute("uv",new gb(Z,2))}function vc(a,b,d,g){qb.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:d,heightSegments:g};var t=a/2,w=b/2;d=Math.floor(d)||1;g=Math.floor(g)||1;var y=d+1,F=g+1,K=a/d,M=b/g;b=new Float32Array(y*F*3);a=new Float32Array(y*F*3);for(var T=new Float32Array(y*F*2),Q=0,P=0,Z=0;Z<F;Z++)for(var ca=Z*M-w,ja=0;ja<y;ja++)b[Q]=ja*K-t,b[Q+1]=-ca,a[Q+2]=1,T[P]=ja/d,T[P+1]=1-Z/g,Q+=
3,P+=2;Q=0;t=new (65535<b.length/3?Uint32Array:Uint16Array)(d*g*6);for(Z=0;Z<g;Z++)for(ja=0;ja<d;ja++)w=ja+y*(Z+1),F=ja+1+y*(Z+1),K=ja+1+y*Z,t[Q]=ja+y*Z,t[Q+1]=w,t[Q+2]=K,t[Q+3]=w,t[Q+4]=F,t[Q+5]=K,Q+=6;this.setIndex(new gb(t,1));this.addAttribute("position",new gb(b,3));this.addAttribute("normal",new gb(a,3));this.addAttribute("uv",new gb(T,2))}function ec(){jb.call(this);this.type="Camera";this.matrixWorldInverse=new z;this.projectionMatrix=new z}function hc(a,b,d,g){ec.call(this);this.type="PerspectiveCamera";
this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==d?d:.1;this.far=void 0!==g?g:2E3;this.focus=10;this.aspect=void 0!==b?b:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}function zc(a,b,d,g,t,w){ec.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=d;this.bottom=g;this.near=void 0!==t?t:.1;this.far=void 0!==w?w:2E3;this.updateProjectionMatrix()}function Qc(a,b,d){var g,t,w;return{setMode:function(y){g=y},
setIndex:function(y){y.array instanceof Uint32Array&&b.get("OES_element_index_uint")?(t=a.UNSIGNED_INT,w=4):(t=a.UNSIGNED_SHORT,w=2)},render:function(y,F){a.drawElements(g,F,t,y*w);d.calls++;d.vertices+=F;g===a.TRIANGLES&&(d.faces+=F/3)},renderInstances:function(y,F,K){var M=b.get("ANGLE_instanced_arrays");null===M?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(M.drawElementsInstancedANGLE(g,K,t,F*w,
y.maxInstancedCount),d.calls++,d.vertices+=K*y.maxInstancedCount,g===a.TRIANGLES&&(d.faces+=y.maxInstancedCount*K/3))}}}function Wc(a,b,d){var g;return{setMode:function(t){g=t},render:function(t,w){a.drawArrays(g,t,w);d.calls++;d.vertices+=w;g===a.TRIANGLES&&(d.faces+=w/3)},renderInstances:function(t){var w=b.get("ANGLE_instanced_arrays");if(null===w)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var y=
t.attributes.position;y=y&&y.isInterleavedBufferAttribute?y.data.count:y.count;w.drawArraysInstancedANGLE(g,0,y,t.maxInstancedCount);d.calls++;d.vertices+=y*t.maxInstancedCount;g===a.TRIANGLES&&(d.faces+=t.maxInstancedCount*y/3)}}}}function Pe(){var a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];switch(b.type){case "DirectionalLight":var d={direction:new r,color:new ma,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n};break;case "SpotLight":d={position:new r,direction:new r,
color:new ma,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n};break;case "PointLight":d={position:new r,color:new ma,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new n};break;case "HemisphereLight":d={direction:new r,skyColor:new ma,groundColor:new ma}}return a[b.id]=d}}}function Rc(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")}function Sc(a,b,d){var g=a.createShader(b);a.shaderSource(g,
d);a.compileShader(g);!1===a.getShaderParameter(g,a.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==a.getShaderInfoLog(g)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",b===a.VERTEX_SHADER?"vertex":"fragment",a.getShaderInfoLog(g),Rc(d));return g}function va(a){switch(a){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];
case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+a);}}function Ea(a,b){b=va(b);return"vec4 "+a+"( vec4 value ) { return "+b[0]+"ToLinear"+b[1]+"; }"}function Ra(a,b){b=va(b);return"vec4 "+a+"( vec4 value ) { return LinearTo"+b[0]+b[1]+"; }"}function Va(a,b){switch(b){case 1:b="Linear";break;case 2:b="Reinhard";break;case 3:b="Uncharted2";break;case 4:b="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+
b);}return"vec3 "+a+"( vec3 color ) { return "+b+"ToneMapping( color ); }"}function Ha(a,b,d){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||b.logarithmicDepthBuffer)&&d.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&d.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||b.envMap)&&d.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":
""].filter(Sa).join("\n")}function La(a){var b=[],d;for(d in a){var g=a[d];!1!==g&&b.push("#define "+d+" "+g)}return b.join("\n")}function Sa(a){return""!==a}function bb(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function Xa(a){return a.replace(/#include +<([\w\d.]+)>/g,function(b,d){b=Lb[d];if(void 0===b)throw Error("Can not resolve #include <"+d+">");
return Xa(b)})}function Qa(a){return a.replace(/for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(b,d,g,t){b="";for(d=parseInt(d);d<parseInt(g);d++)b+=t.replace(/\[ i \]/g,"[ "+d+" ]");return b})}function Ga(a,b,d,g){var t=a.context,w=d.extensions,y=d.defines,F=d.__webglShader.vertexShader,K=d.__webglShader.fragmentShader,M="SHADOWMAP_TYPE_BASIC";1===g.shadowMapType?M="SHADOWMAP_TYPE_PCF":2===g.shadowMapType&&(M="SHADOWMAP_TYPE_PCF_SOFT");var T="ENVMAP_TYPE_CUBE",Q="ENVMAP_MODE_REFLECTION",
P="ENVMAP_BLENDING_MULTIPLY";if(g.envMap){switch(d.envMap.mapping){case 301:case 302:T="ENVMAP_TYPE_CUBE";break;case 306:case 307:T="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:T="ENVMAP_TYPE_EQUIREC";break;case 305:T="ENVMAP_TYPE_SPHERE"}switch(d.envMap.mapping){case 302:case 304:Q="ENVMAP_MODE_REFRACTION"}switch(d.combine){case 0:P="ENVMAP_BLENDING_MULTIPLY";break;case 1:P="ENVMAP_BLENDING_MIX";break;case 2:P="ENVMAP_BLENDING_ADD"}}var Z=0<a.gammaFactor?a.gammaFactor:1;w=Ha(w,g,a.extensions);var ca=
La(y),ja=t.createProgram();d.isRawShaderMaterial?(y=[ca,"\n"].filter(Sa).join("\n"),M=[w,ca,"\n"].filter(Sa).join("\n")):(y=["precision "+g.precision+" float;","precision "+g.precision+" int;","#define SHADER_NAME "+d.__webglShader.name,ca,g.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+Z,"#define MAX_BONES "+g.maxBones,g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+Q:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":
"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.displacementMap&&g.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.vertexColors?"#define USE_COLOR":"",g.flatShading?"#define FLAT_SHADED":"",g.skinning?"#define USE_SKINNING":"",g.useVertexTexture?"#define BONE_TEXTURE":
"",g.morphTargets?"#define USE_MORPHTARGETS":"",g.morphNormals&&!1===g.flatShading?"#define USE_MORPHNORMALS":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+g.numClippingPlanes,g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+M:"",g.sizeAttenuation?"#define USE_SIZEATTENUATION":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":
"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;",
"\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Sa).join("\n"),M=[w,"precision "+g.precision+" float;","precision "+g.precision+" int;","#define SHADER_NAME "+d.__webglShader.name,
ca,g.alphaTest?"#define ALPHATEST "+g.alphaTest:"","#define GAMMA_FACTOR "+Z,g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+T:"",g.envMap?"#define "+Q:"",g.envMap?"#define "+P:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.specularMap?"#define USE_SPECULARMAP":
"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.vertexColors?"#define USE_COLOR":"",g.flatShading?"#define FLAT_SHADED":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+g.numClippingPlanes,g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+M:"",g.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",g.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":
"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",g.envMap&&a.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==g.toneMapping?"#define TONE_MAPPING":"",0!==g.toneMapping?Lb.tonemapping_pars_fragment:"",0!==g.toneMapping?Va("toneMapping",g.toneMapping):"",g.outputEncoding||g.mapEncoding||g.envMapEncoding||g.emissiveMapEncoding?
Lb.encodings_pars_fragment:"",g.mapEncoding?Ea("mapTexelToLinear",g.mapEncoding):"",g.envMapEncoding?Ea("envMapTexelToLinear",g.envMapEncoding):"",g.emissiveMapEncoding?Ea("emissiveMapTexelToLinear",g.emissiveMapEncoding):"",g.outputEncoding?Ra("linearToOutputTexel",g.outputEncoding):"",g.depthPacking?"#define DEPTH_PACKING "+d.depthPacking:"","\n"].filter(Sa).join("\n"));F=Xa(F,g);F=bb(F,g);K=Xa(K,g);K=bb(K,g);d.isShaderMaterial||(F=Qa(F),K=Qa(K));K=M+K;F=Sc(t,t.VERTEX_SHADER,y+F);K=Sc(t,t.FRAGMENT_SHADER,
K);t.attachShader(ja,F);t.attachShader(ja,K);void 0!==d.index0AttributeName?t.bindAttribLocation(ja,0,d.index0AttributeName):!0===g.morphTargets&&t.bindAttribLocation(ja,0,"position");t.linkProgram(ja);g=t.getProgramInfoLog(ja);T=t.getShaderInfoLog(F);Q=t.getShaderInfoLog(K);Z=P=!0;if(!1===t.getProgramParameter(ja,t.LINK_STATUS))P=!1,console.error("THREE.WebGLProgram: shader error: ",t.getError(),"gl.VALIDATE_STATUS",t.getProgramParameter(ja,t.VALIDATE_STATUS),"gl.getProgramInfoLog",g,T,Q);else if(""!==
g)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",g);else if(""===T||""===Q)Z=!1;Z&&(this.diagnostics={runnable:P,material:d,programLog:g,vertexShader:{log:T,prefix:y},fragmentShader:{log:Q,prefix:M}});t.deleteShader(F);t.deleteShader(K);var oa;this.getUniforms=function(){void 0===oa&&(oa=new pa(t,ja,a));return oa};var ra;this.getAttributes=function(){if(void 0===ra){for(var aa={},qa=t.getProgramParameter(ja,t.ACTIVE_ATTRIBUTES),na=0;na<qa;na++){var ua=t.getActiveAttrib(ja,na).name;aa[ua]=
t.getAttribLocation(ja,ua)}ra=aa}return ra};this.destroy=function(){t.deleteProgram(ja);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=lg++;this.code=b;this.usedTimes=1;this.program=ja;this.vertexShader=F;this.fragmentShader=K;return this}
function fb(a,b){function d(y,F){if(y)y&&y.isTexture?K=y.encoding:y&&y.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),K=y.texture.encoding);else var K=3E3;3E3===K&&F&&(K=3007);return K}var g=[],t={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",
LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},w="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking".split(" ");
this.getParameters=function(y,F,K,M,T){var Q=t[y.type];if(b.floatVertexTextures&&T&&T.skeleton&&T.skeleton.useVertexTexture)var P=1024;else P=Math.floor((b.maxVertexUniforms-20)/4),void 0!==T&&T&&T.isSkinnedMesh&&(P=Math.min(T.skeleton.bones.length,P),P<T.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+T.skeleton.bones.length+", this GPU supports just "+P+" (try OpenGL instead of ANGLE)"));var Z=a.getPrecision();null!==y.precision&&(Z=b.getMaxPrecision(y.precision),Z!==y.precision&&
console.warn("THREE.WebGLProgram.getParameters:",y.precision,"not supported, using",Z,"instead."));var ca=a.getCurrentRenderTarget();return{shaderID:Q,precision:Z,supportsVertexTextures:b.vertexTextures,outputEncoding:d(ca?ca.texture:null,a.gammaOutput),map:!!y.map,mapEncoding:d(y.map,a.gammaInput),envMap:!!y.envMap,envMapMode:y.envMap&&y.envMap.mapping,envMapEncoding:d(y.envMap,a.gammaInput),envMapCubeUV:!!y.envMap&&(306===y.envMap.mapping||307===y.envMap.mapping),lightMap:!!y.lightMap,aoMap:!!y.aoMap,
emissiveMap:!!y.emissiveMap,emissiveMapEncoding:d(y.emissiveMap,a.gammaInput),bumpMap:!!y.bumpMap,normalMap:!!y.normalMap,displacementMap:!!y.displacementMap,roughnessMap:!!y.roughnessMap,metalnessMap:!!y.metalnessMap,specularMap:!!y.specularMap,alphaMap:!!y.alphaMap,combine:y.combine,vertexColors:y.vertexColors,fog:!!K,useFog:y.fog,fogExp:K&&K.isFogExp2,flatShading:1===y.shading,sizeAttenuation:y.sizeAttenuation,logarithmicDepthBuffer:b.logarithmicDepthBuffer,skinning:y.skinning,maxBones:P,useVertexTexture:b.floatVertexTextures&&
T&&T.skeleton&&T.skeleton.useVertexTexture,morphTargets:y.morphTargets,morphNormals:y.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:F.directional.length,numPointLights:F.point.length,numSpotLights:F.spot.length,numHemiLights:F.hemi.length,numClippingPlanes:M,shadowMapEnabled:a.shadowMap.enabled&&T.receiveShadow&&0<F.shadows.length,shadowMapType:a.shadowMap.type,toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:y.premultipliedAlpha,
alphaTest:y.alphaTest,doubleSided:2===y.side,flipSided:1===y.side,depthPacking:void 0!==y.depthPacking?y.depthPacking:!1}};this.getProgramCode=function(y,F){var K=[];F.shaderID?K.push(F.shaderID):(K.push(y.fragmentShader),K.push(y.vertexShader));if(void 0!==y.defines)for(var M in y.defines)K.push(M),K.push(y.defines[M]);for(y=0;y<w.length;y++)K.push(F[w[y]]);return K.join()};this.acquireProgram=function(y,F,K){for(var M,T=0,Q=g.length;T<Q;T++){var P=g[T];if(P.code===K){M=P;++M.usedTimes;break}}void 0===
M&&(M=new Ga(a,K,y,F),g.push(M));return M};this.releaseProgram=function(y){if(0===--y.usedTimes){var F=g.indexOf(y);g[F]=g[g.length-1];g.pop();y.destroy()}};this.programs=g}function cb(a,b,d){function g(y){var F=y.target;y=w[F.id];null!==y.index&&t(y.index);var K=y.attributes;for(M in K)t(K[M]);F.removeEventListener("dispose",g);delete w[F.id];var M=b.get(F);M.wireframe&&t(M.wireframe);b.delete(F);F=b.get(y);F.wireframe&&t(F.wireframe);b.delete(y);d.memory.geometries--}function t(y){var F=y.isInterleavedBufferAttribute?
b.get(y.data).__webglBuffer:b.get(y).__webglBuffer;void 0!==F&&(a.deleteBuffer(F),y.isInterleavedBufferAttribute?b.delete(y.data):b.delete(y))}var w={};return{get:function(y){var F=y.geometry;if(void 0!==w[F.id])return w[F.id];F.addEventListener("dispose",g);if(F.isBufferGeometry)var K=F;else F.isGeometry&&(void 0===F._bufferGeometry&&(F._bufferGeometry=(new qb).setFromObject(y)),K=F._bufferGeometry);w[F.id]=K;d.memory.geometries++;return K}}}function zb(a,b,d){function g(w,y){w=w.isInterleavedBufferAttribute?
w.data:w;var F=b.get(w);void 0===F.__webglBuffer?(F.__webglBuffer=a.createBuffer(),a.bindBuffer(y,F.__webglBuffer),a.bufferData(y,w.array,w.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW),F.version=w.version):F.version!==w.version&&(a.bindBuffer(y,F.__webglBuffer),!1===w.dynamic||-1===w.updateRange.count?a.bufferSubData(y,0,w.array):0===w.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):
(a.bufferSubData(y,w.updateRange.offset*w.array.BYTES_PER_ELEMENT,w.array.subarray(w.updateRange.offset,w.updateRange.offset+w.updateRange.count)),w.updateRange.count=0),F.version=w.version)}var t=new cb(a,b,d);return{getAttributeBuffer:function(w){return w.isInterleavedBufferAttribute?b.get(w.data).__webglBuffer:b.get(w).__webglBuffer},getWireframeAttribute:function(w){var y=b.get(w);if(void 0!==y.wireframe)return y.wireframe;var F=[],K=w.index,M=w.attributes;w=M.position;if(null!==K){K=K.array;
M=0;for(var T=K.length;M<T;M+=3){var Q=K[M+0],P=K[M+1],Z=K[M+2];F.push(Q,P,P,Z,Z,Q)}}else for(K=M.position.array,M=0,T=K.length/3-1;M<T;M+=3)Q=M+0,P=M+1,Z=M+2,F.push(Q,P,P,Z,Z,Q);F=new gb(new (65535<w.count?Uint32Array:Uint16Array)(F),1);g(F,a.ELEMENT_ARRAY_BUFFER);return y.wireframe=F},update:function(w){var y=t.get(w);w.geometry.isGeometry&&y.updateFromObject(w);w=y.index;var F=y.attributes;null!==w&&g(w,a.ELEMENT_ARRAY_BUFFER);for(var K in F)g(F[K],a.ARRAY_BUFFER);w=y.morphAttributes;for(K in w){F=
w[K];for(var M=0,T=F.length;M<T;M++)g(F[M],a.ARRAY_BUFFER)}return y}}}function Bb(a,b,d,g,t,w,y){function F(aa,qa){if(aa.width>qa||aa.height>qa){qa/=Math.max(aa.width,aa.height);var na=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");na.width=Math.floor(aa.width*qa);na.height=Math.floor(aa.height*qa);na.getContext("2d").drawImage(aa,0,0,aa.width,aa.height,0,0,na.width,na.height);console.warn("THREE.WebGLRenderer: image is too big ("+aa.width+"x"+aa.height+"). Resized to "+na.width+
"x"+na.height,aa);return na}return aa}function K(aa){return c.Math.isPowerOfTwo(aa.width)&&c.Math.isPowerOfTwo(aa.height)}function M(aa){return 1003===aa||1004===aa||1005===aa?a.NEAREST:a.LINEAR}function T(aa){aa=aa.target;aa.removeEventListener("dispose",T);a:{var qa=g.get(aa);if(aa.image&&qa.__image__webglTextureCube)a.deleteTexture(qa.__image__webglTextureCube);else{if(void 0===qa.__webglInit)break a;a.deleteTexture(qa.__webglTexture)}g.delete(aa)}oa.textures--}function Q(aa){aa=aa.target;aa.removeEventListener("dispose",
Q);var qa=g.get(aa),na=g.get(aa.texture);if(aa){void 0!==na.__webglTexture&&a.deleteTexture(na.__webglTexture);aa.depthTexture&&aa.depthTexture.dispose();if(aa&&aa.isWebGLRenderTargetCube)for(na=0;6>na;na++)a.deleteFramebuffer(qa.__webglFramebuffer[na]),qa.__webglDepthbuffer&&a.deleteRenderbuffer(qa.__webglDepthbuffer[na]);else a.deleteFramebuffer(qa.__webglFramebuffer),qa.__webglDepthbuffer&&a.deleteRenderbuffer(qa.__webglDepthbuffer);g.delete(aa.texture);g.delete(aa)}oa.textures--}function P(aa,
qa){var na=g.get(aa);if(0<aa.version&&na.__version!==aa.version){var ua=aa.image;if(void 0===ua)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",aa);else if(!1===ua.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",aa);else{void 0===na.__webglInit&&(na.__webglInit=!0,aa.addEventListener("dispose",T),na.__webglTexture=a.createTexture(),oa.textures++);d.activeTexture(a.TEXTURE0+qa);d.bindTexture(a.TEXTURE_2D,na.__webglTexture);
a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,aa.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,aa.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,aa.unpackAlignment);var ta=F(aa.image,t.maxTextureSize);(1001!==aa.wrapS||1001!==aa.wrapT||1003!==aa.minFilter&&1006!==aa.minFilter)&&!1===K(ta)&&(qa=ta,qa instanceof HTMLImageElement||qa instanceof HTMLCanvasElement?(ua=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),ua.width=c.Math.nearestPowerOfTwo(qa.width),ua.height=c.Math.nearestPowerOfTwo(qa.height),
ua.getContext("2d").drawImage(qa,0,0,ua.width,ua.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+qa.width+"x"+qa.height+"). Resized to "+ua.width+"x"+ua.height,qa),ta=ua):ta=qa);qa=K(ta);ua=w(aa.format);var Aa=w(aa.type);Z(a.TEXTURE_2D,aa,qa);var Ka=aa.mipmaps;if(aa&&aa.isDepthTexture){Ka=a.DEPTH_COMPONENT;if(1015===aa.type){if(!ra)throw Error("Float Depth Texture only supported in WebGL2.0");Ka=a.DEPTH_COMPONENT32F}else ra&&(Ka=a.DEPTH_COMPONENT16);1027===aa.format&&(Ka=a.DEPTH_STENCIL);
d.texImage2D(a.TEXTURE_2D,0,Ka,ta.width,ta.height,0,ua,Aa,null)}else if(aa&&aa.isDataTexture)if(0<Ka.length&&qa){for(var Ia=0,Oa=Ka.length;Ia<Oa;Ia++)ta=Ka[Ia],d.texImage2D(a.TEXTURE_2D,Ia,ua,ta.width,ta.height,0,ua,Aa,ta.data);aa.generateMipmaps=!1}else d.texImage2D(a.TEXTURE_2D,0,ua,ta.width,ta.height,0,ua,Aa,ta.data);else if(aa&&aa.isCompressedTexture)for(Ia=0,Oa=Ka.length;Ia<Oa;Ia++)ta=Ka[Ia],1023!==aa.format&&1022!==aa.format?-1<d.getCompressedTextureFormats().indexOf(ua)?d.compressedTexImage2D(a.TEXTURE_2D,
Ia,ua,ta.width,ta.height,0,ta.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):d.texImage2D(a.TEXTURE_2D,Ia,ua,ta.width,ta.height,0,ua,Aa,ta.data);else if(0<Ka.length&&qa){Ia=0;for(Oa=Ka.length;Ia<Oa;Ia++)ta=Ka[Ia],d.texImage2D(a.TEXTURE_2D,Ia,ua,ua,Aa,ta);aa.generateMipmaps=!1}else d.texImage2D(a.TEXTURE_2D,0,ua,ua,Aa,ta);aa.generateMipmaps&&qa&&a.generateMipmap(a.TEXTURE_2D);na.__version=aa.version;if(aa.onUpdate)aa.onUpdate(aa);
return}}d.activeTexture(a.TEXTURE0+qa);d.bindTexture(a.TEXTURE_2D,na.__webglTexture)}function Z(aa,qa,na){na?(a.texParameteri(aa,a.TEXTURE_WRAP_S,w(qa.wrapS)),a.texParameteri(aa,a.TEXTURE_WRAP_T,w(qa.wrapT)),a.texParameteri(aa,a.TEXTURE_MAG_FILTER,w(qa.magFilter)),a.texParameteri(aa,a.TEXTURE_MIN_FILTER,w(qa.minFilter))):(a.texParameteri(aa,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(aa,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),1001===qa.wrapS&&1001===qa.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",
qa),a.texParameteri(aa,a.TEXTURE_MAG_FILTER,M(qa.magFilter)),a.texParameteri(aa,a.TEXTURE_MIN_FILTER,M(qa.minFilter)),1003!==qa.minFilter&&1006!==qa.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",qa));!(na=b.get("EXT_texture_filter_anisotropic"))||1015===qa.type&&null===b.get("OES_texture_float_linear")||1016===qa.type&&null===b.get("OES_texture_half_float_linear")||!(1<qa.anisotropy||g.get(qa).__currentAnisotropy)||
(a.texParameterf(aa,na.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(qa.anisotropy,t.getMaxAnisotropy())),g.get(qa).__currentAnisotropy=qa.anisotropy)}function ca(aa,qa,na,ua){var ta=w(qa.texture.format),Aa=w(qa.texture.type);d.texImage2D(ua,0,ta,qa.width,qa.height,0,ta,Aa,null);a.bindFramebuffer(a.FRAMEBUFFER,aa);a.framebufferTexture2D(a.FRAMEBUFFER,na,ua,g.get(qa.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function ja(aa,qa){a.bindRenderbuffer(a.RENDERBUFFER,aa);qa.depthBuffer&&!qa.stencilBuffer?
(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,qa.width,qa.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,aa)):qa.depthBuffer&&qa.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,qa.width,qa.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,aa)):a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,qa.width,qa.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var oa=y.memory,ra="undefined"!==typeof WebGL2RenderingContext&&
a instanceof WebGL2RenderingContext;this.setTexture2D=P;this.setTextureCube=function(aa,qa){var na=g.get(aa);if(6===aa.image.length)if(0<aa.version&&na.__version!==aa.version){na.__image__webglTextureCube||(aa.addEventListener("dispose",T),na.__image__webglTextureCube=a.createTexture(),oa.textures++);d.activeTexture(a.TEXTURE0+qa);d.bindTexture(a.TEXTURE_CUBE_MAP,na.__image__webglTextureCube);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,aa.flipY);qa=aa&&aa.isCompressedTexture;for(var ua=aa.image[0]&&aa.image[0].isDataTexture,
ta=[],Aa=0;6>Aa;Aa++)ta[Aa]=qa||ua?ua?aa.image[Aa].image:aa.image[Aa]:F(aa.image[Aa],t.maxCubemapSize);var Ka=K(ta[0]),Ia=w(aa.format),Oa=w(aa.type);Z(a.TEXTURE_CUBE_MAP,aa,Ka);for(Aa=0;6>Aa;Aa++)if(qa)for(var Ta,Na=ta[Aa].mipmaps,Ua=0,ab=Na.length;Ua<ab;Ua++)Ta=Na[Ua],1023!==aa.format&&1022!==aa.format?-1<d.getCompressedTextureFormats().indexOf(Ia)?d.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+Aa,Ua,Ia,Ta.width,Ta.height,0,Ta.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):
d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+Aa,Ua,Ia,Ta.width,Ta.height,0,Ia,Oa,Ta.data);else ua?d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+Aa,0,Ia,ta[Aa].width,ta[Aa].height,0,Ia,Oa,ta[Aa].data):d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+Aa,0,Ia,Ia,Oa,ta[Aa]);aa.generateMipmaps&&Ka&&a.generateMipmap(a.TEXTURE_CUBE_MAP);na.__version=aa.version;if(aa.onUpdate)aa.onUpdate(aa)}else d.activeTexture(a.TEXTURE0+qa),d.bindTexture(a.TEXTURE_CUBE_MAP,na.__image__webglTextureCube)};this.setTextureCubeDynamic=
function(aa,qa){d.activeTexture(a.TEXTURE0+qa);d.bindTexture(a.TEXTURE_CUBE_MAP,g.get(aa).__webglTexture)};this.setupRenderTarget=function(aa){var qa=g.get(aa),na=g.get(aa.texture);aa.addEventListener("dispose",Q);na.__webglTexture=a.createTexture();oa.textures++;var ua=aa&&aa.isWebGLRenderTargetCube,ta=K(aa);if(ua){qa.__webglFramebuffer=[];for(var Aa=0;6>Aa;Aa++)qa.__webglFramebuffer[Aa]=a.createFramebuffer()}else qa.__webglFramebuffer=a.createFramebuffer();if(ua){d.bindTexture(a.TEXTURE_CUBE_MAP,
na.__webglTexture);Z(a.TEXTURE_CUBE_MAP,aa.texture,ta);for(Aa=0;6>Aa;Aa++)ca(qa.__webglFramebuffer[Aa],aa,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+Aa);aa.texture.generateMipmaps&&ta&&a.generateMipmap(a.TEXTURE_CUBE_MAP);d.bindTexture(a.TEXTURE_CUBE_MAP,null)}else d.bindTexture(a.TEXTURE_2D,na.__webglTexture),Z(a.TEXTURE_2D,aa.texture,ta),ca(qa.__webglFramebuffer,aa,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),aa.texture.generateMipmaps&&ta&&a.generateMipmap(a.TEXTURE_2D),d.bindTexture(a.TEXTURE_2D,
null);if(aa.depthBuffer){qa=g.get(aa);na=aa&&aa.isWebGLRenderTargetCube;if(aa.depthTexture){if(na)throw Error("target.depthTexture not supported in Cube render targets");if(aa&&aa.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");a.bindFramebuffer(a.FRAMEBUFFER,qa.__webglFramebuffer);if(!aa.depthTexture||!aa.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");g.get(aa.depthTexture).__webglTexture&&
aa.depthTexture.image.width===aa.width&&aa.depthTexture.image.height===aa.height||(aa.depthTexture.image.width=aa.width,aa.depthTexture.image.height=aa.height,aa.depthTexture.needsUpdate=!0);P(aa.depthTexture,0);qa=g.get(aa.depthTexture).__webglTexture;if(1026===aa.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,qa,0);else if(1027===aa.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,qa,0);else throw Error("Unknown depthTexture format");
}else if(na)for(qa.__webglDepthbuffer=[],na=0;6>na;na++)a.bindFramebuffer(a.FRAMEBUFFER,qa.__webglFramebuffer[na]),qa.__webglDepthbuffer[na]=a.createRenderbuffer(),ja(qa.__webglDepthbuffer[na],aa);else a.bindFramebuffer(a.FRAMEBUFFER,qa.__webglFramebuffer),qa.__webglDepthbuffer=a.createRenderbuffer(),ja(qa.__webglDepthbuffer,aa);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(aa){var qa=aa.texture;qa.generateMipmaps&&K(aa)&&1003!==qa.minFilter&&1006!==qa.minFilter&&
(aa=aa&&aa.isWebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,qa=g.get(qa).__webglTexture,d.bindTexture(aa,qa),a.generateMipmap(aa),d.bindTexture(aa,null))}}function Ob(){var a={};return{get:function(b){b=b.uuid;var d=a[b];void 0===d&&(d={},a[b]=d);return d},delete:function(b){delete a[b.uuid]},clear:function(){a={}}}}function Sb(a,b,d){function g(Ba,db,hb){var vb=new Uint8Array(4),lb=a.createTexture();a.bindTexture(Ba,lb);a.texParameteri(Ba,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(Ba,
a.TEXTURE_MAG_FILTER,a.NEAREST);for(Ba=0;Ba<hb;Ba++)a.texImage2D(db+Ba,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,vb);return lb}function t(Ba){!0!==ua[Ba]&&(a.enable(Ba),ua[Ba]=!0)}function w(Ba){!1!==ua[Ba]&&(a.disable(Ba),ua[Ba]=!1)}function y(Ba,db,hb,vb,lb,Ib,Jb,lc){if(0!==Ba){t(a.BLEND);if(Ba!==Aa||lc!==ab)2===Ba?lc?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):3===Ba?lc?(a.blendEquationSeparate(a.FUNC_ADD,
a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):4===Ba?lc?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):lc?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,
a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),Aa=Ba,ab=lc;if(5===Ba){lb=lb||db;Ib=Ib||hb;Jb=Jb||vb;if(db!==Ka||lb!==Ta)a.blendEquationSeparate(d(db),d(lb)),Ka=db,Ta=lb;if(hb!==Ia||vb!==Oa||Ib!==Na||Jb!==Ua)a.blendFuncSeparate(d(hb),d(vb),d(Ib),d(Jb)),Ia=hb,Oa=vb,Na=Ib,Ua=Jb}else Ua=Na=Ta=Oa=Ia=Ka=null}else w(a.BLEND),Aa=Ba}function F(Ba){ja.setFunc(Ba)}function K(Ba){Pa!==Ba&&(Ba?a.frontFace(a.CW):a.frontFace(a.CCW),Pa=Ba)}function M(Ba){0!==Ba?(t(a.CULL_FACE),
Ba!==Ma&&(1===Ba?a.cullFace(a.BACK):2===Ba?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):w(a.CULL_FACE);Ma=Ba}function T(Ba){void 0===Ba&&(Ba=a.TEXTURE0+tb-1);ub!==Ba&&(a.activeTexture(Ba),ub=Ba)}function Q(Ba,db,hb,vb){ca.setClear(Ba,db,hb,vb)}function P(Ba){ja.setClear(Ba)}function Z(Ba){oa.setClear(Ba)}var ca=new function(){var Ba=!1,db=new q,hb=null,vb=new q;return{setMask:function(lb){hb===lb||Ba||(a.colorMask(lb,lb,lb,lb),hb=lb)},setLocked:function(lb){Ba=lb},setClear:function(lb,Ib,Jb,
lc){db.set(lb,Ib,Jb,lc);!1===vb.equals(db)&&(a.clearColor(lb,Ib,Jb,lc),vb.copy(db))},reset:function(){Ba=!1;hb=null;vb.set(0,0,0,1)}}},ja=new function(){var Ba=!1,db=null,hb=null,vb=null;return{setTest:function(lb){lb?t(a.DEPTH_TEST):w(a.DEPTH_TEST)},setMask:function(lb){db===lb||Ba||(a.depthMask(lb),db=lb)},setFunc:function(lb){if(hb!==lb){if(lb)switch(lb){case 0:a.depthFunc(a.NEVER);break;case 1:a.depthFunc(a.ALWAYS);break;case 2:a.depthFunc(a.LESS);break;case 3:a.depthFunc(a.LEQUAL);break;case 4:a.depthFunc(a.EQUAL);
break;case 5:a.depthFunc(a.GEQUAL);break;case 6:a.depthFunc(a.GREATER);break;case 7:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);hb=lb}},setLocked:function(lb){Ba=lb},setClear:function(lb){vb!==lb&&(a.clearDepth(lb),vb=lb)},reset:function(){Ba=!1;vb=hb=db=null}}},oa=new function(){var Ba=!1,db=null,hb=null,vb=null,lb=null,Ib=null,Jb=null,lc=null,Bd=null;return{setTest:function(Tb){Tb?t(a.STENCIL_TEST):w(a.STENCIL_TEST)},setMask:function(Tb){db===Tb||Ba||(a.stencilMask(Tb),
db=Tb)},setFunc:function(Tb,Kc,mc){if(hb!==Tb||vb!==Kc||lb!==mc)a.stencilFunc(Tb,Kc,mc),hb=Tb,vb=Kc,lb=mc},setOp:function(Tb,Kc,mc){if(Ib!==Tb||Jb!==Kc||lc!==mc)a.stencilOp(Tb,Kc,mc),Ib=Tb,Jb=Kc,lc=mc},setLocked:function(Tb){Ba=Tb},setClear:function(Tb){Bd!==Tb&&(a.clearStencil(Tb),Bd=Tb)},reset:function(){Ba=!1;Bd=lc=Jb=Ib=lb=vb=hb=db=null}}},ra=a.getParameter(a.MAX_VERTEX_ATTRIBS),aa=new Uint8Array(ra),qa=new Uint8Array(ra),na=new Uint8Array(ra),ua={},ta=null,Aa=null,Ka=null,Ia=null,Oa=null,Ta=
null,Na=null,Ua=null,ab=!1,Pa=null,Ma=null,Wa=null,Ja=null,eb=null,Za=null,tb=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),ub=null,Db={},mb=new q,Hb=new q,Kb={};Kb[a.TEXTURE_2D]=g(a.TEXTURE_2D,a.TEXTURE_2D,1);Kb[a.TEXTURE_CUBE_MAP]=g(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);return{buffers:{color:ca,depth:ja,stencil:oa},init:function(){Q(0,0,0,1);P(1);Z(0);t(a.DEPTH_TEST);F(3);K(!1);M(1);t(a.CULL_FACE);t(a.BLEND);y(1)},initAttributes:function(){for(var Ba=0,db=aa.length;Ba<db;Ba++)aa[Ba]=0},
enableAttribute:function(Ba){aa[Ba]=1;0===qa[Ba]&&(a.enableVertexAttribArray(Ba),qa[Ba]=1);0!==na[Ba]&&(b.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Ba,0),na[Ba]=0)},enableAttributeAndDivisor:function(Ba,db,hb){aa[Ba]=1;0===qa[Ba]&&(a.enableVertexAttribArray(Ba),qa[Ba]=1);na[Ba]!==db&&(hb.vertexAttribDivisorANGLE(Ba,db),na[Ba]=db)},disableUnusedAttributes:function(){for(var Ba=0,db=qa.length;Ba!==db;++Ba)qa[Ba]!==aa[Ba]&&(a.disableVertexAttribArray(Ba),qa[Ba]=0)},enable:t,disable:w,getCompressedTextureFormats:function(){if(null===
ta&&(ta=[],b.get("WEBGL_compressed_texture_pvrtc")||b.get("WEBGL_compressed_texture_s3tc")||b.get("WEBGL_compressed_texture_etc1")))for(var Ba=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),db=0;db<Ba.length;db++)ta.push(Ba[db]);return ta},setBlending:y,setColorWrite:function(Ba){ca.setMask(Ba)},setDepthTest:function(Ba){ja.setTest(Ba)},setDepthWrite:function(Ba){ja.setMask(Ba)},setDepthFunc:F,setStencilTest:function(Ba){oa.setTest(Ba)},setStencilWrite:function(Ba){oa.setMask(Ba)},setStencilFunc:function(Ba,
db,hb){oa.setFunc(Ba,db,hb)},setStencilOp:function(Ba,db,hb){oa.setOp(Ba,db,hb)},setFlipSided:K,setCullFace:M,setLineWidth:function(Ba){Ba!==Wa&&(a.lineWidth(Ba),Wa=Ba)},setPolygonOffset:function(Ba,db,hb){if(Ba){if(t(a.POLYGON_OFFSET_FILL),Ja!==db||eb!==hb)a.polygonOffset(db,hb),Ja=db,eb=hb}else w(a.POLYGON_OFFSET_FILL)},getScissorTest:function(){return Za},setScissorTest:function(Ba){(Za=Ba)?t(a.SCISSOR_TEST):w(a.SCISSOR_TEST)},activeTexture:T,bindTexture:function(Ba,db){null===ub&&T();var hb=Db[ub];
void 0===hb&&(hb={type:void 0,texture:void 0},Db[ub]=hb);if(hb.type!==Ba||hb.texture!==db)a.bindTexture(Ba,db||Kb[Ba]),hb.type=Ba,hb.texture=db},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(Ba){console.error(Ba)}},texImage2D:function(){try{a.texImage2D.apply(a,arguments)}catch(Ba){console.error(Ba)}},clearColor:Q,clearDepth:P,clearStencil:Z,scissor:function(Ba){!1===mb.equals(Ba)&&(a.scissor(Ba.x,Ba.y,Ba.z,Ba.w),mb.copy(Ba))},viewport:function(Ba){!1===Hb.equals(Ba)&&
(a.viewport(Ba.x,Ba.y,Ba.z,Ba.w),Hb.copy(Ba))},reset:function(){for(var Ba=0;Ba<qa.length;Ba++)1===qa[Ba]&&(a.disableVertexAttribArray(Ba),qa[Ba]=0);ua={};ub=ta=null;Db={};Ma=Pa=Aa=null;ca.reset();ja.reset();oa.reset()}}}function Ub(a,b,d){function g(oa){if("highp"===oa){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";oa="mediump"}return"mediump"===oa&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,
a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}var t,w=void 0!==d.precision?d.precision:"highp",y=g(w);y!==w&&(console.warn("THREE.WebGLRenderer:",w,"not supported, using",y,"instead."),w=y);d=!0===d.logarithmicDepthBuffer&&!!b.get("EXT_frag_depth");y=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);var F=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),K=a.getParameter(a.MAX_TEXTURE_SIZE),M=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),
T=a.getParameter(a.MAX_VERTEX_ATTRIBS),Q=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),P=a.getParameter(a.MAX_VARYING_VECTORS),Z=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),ca=0<F,ja=!!b.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==t)return t;var oa=b.get("EXT_texture_filter_anisotropic");return t=null!==oa?a.getParameter(oa.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:g,precision:w,logarithmicDepthBuffer:d,maxTextures:y,maxVertexTextures:F,maxTextureSize:K,maxCubemapSize:M,
maxAttributes:T,maxVertexUniforms:Q,maxVaryings:P,maxFragmentUniforms:Z,vertexTextures:ca,floatFragmentTextures:ja,floatVertexTextures:ca&&ja}}function kb(a){var b={};return{get:function(d){if(void 0!==b[d])return b[d];switch(d){case "WEBGL_depth_texture":var g=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case "EXT_texture_filter_anisotropic":g=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||
a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":g=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":g=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":g=a.getExtension("WEBGL_compressed_texture_etc1");
break;default:g=a.getExtension(d)}null===g&&console.warn("THREE.WebGLRenderer: "+d+" extension not supported.");return b[d]=g}}}function Zb(){function a(){M.value!==g&&(M.value=g,M.needsUpdate=0<t);d.numPlanes=t}function b(T,Q,P,Z){var ca=null!==T?T.length:0,ja=null;if(0!==ca){ja=M.value;if(!0!==Z||null===ja){Z=P+4*ca;Q=Q.matrixWorldInverse;K.getNormalMatrix(Q);if(null===ja||ja.length<Z)ja=new Float32Array(Z);for(Z=0;Z!==ca;++Z,P+=4)F.copy(T[Z]).applyMatrix4(Q,K),F.normal.toArray(ja,P),ja[P+3]=F.constant}M.value=
ja;M.needsUpdate=!0}d.numPlanes=ca;return ja}var d=this,g=null,t=0,w=!1,y=!1,F=new Nb,K=new Mb,M={value:null,needsUpdate:!1};this.uniform=M;this.numPlanes=0;this.init=function(T,Q,P){var Z=0!==T.length||Q||0!==t||w;w=Q;g=b(T,P,0);t=T.length;return Z};this.beginShadows=function(){y=!0;b(null)};this.endShadows=function(){y=!1;a()};this.setState=function(T,Q,P,Z,ca){if(!w||null===T||0===T.length||y&&!Q)y?b(null):a();else{Q=y?0:t;var ja=4*Q,oa=Z.clippingState||null;M.value=oa;oa=b(T,P,ja,ca);for(T=0;T!==
ja;++T)oa[T]=g[T];Z.clippingState=oa;this.numPlanes+=Q}}}function cc(a){function b(ia,xa,sa,$a){!0===Ka&&(ia*=$a,xa*=$a,sa*=$a);yb.clearColor(ia,xa,sa,$a)}function d(){yb.init();yb.scissor(Hb.copy(lc).multiplyScalar(Jb));yb.viewport(Ba.copy(Tb).multiplyScalar(Jb));b(hb.r,hb.g,hb.b,vb)}function g(){mb=eb=null;Db="";ub=-1;yb.reset()}function t(ia){ia.preventDefault();g();d();Ac.clear()}function w(ia){ia=ia.target;ia.removeEventListener("dispose",w);y(ia);Ac.delete(ia)}function y(ia){var xa=Ac.get(ia).program;
ia.program=void 0;void 0!==xa&&de.releaseProgram(xa)}function F(ia,xa){return Math.abs(xa[0])-Math.abs(ia[0])}function K(ia,xa){return ia.object.renderOrder!==xa.object.renderOrder?ia.object.renderOrder-xa.object.renderOrder:ia.material.program&&xa.material.program&&ia.material.program!==xa.material.program?ia.material.program.id-xa.material.program.id:ia.material.id!==xa.material.id?ia.material.id-xa.material.id:ia.z!==xa.z?ia.z-xa.z:ia.id-xa.id}function M(ia,xa){return ia.object.renderOrder!==xa.object.renderOrder?
ia.object.renderOrder-xa.object.renderOrder:ia.z!==xa.z?xa.z-ia.z:ia.id-xa.id}function T(ia,xa,sa,$a,ib){if(sa.transparent){$a=Ua;var sb=++ab}else $a=Ta,sb=++Na;sb=$a[sb];void 0!==sb?(sb.id=ia.id,sb.object=ia,sb.geometry=xa,sb.material=sa,sb.z=pc.z,sb.group=ib):(sb={id:ia.id,object:ia,geometry:xa,material:sa,z:pc.z,group:ib},$a.push(sb))}function Q(ia){if(!Kc.intersectsSphere(ia))return!1;var xa=mc.numPlanes;if(0===xa)return!0;var sa=Ja.clippingPlanes,$a=ia.center;ia=-ia.radius;var ib=0;do if(sa[ib].distanceToPoint($a)<
ia)return!1;while(++ib!==xa);return!0}function P(ia,xa){if(!1!==ia.visible){if(0!==(ia.layers.mask&xa.layers.mask))if(ia.isLight)Oa.push(ia);else if(ia.isSprite){var sa;(sa=!1===ia.frustumCulled)||(Cd.center.set(0,0,0),Cd.radius=.7071067811865476,Cd.applyMatrix4(ia.matrixWorld),sa=!0===Q(Cd));sa&&Ma.push(ia)}else if(ia.isLensFlare)Wa.push(ia);else if(ia.isImmediateRenderObject)!0===Ja.sortObjects&&(pc.setFromMatrixPosition(ia.matrixWorld),pc.applyProjection(Qe)),T(ia,null,ia.material,pc.z,null);else if(ia.isMesh||
ia.isLine||ia.isPoints)if(ia.isSkinnedMesh&&ia.skeleton.update(),(sa=!1===ia.frustumCulled)||(sa=ia.geometry,null===sa.boundingSphere&&sa.computeBoundingSphere(),Cd.copy(sa.boundingSphere).applyMatrix4(ia.matrixWorld),sa=!0===Q(Cd)),sa){var $a=ia.material;if(!0===$a.visible)if(!0===Ja.sortObjects&&(pc.setFromMatrixPosition(ia.matrixWorld),pc.applyProjection(Qe)),sa=cd.update(ia),$a.isMultiMaterial){var ib=sa.groups,sb=$a.materials;$a=0;for(var Ya=ib.length;$a<Ya;$a++){var Da=ib[$a],wb=sb[Da.materialIndex];
!0===wb.visible&&T(ia,sa,wb,pc.z,Da)}}else T(ia,sa,$a,pc.z,null)}ia=ia.children;$a=0;for(Ya=ia.length;$a<Ya;$a++)P(ia[$a],xa)}}function Z(ia,xa,sa,$a){for(var ib=0,sb=ia.length;ib<sb;ib++){var Ya=ia[ib],Da=Ya.object,wb=Ya.geometry,Gb=void 0===$a?Ya.material:$a;Ya=Ya.group;Da.modelViewMatrix.multiplyMatrices(sa.matrixWorldInverse,Da.matrixWorld);Da.normalMatrix.getNormalMatrix(Da.modelViewMatrix);Da.onBeforeRender(Ja,xa,sa,wb,Gb,Ya);if(Da.isImmediateRenderObject){ca(Gb);var Xb=ja(sa,xa.fog,Gb,Da);
Db="";Da.render(function(Fb){Ja.renderBufferImmediate(Fb,Xb,Gb)})}else Ja.renderBufferDirect(sa,xa.fog,wb,Gb,Da,Ya);Da.onAfterRender(Ja,xa,sa,wb,Gb,Ya)}}function ca(ia){2===ia.side?yb.disable(Fa.CULL_FACE):yb.enable(Fa.CULL_FACE);yb.setFlipSided(1===ia.side);!0===ia.transparent?yb.setBlending(ia.blending,ia.blendEquation,ia.blendSrc,ia.blendDst,ia.blendEquationAlpha,ia.blendSrcAlpha,ia.blendDstAlpha,ia.premultipliedAlpha):yb.setBlending(0);yb.setDepthFunc(ia.depthFunc);yb.setDepthTest(ia.depthTest);
yb.setDepthWrite(ia.depthWrite);yb.setColorWrite(ia.colorWrite);yb.setPolygonOffset(ia.polygonOffset,ia.polygonOffsetFactor,ia.polygonOffsetUnits)}function ja(ia,xa,sa,$a){db=0;var ib=Ac.get(sa);Re&&(uf||ia!==mb)&&mc.setState(sa.clippingPlanes,sa.clipShadows,ia,ib,ia===mb&&sa.id===ub);!1===sa.needsUpdate&&(void 0===ib.program?sa.needsUpdate=!0:sa.fog&&ib.fog!==xa?sa.needsUpdate=!0:sa.lights&&ib.lightsHash!==Cb.hash?sa.needsUpdate=!0:void 0!==ib.numClippingPlanes&&ib.numClippingPlanes!==mc.numPlanes&&
(sa.needsUpdate=!0));if(sa.needsUpdate){a:{var sb=Ac.get(sa),Ya=de.getParameters(sa,Cb,xa,mc.numPlanes,$a),Da=de.getProgramCode(sa,Ya),wb=sb.program,Gb=!0;if(void 0===wb)sa.addEventListener("dispose",w);else if(wb.code!==Da)y(sa);else if(void 0!==Ya.shaderID)break a;else Gb=!1;Gb&&(Ya.shaderID?(wb=zd[Ya.shaderID],sb.__webglShader={name:sa.type,uniforms:c.UniformsUtils.clone(wb.uniforms),vertexShader:wb.vertexShader,fragmentShader:wb.fragmentShader}):sb.__webglShader={name:sa.type,uniforms:sa.uniforms,
vertexShader:sa.vertexShader,fragmentShader:sa.fragmentShader},sa.__webglShader=sb.__webglShader,wb=de.acquireProgram(sa,Ya,Da),sb.program=wb,sa.program=wb);Ya=wb.getAttributes();if(sa.morphTargets)for(Da=sa.numSupportedMorphTargets=0;Da<Ja.maxMorphTargets;Da++)0<=Ya["morphTarget"+Da]&&sa.numSupportedMorphTargets++;if(sa.morphNormals)for(Da=sa.numSupportedMorphNormals=0;Da<Ja.maxMorphNormals;Da++)0<=Ya["morphNormal"+Da]&&sa.numSupportedMorphNormals++;Ya=sb.__webglShader.uniforms;if(!sa.isShaderMaterial&&
!sa.isRawShaderMaterial||!0===sa.clipping)sb.numClippingPlanes=mc.numPlanes,Ya.clippingPlanes=mc.uniform;sb.fog=xa;sb.lightsHash=Cb.hash;sa.lights&&(Ya.ambientLightColor.value=Cb.ambient,Ya.directionalLights.value=Cb.directional,Ya.spotLights.value=Cb.spot,Ya.pointLights.value=Cb.point,Ya.hemisphereLights.value=Cb.hemi,Ya.directionalShadowMap.value=Cb.directionalShadowMap,Ya.directionalShadowMatrix.value=Cb.directionalShadowMatrix,Ya.spotShadowMap.value=Cb.spotShadowMap,Ya.spotShadowMatrix.value=
Cb.spotShadowMatrix,Ya.pointShadowMap.value=Cb.pointShadowMap,Ya.pointShadowMatrix.value=Cb.pointShadowMatrix);Da=sb.program.getUniforms();Ya=pa.seqWithValue(Da.seq,Ya);sb.uniformsList=Ya}sa.needsUpdate=!1}var Xb=!1;Gb=wb=!1;sb=ib.program;Ya=sb.getUniforms();Da=ib.__webglShader.uniforms;sb.id!==eb&&(Fa.useProgram(sb.program),eb=sb.id,Gb=wb=Xb=!0);sa.id!==ub&&(ub=sa.id,wb=!0);if(Xb||ia!==mb){Ya.set(Fa,ia,"projectionMatrix");Lc.logarithmicDepthBuffer&&Ya.setValue(Fa,"logDepthBufFC",2/(Math.log(ia.far+
1)/Math.LN2));ia!==mb&&(mb=ia,Gb=wb=!0);if(sa.isShaderMaterial||sa.isMeshPhongMaterial||sa.isMeshStandardMaterial||sa.envMap)Xb=Ya.map.cameraPosition,void 0!==Xb&&Xb.setValue(Fa,pc.setFromMatrixPosition(ia.matrixWorld));(sa.isMeshPhongMaterial||sa.isMeshLambertMaterial||sa.isMeshBasicMaterial||sa.isMeshStandardMaterial||sa.isShaderMaterial||sa.skinning)&&Ya.setValue(Fa,"viewMatrix",ia.matrixWorldInverse);Ya.set(Fa,Ja,"toneMappingExposure");Ya.set(Fa,Ja,"toneMappingWhitePoint")}sa.skinning&&(Ya.setOptional(Fa,
$a,"bindMatrix"),Ya.setOptional(Fa,$a,"bindMatrixInverse"),ia=$a.skeleton)&&(Lc.floatVertexTextures&&ia.useVertexTexture?(Ya.set(Fa,ia,"boneTexture"),Ya.set(Fa,ia,"boneTextureWidth"),Ya.set(Fa,ia,"boneTextureHeight")):Ya.setOptional(Fa,ia,"boneMatrices"));if(wb){sa.lights&&(ia=Gb,Da.ambientLightColor.needsUpdate=ia,Da.directionalLights.needsUpdate=ia,Da.pointLights.needsUpdate=ia,Da.spotLights.needsUpdate=ia,Da.hemisphereLights.needsUpdate=ia);xa&&sa.fog&&(Da.fogColor.value=xa.color,xa.isFog?(Da.fogNear.value=
xa.near,Da.fogFar.value=xa.far):xa.isFogExp2&&(Da.fogDensity.value=xa.density));if(sa.isMeshBasicMaterial||sa.isMeshLambertMaterial||sa.isMeshPhongMaterial||sa.isMeshStandardMaterial||sa.isMeshDepthMaterial){Da.opacity.value=sa.opacity;Da.diffuse.value=sa.color;sa.emissive&&Da.emissive.value.copy(sa.emissive).multiplyScalar(sa.emissiveIntensity);Da.map.value=sa.map;Da.specularMap.value=sa.specularMap;Da.alphaMap.value=sa.alphaMap;sa.aoMap&&(Da.aoMap.value=sa.aoMap,Da.aoMapIntensity.value=sa.aoMapIntensity);
if(sa.map)var Fb=sa.map;else sa.specularMap?Fb=sa.specularMap:sa.displacementMap?Fb=sa.displacementMap:sa.normalMap?Fb=sa.normalMap:sa.bumpMap?Fb=sa.bumpMap:sa.roughnessMap?Fb=sa.roughnessMap:sa.metalnessMap?Fb=sa.metalnessMap:sa.alphaMap?Fb=sa.alphaMap:sa.emissiveMap&&(Fb=sa.emissiveMap);void 0!==Fb&&(Fb.isWebGLRenderTarget&&(Fb=Fb.texture),xa=Fb.offset,Fb=Fb.repeat,Da.offsetRepeat.value.set(xa.x,xa.y,Fb.x,Fb.y));Da.envMap.value=sa.envMap;Da.flipEnvMap.value=sa.envMap&&sa.envMap.isCubeTexture?-1:
1;Da.reflectivity.value=sa.reflectivity;Da.refractionRatio.value=sa.refractionRatio}sa.isLineBasicMaterial?(Da.diffuse.value=sa.color,Da.opacity.value=sa.opacity):sa.isLineDashedMaterial?(Da.diffuse.value=sa.color,Da.opacity.value=sa.opacity,Da.dashSize.value=sa.dashSize,Da.totalSize.value=sa.dashSize+sa.gapSize,Da.scale.value=sa.scale):sa.isPointsMaterial?(Da.diffuse.value=sa.color,Da.opacity.value=sa.opacity,Da.size.value=sa.size*Jb,Da.scale.value=.5*Ib,Da.map.value=sa.map,null!==sa.map&&(Fb=sa.map.offset,
sa=sa.map.repeat,Da.offsetRepeat.value.set(Fb.x,Fb.y,sa.x,sa.y))):sa.isMeshLambertMaterial?(sa.lightMap&&(Da.lightMap.value=sa.lightMap,Da.lightMapIntensity.value=sa.lightMapIntensity),sa.emissiveMap&&(Da.emissiveMap.value=sa.emissiveMap)):sa.isMeshPhongMaterial?(Da.specular.value=sa.specular,Da.shininess.value=Math.max(sa.shininess,1E-4),sa.lightMap&&(Da.lightMap.value=sa.lightMap,Da.lightMapIntensity.value=sa.lightMapIntensity),sa.emissiveMap&&(Da.emissiveMap.value=sa.emissiveMap),sa.bumpMap&&(Da.bumpMap.value=
sa.bumpMap,Da.bumpScale.value=sa.bumpScale),sa.normalMap&&(Da.normalMap.value=sa.normalMap,Da.normalScale.value.copy(sa.normalScale)),sa.displacementMap&&(Da.displacementMap.value=sa.displacementMap,Da.displacementScale.value=sa.displacementScale,Da.displacementBias.value=sa.displacementBias)):sa.isMeshPhysicalMaterial?(Da.clearCoat.value=sa.clearCoat,Da.clearCoatRoughness.value=sa.clearCoatRoughness,oa(Da,sa)):sa.isMeshStandardMaterial?oa(Da,sa):sa.isMeshDepthMaterial?sa.displacementMap&&(Da.displacementMap.value=
sa.displacementMap,Da.displacementScale.value=sa.displacementScale,Da.displacementBias.value=sa.displacementBias):sa.isMeshNormalMaterial&&(Da.opacity.value=sa.opacity);pa.upload(Fa,ib.uniformsList,Da,Ja)}Ya.set(Fa,$a,"modelViewMatrix");Ya.set(Fa,$a,"normalMatrix");Ya.setValue(Fa,"modelMatrix",$a.matrixWorld);return sb}function oa(ia,xa){ia.roughness.value=xa.roughness;ia.metalness.value=xa.metalness;xa.roughnessMap&&(ia.roughnessMap.value=xa.roughnessMap);xa.metalnessMap&&(ia.metalnessMap.value=
xa.metalnessMap);xa.lightMap&&(ia.lightMap.value=xa.lightMap,ia.lightMapIntensity.value=xa.lightMapIntensity);xa.emissiveMap&&(ia.emissiveMap.value=xa.emissiveMap);xa.bumpMap&&(ia.bumpMap.value=xa.bumpMap,ia.bumpScale.value=xa.bumpScale);xa.normalMap&&(ia.normalMap.value=xa.normalMap,ia.normalScale.value.copy(xa.normalScale));xa.displacementMap&&(ia.displacementMap.value=xa.displacementMap,ia.displacementScale.value=xa.displacementScale,ia.displacementBias.value=xa.displacementBias);xa.envMap&&(ia.envMapIntensity.value=
xa.envMapIntensity)}function ra(ia){if(1E3===ia)return Fa.REPEAT;if(1001===ia)return Fa.CLAMP_TO_EDGE;if(1002===ia)return Fa.MIRRORED_REPEAT;if(1003===ia)return Fa.NEAREST;if(1004===ia)return Fa.NEAREST_MIPMAP_NEAREST;if(1005===ia)return Fa.NEAREST_MIPMAP_LINEAR;if(1006===ia)return Fa.LINEAR;if(1007===ia)return Fa.LINEAR_MIPMAP_NEAREST;if(1008===ia)return Fa.LINEAR_MIPMAP_LINEAR;if(1009===ia)return Fa.UNSIGNED_BYTE;if(1017===ia)return Fa.UNSIGNED_SHORT_4_4_4_4;if(1018===ia)return Fa.UNSIGNED_SHORT_5_5_5_1;
if(1019===ia)return Fa.UNSIGNED_SHORT_5_6_5;if(1010===ia)return Fa.BYTE;if(1011===ia)return Fa.SHORT;if(1012===ia)return Fa.UNSIGNED_SHORT;if(1013===ia)return Fa.INT;if(1014===ia)return Fa.UNSIGNED_INT;if(1015===ia)return Fa.FLOAT;var xa=Vb.get("OES_texture_half_float");if(null!==xa&&1016===ia)return xa.HALF_FLOAT_OES;if(1021===ia)return Fa.ALPHA;if(1022===ia)return Fa.RGB;if(1023===ia)return Fa.RGBA;if(1024===ia)return Fa.LUMINANCE;if(1025===ia)return Fa.LUMINANCE_ALPHA;if(1026===ia)return Fa.DEPTH_COMPONENT;
if(1027===ia)return Fa.DEPTH_STENCIL;if(100===ia)return Fa.FUNC_ADD;if(101===ia)return Fa.FUNC_SUBTRACT;if(102===ia)return Fa.FUNC_REVERSE_SUBTRACT;if(200===ia)return Fa.ZERO;if(201===ia)return Fa.ONE;if(202===ia)return Fa.SRC_COLOR;if(203===ia)return Fa.ONE_MINUS_SRC_COLOR;if(204===ia)return Fa.SRC_ALPHA;if(205===ia)return Fa.ONE_MINUS_SRC_ALPHA;if(206===ia)return Fa.DST_ALPHA;if(207===ia)return Fa.ONE_MINUS_DST_ALPHA;if(208===ia)return Fa.DST_COLOR;if(209===ia)return Fa.ONE_MINUS_DST_COLOR;if(210===
ia)return Fa.SRC_ALPHA_SATURATE;xa=Vb.get("WEBGL_compressed_texture_s3tc");if(null!==xa){if(2001===ia)return xa.COMPRESSED_RGB_S3TC_DXT1_EXT;if(2002===ia)return xa.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(2003===ia)return xa.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(2004===ia)return xa.COMPRESSED_RGBA_S3TC_DXT5_EXT}xa=Vb.get("WEBGL_compressed_texture_pvrtc");if(null!==xa){if(2100===ia)return xa.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(2101===ia)return xa.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(2102===ia)return xa.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;
if(2103===ia)return xa.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}xa=Vb.get("WEBGL_compressed_texture_etc1");if(null!==xa&&2151===ia)return xa.COMPRESSED_RGB_ETC1_WEBGL;xa=Vb.get("EXT_blend_minmax");if(null!==xa){if(103===ia)return xa.MIN_EXT;if(104===ia)return xa.MAX_EXT}xa=Vb.get("WEBGL_depth_texture");return null!==xa&&1020===ia?xa.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer","82dev");a=a||{};var aa=void 0!==a.canvas?a.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),
qa=void 0!==a.context?a.context:null,na=void 0!==a.alpha?a.alpha:!1,ua=void 0!==a.depth?a.depth:!0,ta=void 0!==a.stencil?a.stencil:!0,Aa=void 0!==a.antialias?a.antialias:!1,Ka=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,Ia=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,Oa=[],Ta=[],Na=-1,Ua=[],ab=-1,Pa=new Float32Array(8),Ma=[],Wa=[];this.domElement=aa;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=
[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var Ja=this,eb=null,Za=null,tb=null,ub=-1,Db="",mb=null,Hb=new q,Kb=null,Ba=new q,db=0,hb=new ma(0),vb=0,lb=aa.width,Ib=aa.height,Jb=1,lc=new q(0,0,lb,Ib),Bd=!1,Tb=new q(0,0,lb,Ib),Kc=new jc,mc=new Zb,Re=!1,uf=!1,Cd=new rb,Qe=new z,pc=new r,Cb={hash:"",ambient:[0,0,0],
directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},dd={calls:0,vertices:0,faces:0,points:0};this.info={render:dd,memory:{geometries:0,textures:0},programs:null};try{na={alpha:na,depth:ua,stencil:ta,antialias:Aa,premultipliedAlpha:Ka,preserveDrawingBuffer:Ia};var Fa=qa||aa.getContext("webgl",na)||aa.getContext("experimental-webgl",na);if(null===Fa){if(null!==aa.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";
throw"Error creating WebGL context.";}void 0===Fa.getShaderPrecisionFormat&&(Fa.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});aa.addEventListener("webglcontextlost",t,!1)}catch(ia){console.error("THREE.WebGLRenderer: "+ia)}var Vb=new kb(Fa);Vb.get("WEBGL_depth_texture");Vb.get("OES_texture_float");Vb.get("OES_texture_float_linear");Vb.get("OES_texture_half_float");Vb.get("OES_texture_half_float_linear");Vb.get("OES_standard_derivatives");Vb.get("ANGLE_instanced_arrays");
Vb.get("OES_element_index_uint")&&(qb.MaxIndex=4294967296);var Lc=new Ub(Fa,Vb,a),yb=new Sb(Fa,Vb,ra),Ac=new Ob,Dd=new Bb(Fa,Vb,yb,Ac,Lc,ra,this.info),cd=new zb(Fa,Ac,this.info),de=new fb(this,Lc),Se=new Pe;this.info.programs=de.programs;var mg=new Wc(Fa,Vb,dd),ng=new Qc(Fa,Vb,dd),og=new zc(-1,1,1,-1,0,1),Ed=new hc,ee=new Rb(new vc(2,2),new bc({depthTest:!1,depthWrite:!1,fog:!1}));a=zd.cube;var ed=new Rb(new Jc(5,5,5),new ob({uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,
side:1,depthTest:!1,depthWrite:!1,fog:!1}));d();this.context=Fa;this.capabilities=Lc;this.extensions=Vb;this.properties=Ac;this.state=yb;var $f=new yd(this,Cb,cd,Lc);this.shadowMap=$f;var pg=new ya(this,Ma),qg=new Ca(this,Wa);this.getContext=function(){return Fa};this.getContextAttributes=function(){return Fa.getContextAttributes()};this.forceContextLoss=function(){Vb.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){return Lc.getMaxAnisotropy()};this.getPrecision=function(){return Lc.precision};
this.getPixelRatio=function(){return Jb};this.setPixelRatio=function(ia){void 0!==ia&&(Jb=ia,this.setSize(Tb.z,Tb.w,!1))};this.getSize=function(){return{width:lb,height:Ib}};this.setSize=function(ia,xa,sa){lb=ia;Ib=xa;aa.width=ia*Jb;aa.height=xa*Jb;!1!==sa&&(aa.style.width=ia+"px",aa.style.height=xa+"px");this.setViewport(0,0,ia,xa)};this.setViewport=function(ia,xa,sa,$a){yb.viewport(Tb.set(ia,xa,sa,$a))};this.setScissor=function(ia,xa,sa,$a){yb.scissor(lc.set(ia,xa,sa,$a))};this.setScissorTest=function(ia){yb.setScissorTest(Bd=
ia)};this.getClearColor=function(){return hb};this.setClearColor=function(ia,xa){hb.set(ia);vb=void 0!==xa?xa:1;b(hb.r,hb.g,hb.b,vb)};this.getClearAlpha=function(){return vb};this.setClearAlpha=function(ia){vb=ia;b(hb.r,hb.g,hb.b,vb)};this.clear=function(ia,xa,sa){var $a=0;if(void 0===ia||ia)$a|=Fa.COLOR_BUFFER_BIT;if(void 0===xa||xa)$a|=Fa.DEPTH_BUFFER_BIT;if(void 0===sa||sa)$a|=Fa.STENCIL_BUFFER_BIT;Fa.clear($a)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,
!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(ia,xa,sa,$a){this.setRenderTarget(ia);this.clear(xa,sa,$a)};this.resetGLState=g;this.dispose=function(){Ua=[];ab=-1;Ta=[];Na=-1;aa.removeEventListener("webglcontextlost",t,!1)};this.renderBufferImmediate=function(ia,xa,sa){yb.initAttributes();var $a=Ac.get(ia);ia.hasPositions&&!$a.position&&($a.position=Fa.createBuffer());ia.hasNormals&&!$a.normal&&($a.normal=Fa.createBuffer());ia.hasUvs&&!$a.uv&&($a.uv=Fa.createBuffer());
ia.hasColors&&!$a.color&&($a.color=Fa.createBuffer());xa=xa.getAttributes();ia.hasPositions&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,$a.position),Fa.bufferData(Fa.ARRAY_BUFFER,ia.positionArray,Fa.DYNAMIC_DRAW),yb.enableAttribute(xa.position),Fa.vertexAttribPointer(xa.position,3,Fa.FLOAT,!1,0,0));if(ia.hasNormals){Fa.bindBuffer(Fa.ARRAY_BUFFER,$a.normal);if(!sa.isMeshPhongMaterial&&!sa.isMeshStandardMaterial&&1===sa.shading)for(var ib=0,sb=3*ia.count;ib<sb;ib+=9){var Ya=ia.normalArray,Da=(Ya[ib+0]+Ya[ib+3]+
Ya[ib+6])/3,wb=(Ya[ib+1]+Ya[ib+4]+Ya[ib+7])/3,Gb=(Ya[ib+2]+Ya[ib+5]+Ya[ib+8])/3;Ya[ib+0]=Da;Ya[ib+1]=wb;Ya[ib+2]=Gb;Ya[ib+3]=Da;Ya[ib+4]=wb;Ya[ib+5]=Gb;Ya[ib+6]=Da;Ya[ib+7]=wb;Ya[ib+8]=Gb}Fa.bufferData(Fa.ARRAY_BUFFER,ia.normalArray,Fa.DYNAMIC_DRAW);yb.enableAttribute(xa.normal);Fa.vertexAttribPointer(xa.normal,3,Fa.FLOAT,!1,0,0)}ia.hasUvs&&sa.map&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,$a.uv),Fa.bufferData(Fa.ARRAY_BUFFER,ia.uvArray,Fa.DYNAMIC_DRAW),yb.enableAttribute(xa.uv),Fa.vertexAttribPointer(xa.uv,
2,Fa.FLOAT,!1,0,0));ia.hasColors&&0!==sa.vertexColors&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,$a.color),Fa.bufferData(Fa.ARRAY_BUFFER,ia.colorArray,Fa.DYNAMIC_DRAW),yb.enableAttribute(xa.color),Fa.vertexAttribPointer(xa.color,3,Fa.FLOAT,!1,0,0));yb.disableUnusedAttributes();Fa.drawArrays(Fa.TRIANGLES,0,ia.count);ia.count=0};this.renderBufferDirect=function(ia,xa,sa,$a,ib,sb){ca($a);var Ya=ja(ia,xa,$a,ib),Da=!1;ia=sa.id+"_"+Ya.id+"_"+$a.wireframe;ia!==Db&&(Db=ia,Da=!0);xa=ib.morphTargetInfluences;if(void 0!==
xa){var wb=[];ia=0;for(var Gb=xa.length;ia<Gb;ia++)Da=xa[ia],wb.push([Da,ia]);wb.sort(F);8<wb.length&&(wb.length=8);var Xb=sa.morphAttributes;ia=0;for(Gb=wb.length;ia<Gb;ia++)Da=wb[ia],Pa[ia]=Da[0],0!==Da[0]?(xa=Da[1],!0===$a.morphTargets&&Xb.position&&sa.addAttribute("morphTarget"+ia,Xb.position[xa]),!0===$a.morphNormals&&Xb.normal&&sa.addAttribute("morphNormal"+ia,Xb.normal[xa])):(!0===$a.morphTargets&&sa.removeAttribute("morphTarget"+ia),!0===$a.morphNormals&&sa.removeAttribute("morphNormal"+ia));
ia=wb.length;for(xa=Pa.length;ia<xa;ia++)Pa[ia]=0;Ya.getUniforms().setValue(Fa,"morphTargetInfluences",Pa);Da=!0}xa=sa.index;Gb=sa.attributes.position;wb=1;!0===$a.wireframe&&(xa=cd.getWireframeAttribute(sa),wb=2);null!==xa?(ia=ng,ia.setIndex(xa)):ia=mg;if(Da){a:{Da=void 0;if(sa&&sa.isInstancedBufferGeometry){var Fb=Vb.get("ANGLE_instanced_arrays");if(null===Fb){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
break a}}void 0===Da&&(Da=0);yb.initAttributes();Xb=sa.attributes;Ya=Ya.getAttributes();var Xc=$a.defaultAttributeValues;for(fd in Ya){var ic=Ya[fd];if(0<=ic){var Yb=Xb[fd];if(void 0!==Yb){var fc=Fa.FLOAT,nc=Yb.array,Tc=Yb.normalized;nc instanceof Float32Array?fc=Fa.FLOAT:nc instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):nc instanceof Uint16Array?fc=Fa.UNSIGNED_SHORT:nc instanceof Int16Array?fc=Fa.SHORT:nc instanceof Uint32Array?fc=Fa.UNSIGNED_INT:nc instanceof
Int32Array?fc=Fa.INT:nc instanceof Int8Array?fc=Fa.BYTE:nc instanceof Uint8Array&&(fc=Fa.UNSIGNED_BYTE);nc=Yb.itemSize;var Te=cd.getAttributeBuffer(Yb);if(Yb&&Yb.isInterleavedBufferAttribute){var Ec=Yb.data,xb=Ec.stride;Yb=Yb.offset;Ec&&Ec.isInstancedInterleavedBuffer?(yb.enableAttributeAndDivisor(ic,Ec.meshPerAttribute,Fb),void 0===sa.maxInstancedCount&&(sa.maxInstancedCount=Ec.meshPerAttribute*Ec.count)):yb.enableAttribute(ic);Fa.bindBuffer(Fa.ARRAY_BUFFER,Te);Fa.vertexAttribPointer(ic,nc,fc,Tc,
xb*Ec.array.BYTES_PER_ELEMENT,(Da*xb+Yb)*Ec.array.BYTES_PER_ELEMENT)}else Yb&&Yb.isInstancedBufferAttribute?(yb.enableAttributeAndDivisor(ic,Yb.meshPerAttribute,Fb),void 0===sa.maxInstancedCount&&(sa.maxInstancedCount=Yb.meshPerAttribute*Yb.count)):yb.enableAttribute(ic),Fa.bindBuffer(Fa.ARRAY_BUFFER,Te),Fa.vertexAttribPointer(ic,nc,fc,Tc,0,Da*nc*Yb.array.BYTES_PER_ELEMENT)}else if(void 0!==Xc&&(fc=Xc[fd],void 0!==fc))switch(fc.length){case 2:Fa.vertexAttrib2fv(ic,fc);break;case 3:Fa.vertexAttrib3fv(ic,
fc);break;case 4:Fa.vertexAttrib4fv(ic,fc);break;default:Fa.vertexAttrib1fv(ic,fc)}}}yb.disableUnusedAttributes()}null!==xa&&Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,cd.getAttributeBuffer(xa))}Fb=0;null!==xa?Fb=xa.count:void 0!==Gb&&(Fb=Gb.count);xa=sa.drawRange.start*wb;Gb=null!==sb?sb.start*wb:0;var fd=Math.max(xa,Gb);sb=Math.max(0,Math.min(Fb,xa+sa.drawRange.count*wb,Gb+(null!==sb?sb.count*wb:Infinity))-1-fd+1);if(0!==sb){if(ib.isMesh)if(!0===$a.wireframe)yb.setLineWidth($a.wireframeLinewidth*(null===
Za?Jb:1)),ia.setMode(Fa.LINES);else switch(ib.drawMode){case 0:ia.setMode(Fa.TRIANGLES);break;case 1:ia.setMode(Fa.TRIANGLE_STRIP);break;case 2:ia.setMode(Fa.TRIANGLE_FAN)}else ib.isLine?($a=$a.linewidth,void 0===$a&&($a=1),yb.setLineWidth($a*(null===Za?Jb:1)),ib.isLineSegments?ia.setMode(Fa.LINES):ia.setMode(Fa.LINE_STRIP)):ib.isPoints&&ia.setMode(Fa.POINTS);sa&&sa.isInstancedBufferGeometry?0<sa.maxInstancedCount&&ia.renderInstances(sa,fd,sb):ia.render(fd,sb)}};this.render=function(ia,xa,sa,$a){if(void 0!==
xa&&!0!==xa.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{Db="";ub=-1;mb=null;!0===ia.autoUpdate&&ia.updateMatrixWorld();null===xa.parent&&xa.updateMatrixWorld();xa.matrixWorldInverse.getInverse(xa.matrixWorld);Qe.multiplyMatrices(xa.projectionMatrix,xa.matrixWorldInverse);Kc.setFromMatrix(Qe);Oa.length=0;ab=Na=-1;Ma.length=0;Wa.length=0;uf=this.localClippingEnabled;Re=mc.init(this.clippingPlanes,uf,xa);P(ia,xa);Ta.length=Na+1;Ua.length=ab+1;
!0===Ja.sortObjects&&(Ta.sort(K),Ua.sort(M));Re&&mc.beginShadows();for(var ib=Oa,sb=0,Ya=0,Da=ib.length;Ya<Da;Ya++){var wb=ib[Ya];wb.castShadow&&(Cb.shadows[sb++]=wb)}Cb.shadows.length=sb;$f.render(ia,xa);ib=Oa;var Gb=wb=0,Xb=0,Fb=xa.matrixWorldInverse,Xc=0,ic=0,Yb=0,fc=0;sb=0;for(Ya=ib.length;sb<Ya;sb++){Da=ib[sb];var nc=Da.color;var Tc=Da.intensity;var Te=Da.distance;var Ec=Da.shadow&&Da.shadow.map?Da.shadow.map.texture:null;if(Da.isAmbientLight)wb+=nc.r*Tc,Gb+=nc.g*Tc,Xb+=nc.b*Tc;else if(Da.isDirectionalLight){var xb=
Se.get(Da);xb.color.copy(Da.color).multiplyScalar(Da.intensity);xb.direction.setFromMatrixPosition(Da.matrixWorld);pc.setFromMatrixPosition(Da.target.matrixWorld);xb.direction.sub(pc);xb.direction.transformDirection(Fb);if(xb.shadow=Da.castShadow)xb.shadowBias=Da.shadow.bias,xb.shadowRadius=Da.shadow.radius,xb.shadowMapSize=Da.shadow.mapSize;Cb.directionalShadowMap[Xc]=Ec;Cb.directionalShadowMatrix[Xc]=Da.shadow.matrix;Cb.directional[Xc++]=xb}else if(Da.isSpotLight){xb=Se.get(Da);xb.position.setFromMatrixPosition(Da.matrixWorld);
xb.position.applyMatrix4(Fb);xb.color.copy(nc).multiplyScalar(Tc);xb.distance=Te;xb.direction.setFromMatrixPosition(Da.matrixWorld);pc.setFromMatrixPosition(Da.target.matrixWorld);xb.direction.sub(pc);xb.direction.transformDirection(Fb);xb.coneCos=Math.cos(Da.angle);xb.penumbraCos=Math.cos(Da.angle*(1-Da.penumbra));xb.decay=0===Da.distance?0:Da.decay;if(xb.shadow=Da.castShadow)xb.shadowBias=Da.shadow.bias,xb.shadowRadius=Da.shadow.radius,xb.shadowMapSize=Da.shadow.mapSize;Cb.spotShadowMap[Yb]=Ec;
Cb.spotShadowMatrix[Yb]=Da.shadow.matrix;Cb.spot[Yb++]=xb}else if(Da.isPointLight){xb=Se.get(Da);xb.position.setFromMatrixPosition(Da.matrixWorld);xb.position.applyMatrix4(Fb);xb.color.copy(Da.color).multiplyScalar(Da.intensity);xb.distance=Da.distance;xb.decay=0===Da.distance?0:Da.decay;if(xb.shadow=Da.castShadow)xb.shadowBias=Da.shadow.bias,xb.shadowRadius=Da.shadow.radius,xb.shadowMapSize=Da.shadow.mapSize;Cb.pointShadowMap[ic]=Ec;void 0===Cb.pointShadowMatrix[ic]&&(Cb.pointShadowMatrix[ic]=new z);
pc.setFromMatrixPosition(Da.matrixWorld).negate();Cb.pointShadowMatrix[ic].identity().setPosition(pc);Cb.point[ic++]=xb}else Da.isHemisphereLight&&(xb=Se.get(Da),xb.direction.setFromMatrixPosition(Da.matrixWorld),xb.direction.transformDirection(Fb),xb.direction.normalize(),xb.skyColor.copy(Da.color).multiplyScalar(Tc),xb.groundColor.copy(Da.groundColor).multiplyScalar(Tc),Cb.hemi[fc++]=xb)}Cb.ambient[0]=wb;Cb.ambient[1]=Gb;Cb.ambient[2]=Xb;Cb.directional.length=Xc;Cb.spot.length=Yb;Cb.point.length=
ic;Cb.hemi.length=fc;Cb.hash=Xc+","+ic+","+Yb+","+fc+","+Cb.shadows.length;Re&&mc.endShadows();dd.calls=0;dd.vertices=0;dd.faces=0;dd.points=0;void 0===sa&&(sa=null);this.setRenderTarget(sa);ib=ia.background;null===ib?b(hb.r,hb.g,hb.b,vb):ib&&ib.isColor&&(b(ib.r,ib.g,ib.b,1),$a=!0);(this.autoClear||$a)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);ib&&ib.isCubeTexture?(Ed.projectionMatrix.copy(xa.projectionMatrix),Ed.matrixWorld.extractRotation(xa.matrixWorld),Ed.matrixWorldInverse.getInverse(Ed.matrixWorld),
ed.material.uniforms.tCube.value=ib,ed.modelViewMatrix.multiplyMatrices(Ed.matrixWorldInverse,ed.matrixWorld),cd.update(ed),Ja.renderBufferDirect(Ed,null,ed.geometry,ed.material,ed,null)):ib&&ib.isTexture&&(ee.material.map=ib,cd.update(ee),Ja.renderBufferDirect(og,null,ee.geometry,ee.material,ee,null));ia.overrideMaterial?($a=ia.overrideMaterial,Z(Ta,ia,xa,$a),Z(Ua,ia,xa,$a)):(yb.setBlending(0),Z(Ta,ia,xa),Z(Ua,ia,xa));pg.render(ia,xa);qg.render(ia,xa,Ba);sa&&Dd.updateRenderTargetMipmap(sa);yb.setDepthTest(!0);
yb.setDepthWrite(!0);yb.setColorWrite(!0)}};this.setFaceCulling=function(ia,xa){yb.setCullFace(ia);yb.setFlipSided(0===xa)};this.allocTextureUnit=function(){var ia=db;ia>=Lc.maxTextures&&console.warn("WebGLRenderer: trying to use "+ia+" texture units while this GPU supports only "+Lc.maxTextures);db+=1;return ia};this.setTexture2D=function(){var ia=!1;return function(xa,sa){xa&&xa.isWebGLRenderTarget&&(ia||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),
ia=!0),xa=xa.texture);Dd.setTexture2D(xa,sa)}}();this.setTexture=function(){var ia=!1;return function(xa,sa){ia||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),ia=!0);Dd.setTexture2D(xa,sa)}}();this.setTextureCube=function(){var ia=!1;return function(xa,sa){xa&&xa.isWebGLRenderTargetCube&&(ia||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),ia=!0),xa=xa.texture);xa&&xa.isCubeTexture||
Array.isArray(xa.image)&&6===xa.image.length?Dd.setTextureCube(xa,sa):Dd.setTextureCubeDynamic(xa,sa)}}();this.getCurrentRenderTarget=function(){return Za};this.setRenderTarget=function(ia){(Za=ia)&&void 0===Ac.get(ia).__webglFramebuffer&&Dd.setupRenderTarget(ia);var xa=ia&&ia.isWebGLRenderTargetCube;if(ia){var sa=Ac.get(ia);sa=xa?sa.__webglFramebuffer[ia.activeCubeFace]:sa.__webglFramebuffer;Hb.copy(ia.scissor);Kb=ia.scissorTest;Ba.copy(ia.viewport)}else sa=null,Hb.copy(lc).multiplyScalar(Jb),Kb=
Bd,Ba.copy(Tb).multiplyScalar(Jb);tb!==sa&&(Fa.bindFramebuffer(Fa.FRAMEBUFFER,sa),tb=sa);yb.scissor(Hb);yb.setScissorTest(Kb);yb.viewport(Ba);xa&&(xa=Ac.get(ia.texture),Fa.framebufferTexture2D(Fa.FRAMEBUFFER,Fa.COLOR_ATTACHMENT0,Fa.TEXTURE_CUBE_MAP_POSITIVE_X+ia.activeCubeFace,xa.__webglTexture,ia.activeMipMapLevel))};this.readRenderTargetPixels=function(ia,xa,sa,$a,ib,sb){if(!1===(ia&&ia.isWebGLRenderTarget))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");
else{var Ya=Ac.get(ia).__webglFramebuffer;if(Ya){var Da=!1;Ya!==tb&&(Fa.bindFramebuffer(Fa.FRAMEBUFFER,Ya),Da=!0);try{var wb=ia.texture,Gb=wb.format,Xb=wb.type;1023!==Gb&&ra(Gb)!==Fa.getParameter(Fa.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===Xb||ra(Xb)===Fa.getParameter(Fa.IMPLEMENTATION_COLOR_READ_TYPE)||1015===Xb&&(Vb.get("OES_texture_float")||Vb.get("WEBGL_color_buffer_float"))||
1016===Xb&&Vb.get("EXT_color_buffer_half_float")?Fa.checkFramebufferStatus(Fa.FRAMEBUFFER)===Fa.FRAMEBUFFER_COMPLETE?0<=xa&&xa<=ia.width-$a&&0<=sa&&sa<=ia.height-ib&&Fa.readPixels(xa,sa,$a,ib,ra(Gb),ra(Xb),sb):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{Da&&Fa.bindFramebuffer(Fa.FRAMEBUFFER,
tb)}}}}}function Wb(a,b){this.name="";this.color=new ma(a);this.density=void 0!==b?b:2.5E-4}function qc(a,b,d){this.name="";this.color=new ma(a);this.near=void 0!==b?b:1;this.far=void 0!==d?d:1E3}function dc(){jb.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0}function wc(a,b,d,g,t){jb.call(this);this.lensFlares=[];this.positionScreen=new r;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,d,g,t)}function Bc(a){za.call(this);this.type="SpriteMaterial";
this.color=new ma(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(a)}function Yc(a){jb.call(this);this.type="Sprite";this.material=void 0!==a?a:new Bc}function fe(){jb.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function gd(a,b,d,g,t,w,y,F,K,M,T,Q){f.call(this,null,w,y,F,K,M,g,t,T,Q);this.image={data:a,width:b,height:d};this.magFilter=void 0!==K?K:1003;this.minFilter=void 0!==M?M:1003;this.generateMipmaps=this.flipY=!1}
function Ue(a,b,d){this.useVertexTexture=void 0!==d?d:!0;this.identityMatrix=new z;a=a||[];this.bones=a.slice(0);this.useVertexTexture?(a=Math.sqrt(4*this.bones.length),a=c.Math.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=this.boneTextureWidth=a=Math.max(a,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new gd(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,1023,1015)):this.boneMatrices=new Float32Array(16*this.bones.length);
if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],b=0,a=this.bones.length;b<a;b++)this.boneInverses.push(new z)}function Ve(a){jb.call(this);this.type="Bone";this.skin=a}function We(a,b,d){Rb.call(this,a,b);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new z;this.bindMatrixInverse=new z;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var g,
t=0,w=this.geometry.bones.length;t<w;++t)g=this.geometry.bones[t],b=new Ve(this),a.push(b),b.name=g.name,b.position.fromArray(g.pos),b.quaternion.fromArray(g.rotq),void 0!==g.scl&&b.scale.fromArray(g.scl);t=0;for(w=this.geometry.bones.length;t<w;++t)g=this.geometry.bones[t],-1!==g.parent&&null!==g.parent&&void 0!==a[g.parent]?a[g.parent].add(a[t]):this.add(a[t])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new Ue(a,void 0,d),this.matrixWorld)}function gc(a){za.call(this);this.type=
"LineBasicMaterial";this.color=new ma(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;this.setValues(a)}function Uc(a,b,d){if(1===d)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new $b(a,b);jb.call(this);this.type="Line";this.geometry=void 0!==a?a:new qb;this.material=void 0!==b?b:new gc({color:16777215*Math.random()})}function $b(a,b){Uc.call(this,a,b);this.type="LineSegments"}function Fc(a){za.call(this);
this.type="PointsMaterial";this.color=new ma(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)}function Fd(a,b){jb.call(this);this.type="Points";this.geometry=void 0!==a?a:new qb;this.material=void 0!==b?b:new Fc({color:16777215*Math.random()})}function ge(){jb.call(this);this.type="Group"}function Xe(a,b,d,g,t,w,y,F,K){function M(){requestAnimationFrame(M);a.readyState>=a.HAVE_CURRENT_DATA&&(T.needsUpdate=!0)}f.call(this,a,b,d,g,t,w,y,F,K);this.generateMipmaps=
!1;var T=this;M()}function Gd(a,b,d,g,t,w,y,F,K,M,T,Q){f.call(this,null,w,y,F,K,M,g,t,T,Q);this.image={width:b,height:d};this.mipmaps=a;this.generateMipmaps=this.flipY=!1}function Ye(a,b,d,g,t,w,y,F,K){f.call(this,a,b,d,g,t,w,y,F,K);this.needsUpdate=!0}function he(a,b,d,g,t,w,y,F,K,M){M=void 0!==M?M:1026;if(1026!==M&&1027!==M)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");f.call(this,null,g,t,w,y,F,M,d,K);this.image={width:a,height:b};this.type=void 0!==
d?d:1012;this.magFilter=void 0!==y?y:1003;this.minFilter=void 0!==F?F:1003;this.generateMipmaps=this.flipY=!1}function Hd(a){function b(ca,ja){return ca-ja}qb.call(this);var d=[0,0],g={},t=["a","b","c"];if(a&&a.isGeometry){var w=a.vertices,y=a.faces,F=0,K=new Uint32Array(6*y.length);a=0;for(var M=y.length;a<M;a++)for(var T=y[a],Q=0;3>Q;Q++){d[0]=T[t[Q]];d[1]=T[t[(Q+1)%3]];d.sort(b);var P=d.toString();void 0===g[P]&&(K[2*F]=d[0],K[2*F+1]=d[1],g[P]=!0,F++)}d=new Float32Array(6*F);a=0;for(M=F;a<M;a++)for(Q=
0;2>Q;Q++)g=w[K[2*a+Q]],F=6*a+3*Q,d[F+0]=g.x,d[F+1]=g.y,d[F+2]=g.z;this.addAttribute("position",new gb(d,3))}else if(a&&a.isBufferGeometry){if(null!==a.index){M=a.index.array;w=a.attributes.position;t=a.groups;F=0;0===t.length&&a.addGroup(0,M.length);K=new Uint32Array(2*M.length);y=0;for(T=t.length;y<T;++y){a=t[y];Q=a.start;P=a.count;a=Q;for(var Z=Q+P;a<Z;a+=3)for(Q=0;3>Q;Q++)d[0]=M[a+Q],d[1]=M[a+(Q+1)%3],d.sort(b),P=d.toString(),void 0===g[P]&&(K[2*F]=d[0],K[2*F+1]=d[1],g[P]=!0,F++)}d=new Float32Array(6*
F);a=0;for(M=F;a<M;a++)for(Q=0;2>Q;Q++)F=6*a+3*Q,g=K[2*a+Q],d[F+0]=w.getX(g),d[F+1]=w.getY(g),d[F+2]=w.getZ(g)}else for(w=a.attributes.position.array,F=w.length/3,K=F/3,d=new Float32Array(6*F),a=0,M=K;a<M;a++)for(Q=0;3>Q;Q++)F=18*a+6*Q,K=9*a+3*Q,d[F+0]=w[K],d[F+1]=w[K+1],d[F+2]=w[K+2],g=9*a+(Q+1)%3*3,d[F+3]=w[g],d[F+4]=w[g+1],d[F+5]=w[g+2];this.addAttribute("position",new gb(d,3))}}function Ze(a,b,d){qb.call(this);this.type="ParametricBufferGeometry";this.parameters={func:a,slices:b,stacks:d};var g=
[],t=[],w,y,F=b+1;for(w=0;w<=d;w++){var K=w/d;for(y=0;y<=b;y++){var M=y/b;var T=a(M,K);g.push(T.x,T.y,T.z);t.push(M,K)}}a=[];for(w=0;w<d;w++)for(y=0;y<b;y++){T=w*F+y;M=w*F+y+1;K=(w+1)*F+y+1;var Q=(w+1)*F+y;a.push(T,M,Q);a.push(M,K,Q)}this.setIndex(be(a,1));this.addAttribute("position",Qb(g,3));this.addAttribute("uv",Qb(t,2));this.computeVertexNormals()}function ie(a,b,d){pb.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:b,stacks:d};this.fromBufferGeometry(new Ze(a,b,d));
this.mergeVertices()}function xc(a,b,d,g){function t(M){F.push(M.x,M.y,M.z)}function w(M,T){M*=3;T.x=a[M+0];T.y=a[M+1];T.z=a[M+2]}function y(M,T,Q,P){0>P&&1===M.x&&(K[T]=M.x-1);0===Q.x&&0===Q.z&&(K[T]=P/2/Math.PI+.5)}qb.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:b,radius:d,detail:g};d=d||1;var F=[],K=[];(function(M){for(var T=new r,Q=new r,P=new r,Z=0;Z<b.length;Z+=3){w(b[Z+0],T);w(b[Z+1],Q);w(b[Z+2],P);var ca,ja,oa=T,ra=Q,aa=P,qa=Math.pow(2,M),na=[];for(ja=
0;ja<=qa;ja++){na[ja]=[];var ua=oa.clone().lerp(aa,ja/qa),ta=ra.clone().lerp(aa,ja/qa),Aa=qa-ja;for(ca=0;ca<=Aa;ca++)na[ja][ca]=0===ca&&ja===qa?ua:ua.clone().lerp(ta,ca/Aa)}for(ja=0;ja<qa;ja++)for(ca=0;ca<2*(qa-ja)-1;ca++)oa=Math.floor(ca/2),0===ca%2?(t(na[ja][oa+1]),t(na[ja+1][oa]),t(na[ja][oa])):(t(na[ja][oa+1]),t(na[ja+1][oa+1]),t(na[ja+1][oa]))}})(g||0);(function(M){for(var T=new r,Q=0;Q<F.length;Q+=3)T.x=F[Q+0],T.y=F[Q+1],T.z=F[Q+2],T.normalize().multiplyScalar(M),F[Q+0]=T.x,F[Q+1]=T.y,F[Q+2]=
T.z})(d);(function(){for(var M=new r,T=0;T<F.length;T+=3)M.x=F[T+0],M.y=F[T+1],M.z=F[T+2],K.push(Math.atan2(M.z,-M.x)/2/Math.PI+.5,1-(Math.atan2(-M.y,Math.sqrt(M.x*M.x+M.z*M.z))/Math.PI+.5));M=new r;T=new r;for(var Q=new r,P=new r,Z=new n,ca=new n,ja=new n,oa=0,ra=0;oa<F.length;oa+=9,ra+=6){M.set(F[oa+0],F[oa+1],F[oa+2]);T.set(F[oa+3],F[oa+4],F[oa+5]);Q.set(F[oa+6],F[oa+7],F[oa+8]);Z.set(K[ra+0],K[ra+1]);ca.set(K[ra+2],K[ra+3]);ja.set(K[ra+4],K[ra+5]);P.copy(M).add(T).add(Q).divideScalar(3);var aa=
Math.atan2(P.z,-P.x);y(Z,ra+0,M,aa);y(ca,ra+2,T,aa);y(ja,ra+4,Q,aa)}for(M=0;M<K.length;M+=6)T=K[M+0],Q=K[M+2],P=K[M+4],Z=Math.min(T,Q,P),.9<Math.max(T,Q,P)&&.1>Z&&(.2>T&&(K[M+0]+=1),.2>Q&&(K[M+2]+=1),.2>P&&(K[M+4]+=1))})();this.addAttribute("position",Qb(F,3));this.addAttribute("normal",Qb(F.slice(),3));this.addAttribute("uv",Qb(K,2));this.normalizeNormals();this.boundingSphere=new rb(new r,d)}function je(a,b){xc.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type="TetrahedronBufferGeometry";
this.parameters={radius:a,detail:b}}function ke(a,b){pb.call(this);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new THREE.TetrahedronBufferGeometry(a,b));this.mergeVertices()}function le(a,b){xc.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronBufferGeometry";this.parameters={radius:a,detail:b}}function me(a,b){pb.call(this);this.type="OctahedronGeometry";this.parameters={radius:a,
detail:b};this.fromBufferGeometry(new THREE.OctahedronBufferGeometry(a,b));this.mergeVertices()}function ne(a,b){var d=(1+Math.sqrt(5))/2;xc.call(this,[-1,d,0,1,d,0,-1,-d,0,1,-d,0,0,-1,d,0,1,d,0,-1,-d,0,1,-d,d,0,-1,d,0,1,-d,0,-1,-d,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:b}}function oe(a,b){pb.call(this);this.type="IcosahedronGeometry";
this.parameters={radius:a,detail:b};this.fromBufferGeometry(new THREE.IcosahedronBufferGeometry(a,b));this.mergeVertices()}function pe(a,b){var d=(1+Math.sqrt(5))/2,g=1/d;xc.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-g,-d,0,-g,d,0,g,-d,0,g,d,-g,-d,0,-g,d,0,g,-d,0,g,d,0,-d,0,-g,d,0,-g,-d,0,g,d,0,g],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,
11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,b);this.type="DodecahedronBufferGeometry";this.parameters={radius:a,detail:b}}function qe(a,b){pb.call(this);this.type="DodecahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new THREE.DodecahedronBufferGeometry(a,b));this.mergeVertices()}function re(a,b,d,g){pb.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,indices:b,radius:d,detail:g};this.fromBufferGeometry(new xc(a,
b,d,g));this.mergeVertices()}function Gc(a,b,d,g,t,w){pb.call(this);this.type="TubeGeometry";this.parameters={path:a,segments:b,radius:d,radialSegments:g,closed:t,taper:w};b=b||64;d=d||1;g=g||8;t=t||!1;w=w||Gc.NoTaper;var y=[],F=b+1,K=new r;var M=new Gc.FrenetFrames(a,b,t);var T=M.normals;var Q=M.binormals;this.tangents=M.tangents;this.normals=T;this.binormals=Q;for(M=0;M<F;M++){y[M]=[];var P=M/(F-1);var Z=a.getPointAt(P);var ca=T[M];var ja=Q[M];var oa=d*w(P);for(P=0;P<g;P++){var ra=P/g*2*Math.PI;
var aa=-oa*Math.cos(ra);ra=oa*Math.sin(ra);K.copy(Z);K.x+=aa*ca.x+ra*ja.x;K.y+=aa*ca.y+ra*ja.y;K.z+=aa*ca.z+ra*ja.z;y[M][P]=this.vertices.push(new r(K.x,K.y,K.z))-1}}for(M=0;M<b;M++)for(P=0;P<g;P++)w=t?(M+1)%b:M+1,F=(P+1)%g,a=y[M][P],d=y[w][P],w=y[w][F],F=y[M][F],K=new n(M/b,P/g),T=new n((M+1)/b,P/g),Q=new n((M+1)/b,(P+1)/g),ca=new n(M/b,(P+1)/g),this.faces.push(new Pb(a,d,F)),this.faceVertexUvs[0].push([K,T,ca]),this.faces.push(new Pb(d,w,F)),this.faceVertexUvs[0].push([T.clone(),Q,ca.clone()]);
this.computeFaceNormals();this.computeVertexNormals()}function Id(a,b,d,g,t,w){function y(Ia,Oa,Ta,Na,Ua){var ab=Math.sin(Ia);Oa=Ta/Oa*Ia;Ta=Math.cos(Oa);Ua.x=Na*(2+Ta)*.5*Math.cos(Ia);Ua.y=Na*(2+Ta)*ab*.5;Ua.z=Na*Math.sin(Oa)*.5}qb.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:a,tube:b,tubularSegments:d,radialSegments:g,p:t,q:w};a=a||100;b=b||40;d=Math.floor(d)||64;g=Math.floor(g)||8;t=t||2;w=w||3;var F=(g+1)*(d+1),K=g*d*6;K=new gb(new (65535<K?Uint32Array:Uint16Array)(K),
1);var M=new gb(new Float32Array(3*F),3),T=new gb(new Float32Array(3*F),3);F=new gb(new Float32Array(2*F),2);var Q,P=0,Z=0,ca=new r,ja=new r,oa=new n,ra=new r,aa=new r,qa=new r,na=new r,ua=new r;for(Q=0;Q<=d;++Q){var ta=Q/d*t*Math.PI*2;y(ta,t,w,a,ra);y(ta+.01,t,w,a,aa);na.subVectors(aa,ra);ua.addVectors(aa,ra);qa.crossVectors(na,ua);ua.crossVectors(qa,na);qa.normalize();ua.normalize();for(ta=0;ta<=g;++ta){var Aa=ta/g*Math.PI*2,Ka=-b*Math.cos(Aa);Aa=b*Math.sin(Aa);ca.x=ra.x+(Ka*ua.x+Aa*qa.x);ca.y=
ra.y+(Ka*ua.y+Aa*qa.y);ca.z=ra.z+(Ka*ua.z+Aa*qa.z);M.setXYZ(P,ca.x,ca.y,ca.z);ja.subVectors(ca,ra).normalize();T.setXYZ(P,ja.x,ja.y,ja.z);oa.x=Q/d;oa.y=ta/g;F.setXY(P,oa.x,oa.y);P++}}for(ta=1;ta<=d;ta++)for(Q=1;Q<=g;Q++)a=(g+1)*ta+(Q-1),b=(g+1)*ta+Q,t=(g+1)*(ta-1)+Q,K.setX(Z,(g+1)*(ta-1)+(Q-1)),Z++,K.setX(Z,a),Z++,K.setX(Z,t),Z++,K.setX(Z,a),Z++,K.setX(Z,b),Z++,K.setX(Z,t),Z++;this.setIndex(K);this.addAttribute("position",M);this.addAttribute("normal",T);this.addAttribute("uv",F)}function se(a,b,
d,g,t,w,y){pb.call(this);this.type="TorusKnotGeometry";this.parameters={radius:a,tube:b,tubularSegments:d,radialSegments:g,p:t,q:w};void 0!==y&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new Id(a,b,d,g,t,w));this.mergeVertices()}function Jd(a,b,d,g,t){qb.call(this);this.type="TorusBufferGeometry";this.parameters={radius:a,tube:b,radialSegments:d,tubularSegments:g,arc:t};a=a||100;b=b||40;d=Math.floor(d)||8;g=Math.floor(g)||
6;t=t||2*Math.PI;var w=(d+1)*(g+1),y=d*g*6;y=new (65535<y?Uint32Array:Uint16Array)(y);var F=new Float32Array(3*w),K=new Float32Array(3*w);w=new Float32Array(2*w);var M=0,T=0,Q=0,P=new r,Z=new r,ca=new r,ja,oa;for(ja=0;ja<=d;ja++)for(oa=0;oa<=g;oa++){var ra=oa/g*t,aa=ja/d*Math.PI*2;Z.x=(a+b*Math.cos(aa))*Math.cos(ra);Z.y=(a+b*Math.cos(aa))*Math.sin(ra);Z.z=b*Math.sin(aa);F[M]=Z.x;F[M+1]=Z.y;F[M+2]=Z.z;P.x=a*Math.cos(ra);P.y=a*Math.sin(ra);ca.subVectors(Z,P).normalize();K[M]=ca.x;K[M+1]=ca.y;K[M+2]=
ca.z;w[T]=oa/g;w[T+1]=ja/d;M+=3;T+=2}for(ja=1;ja<=d;ja++)for(oa=1;oa<=g;oa++)a=(g+1)*(ja-1)+oa-1,b=(g+1)*(ja-1)+oa,t=(g+1)*ja+oa,y[Q]=(g+1)*ja+oa-1,y[Q+1]=a,y[Q+2]=t,y[Q+3]=a,y[Q+4]=b,y[Q+5]=t,Q+=6;this.setIndex(new gb(y,1));this.addAttribute("position",new gb(F,3));this.addAttribute("normal",new gb(K,3));this.addAttribute("uv",new gb(w,2))}function te(a,b,d,g,t){pb.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:d,tubularSegments:g,arc:t};this.fromBufferGeometry(new Jd(a,
b,d,g,t))}function Cc(a,b){"undefined"!==typeof a&&(pb.call(this),this.type="ExtrudeGeometry",a=Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeFaceNormals())}function ue(a,b){b=b||{};var d=b.font;if(!1===(d&&d.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new pb;a=d.generateShapes(a,b.size,b.curveSegments);b.amount=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===
b.bevelEnabled&&(b.bevelEnabled=!1);Cc.call(this,a,b);this.type="TextGeometry"}function hd(a,b,d,g,t,w,y){qb.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:d,phiStart:g,phiLength:t,thetaStart:w,thetaLength:y};a=a||50;b=Math.max(3,Math.floor(b)||8);d=Math.max(2,Math.floor(d)||6);g=void 0!==g?g:0;t=void 0!==t?t:2*Math.PI;w=void 0!==w?w:0;y=void 0!==y?y:Math.PI;var F=w+y,K=(b+1)*(d+1),M=new gb(new Float32Array(3*K),3),T=new gb(new Float32Array(3*
K),3);K=new gb(new Float32Array(2*K),2);for(var Q=0,P=[],Z=new r,ca=0;ca<=d;ca++){for(var ja=[],oa=ca/d,ra=0;ra<=b;ra++){var aa=ra/b,qa=-a*Math.cos(g+aa*t)*Math.sin(w+oa*y),na=a*Math.cos(w+oa*y),ua=a*Math.sin(g+aa*t)*Math.sin(w+oa*y);Z.set(qa,na,ua).normalize();M.setXYZ(Q,qa,na,ua);T.setXYZ(Q,Z.x,Z.y,Z.z);K.setXY(Q,aa,1-oa);ja.push(Q);Q++}P.push(ja)}g=[];for(ca=0;ca<d;ca++)for(ra=0;ra<b;ra++)t=P[ca][ra+1],y=P[ca][ra],Q=P[ca+1][ra],Z=P[ca+1][ra+1],(0!==ca||0<w)&&g.push(t,y,Z),(ca!==d-1||F<Math.PI)&&
g.push(y,Q,Z);this.setIndex(new (65535<M.count?Ad:be)(g,1));this.addAttribute("position",M);this.addAttribute("normal",T);this.addAttribute("uv",K);this.boundingSphere=new rb(new r,a)}function Kd(a,b,d,g,t,w,y){pb.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:d,phiStart:g,phiLength:t,thetaStart:w,thetaLength:y};this.fromBufferGeometry(new hd(a,b,d,g,t,w,y))}function Ld(a,b,d,g,t,w){qb.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:a,
outerRadius:b,thetaSegments:d,phiSegments:g,thetaStart:t,thetaLength:w};a=a||20;b=b||50;t=void 0!==t?t:0;w=void 0!==w?w:2*Math.PI;d=void 0!==d?Math.max(3,d):8;g=void 0!==g?Math.max(1,g):1;var y=(d+1)*(g+1),F=d*g*6;F=new gb(new (65535<F?Uint32Array:Uint16Array)(F),1);var K=new gb(new Float32Array(3*y),3),M=new gb(new Float32Array(3*y),3);y=new gb(new Float32Array(2*y),2);var T=0,Q=0,P=a,Z=(b-a)/g,ca=new r,ja=new n,oa;for(a=0;a<=g;a++){for(oa=0;oa<=d;oa++){var ra=t+oa/d*w;ca.x=P*Math.cos(ra);ca.y=P*
Math.sin(ra);K.setXYZ(T,ca.x,ca.y,ca.z);M.setXYZ(T,0,0,1);ja.x=(ca.x/b+1)/2;ja.y=(ca.y/b+1)/2;y.setXY(T,ja.x,ja.y);T++}P+=Z}for(a=0;a<g;a++)for(b=a*(d+1),oa=0;oa<d;oa++)t=ra=oa+b,w=ra+d+1,T=ra+d+2,ra+=1,F.setX(Q,t),Q++,F.setX(Q,w),Q++,F.setX(Q,T),Q++,F.setX(Q,t),Q++,F.setX(Q,T),Q++,F.setX(Q,ra),Q++;this.setIndex(F);this.addAttribute("position",K);this.addAttribute("normal",M);this.addAttribute("uv",y)}function ve(a,b,d,g,t,w){pb.call(this);this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:b,
thetaSegments:d,phiSegments:g,thetaStart:t,thetaLength:w};this.fromBufferGeometry(new Ld(a,b,d,g,t,w))}function we(a,b,d,g){pb.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:b,widthSegments:d,heightSegments:g};this.fromBufferGeometry(new vc(a,b,d,g))}function Md(a,b,d,g){qb.call(this);this.type="LatheBufferGeometry";this.parameters={points:a,segments:b,phiStart:d,phiLength:g};b=Math.floor(b)||12;d=d||0;g=g||2*Math.PI;g=c.Math.clamp(g,0,2*Math.PI);var t=(b+1)*a.length,w=b*a.length*
6,y=new gb(new (65535<w?Uint32Array:Uint16Array)(w),1),F=new gb(new Float32Array(3*t),3),K=new gb(new Float32Array(2*t),2),M=0,T=0,Q=1/b,P=new r,Z=new n;for(t=0;t<=b;t++){w=d+t*Q*g;var ca=Math.sin(w),ja=Math.cos(w);for(w=0;w<=a.length-1;w++)P.x=a[w].x*ca,P.y=a[w].y,P.z=a[w].x*ja,F.setXYZ(M,P.x,P.y,P.z),Z.x=t/b,Z.y=w/(a.length-1),K.setXY(M,Z.x,Z.y),M++}for(t=0;t<b;t++)for(w=0;w<a.length-1;w++)d=w+t*a.length,M=d+a.length,Q=d+a.length+1,P=d+1,y.setX(T,d),T++,y.setX(T,M),T++,y.setX(T,P),T++,y.setX(T,
M),T++,y.setX(T,Q),T++,y.setX(T,P),T++;this.setIndex(y);this.addAttribute("position",F);this.addAttribute("uv",K);this.computeVertexNormals();if(g===2*Math.PI)for(g=this.attributes.normal.array,y=new r,F=new r,K=new r,d=b*a.length*3,w=t=0;t<a.length;t++,w+=3)y.x=g[w+0],y.y=g[w+1],y.z=g[w+2],F.x=g[d+w+0],F.y=g[d+w+1],F.z=g[d+w+2],K.addVectors(y,F).normalize(),g[w+0]=g[d+w+0]=K.x,g[w+1]=g[d+w+1]=K.y,g[w+2]=g[d+w+2]=K.z}function xe(a,b,d,g){pb.call(this);this.type="LatheGeometry";this.parameters={points:a,
segments:b,phiStart:d,phiLength:g};this.fromBufferGeometry(new Md(a,b,d,g));this.mergeVertices()}function Zc(a,b){pb.call(this);this.type="ShapeGeometry";!1===Array.isArray(a)&&(a=[a]);this.addShapeList(a,b);this.computeFaceNormals()}function Nd(a,b){function d(P,Z){return P-Z}qb.call(this);b=Math.cos(c.Math.DEG2RAD*(void 0!==b?b:1));var g=[0,0],t={},w=["a","b","c"];if(a&&a.isBufferGeometry){var y=new pb;y.fromBufferGeometry(a)}else y=a.clone();y.mergeVertices();y.computeFaceNormals();a=y.vertices;
y=y.faces;for(var F=0,K=y.length;F<K;F++)for(var M=y[F],T=0;3>T;T++){g[0]=M[w[T]];g[1]=M[w[(T+1)%3]];g.sort(d);var Q=g.toString();void 0===t[Q]?t[Q]={vert1:g[0],vert2:g[1],face1:F,face2:void 0}:t[Q].face2=F}g=[];for(Q in t)if(w=t[Q],void 0===w.face2||y[w.face1].normal.dot(y[w.face2].normal)<=b)F=a[w.vert1],g.push(F.x),g.push(F.y),g.push(F.z),F=a[w.vert2],g.push(F.x),g.push(F.y),g.push(F.z);this.addAttribute("position",new gb(new Float32Array(g),3))}function $c(a,b,d,g,t,w,y,F){function K(ta){var Aa,
Ka=new n,Ia=new r,Oa=0,Ta=!0===ta?a:b,Na=!0===ta?1:-1;var Ua=ra;for(Aa=1;Aa<=g;Aa++)ca.setXYZ(ra,0,na*Na,0),ja.setXYZ(ra,0,Na,0),Ka.x=.5,Ka.y=.5,oa.setXY(ra,Ka.x,Ka.y),ra++;var ab=ra;for(Aa=0;Aa<=g;Aa++){var Pa=Aa/g*F+y,Ma=Math.cos(Pa);Pa=Math.sin(Pa);Ia.x=Ta*Pa;Ia.y=na*Na;Ia.z=Ta*Ma;ca.setXYZ(ra,Ia.x,Ia.y,Ia.z);ja.setXYZ(ra,0,Na,0);Ka.x=.5*Ma+.5;Ka.y=.5*Pa*Na+.5;oa.setXY(ra,Ka.x,Ka.y);ra++}for(Aa=0;Aa<g;Aa++)Ka=Ua+Aa,Ia=ab+Aa,!0===ta?(Z.setX(aa,Ia),aa++,Z.setX(aa,Ia+1)):(Z.setX(aa,Ia+1),aa++,Z.setX(aa,
Ia)),aa++,Z.setX(aa,Ka),aa++,Oa+=3;M.addGroup(ua,Oa,!0===ta?1:2);ua+=Oa}qb.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:d,radialSegments:g,heightSegments:t,openEnded:w,thetaStart:y,thetaLength:F};var M=this;a=void 0!==a?a:20;b=void 0!==b?b:20;d=void 0!==d?d:100;g=Math.floor(g)||8;t=Math.floor(t)||1;w=void 0!==w?w:!1;y=void 0!==y?y:0;F=void 0!==F?F:2*Math.PI;var T=0;!1===w&&(0<a&&T++,0<b&&T++);var Q=function(){var ta=(g+1)*(t+1);!1===w&&(ta+=(g+1)*
T+g*T);return ta}(),P=function(){var ta=g*t*6;!1===w&&(ta+=g*T*3);return ta}(),Z=new gb(new (65535<P?Uint32Array:Uint16Array)(P),1),ca=new gb(new Float32Array(3*Q),3),ja=new gb(new Float32Array(3*Q),3),oa=new gb(new Float32Array(2*Q),2),ra=0,aa=0,qa=[],na=d/2,ua=0;(function(){var ta,Aa,Ka=new r,Ia=new r,Oa=0,Ta=(b-a)/d;for(Aa=0;Aa<=t;Aa++){var Na=[],Ua=Aa/t,ab=Ua*(b-a)+a;for(ta=0;ta<=g;ta++){var Pa=ta/g,Ma=Pa*F+y,Wa=Math.sin(Ma);Ma=Math.cos(Ma);Ia.x=ab*Wa;Ia.y=-Ua*d+na;Ia.z=ab*Ma;ca.setXYZ(ra,Ia.x,
Ia.y,Ia.z);Ka.set(Wa,Ta,Ma).normalize();ja.setXYZ(ra,Ka.x,Ka.y,Ka.z);oa.setXY(ra,Pa,1-Ua);Na.push(ra);ra++}qa.push(Na)}for(ta=0;ta<g;ta++)for(Aa=0;Aa<t;Aa++)Ka=qa[Aa+1][ta],Ia=qa[Aa+1][ta+1],Ta=qa[Aa][ta+1],Z.setX(aa,qa[Aa][ta]),aa++,Z.setX(aa,Ka),aa++,Z.setX(aa,Ta),aa++,Z.setX(aa,Ka),aa++,Z.setX(aa,Ia),aa++,Z.setX(aa,Ta),aa++,Oa+=6;M.addGroup(ua,Oa,0);ua+=Oa})();!1===w&&(0<a&&K(!0),0<b&&K(!1));this.setIndex(Z);this.addAttribute("position",ca);this.addAttribute("normal",ja);this.addAttribute("uv",
oa)}function id(a,b,d,g,t,w,y,F){pb.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:d,radialSegments:g,heightSegments:t,openEnded:w,thetaStart:y,thetaLength:F};this.fromBufferGeometry(new $c(a,b,d,g,t,w,y,F));this.mergeVertices()}function ye(a,b,d,g,t,w,y){id.call(this,0,a,b,d,g,t,w,y);this.type="ConeGeometry";this.parameters={radius:a,height:b,radialSegments:d,heightSegments:g,openEnded:t,thetaStart:w,thetaLength:y}}function ze(a,b,d,g,t,w,y){$c.call(this,
0,a,b,d,g,t,w,y);this.type="ConeBufferGeometry";this.parameters={radius:a,height:b,radialSegments:d,heightSegments:g,thetaStart:w,thetaLength:y}}function Od(a,b,d,g){qb.call(this);this.type="CircleBufferGeometry";this.parameters={radius:a,segments:b,thetaStart:d,thetaLength:g};a=a||50;b=void 0!==b?Math.max(3,b):8;d=void 0!==d?d:0;g=void 0!==g?g:2*Math.PI;var t=b+2,w=new Float32Array(3*t),y=new Float32Array(3*t);t=new Float32Array(2*t);y[2]=1;t[0]=.5;t[1]=.5;for(var F=0,K=3,M=2;F<=b;F++,K+=3,M+=2){var T=
d+F/b*g;w[K]=a*Math.cos(T);w[K+1]=a*Math.sin(T);y[K+2]=1;t[M]=(w[K]/a+1)/2;t[M+1]=(w[K+1]/a+1)/2}d=[];for(K=1;K<=b;K++)d.push(K,K+1,0);this.setIndex(new gb(new Uint16Array(d),1));this.addAttribute("position",new gb(w,3));this.addAttribute("normal",new gb(y,3));this.addAttribute("uv",new gb(t,2));this.boundingSphere=new rb(new r,a)}function Ae(a,b,d,g){pb.call(this);this.type="CircleGeometry";this.parameters={radius:a,segments:b,thetaStart:d,thetaLength:g};this.fromBufferGeometry(new Od(a,b,d,g))}
function jd(a,b,d,g,t,w){pb.call(this);this.type="BoxGeometry";this.parameters={width:a,height:b,depth:d,widthSegments:g,heightSegments:t,depthSegments:w};this.fromBufferGeometry(new Jc(a,b,d,g,t,w));this.mergeVertices()}function Pd(){ob.call(this,{uniforms:c.UniformsUtils.merge([Eb.lights,{opacity:{value:1}}]),vertexShader:Lb.shadow_vert,fragmentShader:Lb.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},
set:function(a){this.uniforms.opacity.value=a}}})}function Qd(a){ob.call(this,a);this.type="RawShaderMaterial"}function Be(a){this.uuid=c.Math.generateUUID();this.type="MultiMaterial";this.materials=a instanceof Array?a:[];this.visible=!0}function Mc(a){za.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new ma(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new ma(0);
this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new n(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function kd(a){Mc.call(this);
this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)}function ad(a){za.call(this);this.type="MeshPhongMaterial";this.color=new ma(16777215);this.specular=new ma(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new ma(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=
new n(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function ld(a){za.call(this,a);this.type="MeshNormalMaterial";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=this.lights=this.fog=
!1;this.setValues(a)}function md(a){za.call(this);this.type="MeshLambertMaterial";this.color=new ma(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new ma(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=
this.skinning=!1;this.setValues(a)}function nd(a){za.call(this);this.type="LineDashedMaterial";this.color=new ma(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(a)}function vf(a,b,d){var g=this,t=!1,w=0,y=0;this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=d;this.itemStart=function(F){y++;if(!1===t&&void 0!==g.onStart)g.onStart(F,w,y);t=!0};this.itemEnd=function(F){w++;if(void 0!==g.onProgress)g.onProgress(F,w,y);if(w===y&&(t=!1,void 0!==
g.onLoad))g.onLoad()};this.itemError=function(F){if(void 0!==g.onError)g.onError(F)}}function Hc(a){this.manager=void 0!==a?a:c.DefaultLoadingManager}function ag(a){this.manager=void 0!==a?a:c.DefaultLoadingManager;this._parser=null}function wf(a){this.manager=void 0!==a?a:c.DefaultLoadingManager;this._parser=null}function Ce(a){this.manager=void 0!==a?a:c.DefaultLoadingManager}function xf(a){this.manager=void 0!==a?a:c.DefaultLoadingManager}function $e(a){this.manager=void 0!==a?a:c.DefaultLoadingManager}
function kc(a,b){jb.call(this);this.type="Light";this.color=new ma(a);this.intensity=void 0!==b?b:1;this.receiveShadow=void 0}function af(a,b,d){kc.call(this,a,d);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(jb.DefaultUp);this.updateMatrix();this.groundColor=new ma(b)}function od(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new n(512,512);this.map=null;this.matrix=new z}function bf(){od.call(this,new hc(50,1,.5,500))}function cf(a,b,d,g,t,w){kc.call(this,a,b);this.type=
"SpotLight";this.position.copy(jb.DefaultUp);this.updateMatrix();this.target=new jb;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(y){this.intensity=y/Math.PI}});this.distance=void 0!==d?d:0;this.angle=void 0!==g?g:Math.PI/3;this.penumbra=void 0!==t?t:0;this.decay=void 0!==w?w:1;this.shadow=new bf}function df(a,b,d,g){kc.call(this,a,b);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=
t/(4*Math.PI)}});this.distance=void 0!==d?d:0;this.decay=void 0!==g?g:1;this.shadow=new od(new hc(90,1,.5,500))}function ef(a){od.call(this,new zc(-5,5,5,-5,.5,500))}function ff(a,b){kc.call(this,a,b);this.type="DirectionalLight";this.position.copy(jb.DefaultUp);this.updateMatrix();this.target=new jb;this.shadow=new ef}function gf(a,b){kc.call(this,a,b);this.type="AmbientLight";this.castShadow=void 0}function yc(a,b,d,g){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==g?g:
new b.constructor(d);this.sampleValues=b;this.valueSize=d}function hf(a,b,d,g){yc.call(this,a,b,d,g);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function De(a,b,d,g){yc.call(this,a,b,d,g)}function jf(a,b,d,g){yc.call(this,a,b,d,g)}function pd(a,b,d,g){if(void 0===a)throw Error("track name is undefined");if(void 0===b||0===b.length)throw Error("no keyframes in track named "+a);this.name=a;this.times=c.AnimationUtils.convertArray(b,this.TimeBufferType);this.values=c.AnimationUtils.convertArray(d,
this.ValueBufferType);this.setInterpolation(g||this.DefaultInterpolation);this.validate();this.optimize()}function Rd(a,b,d,g){pd.call(this,a,b,d,g)}function kf(a,b,d,g){yc.call(this,a,b,d,g)}function Ee(a,b,d,g){pd.call(this,a,b,d,g)}function Sd(a,b,d,g){pd.call(this,a,b,d,g)}function lf(a,b,d,g){pd.call(this,a,b,d,g)}function mf(a,b,d){pd.call(this,a,b,d)}function nf(a,b,d,g){pd.call(this,a,b,d,g)}function qd(a,b,d,g){pd.apply(this,arguments)}function Dc(a,b,d){this.name=a;this.tracks=d;this.duration=
void 0!==b?b:-1;this.uuid=c.Math.generateUUID();0>this.duration&&this.resetDuration();this.optimize()}function of(a){this.manager=void 0!==a?a:c.DefaultLoadingManager;this.textures={}}function yf(a){this.manager=void 0!==a?a:c.DefaultLoadingManager}function rd(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}}function zf(a){"boolean"===typeof a&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=
void 0!==a?a:c.DefaultLoadingManager;this.withCredentials=!1}function bg(a){this.manager=void 0!==a?a:c.DefaultLoadingManager;this.texturePath=""}function rc(){}function Nc(a,b){this.v1=a;this.v2=b}function Fe(){this.curves=[];this.autoClose=!1}function Vc(a,b,d,g,t,w,y,F){this.aX=a;this.aY=b;this.xRadius=d;this.yRadius=g;this.aStartAngle=t;this.aEndAngle=w;this.aClockwise=y;this.aRotation=F||0}function sd(a){this.points=void 0===a?[]:a}function td(a,b,d,g){this.v0=a;this.v1=b;this.v2=d;this.v3=g}
function ud(a,b,d){this.v0=a;this.v1=b;this.v2=d}function vd(){Ge.apply(this,arguments);this.holes=[]}function Ge(a){Fe.call(this);this.currentPoint=new n;a&&this.fromPoints(a)}function Af(){this.subPaths=[];this.currentPath=null}function Bf(a){this.data=a}function cg(a){this.manager=void 0!==a?a:c.DefaultLoadingManager}function Cf(){void 0===Df&&(Df=new (window.AudioContext||window.webkitAudioContext));return Df}function Ef(a){this.manager=void 0!==a?a:c.DefaultLoadingManager}function dg(){this.type=
"StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new hc;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new hc;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1}function pf(a,b,d){jb.call(this);this.type="CubeCamera";var g=new hc(90,1,a,b);g.up.set(0,-1,0);g.lookAt(new r(1,0,0));this.add(g);var t=new hc(90,1,a,b);t.up.set(0,-1,0);t.lookAt(new r(-1,0,0));this.add(t);var w=new hc(90,1,a,b);w.up.set(0,0,1);w.lookAt(new r(0,1,0));this.add(w);var y=new hc(90,
1,a,b);y.up.set(0,0,-1);y.lookAt(new r(0,-1,0));this.add(y);var F=new hc(90,1,a,b);F.up.set(0,-1,0);F.lookAt(new r(0,0,1));this.add(F);var K=new hc(90,1,a,b);K.up.set(0,-1,0);K.lookAt(new r(0,0,-1));this.add(K);this.renderTarget=new k(d,d,{format:1022,magFilter:1006,minFilter:1006});this.updateCubeMap=function(M,T){null===this.parent&&this.updateMatrixWorld();var Q=this.renderTarget,P=Q.texture.generateMipmaps;Q.texture.generateMipmaps=!1;Q.activeCubeFace=0;M.render(T,g,Q);Q.activeCubeFace=1;M.render(T,
t,Q);Q.activeCubeFace=2;M.render(T,w,Q);Q.activeCubeFace=3;M.render(T,y,Q);Q.activeCubeFace=4;M.render(T,F,Q);Q.texture.generateMipmaps=P;Q.activeCubeFace=5;M.render(T,K,Q);M.setRenderTarget(null)}}function Ff(){jb.call(this);this.type="AudioListener";this.context=Cf();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}function Td(a){jb.call(this);this.type="Audio";this.context=a.context;this.source=this.context.createBufferSource();this.source.onended=
this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]}function Gf(a){Td.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)}function Hf(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==b?b:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)}
function qf(a,b,d){this.binding=a;this.valueSize=d;a=Float64Array;switch(b){case "quaternion":b=this._slerp;break;case "string":case "bool":a=Array;b=this._select;break;default:b=this._lerp}this.buffer=new a(4*d);this._mixBufferRegion=b;this.referenceCount=this.useCount=this.cumulativeWeight=0}function ac(a,b,d){this.path=b;this.parsedPath=d||ac.parseTrackName(b);this.node=ac.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a}function If(a){this.uuid=c.Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);
this.nCachedObjects_=0;var b={};this._indicesByUUID=b;for(var d=0,g=arguments.length;d!==g;++d)b[arguments[d].uuid]=d;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}function Jf(a,b,d){this._mixer=a;this._clip=b;this._localRoot=d||null;a=b.tracks;b=a.length;d=Array(b);for(var g={endingStart:2400,
endingEnd:2400},t=0;t!==b;++t){var w=a[t].createInterpolant(null);d[t]=w;w.settings=g}this._interpolantSettings=g;this._interpolants=d;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=
this.zeroSlopeAtStart=!0}function Kf(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function eg(a,b){"string"===typeof a&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),a=b);this.value=a}function wd(){qb.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}function Lf(a,b,d,g){this.uuid=c.Math.generateUUID();this.data=a;this.itemSize=b;this.offset=d;this.normalized=!0===g}function Ud(a,b){this.uuid=c.Math.generateUUID();
this.array=a;this.stride=b;this.count=void 0!==a?a.length/b:0;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0}function Vd(a,b,d){Ud.call(this,a,b);this.meshPerAttribute=d||1}function Wd(a,b,d){gb.call(this,a,b);this.meshPerAttribute=d||1}function Mf(a,b,d,g){this.ray=new sc(a,b);this.near=d||0;this.far=g||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");
return this.Points}}})}function fg(a,b){return a.distance-b.distance}function Nf(a,b,d,g){if(!1!==a.visible&&(a.raycast(b,d),!0===g)){a=a.children;g=0;for(var t=a.length;g<t;g++)Nf(a[g],b,d,!0)}}function Of(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}function Pf(a,b,d){this.radius=void 0!==a?a:1;this.phi=void 0!==b?b:0;this.theta=void 0!==d?d:0;return this}function oc(a,b){Rb.call(this,a,b);this.animationsMap={};this.animationsList=[];a=this.geometry.morphTargets.length;
this.createAnimation("__default",0,a-1,a/1);this.setAnimationWeight("__default",1)}function He(a){jb.call(this);this.material=a;this.render=function(b){}}function Ie(a,b,d,g){this.object=a;this.size=void 0!==b?b:1;a=void 0!==d?d:16711680;g=void 0!==g?g:1;b=0;(d=this.object.geometry)&&d.isGeometry?b=3*d.faces.length:d&&d.isBufferGeometry&&(b=d.attributes.normal.count);d=new qb;b=new Qb(6*b,3);d.addAttribute("position",b);$b.call(this,d,new gc({color:a,linewidth:g}));this.matrixAutoUpdate=!1;this.update()}
function Xd(a){jb.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new qb;for(var b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],d=0,g=1;32>d;d++,g++){var t=d/32*Math.PI*2,w=g/32*Math.PI*2;b.push(Math.cos(t),Math.sin(t),1,Math.cos(w),Math.sin(w),1)}a.addAttribute("position",new Qb(b,3));b=new gc({fog:!1});this.cone=new $b(a,b);this.add(this.cone);this.update()}function Yd(a){this.bones=this.getBoneList(a);for(var b=new pb,
d=0;d<this.bones.length;d++){var g=this.bones[d];g.parent&&g.parent.isBone&&(b.vertices.push(new r),b.vertices.push(new r),b.colors.push(new ma(0,0,1)),b.colors.push(new ma(0,1,0)))}b.dynamic=!0;d=new gc({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});$b.call(this,b,d);this.root=a;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function Zd(a,b){this.light=a;this.light.updateMatrixWorld();a=new hd(b,4,2);b=new bc({wireframe:!0,fog:!1});b.color.copy(this.light.color).multiplyScalar(this.light.intensity);
Rb.call(this,a,b);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1}function $d(a,b){jb.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new ma,new ma];a=new Kd(b,4,2);a.rotateX(-Math.PI/2);for(b=0;8>b;b++)a.faces[b].color=this.colors[4>b?0:1];b=new bc({vertexColors:1,wireframe:!0});this.lightSphere=new Rb(a,b);this.add(this.lightSphere);this.update()}function Je(a,b,d,g){b=b||1;d=new ma(void 0!==d?d:4473924);g=new ma(void 0!==
g?g:8947848);for(var t=b/2,w=2*a/b,y=[],F=[],K=0,M=0,T=-a;K<=b;K++,T+=w){y.push(-a,0,T,a,0,T);y.push(T,0,-a,T,0,a);var Q=K===t?d:g;Q.toArray(F,M);M+=3;Q.toArray(F,M);M+=3;Q.toArray(F,M);M+=3;Q.toArray(F,M);M+=3}a=new qb;a.addAttribute("position",new Qb(y,3));a.addAttribute("color",new Qb(F,3));y=new gc({vertexColors:2});$b.call(this,a,y)}function Ke(a,b,d,g){this.object=a;this.size=void 0!==b?b:1;a=void 0!==d?d:16776960;g=void 0!==g?g:1;b=0;(d=this.object.geometry)&&d.isGeometry?b=d.faces.length:
console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");d=new qb;b=new Qb(6*b,3);d.addAttribute("position",b);$b.call(this,d,new gc({color:a,linewidth:g}));this.matrixAutoUpdate=!1;this.update()}function ae(a,b){jb.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;void 0===b&&(b=1);a=new qb;a.addAttribute("position",new Qb([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));b=new gc({fog:!1});this.add(new Uc(a,
b));a=new qb;a.addAttribute("position",new Qb([0,0,0,0,0,1],3));this.add(new Uc(a,b));this.update()}function Le(a){function b(y,F,K){d(y,K);d(F,K)}function d(y,F){g.vertices.push(new r);g.colors.push(new ma(F));void 0===w[y]&&(w[y]=[]);w[y].push(g.vertices.length-1)}var g=new pb,t=new gc({color:16777215,vertexColors:1}),w={};b("n1","n2",16755200);b("n2","n4",16755200);b("n4","n3",16755200);b("n3","n1",16755200);b("f1","f2",16755200);b("f2","f4",16755200);b("f4","f3",16755200);b("f3","f1",16755200);
b("n1","f1",16755200);b("n2","f2",16755200);b("n3","f3",16755200);b("n4","f4",16755200);b("p","n1",16711680);b("p","n2",16711680);b("p","n3",16711680);b("p","n4",16711680);b("u1","u2",43775);b("u2","u3",43775);b("u3","u1",43775);b("c","t",16777215);b("p","c",3355443);b("cn1","cn2",3355443);b("cn3","cn4",3355443);b("cf1","cf2",3355443);b("cf3","cf4",3355443);$b.call(this,g,t);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=
!1;this.pointMap=w;this.update()}function Me(a,b){b=void 0!==b?b:8947848;this.object=a;this.box=new Ab;Rb.call(this,new jd(1,1,1),new bc({color:b,wireframe:!0}))}function Ne(a,b){void 0===b&&(b=16776960);var d=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),g=new Float32Array(24),t=new qb;t.setIndex(new gb(d,1));t.addAttribute("position",new gb(g,3));$b.call(this,t,new gc({color:b}));void 0!==a&&this.update(a)}function xd(a,b,d,g,t,w){jb.call(this);void 0===g&&(g=16776960);void 0===
d&&(d=1);void 0===t&&(t=.2*d);void 0===w&&(w=.2*t);this.position.copy(b);this.line=new Uc(gg,new gc({color:g}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new Rb(hg,new bc({color:g}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(a);this.setLength(d,t,w)}function rf(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),d=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);a=new qb;a.addAttribute("position",new gb(b,3));a.addAttribute("color",
new gb(d,3));b=new gc({vertexColors:2});$b.call(this,a,b)}function ig(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.");c.CatmullRomCurve3.call(this,a);this.type="catmullrom";this.closed=!0}function sf(a,b,d,g,t,w){Vc.call(this,a,b,d,d,g,t,w)}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",
{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});void 0===Object.assign&&function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),d=1;d<arguments.length;d++){var g=arguments[d];if(void 0!==g&&null!==g)for(var t in g)Object.prototype.hasOwnProperty.call(g,t)&&(b[t]=g[t])}return b}}();Object.assign(h.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners=
{});var d=this._listeners;void 0===d[a]&&(d[a]=[]);-1===d[a].indexOf(b)&&d[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var d=this._listeners;return void 0!==d[a]&&-1!==d[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;var d=[],g,t=b.length;for(g=
0;g<t;g++)d[g]=b[g];for(g=0;g<t;g++)d[g].call(this,a)}}}});var jg={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},kg={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Qf={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Rf={NearestFilter:1003,
NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};c.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),d=0,g;return function(){for(var t=0;36>t;t++)8===t||13===t||18===t||23===t?b[t]="-":14===t?b[t]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),g=d&15,d>>=4,b[t]=a[19===t?g&3|8:g]);return b.join("")}}(),
clamp:function(a,b,d){return Math.max(b,Math.min(d,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,d,g,t){return g+(a-b)*(t-g)/(d-b)},smoothstep:function(a,b,d){if(a<=b)return 0;if(a>=d)return 1;a=(a-b)/(d-b);return a*a*(3-2*a)},smootherstep:function(a,b,d){if(a<=b)return 0;if(a>=d)return 1;a=(a-b)/(d-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");return Math.random()},randInt:function(a,
b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(a){return a*c.Math.DEG2RAD},radToDeg:function(a){return a*c.Math.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};n.prototype={constructor:n,isVector2:!0,
get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+
a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},
sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;
this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,b;return function(d,g){void 0===a&&(a=new n,b=new n);a.set(d,d);b.set(g,g);return this.clamp(a,b)}}(),
clampLength:function(a,b){var d=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,d))/d)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=
-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=
this.x-a.x;a=this.y-a.y;return b*b+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,d){return this.subVectors(b,a).multiplyScalar(d).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,
b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,d){void 0===d&&(d=0);b=b*a.itemSize+d;this.x=a.array[b];this.y=a.array[b+1];return this},rotateAround:function(a,b){var d=Math.cos(b);b=Math.sin(b);var g=this.x-a.x,t=this.y-a.y;this.x=g*d-t*b+a.x;this.y=g*b+t*d+a.y;return this}};f.DEFAULT_IMAGE=void 0;f.DEFAULT_MAPPING=300;f.prototype={constructor:f,isTexture:!0,set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==
a.textures[this.uuid])return a.textures[this.uuid];var b={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var d=this.image;void 0===d.uuid&&(d.uuid=c.Math.generateUUID());if(void 0===a.images[d.uuid]){var g=a.images,
t=d.uuid,w=d.uuid;if(void 0!==d.toDataURL)var y=d;else y=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),y.width=d.width,y.height=d.height,y.getContext("2d").drawImage(d,0,0,d.width,d.height);y=2048<y.width||2048<y.height?y.toDataURL("image/jpeg",.6):y.toDataURL("image/png");g[t]={uuid:w,url:y}}b.image=d.uuid}return a.textures[this.uuid]=b},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(300===this.mapping){a.multiply(this.repeat);a.add(this.offset);
if(0>a.x||1<a.x)switch(this.wrapS){case 1E3:a.x-=Math.floor(a.x);break;case 1001:a.x=0>a.x?0:1;break;case 1002:a.x=1===Math.abs(Math.floor(a.x)%2)?Math.ceil(a.x)-a.x:a.x-Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case 1E3:a.y-=Math.floor(a.y);break;case 1001:a.y=0>a.y?0:1;break;case 1002:a.y=1===Math.abs(Math.floor(a.y)%2)?Math.ceil(a.y)-a.y:a.y-Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};Object.assign(f.prototype,h.prototype);var Tf=0;q.prototype={constructor:q,isVector4:!0,set:function(a,
b,d,g){this.x=a;this.y=b;this.z=d;this.w=g;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},
addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=
a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,d=this.y,g=this.z,t=this.w;a=a.elements;this.x=a[0]*b+a[4]*d+a[8]*g+a[12]*t;this.y=a[1]*b+a[5]*d+a[9]*g+a[13]*t;this.z=a[2]*b+a[6]*d+a[10]*g+a[14]*t;this.w=a[3]*b+a[7]*d+a[11]*g+a[15]*t;return this},
divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var b=a[0];var d=a[4];var g=a[8],t=a[1],w=a[5],y=a[9];var F=a[2];var K=a[6];var M=a[10];if(.01>Math.abs(d-t)&&.01>Math.abs(g-F)&&.01>Math.abs(y-K)){if(.1>Math.abs(d+t)&&.1>Math.abs(g+F)&&.1>Math.abs(y+K)&&.1>Math.abs(b+
w+M-3))return this.set(1,0,0,0),this;a=Math.PI;b=(b+1)/2;w=(w+1)/2;M=(M+1)/2;d=(d+t)/4;g=(g+F)/4;y=(y+K)/4;b>w&&b>M?.01>b?(K=0,d=F=.707106781):(K=Math.sqrt(b),F=d/K,d=g/K):w>M?.01>w?(K=.707106781,F=0,d=.707106781):(F=Math.sqrt(w),K=d/F,d=y/F):.01>M?(F=K=.707106781,d=0):(d=Math.sqrt(M),K=g/d,F=y/d);this.set(K,F,d,a);return this}a=Math.sqrt((K-y)*(K-y)+(g-F)*(g-F)+(t-d)*(t-d));.001>Math.abs(a)&&(a=1);this.x=(K-y)/a;this.y=(g-F)/a;this.z=(t-d)/a;this.w=Math.acos((b+w+M-1)/2);return this},min:function(a){this.x=
Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));this.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(d,
g){void 0===a&&(a=new q,b=new q);a.set(d,d,d,d);b.set(g,g,g,g);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=
0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,b,d){return this.subVectors(b,a).multiplyScalar(d).add(a)},equals:function(a){return a.x===
this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,d){void 0===d&&(d=0);b=b*a.itemSize+d;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=a.array[b+3];return this}};Object.assign(l.prototype,h.prototype,{isWebGLRenderTarget:!0,
setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
k.prototype=Object.create(l.prototype);k.prototype.constructor=k;k.prototype.isWebGLRenderTargetCube=!0;u.prototype={constructor:u,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,b,d,g){this._x=a;this._y=b;this._z=d;this._w=g;this.onChangeCallback();return this},
clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===(a&&a.isEuler))throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var d=Math.cos(a._x/2),g=Math.cos(a._y/2),t=Math.cos(a._z/2),w=Math.sin(a._x/2),y=Math.sin(a._y/2),F=Math.sin(a._z/2);a=a.order;"XYZ"===a?(this._x=w*g*t+d*y*F,
this._y=d*y*t-w*g*F,this._z=d*g*F+w*y*t,this._w=d*g*t-w*y*F):"YXZ"===a?(this._x=w*g*t+d*y*F,this._y=d*y*t-w*g*F,this._z=d*g*F-w*y*t,this._w=d*g*t+w*y*F):"ZXY"===a?(this._x=w*g*t-d*y*F,this._y=d*y*t+w*g*F,this._z=d*g*F+w*y*t,this._w=d*g*t-w*y*F):"ZYX"===a?(this._x=w*g*t-d*y*F,this._y=d*y*t+w*g*F,this._z=d*g*F-w*y*t,this._w=d*g*t+w*y*F):"YZX"===a?(this._x=w*g*t+d*y*F,this._y=d*y*t+w*g*F,this._z=d*g*F-w*y*t,this._w=d*g*t-w*y*F):"XZY"===a&&(this._x=w*g*t-d*y*F,this._y=d*y*t-w*g*F,this._z=d*g*F+w*y*t,
this._w=d*g*t+w*y*F);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,b){b/=2;var d=Math.sin(b);this._x=a.x*d;this._y=a.y*d;this._z=a.z*d;this._w=Math.cos(b);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,d=b[0];a=b[4];var g=b[8],t=b[1],w=b[5],y=b[9],F=b[2],K=b[6];b=b[10];var M=d+w+b;0<M?(d=.5/Math.sqrt(M+1),this._w=.25/d,this._x=(K-y)*d,this._y=(g-F)*d,this._z=(t-a)*d):d>w&&d>b?(d=2*Math.sqrt(1+d-w-b),this._w=(K-y)/d,this._x=.25*
d,this._y=(a+t)/d,this._z=(g+F)/d):w>b?(d=2*Math.sqrt(1+w-d-b),this._w=(g-F)/d,this._x=(a+t)/d,this._y=.25*d,this._z=(y+K)/d):(d=2*Math.sqrt(1+b-d-w),this._w=(t-a)/d,this._x=(g+F)/d,this._y=(y+K)/d,this._z=.25*d);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(d,g){void 0===a&&(a=new r);b=d.dot(g)+1;1E-6>b?(b=0,Math.abs(d.x)>Math.abs(d.z)?a.set(-d.y,d.x,0):a.set(0,-d.z,d.y)):a.crossVectors(d,g);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;return this.normalize()}}(),
inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=
1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var d=a._x,g=a._y,t=a._z;a=a._w;var w=b._x,y=b._y,F=b._z;b=b._w;this._x=d*b+a*w+g*F-
t*y;this._y=g*b+a*y+t*w-d*F;this._z=t*b+a*F+d*y-g*w;this._w=a*b-d*w-g*y-t*F;this.onChangeCallback();return this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var d=this._x,g=this._y,t=this._z,w=this._w,y=w*a._w+d*a._x+g*a._y+t*a._z;0>y?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,y=-y):this.copy(a);if(1<=y)return this._w=w,this._x=d,this._y=g,this._z=t,this;a=Math.sqrt(1-y*y);if(.001>Math.abs(a))return this._w=.5*(w+this._w),this._x=.5*(d+this._x),this._y=.5*(g+
this._y),this._z=.5*(t+this._z),this;var F=Math.atan2(a,y);y=Math.sin((1-b)*F)/a;b=Math.sin(b*F)/a;this._w=w*y+this._w*b;this._x=d*y+this._x*b;this._y=g*y+this._y*b;this._z=t*y+this._z*b;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===
b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};Object.assign(u,{slerp:function(a,b,d,g){return d.copy(a).slerp(b,g)},slerpFlat:function(a,b,d,g,t,w,y){var F=d[g+0],K=d[g+1],M=d[g+2];d=d[g+3];g=t[w+0];var T=t[w+1],Q=t[w+2];t=t[w+3];if(d!==t||F!==g||K!==T||M!==Q){w=1-y;var P=F*g+K*T+M*Q+d*t,Z=0<=P?1:-1,ca=1-P*P;ca>Number.EPSILON&&(ca=Math.sqrt(ca),P=Math.atan2(ca,P*Z),w=Math.sin(w*
P)/ca,y=Math.sin(y*P)/ca);Z*=y;F=F*w+g*Z;K=K*w+T*Z;M=M*w+Q*Z;d=d*w+t*Z;w===1-y&&(y=1/Math.sqrt(F*F+K*K+M*M+d*d),F*=y,K*=y,M*=y,d*=y)}a[b]=F;a[b+1]=K;a[b+2]=M;a[b+3]=d}});r.prototype={constructor:r,isVector3:!0,set:function(a,b,d){this.x=a;this.y=b;this.z=d;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;
case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;
return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,
b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===(b&&b.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new u);return this.applyQuaternion(a.setFromEuler(b))}}(),applyAxisAngle:function(){var a;return function(b,d){void 0===a&&(a=new u);return this.applyQuaternion(a.setFromAxisAngle(b,d))}}(),applyMatrix3:function(a){var b=this.x,d=this.y,g=this.z;a=
a.elements;this.x=a[0]*b+a[3]*d+a[6]*g;this.y=a[1]*b+a[4]*d+a[7]*g;this.z=a[2]*b+a[5]*d+a[8]*g;return this},applyMatrix4:function(a){var b=this.x,d=this.y,g=this.z;a=a.elements;this.x=a[0]*b+a[4]*d+a[8]*g+a[12];this.y=a[1]*b+a[5]*d+a[9]*g+a[13];this.z=a[2]*b+a[6]*d+a[10]*g+a[14];return this},applyProjection:function(a){var b=this.x,d=this.y,g=this.z;a=a.elements;var t=1/(a[3]*b+a[7]*d+a[11]*g+a[15]);this.x=(a[0]*b+a[4]*d+a[8]*g+a[12])*t;this.y=(a[1]*b+a[5]*d+a[9]*g+a[13])*t;this.z=(a[2]*b+a[6]*d+
a[10]*g+a[14])*t;return this},applyQuaternion:function(a){var b=this.x,d=this.y,g=this.z,t=a.x,w=a.y,y=a.z;a=a.w;var F=a*b+w*g-y*d,K=a*d+y*b-t*g,M=a*g+t*d-w*b;b=-t*b-w*d-y*g;this.x=F*a+b*-t+K*-y-M*-w;this.y=K*a+b*-w+M*-t-F*-y;this.z=M*a+b*-y+F*-w-K*-t;return this},project:function(){var a;return function(b){void 0===a&&(a=new z);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===a&&(a=new z);
a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,d=this.y,g=this.z;a=a.elements;this.x=a[0]*b+a[4]*d+a[8]*g;this.y=a[1]*b+a[5]*d+a[9]*g;this.z=a[2]*b+a[6]*d+a[10]*g;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,
a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,b;return function(d,g){void 0===a&&(a=new r,b=new r);a.set(d,d,d);b.set(g,g,g);return this.clamp(a,b)}}(),clampLength:function(a,b){var d=this.length();return this.multiplyScalar(Math.max(a,
Math.min(b,d))/d)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):
Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/
this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,d){return this.subVectors(b,a).multiplyScalar(d).add(a)},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);b=this.x;var d=this.y,g=this.z;this.x=d*a.z-g*a.y;this.y=g*a.x-b*a.z;this.z=b*a.y-d*a.x;return this},crossVectors:function(a,b){var d=
a.x,g=a.y;a=a.z;var t=b.x,w=b.y;b=b.z;this.x=g*b-a*w;this.y=a*t-d*b;this.z=d*w-g*t;return this},projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new r);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new r);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*
a.lengthSq());return Math.acos(c.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,d=this.y-a.y;a=this.z-a.z;return b*b+d*d+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,
3)},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),d=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=d;this.z=a;return this},setFromMatrixColumn:function(a,b){if("number"===typeof a){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var d=a;a=b;b=d}return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&
(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,d){void 0===d&&(d=0);b=b*a.itemSize+d;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};z.prototype={constructor:z,isMatrix4:!0,set:function(a,b,d,g,t,w,y,F,K,M,T,Q,P,Z,ca,ja){var oa=this.elements;oa[0]=a;oa[4]=b;oa[8]=d;oa[12]=g;oa[1]=t;oa[5]=w;oa[9]=y;oa[13]=F;oa[2]=K;oa[6]=M;oa[10]=
T;oa[14]=Q;oa[3]=P;oa[7]=Z;oa[11]=ca;oa[15]=ja;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new z).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,d){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);d.setFromMatrixColumn(this,2);return this},makeBasis:function(a,
b,d){this.set(a.x,b.x,d.x,0,a.y,b.y,d.y,0,a.z,b.z,d.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(b){void 0===a&&(a=new r);var d=this.elements,g=b.elements,t=1/a.setFromMatrixColumn(b,0).length(),w=1/a.setFromMatrixColumn(b,1).length();b=1/a.setFromMatrixColumn(b,2).length();d[0]=g[0]*t;d[1]=g[1]*t;d[2]=g[2]*t;d[4]=g[4]*w;d[5]=g[5]*w;d[6]=g[6]*w;d[8]=g[8]*b;d[9]=g[9]*b;d[10]=g[10]*b;return this}}(),makeRotationFromEuler:function(a){!1===(a&&a.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");
var b=this.elements,d=a.x,g=a.y,t=a.z,w=Math.cos(d);d=Math.sin(d);var y=Math.cos(g);g=Math.sin(g);var F=Math.cos(t);t=Math.sin(t);if("XYZ"===a.order){a=w*F;var K=w*t,M=d*F,T=d*t;b[0]=y*F;b[4]=-y*t;b[8]=g;b[1]=K+M*g;b[5]=a-T*g;b[9]=-d*y;b[2]=T-a*g;b[6]=M+K*g;b[10]=w*y}else"YXZ"===a.order?(a=y*F,K=y*t,M=g*F,T=g*t,b[0]=a+T*d,b[4]=M*d-K,b[8]=w*g,b[1]=w*t,b[5]=w*F,b[9]=-d,b[2]=K*d-M,b[6]=T+a*d,b[10]=w*y):"ZXY"===a.order?(a=y*F,K=y*t,M=g*F,T=g*t,b[0]=a-T*d,b[4]=-w*t,b[8]=M+K*d,b[1]=K+M*d,b[5]=w*F,b[9]=
T-a*d,b[2]=-w*g,b[6]=d,b[10]=w*y):"ZYX"===a.order?(a=w*F,K=w*t,M=d*F,T=d*t,b[0]=y*F,b[4]=M*g-K,b[8]=a*g+T,b[1]=y*t,b[5]=T*g+a,b[9]=K*g-M,b[2]=-g,b[6]=d*y,b[10]=w*y):"YZX"===a.order?(a=w*y,K=w*g,M=d*y,T=d*g,b[0]=y*F,b[4]=T-a*t,b[8]=M*t+K,b[1]=t,b[5]=w*F,b[9]=-d*F,b[2]=-g*F,b[6]=K*t+M,b[10]=a-T*t):"XZY"===a.order&&(a=w*y,K=w*g,M=d*y,T=d*g,b[0]=y*F,b[4]=-t,b[8]=g*F,b[1]=a*t+T,b[5]=w*F,b[9]=K*t-M,b[2]=M*t-K,b[6]=d*F,b[10]=T*t+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(a){var b=
this.elements,d=a.x,g=a.y,t=a.z,w=a.w,y=d+d,F=g+g,K=t+t;a=d*y;var M=d*F;d*=K;var T=g*F;g*=K;t*=K;y*=w;F*=w;w*=K;b[0]=1-(T+t);b[4]=M-w;b[8]=d+F;b[1]=M+w;b[5]=1-(a+t);b[9]=g-y;b[2]=d-F;b[6]=g+y;b[10]=1-(a+T);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a,b,d;return function(g,t,w){void 0===a&&(a=new r,b=new r,d=new r);var y=this.elements;d.subVectors(g,t).normalize();0===d.lengthSq()&&(d.z=1);a.crossVectors(w,d).normalize();0===a.lengthSq()&&(d.z+=1E-4,a.crossVectors(w,
d).normalize());b.crossVectors(d,a);y[0]=a.x;y[4]=b.x;y[8]=d.x;y[1]=a.y;y[5]=b.y;y[9]=d.y;y[2]=a.z;y[6]=b.z;y[10]=d.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var d=a.elements,g=b.elements;b=this.elements;a=d[0];var t=d[4],
w=d[8],y=d[12],F=d[1],K=d[5],M=d[9],T=d[13],Q=d[2],P=d[6],Z=d[10],ca=d[14],ja=d[3],oa=d[7],ra=d[11];d=d[15];var aa=g[0],qa=g[4],na=g[8],ua=g[12],ta=g[1],Aa=g[5],Ka=g[9],Ia=g[13],Oa=g[2],Ta=g[6],Na=g[10],Ua=g[14],ab=g[3],Pa=g[7],Ma=g[11];g=g[15];b[0]=a*aa+t*ta+w*Oa+y*ab;b[4]=a*qa+t*Aa+w*Ta+y*Pa;b[8]=a*na+t*Ka+w*Na+y*Ma;b[12]=a*ua+t*Ia+w*Ua+y*g;b[1]=F*aa+K*ta+M*Oa+T*ab;b[5]=F*qa+K*Aa+M*Ta+T*Pa;b[9]=F*na+K*Ka+M*Na+T*Ma;b[13]=F*ua+K*Ia+M*Ua+T*g;b[2]=Q*aa+P*ta+Z*Oa+ca*ab;b[6]=Q*qa+P*Aa+Z*Ta+ca*Pa;b[10]=
Q*na+P*Ka+Z*Na+ca*Ma;b[14]=Q*ua+P*Ia+Z*Ua+ca*g;b[3]=ja*aa+oa*ta+ra*Oa+d*ab;b[7]=ja*qa+oa*Aa+ra*Ta+d*Pa;b[11]=ja*na+oa*Ka+ra*Na+d*Ma;b[15]=ja*ua+oa*Ia+ra*Ua+d*g;return this},multiplyToArray:function(a,b,d){var g=this.elements;this.multiplyMatrices(a,b);d[0]=g[0];d[1]=g[1];d[2]=g[2];d[3]=g[3];d[4]=g[4];d[5]=g[5];d[6]=g[6];d[7]=g[7];d[8]=g[8];d[9]=g[9];d[10]=g[10];d[11]=g[11];d[12]=g[12];d[13]=g[13];d[14]=g[14];d[15]=g[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=
a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToVector3Array:function(){var a;return function(b,d,g){void 0===a&&(a=new r);void 0===d&&(d=0);void 0===g&&(g=b.length);for(var t=0;t<g;t+=3,d+=3)a.fromArray(b,d),a.applyMatrix4(this),a.toArray(b,d);return b}}(),applyToBuffer:function(){var a;return function(b,d,g){void 0===a&&(a=new r);void 0===d&&(d=0);void 0===g&&(g=b.length/b.itemSize);for(var t=0;t<g;t++,d++)a.x=b.getX(d),
a.y=b.getY(d),a.z=b.getZ(d),a.applyMatrix4(this),b.setXYZ(a.x,a.y,a.z);return b}}(),determinant:function(){var a=this.elements,b=a[0],d=a[4],g=a[8],t=a[12],w=a[1],y=a[5],F=a[9],K=a[13],M=a[2],T=a[6],Q=a[10],P=a[14];return a[3]*(+t*F*T-g*K*T-t*y*Q+d*K*Q+g*y*P-d*F*P)+a[7]*(+b*F*P-b*K*Q+t*w*Q-g*w*P+g*K*M-t*F*M)+a[11]*(+b*K*T-b*y*P-t*w*T+d*w*P+t*y*M-d*K*M)+a[15]*(-g*y*M-b*F*T+b*y*Q+g*w*T-d*w*Q+d*F*M)},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];
a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(a,b)},getPosition:function(){var a;return function(){void 0===a&&(a=new r);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return a.setFromMatrixColumn(this,3)}}(),setPosition:function(a){var b=
this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var d=this.elements,g=a.elements;a=g[0];var t=g[1],w=g[2],y=g[3],F=g[4],K=g[5],M=g[6],T=g[7],Q=g[8],P=g[9],Z=g[10],ca=g[11],ja=g[12],oa=g[13],ra=g[14];g=g[15];var aa=P*ra*T-oa*Z*T+oa*M*ca-K*ra*ca-P*M*g+K*Z*g,qa=ja*Z*T-Q*ra*T-ja*M*ca+F*ra*ca+Q*M*g-F*Z*g,na=Q*oa*T-ja*P*T+ja*K*ca-F*oa*ca-Q*K*g+F*P*g,ua=ja*P*M-Q*oa*M-ja*K*Z+F*oa*Z+Q*K*ra-F*P*ra,ta=a*aa+t*qa+w*na+y*ua;if(0===ta){if(!0===b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");return this.identity()}b=1/ta;d[0]=aa*b;d[1]=(oa*Z*y-P*ra*y-oa*w*ca+t*ra*ca+P*w*g-t*Z*g)*b;d[2]=(K*ra*y-oa*M*y+oa*w*T-t*ra*T-K*w*g+t*M*g)*b;d[3]=(P*M*y-K*Z*y-P*w*T+t*Z*T+K*w*ca-t*M*ca)*b;d[4]=qa*b;d[5]=(Q*ra*y-ja*Z*y+ja*w*ca-a*ra*ca-Q*w*g+a*Z*g)*b;d[6]=(ja*M*y-F*ra*y-ja*w*T+a*ra*T+F*w*g-a*M*g)*b;d[7]=(F*Z*y-Q*M*y+Q*w*T-a*Z*T-F*w*ca+a*M*ca)*b;d[8]=na*b;d[9]=(ja*P*y-Q*oa*y-ja*t*ca+a*oa*ca+Q*t*g-a*P*g)*b;d[10]=(F*oa*y-
ja*K*y+ja*t*T-a*oa*T-F*t*g+a*K*g)*b;d[11]=(Q*K*y-F*P*y-Q*t*T+a*P*T+F*t*ca-a*K*ca)*b;d[12]=ua*b;d[13]=(Q*oa*w-ja*P*w+ja*t*Z-a*oa*Z-Q*t*ra+a*P*ra)*b;d[14]=(ja*K*w-F*oa*w-ja*t*M+a*oa*M+F*t*ra-a*K*ra)*b;d[15]=(F*P*w-Q*K*w+Q*t*M-a*P*M-F*t*Z+a*K*Z)*b;return this},scale:function(a){var b=this.elements,d=a.x,g=a.y;a=a.z;b[0]*=d;b[4]*=g;b[8]*=a;b[1]*=d;b[5]*=g;b[9]*=a;b[2]*=d;b[6]*=g;b[10]*=a;b[3]*=d;b[7]*=g;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*
a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,d){this.set(1,0,0,a,0,1,0,b,0,0,1,d,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,
0,1);return this},makeRotationAxis:function(a,b){var d=Math.cos(b);b=Math.sin(b);var g=1-d,t=a.x,w=a.y;a=a.z;var y=g*t,F=g*w;this.set(y*t+d,y*w-b*a,y*a+b*w,0,y*w+b*a,F*w+d,F*a-b*t,0,y*a-b*w,F*a+b*t,g*a*a+d,0,0,0,0,1);return this},makeScale:function(a,b,d){this.set(a,0,0,0,0,b,0,0,0,0,d,0,0,0,0,1);return this},compose:function(a,b,d){this.makeRotationFromQuaternion(b);this.scale(d);this.setPosition(a);return this},decompose:function(){var a,b;return function(d,g,t){void 0===a&&(a=new r,b=new z);var w=
this.elements,y=a.set(w[0],w[1],w[2]).length(),F=a.set(w[4],w[5],w[6]).length(),K=a.set(w[8],w[9],w[10]).length();0>this.determinant()&&(y=-y);d.x=w[12];d.y=w[13];d.z=w[14];b.elements.set(this.elements);d=1/y;w=1/F;var M=1/K;b.elements[0]*=d;b.elements[1]*=d;b.elements[2]*=d;b.elements[4]*=w;b.elements[5]*=w;b.elements[6]*=w;b.elements[8]*=M;b.elements[9]*=M;b.elements[10]*=M;g.setFromRotationMatrix(b);t.x=y;t.y=F;t.z=K;return this}}(),makeFrustum:function(a,b,d,g,t,w){var y=this.elements;y[0]=2*
t/(b-a);y[4]=0;y[8]=(b+a)/(b-a);y[12]=0;y[1]=0;y[5]=2*t/(g-d);y[9]=(g+d)/(g-d);y[13]=0;y[2]=0;y[6]=0;y[10]=-(w+t)/(w-t);y[14]=-2*w*t/(w-t);y[3]=0;y[7]=0;y[11]=-1;y[15]=0;return this},makePerspective:function(a,b,d,g){a=d*Math.tan(c.Math.DEG2RAD*a*.5);var t=-a;return this.makeFrustum(t*b,a*b,t,a,d,g)},makeOrthographic:function(a,b,d,g,t,w){var y=this.elements,F=1/(b-a),K=1/(d-g),M=1/(w-t);y[0]=2*F;y[4]=0;y[8]=0;y[12]=-((b+a)*F);y[1]=0;y[5]=2*K;y[9]=0;y[13]=-((d+g)*K);y[2]=0;y[6]=0;y[10]=-2*M;y[14]=
-((w+t)*M);y[3]=0;y[7]=0;y[11]=0;y[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var d=0;16>d;d++)if(b[d]!==a[d])return!1;return!0},fromArray:function(a,b){void 0===b&&(b=0);for(var d=0;16>d;d++)this.elements[d]=a[d+b];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var d=this.elements;a[b]=d[0];a[b+1]=d[1];a[b+2]=d[2];a[b+3]=d[3];a[b+4]=d[4];a[b+5]=d[5];a[b+6]=d[6];a[b+7]=d[7];a[b+8]=d[8];a[b+9]=d[9];a[b+10]=d[10];a[b+11]=d[11];a[b+12]=d[12];a[b+
13]=d[13];a[b+14]=d[14];a[b+15]=d[15];return a}};C.prototype=Object.create(f.prototype);C.prototype.constructor=C;C.prototype.isCubeTexture=!0;Object.defineProperty(C.prototype,"images",{get:function(){return this.image},set:function(a){this.image=a}});var Wf=new f,Xf=new C,Uf=[],Vf=[];da.prototype.setValue=function(a,b){for(var d=this.seq,g=0,t=d.length;g!==t;++g){var w=d[g];w.setValue(a,b[w.id])}};var tf=/([\w\d_]+)(\])?(\[|\.)?/g;pa.prototype.setValue=function(a,b,d){b=this.map[b];void 0!==b&&
b.setValue(a,d,this.renderer)};pa.prototype.set=function(a,b,d){var g=this.map[d];void 0!==g&&g.setValue(a,b[d],this.renderer)};pa.prototype.setOptional=function(a,b,d){b=b[d];void 0!==b&&this.setValue(a,d,b)};pa.upload=function(a,b,d,g){for(var t=0,w=b.length;t!==w;++t){var y=b[t],F=d[y.id];!1!==F.needsUpdate&&y.setValue(a,F.value,g)}};pa.seqWithValue=function(a,b){for(var d=[],g=0,t=a.length;g!==t;++g){var w=a[g];w.id in b&&d.push(w)}return d};c.UniformsUtils={merge:function(a){for(var b={},d=0;d<
a.length;d++){var g=this.clone(a[d]),t;for(t in g)b[t]=g[t]}return b},clone:function(a){var b={},d;for(d in a){b[d]={};for(var g in a[d]){var t=a[d][g];t&&t.isColor||t&&t.isVector2||t&&t.isVector3||t&&t.isVector4||t&&t.isMatrix3||t&&t.isMatrix4||t&&t.isTexture?b[d][g]=t.clone():Array.isArray(t)?b[d][g]=t.slice():b[d][g]=t}}return b}};var Lb={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",
alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",
aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",
clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\n",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",
defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",
emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",
envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",
fog_fragment:"#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",
lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",
lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\n\t\t\tdirectLight.color = pointLight.color;\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#include <normal_flip>\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#include <normal_flip>\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",
lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",
logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",
map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",
metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",
normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",
packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",
roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",
shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",
uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",
uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",
uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",
cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",
depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",
equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n",
meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
normal_frag:"uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <packing>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\n\t#include <logdepthbuf_fragment>\n}\n",normal_vert:"varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"};ma.prototype={constructor:ma,
isColor:!0,r:1,g:1,b:1,set:function(a){a&&a.isColor?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,d){this.r=a;this.g=b;this.b=d;return this},setHSL:function(){function a(b,d,g){0>g&&(g+=1);1<g&&--g;return g<1/6?b+6*(d-b)*g:.5>g?d:g<2/3?b+6*(d-b)*(2/3-g):b}return function(b,
d,g){b=c.Math.euclideanModulo(b,1);d=c.Math.clamp(d,0,1);g=c.Math.clamp(g,0,1);0===d?this.r=this.g=this.b=g:(d=.5>=g?g*(1+d):g+d-g*d,g=2*g-d,this.r=a(g,d,b+1/3),this.g=a(g,d,b),this.b=a(g,d,b-1/3));return this}}(),setStyle:function(a){function b(y){void 0!==y&&1>parseFloat(y)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var d;if(d=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var g=d[2];switch(d[1]){case "rgb":case "rgba":if(d=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g))return this.r=
Math.min(255,parseInt(d[1],10))/255,this.g=Math.min(255,parseInt(d[2],10))/255,this.b=Math.min(255,parseInt(d[3],10))/255,b(d[5]),this;if(d=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g))return this.r=Math.min(100,parseInt(d[1],10))/100,this.g=Math.min(100,parseInt(d[2],10))/100,this.b=Math.min(100,parseInt(d[3],10))/100,b(d[5]),this;break;case "hsl":case "hsla":if(d=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g)){g=parseFloat(d[1])/
360;var t=parseInt(d[2],10)/100,w=parseInt(d[3],10)/100;b(d[5]);return this.setHSL(g,t,w)}}}else if(d=/^#([A-Fa-f0-9]+)$/.exec(a)){d=d[1];g=d.length;if(3===g)return this.r=parseInt(d.charAt(0)+d.charAt(0),16)/255,this.g=parseInt(d.charAt(1)+d.charAt(1),16)/255,this.b=parseInt(d.charAt(2)+d.charAt(2),16)/255,this;if(6===g)return this.r=parseInt(d.charAt(0)+d.charAt(1),16)/255,this.g=parseInt(d.charAt(2)+d.charAt(3),16)/255,this.b=parseInt(d.charAt(4)+d.charAt(5),16)/255,this}a&&0<a.length&&(d=c.ColorKeywords[a],
void 0!==d?this.setHex(d):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);b=0<b?1/b:1;this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},convertGammaToLinear:function(){var a=
this.r,b=this.g,d=this.b;this.r=a*a;this.g=b*b;this.b=d*d;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,d=this.g,g=this.b,t=Math.max(b,d,g),w=Math.min(b,d,g),y,F=(w+t)/2;if(w===t)w=y=0;else{var K=t-w;w=.5>=F?K/(t+w):
K/(2-t-w);switch(t){case b:y=(d-g)/K+(d<g?6:0);break;case d:y=(g-b)/K+2;break;case g:y=(b-d)/K+4}y/=6}a.h=y;a.s=w;a.l=F;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,d){var g=this.getHSL();g.h+=a;g.s+=b;g.l+=d;this.setHSL(g.h,g.s,g.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=
a;this.g+=a;this.b+=a;return this},sub:function(a){this.r=Math.max(0,this.r-a.r);this.g=Math.max(0,this.g-a.g);this.b=Math.max(0,this.b-a.b);return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void 0===b&&(b=
0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},toJSON:function(){return this.getHex()}};c.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,
cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,
dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,
lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,
mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,
seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};var Eb={common:{diffuse:{value:new ma(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new q(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},
envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new n(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},
metalnessmap:{metalnessMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new ma(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},
shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}}},points:{diffuse:{value:new ma(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new q(0,0,1,1)}}},
zd={basic:{uniforms:c.UniformsUtils.merge([Eb.common,Eb.aomap,Eb.fog]),vertexShader:Lb.meshbasic_vert,fragmentShader:Lb.meshbasic_frag},lambert:{uniforms:c.UniformsUtils.merge([Eb.common,Eb.aomap,Eb.lightmap,Eb.emissivemap,Eb.fog,Eb.lights,{emissive:{value:new ma(0)}}]),vertexShader:Lb.meshlambert_vert,fragmentShader:Lb.meshlambert_frag},phong:{uniforms:c.UniformsUtils.merge([Eb.common,Eb.aomap,Eb.lightmap,Eb.emissivemap,Eb.bumpmap,Eb.normalmap,Eb.displacementmap,Eb.fog,Eb.lights,{emissive:{value:new ma(0)},
specular:{value:new ma(1118481)},shininess:{value:30}}]),vertexShader:Lb.meshphong_vert,fragmentShader:Lb.meshphong_frag},standard:{uniforms:c.UniformsUtils.merge([Eb.common,Eb.aomap,Eb.lightmap,Eb.emissivemap,Eb.bumpmap,Eb.normalmap,Eb.displacementmap,Eb.roughnessmap,Eb.metalnessmap,Eb.fog,Eb.lights,{emissive:{value:new ma(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Lb.meshphysical_vert,fragmentShader:Lb.meshphysical_frag},points:{uniforms:c.UniformsUtils.merge([Eb.points,
Eb.fog]),vertexShader:Lb.points_vert,fragmentShader:Lb.points_frag},dashed:{uniforms:c.UniformsUtils.merge([Eb.common,Eb.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Lb.linedashed_vert,fragmentShader:Lb.linedashed_frag},depth:{uniforms:c.UniformsUtils.merge([Eb.common,Eb.displacementmap]),vertexShader:Lb.depth_vert,fragmentShader:Lb.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexShader:Lb.normal_vert,fragmentShader:Lb.normal_frag},cube:{uniforms:{tCube:{value:null},
tFlip:{value:-1},opacity:{value:1}},vertexShader:Lb.cube_vert,fragmentShader:Lb.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:Lb.equirect_vert,fragmentShader:Lb.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new r}},vertexShader:Lb.distanceRGBA_vert,fragmentShader:Lb.distanceRGBA_frag}};zd.physical={uniforms:c.UniformsUtils.merge([zd.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Lb.meshphysical_vert,fragmentShader:Lb.meshphysical_frag};
wa.prototype={constructor:wa,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,d=a.length;b<d;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new n;return function(b,d){d=a.copy(d).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=
this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(a){a=a||new n;return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){a=a||new n;return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);
this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new n).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?
!1:!0},clampPoint:function(a,b){return(b||new n).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new n;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};za.prototype=
{constructor:za,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=a},setValues:function(a){if(void 0!==a)for(var b in a){var d=a[b];if(void 0===d)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else{var g=this[b];void 0===g?console.warn("THREE."+this.type+": '"+b+"' is not a property of this material."):g&&g.isColor?g.set(d):g&&g.isVector3&&d&&d.isVector3?g.copy(d):this[b]="overdraw"===b?Number(d):d}}},toJSON:function(a){function b(t){var w=
[],y;for(y in t){var F=t[y];delete F.metadata;w.push(F)}return w}var d=void 0===a;d&&(a={textures:{},images:{}});var g={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};g.uuid=this.uuid;g.type=this.type;""!==this.name&&(g.name=this.name);this.color&&this.color.isColor&&(g.color=this.color.getHex());void 0!==this.roughness&&(g.roughness=this.roughness);void 0!==this.metalness&&(g.metalness=this.metalness);this.emissive&&this.emissive.isColor&&(g.emissive=this.emissive.getHex());
this.specular&&this.specular.isColor&&(g.specular=this.specular.getHex());void 0!==this.shininess&&(g.shininess=this.shininess);this.map&&this.map.isTexture&&(g.map=this.map.toJSON(a).uuid);this.alphaMap&&this.alphaMap.isTexture&&(g.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap&&this.lightMap.isTexture&&(g.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap&&this.bumpMap.isTexture&&(g.bumpMap=this.bumpMap.toJSON(a).uuid,g.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&
(g.normalMap=this.normalMap.toJSON(a).uuid,g.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(g.displacementMap=this.displacementMap.toJSON(a).uuid,g.displacementScale=this.displacementScale,g.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(g.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(g.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&
(g.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap&&this.specularMap.isTexture&&(g.specularMap=this.specularMap.toJSON(a).uuid);this.envMap&&this.envMap.isTexture&&(g.envMap=this.envMap.toJSON(a).uuid,g.reflectivity=this.reflectivity);void 0!==this.size&&(g.size=this.size);void 0!==this.sizeAttenuation&&(g.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(g.blending=this.blending);2!==this.shading&&(g.shading=this.shading);0!==this.side&&(g.side=this.side);0!==this.vertexColors&&
(g.vertexColors=this.vertexColors);1>this.opacity&&(g.opacity=this.opacity);!0===this.transparent&&(g.transparent=this.transparent);g.depthFunc=this.depthFunc;g.depthTest=this.depthTest;g.depthWrite=this.depthWrite;0<this.alphaTest&&(g.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(g.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(g.wireframe=this.wireframe);1<this.wireframeLinewidth&&(g.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(g.wireframeLinecap=
this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(g.wireframeLinejoin=this.wireframeLinejoin);g.skinning=this.skinning;g.morphTargets=this.morphTargets;d&&(d=b(a.textures),a=b(a.images),0<d.length&&(g.textures=d),0<a.length&&(g.images=a));return g},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.shading=a.shading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;
this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=
a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;a=a.clippingPlanes;var b=null;if(null!==a){var d=a.length;b=Array(d);for(var g=0;g!==d;++g)b[g]=a[g].clone()}this.clippingPlanes=b;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(za.prototype,h.prototype);var Yf=0;ob.prototype=Object.create(za.prototype);ob.prototype.constructor=
ob;ob.prototype.isShaderMaterial=!0;ob.prototype.copy=function(a){za.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=c.UniformsUtils.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};ob.prototype.toJSON=
function(a){a=za.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};nb.prototype=Object.create(za.prototype);nb.prototype.constructor=nb;nb.prototype.isMeshDepthMaterial=!0;nb.prototype.copy=function(a){za.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=
a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};Ab.prototype={constructor:Ab,isBox3:!0,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,d=Infinity,g=Infinity,t=-Infinity,w=-Infinity,y=-Infinity,F=0,K=a.length;F<K;F+=3){var M=a[F],T=a[F+1],Q=a[F+2];M<b&&(b=M);T<d&&(d=T);Q<g&&(g=Q);M>t&&(t=M);T>w&&(w=T);Q>y&&(y=Q)}this.min.set(b,d,g);this.max.set(t,
w,y)},setFromPoints:function(a){this.makeEmpty();for(var b=0,d=a.length;b<d;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new r;return function(b,d){d=a.copy(d).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),setFromObject:function(){var a=new r;return function(b){var d=this;b.updateMatrixWorld(!0);this.makeEmpty();b.traverse(function(g){var t=g.geometry;if(void 0!==t)if(t&&t.isGeometry){t=t.vertices;for(var w=0,y=t.length;w<y;w++)a.copy(t[w]),
a.applyMatrix4(g.matrixWorld),d.expandByPoint(a)}else if(t&&t.isBufferGeometry&&(y=t.attributes.position,void 0!==y)){if(y&&y.isInterleavedBufferAttribute){t=y.data.array;w=y.offset;var F=y.data.stride}else t=y.array,w=0,F=3;for(y=t.length;w<y;w+=F)a.fromArray(t,w),a.applyMatrix4(g.matrixWorld),d.expandByPoint(a)}});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=
this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(a){a=a||new r;return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){a=a||new r;return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);
this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new r).set((a.x-this.min.x)/(this.max.x-this.min.x),
(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(b){void 0===a&&(a=new r);this.clampPoint(b.center,a);return a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsPlane:function(a){if(0<a.normal.x){var b=a.normal.x*this.min.x;var d=a.normal.x*this.max.x}else b=
a.normal.x*this.max.x,d=a.normal.x*this.min.x;0<a.normal.y?(b+=a.normal.y*this.min.y,d+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,d+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,d+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,d+=a.normal.z*this.min.z);return b<=a.constant&&d>=a.constant},clampPoint:function(a,b){return(b||new r).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new r;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),
getBoundingSphere:function(){var a=new r;return function(b){b=b||new rb;this.getCenter(b.center);b.radius=.5*this.getSize(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new r,new r,new r,new r,new r,new r,new r,new r];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);
a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);
return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};rb.prototype={constructor:rb,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new Ab;return function(b,d){var g=this.center;void 0!==d?g.copy(d):a.setFromPoints(b).getCenter(g);for(var t=d=0,w=b.length;t<w;t++)d=Math.max(d,g.distanceToSquared(b[t]));this.radius=Math.sqrt(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);
this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},
clampPoint:function(a,b){var d=this.center.distanceToSquared(a);b=b||new r;b.copy(a);d>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b},getBoundingBox:function(a){a=a||new Ab;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&
a.radius===this.radius}};Mb.prototype={constructor:Mb,isMatrix3:!0,set:function(a,b,d,g,t,w,y,F,K){var M=this.elements;M[0]=a;M[1]=g;M[2]=y;M[3]=b;M[4]=t;M[5]=F;M[6]=d;M[7]=w;M[8]=K;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],
a[2],a[6],a[10]);return this},applyToVector3Array:function(){var a;return function(b,d,g){void 0===a&&(a=new r);void 0===d&&(d=0);void 0===g&&(g=b.length);for(var t=0;t<g;t+=3,d+=3)a.fromArray(b,d),a.applyMatrix3(this),a.toArray(b,d);return b}}(),applyToBuffer:function(){var a;return function(b,d,g){void 0===a&&(a=new r);void 0===d&&(d=0);void 0===g&&(g=b.length/b.itemSize);for(var t=0;t<g;t++,d++)a.x=b.getX(d),a.y=b.getY(d),a.z=b.getZ(d),a.applyMatrix3(this),b.setXYZ(a.x,a.y,a.z);return b}}(),multiplyScalar:function(a){var b=
this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],d=a[1],g=a[2],t=a[3],w=a[4],y=a[5],F=a[6],K=a[7];a=a[8];return b*w*a-b*y*K-d*t*a+d*y*F+g*t*K-g*w*F},getInverse:function(a,b){a&&a.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var d=a.elements;a=this.elements;var g=d[0],t=d[1],w=d[2],y=d[3],F=d[4],K=d[5],M=d[6],T=d[7];d=d[8];var Q=d*F-K*T,P=K*M-d*y,Z=T*y-F*M,
ca=g*Q+t*P+w*Z;if(0===ca){if(!0===b)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}b=1/ca;a[0]=Q*b;a[1]=(w*T-d*t)*b;a[2]=(K*t-w*F)*b;a[3]=P*b;a[4]=(d*g-w*M)*b;a[5]=(w*y-K*g)*b;a[6]=Z*b;a[7]=(t*M-T*g)*b;a[8]=(F*g-t*y)*b;return this},transpose:function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},
flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(a,b)},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a,b){void 0===b&&(b=0);for(var d=0;9>d;d++)this.elements[d]=a[d+b];return this},toArray:function(a,
b){void 0===a&&(a=[]);void 0===b&&(b=0);var d=this.elements;a[b]=d[0];a[b+1]=d[1];a[b+2]=d[2];a[b+3]=d[3];a[b+4]=d[4];a[b+5]=d[5];a[b+6]=d[6];a[b+7]=d[7];a[b+8]=d[8];return a}};Nb.prototype={constructor:Nb,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,d,g){this.normal.set(a,b,d);this.constant=g;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=
new r,b=new r;return function(d,g,t){g=a.subVectors(t,g).cross(b.subVectors(d,g)).normalize();this.setFromNormalAndCoplanarPoint(g,d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+
this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){a=this.distanceToPoint(a);return(b||new r).copy(this.normal).multiplyScalar(a)},intersectLine:function(){var a=new r;return function(b,d){d=d||new r;var g=b.delta(a),t=this.normal.dot(g);if(0===t){if(0===this.distanceToPoint(b.start))return d.copy(b.start)}else if(t=-(b.start.dot(this.normal)+this.constant)/t,!(0>
t||1<t))return d.copy(g).multiplyScalar(t).add(b.start)}}(),intersectsLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return(a||new r).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new r,b=new Mb;return function(d,g){var t=this.coplanarPoint(a).applyMatrix4(d);
d=g||b.getNormalMatrix(d);d=this.normal.applyMatrix3(d).normalize();this.constant=-t.dot(d);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}};jc.prototype={constructor:jc,set:function(a,b,d,g,t,w){var y=this.planes;y[0].copy(a);y[1].copy(b);y[2].copy(d);y[3].copy(g);y[4].copy(t);y[5].copy(w);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=
this.planes,d=0;6>d;d++)b[d].copy(a.planes[d]);return this},setFromMatrix:function(a){var b=this.planes,d=a.elements;a=d[0];var g=d[1],t=d[2],w=d[3],y=d[4],F=d[5],K=d[6],M=d[7],T=d[8],Q=d[9],P=d[10],Z=d[11],ca=d[12],ja=d[13],oa=d[14];d=d[15];b[0].setComponents(w-a,M-y,Z-T,d-ca).normalize();b[1].setComponents(w+a,M+y,Z+T,d+ca).normalize();b[2].setComponents(w+g,M+F,Z+Q,d+ja).normalize();b[3].setComponents(w-g,M-F,Z-Q,d-ja).normalize();b[4].setComponents(w-t,M-K,Z-P,d-oa).normalize();b[5].setComponents(w+
t,M+K,Z+P,d+oa).normalize();return this},intersectsObject:function(){var a=new rb;return function(b){var d=b.geometry;null===d.boundingSphere&&d.computeBoundingSphere();a.copy(d.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSprite:function(){var a=new rb;return function(b){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,d=a.center;a=-a.radius;
for(var g=0;6>g;g++)if(b[g].distanceToPoint(d)<a)return!1;return!0},intersectsBox:function(){var a=new r,b=new r;return function(d){for(var g=this.planes,t=0;6>t;t++){var w=g[t];a.x=0<w.normal.x?d.min.x:d.max.x;b.x=0<w.normal.x?d.max.x:d.min.x;a.y=0<w.normal.y?d.min.y:d.max.y;b.y=0<w.normal.y?d.max.y:d.min.y;a.z=0<w.normal.z?d.min.z:d.max.z;b.z=0<w.normal.z?d.max.z:d.min.z;var y=w.distanceToPoint(a);w=w.distanceToPoint(b);if(0>y&&0>w)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,
d=0;6>d;d++)if(0>b[d].distanceToPoint(a))return!1;return!0}};sc.prototype={constructor:sc,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new r).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=
new r;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){b=b||new r;b.subVectors(a,this.origin);a=b.dot(this.direction);return 0>a?b.copy(this.origin):b.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new r;return function(b){var d=a.subVectors(b,this.origin).dot(this.direction);if(0>d)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(d).add(this.origin);
return a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=new r,b=new r,d=new r;return function(g,t,w,y){a.copy(g).add(t).multiplyScalar(.5);b.copy(t).sub(g).normalize();d.copy(this.origin).sub(a);var F=.5*g.distanceTo(t),K=-this.direction.dot(b),M=d.dot(this.direction),T=-d.dot(b),Q=d.lengthSq(),P=Math.abs(1-K*K);if(0<P){g=K*T-M;t=K*M-T;var Z=F*P;0<=g?t>=-Z?t<=Z?(F=1/P,g*=F,t*=F,K=g*(g+K*t+2*M)+t*(K*g+t+2*T)+Q):(t=F,g=Math.max(0,-(K*t+M)),K=-g*g+t*(t+2*T)+Q):(t=-F,g=Math.max(0,-(K*t+
M)),K=-g*g+t*(t+2*T)+Q):t<=-Z?(g=Math.max(0,-(-K*F+M)),t=0<g?-F:Math.min(Math.max(-F,-T),F),K=-g*g+t*(t+2*T)+Q):t<=Z?(g=0,t=Math.min(Math.max(-F,-T),F),K=t*(t+2*T)+Q):(g=Math.max(0,-(K*F+M)),t=0<g?F:Math.min(Math.max(-F,-T),F),K=-g*g+t*(t+2*T)+Q)}else t=0<K?-F:F,g=Math.max(0,-(K*t+M)),K=-g*g+t*(t+2*T)+Q;w&&w.copy(this.direction).multiplyScalar(g).add(this.origin);y&&y.copy(b).multiplyScalar(t).add(a);return K}}(),intersectSphere:function(){var a=new r;return function(b,d){a.subVectors(b.center,this.origin);
var g=a.dot(this.direction),t=a.dot(a)-g*g;b=b.radius*b.radius;if(t>b)return null;b=Math.sqrt(b-t);t=g-b;g+=b;return 0>t&&0>g?null:0>t?this.at(g,d):this.at(t,d)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){a=this.distanceToPlane(a);return null===a?null:
this.at(a,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var d=1/this.direction.x;var g=1/this.direction.y;var t=1/this.direction.z,w=this.origin;if(0<=d){var y=(a.min.x-w.x)*d;d*=a.max.x-w.x}else y=(a.max.x-w.x)*d,d*=a.min.x-w.x;if(0<=g){var F=(a.min.y-w.y)*g;g*=a.max.y-w.y}else F=(a.max.y-w.y)*g,g*=a.min.y-w.y;if(y>g||F>d)return null;if(F>y||y!==y)y=F;if(g<d||d!==d)d=g;0<=t?(F=(a.min.z-w.z)*t,
a=(a.max.z-w.z)*t):(F=(a.max.z-w.z)*t,a=(a.min.z-w.z)*t);if(y>a||F>d)return null;if(F>y||y!==y)y=F;if(a<d||d!==d)d=a;return 0>d?null:this.at(0<=y?y:d,b)},intersectsBox:function(){var a=new r;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new r,b=new r,d=new r,g=new r;return function(t,w,y,F,K){b.subVectors(w,t);d.subVectors(y,t);g.crossVectors(b,d);w=this.direction.dot(g);if(0<w){if(F)return null;F=1}else if(0>w)F=-1,w=-w;else return null;a.subVectors(this.origin,
t);t=F*this.direction.dot(d.crossVectors(a,d));if(0>t)return null;y=F*this.direction.dot(b.cross(a));if(0>y||t+y>w)return null;t=-F*a.dot(g);return 0>t?null:this.at(t/w,K)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};tc.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");tc.DefaultOrder=
"XYZ";tc.prototype={constructor:tc,isEuler:!0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,d,g){this._x=a;this._y=b;this._z=d;this._order=g||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,
this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,d){var g=c.Math.clamp,t=a.elements;a=t[0];var w=t[4],y=t[8],F=t[1],K=t[5],M=t[9],T=t[2],Q=t[6];t=t[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(g(y,-1,1)),.99999>Math.abs(y)?(this._x=Math.atan2(-M,t),this._z=Math.atan2(-w,a)):(this._x=Math.atan2(Q,K),this._z=0)):"YXZ"===b?(this._x=Math.asin(-g(M,-1,1)),.99999>Math.abs(M)?
(this._y=Math.atan2(y,t),this._z=Math.atan2(F,K)):(this._y=Math.atan2(-T,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(g(Q,-1,1)),.99999>Math.abs(Q)?(this._y=Math.atan2(-T,t),this._z=Math.atan2(-w,K)):(this._y=0,this._z=Math.atan2(F,a))):"ZYX"===b?(this._y=Math.asin(-g(T,-1,1)),.99999>Math.abs(T)?(this._x=Math.atan2(Q,t),this._z=Math.atan2(F,a)):(this._x=0,this._z=Math.atan2(-w,K))):"YZX"===b?(this._z=Math.asin(g(F,-1,1)),.99999>Math.abs(F)?(this._x=Math.atan2(-M,K),this._y=Math.atan2(-T,a)):(this._x=
0,this._y=Math.atan2(y,t))):"XZY"===b?(this._z=Math.asin(-g(w,-1,1)),.99999>Math.abs(w)?(this._x=Math.atan2(Q,K),this._y=Math.atan2(y,a)):(this._x=Math.atan2(-M,t),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==d)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,d,g){void 0===a&&(a=new z);a.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(a,d,g)}}(),setFromVector3:function(a,
b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new u;return function(b){a.setFromEuler(this);return this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;
return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new r(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};Oc.prototype={constructor:Oc,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==(this.mask&a.mask)}};jb.DefaultUp=new r(0,1,0);jb.DefaultMatrixAutoUpdate=!0;Object.assign(jb.prototype,h.prototype,
{isObject3D:!0,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new u;return function(b,d){a.setFromAxisAngle(b,
d);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new r(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new r(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new r(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new r;return function(b,d){a.copy(b).applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(d));return this}}(),translateX:function(){var a=
new r(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new r(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new r(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new z;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new z;return function(b){a.lookAt(b,
this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a&&a.isObject3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<
arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var d=0,g=this.children.length;d<g;d++){var t=this.children[d].getObjectByProperty(a,b);if(void 0!==t)return t}},
getWorldPosition:function(a){a=a||new r;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new r,b=new r;return function(d){d=d||new u;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,d,b);return d}}(),getWorldRotation:function(){var a=new u;return function(b){b=b||new tc;this.getWorldQuaternion(a);return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new r,b=new u;return function(d){d=d||new r;
this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,b,d);return d}}(),getWorldDirection:function(){var a=new u;return function(b){b=b||new r;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,d=0,g=b.length;d<g;d++)b[d].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=this.children,d=0,g=b.length;d<g;d++)b[d].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;
null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=this.children,d=0,g=b.length;d<g;d++)b[d].updateMatrixWorld(a)},
toJSON:function(a){function b(F){var K=[],M;for(M in F){var T=F[M];delete T.metadata;K.push(T)}return K}var d=void 0===a||""===a,g={};d&&(a={geometries:{},materials:{},textures:{},images:{}},g.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var t={};t.uuid=this.uuid;t.type=this.type;""!==this.name&&(t.name=this.name);"{}"!==JSON.stringify(this.userData)&&(t.userData=this.userData);!0===this.castShadow&&(t.castShadow=!0);!0===this.receiveShadow&&(t.receiveShadow=!0);!1===this.visible&&
(t.visible=!1);t.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),t.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),t.material=this.material.uuid);if(0<this.children.length){t.children=[];for(var w=0;w<this.children.length;w++)t.children.push(this.children[w].toJSON(a).object)}if(d){d=b(a.geometries);
w=b(a.materials);var y=b(a.textures);a=b(a.images);0<d.length&&(g.geometries=d);0<w.length&&(g.materials=w);0<y.length&&(g.textures=y);0<a.length&&(g.images=a)}g.object=t;return g},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;
this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(b=0;b<a.children.length;b++)this.add(a.children[b].clone());return this}});var Zf=0;Pc.prototype={constructor:Pc,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},getCenter:function(a){return(a||new r).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new r).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){b=b||new r;return this.delta(b).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new r,b=
new r;return function(d,g){a.subVectors(d,this.start);b.subVectors(this.end,this.start);d=b.dot(b);d=b.dot(a)/d;g&&(d=c.Math.clamp(d,0,1));return d}}(),closestPointToPoint:function(a,b,d){a=this.closestPointToPointParameter(a,b);d=d||new r;return this.delta(d).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}};uc.normal=function(){var a=new r;return function(b,
d,g,t){t=t||new r;t.subVectors(g,d);a.subVectors(b,d);t.cross(a);b=t.lengthSq();return 0<b?t.multiplyScalar(1/Math.sqrt(b)):t.set(0,0,0)}}();uc.barycoordFromPoint=function(){var a=new r,b=new r,d=new r;return function(g,t,w,y,F){a.subVectors(y,t);b.subVectors(w,t);d.subVectors(g,t);g=a.dot(a);t=a.dot(b);w=a.dot(d);var K=b.dot(b);y=b.dot(d);var M=g*K-t*t;F=F||new r;if(0===M)return F.set(-2,-1,-1);M=1/M;K=(K*w-t*y)*M;g=(g*y-t*w)*M;return F.set(1-K-g,g,K)}}();uc.containsPoint=function(){var a=new r;
return function(b,d,g,t){b=uc.barycoordFromPoint(b,d,g,t,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();uc.prototype={constructor:uc,set:function(a,b,d){this.a.copy(a);this.b.copy(b);this.c.copy(d);return this},setFromPointsAndIndices:function(a,b,d,g){this.a.copy(a[b]);this.b.copy(a[d]);this.c.copy(a[g]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new r,b=new r;return function(){a.subVectors(this.c,
this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new r).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return uc.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new Nb).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return uc.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return uc.containsPoint(a,this.a,this.b,this.c)},closestPointToPoint:function(){var a,
b,d,g;return function(t,w){void 0===a&&(a=new Nb,b=[new Pc,new Pc,new Pc],d=new r,g=new r);w=w||new r;var y=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(t,d);if(!0===this.containsPoint(d))w.copy(d);else for(b[0].set(this.a,this.b),b[1].set(this.b,this.c),b[2].set(this.c,this.a),t=0;t<b.length;t++){b[t].closestPointToPoint(d,!0,g);var F=d.distanceToSquared(g);F<y&&(y=F,w.copy(g))}return w}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};
Pb.prototype={constructor:Pb,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,d=a.vertexNormals.length;b<d;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(d=a.vertexColors.length;b<d;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}};bc.prototype=Object.create(za.prototype);bc.prototype.constructor=bc;bc.prototype.isMeshBasicMaterial=
!0;bc.prototype.copy=function(a){za.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=
a.skinning;this.morphTargets=a.morphTargets;return this};gb.prototype={constructor:gb,isBufferAttribute:!0,set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.count=a.count;this.normalized=a.normalized;this.dynamic=a.dynamic;return this},copyAt:function(a,b,d){a*=this.itemSize;d*=b.itemSize;for(var g=0,t=this.itemSize;g<t;g++)this.array[a+g]=b.array[d+g];return this},
copyArray:function(a){this.array.set(a);return this},copyColorsArray:function(a){for(var b=this.array,d=0,g=0,t=a.length;g<t;g++){var w=a[g];void 0===w&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",g),w=new ma);b[d++]=w.r;b[d++]=w.g;b[d++]=w.b}return this},copyIndicesArray:function(a){for(var b=this.array,d=0,g=0,t=a.length;g<t;g++){var w=a[g];b[d++]=w.a;b[d++]=w.b;b[d++]=w.c}return this},copyVector2sArray:function(a){for(var b=this.array,d=0,g=0,t=a.length;g<t;g++){var w=
a[g];void 0===w&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",g),w=new n);b[d++]=w.x;b[d++]=w.y}return this},copyVector3sArray:function(a){for(var b=this.array,d=0,g=0,t=a.length;g<t;g++){var w=a[g];void 0===w&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",g),w=new r);b[d++]=w.x;b[d++]=w.y;b[d++]=w.z}return this},copyVector4sArray:function(a){for(var b=this.array,d=0,g=0,t=a.length;g<t;g++){var w=a[g];void 0===w&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",
g),w=new q);b[d++]=w.x;b[d++]=w.y;b[d++]=w.z;b[d++]=w.w}return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*
this.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=d;return this},setXYZ:function(a,b,d,g){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=d;this.array[a+2]=g;return this},setXYZW:function(a,b,d,g,t){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=d;this.array[a+2]=g;this.array[a+3]=t;return this},clone:function(){return(new this.constructor).copy(this)}};Object.assign(pb.prototype,h.prototype,
{isGeometry:!0,applyMatrix:function(a){for(var b=(new Mb).getNormalMatrix(a),d=0,g=this.vertices.length;d<g;d++)this.vertices[d].applyMatrix4(a);d=0;for(g=this.faces.length;d<g;d++){a=this.faces[d];a.normal.applyMatrix3(b).normalize();for(var t=0,w=a.vertexNormals.length;t<w;t++)a.vertexNormals[t].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a;
return function(b){void 0===a&&(a=new z);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new z);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===a&&(a=new z);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,d,g){void 0===a&&(a=new z);a.makeTranslation(b,d,g);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,
d,g){void 0===a&&(a=new z);a.makeScale(b,d,g);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new jb);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function b(ra,aa,qa,na){var ua=void 0!==y?[T[ra].clone(),T[aa].clone(),T[qa].clone()]:[],ta=void 0!==F?[d.colors[ra].clone(),d.colors[aa].clone(),d.colors[qa].clone()]:[];na=new Pb(ra,aa,qa,ua,ta,na);d.faces.push(na);void 0!==K&&d.faceVertexUvs[0].push([Q[ra].clone(),
Q[aa].clone(),Q[qa].clone()]);void 0!==M&&d.faceVertexUvs[1].push([P[ra].clone(),P[aa].clone(),P[qa].clone()])}var d=this,g=null!==a.index?a.index.array:void 0,t=a.attributes,w=t.position.array,y=void 0!==t.normal?t.normal.array:void 0,F=void 0!==t.color?t.color.array:void 0,K=void 0!==t.uv?t.uv.array:void 0,M=void 0!==t.uv2?t.uv2.array:void 0;void 0!==M&&(this.faceVertexUvs[1]=[]);for(var T=[],Q=[],P=[],Z=t=0;t<w.length;t+=3,Z+=2)d.vertices.push(new r(w[t],w[t+1],w[t+2])),void 0!==y&&T.push(new r(y[t],
y[t+1],y[t+2])),void 0!==F&&d.colors.push(new ma(F[t],F[t+1],F[t+2])),void 0!==K&&Q.push(new n(K[Z],K[Z+1])),void 0!==M&&P.push(new n(M[Z],M[Z+1]));if(void 0!==g)if(w=a.groups,0<w.length)for(t=0;t<w.length;t++){var ca=w[t],ja=ca.start,oa=ca.count;Z=ja;for(ja+=oa;Z<ja;Z+=3)b(g[Z],g[Z+1],g[Z+2],ca.materialIndex)}else for(t=0;t<g.length;t+=3)b(g[t],g[t+1],g[t+2]);else for(t=0;t<w.length/3;t+=3)b(t,t+1,t+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==
a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var a=this.boundingBox.getCenter().negate();this.translate(a.x,a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius;b=0===b?1:1/b;var d=new z;d.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applyMatrix(d);return this},computeFaceNormals:function(){for(var a=new r,b=new r,d=0,g=this.faces.length;d<
g;d++){var t=this.faces[d],w=this.vertices[t.a],y=this.vertices[t.b];a.subVectors(this.vertices[t.c],y);b.subVectors(w,y);a.cross(b);a.normalize();t.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);var b;var d=Array(this.vertices.length);var g=0;for(b=this.vertices.length;g<b;g++)d[g]=new r;if(a){var t=new r,w=new r;a=0;for(g=this.faces.length;a<g;a++){b=this.faces[a];var y=this.vertices[b.a];var F=this.vertices[b.b];var K=this.vertices[b.c];t.subVectors(K,F);w.subVectors(y,F);
t.cross(w);d[b.a].add(t);d[b.b].add(t);d[b.c].add(t)}}else for(a=0,g=this.faces.length;a<g;a++)b=this.faces[a],d[b.a].add(b.normal),d[b.b].add(b.normal),d[b.c].add(b.normal);g=0;for(b=this.vertices.length;g<b;g++)d[g].normalize();a=0;for(g=this.faces.length;a<g;a++)b=this.faces[a],y=b.vertexNormals,3===y.length?(y[0].copy(d[b.a]),y[1].copy(d[b.b]),y[2].copy(d[b.c])):(y[0]=d[b.a].clone(),y[1]=d[b.b].clone(),y[2]=d[b.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,
b;var d=0;for(b=this.faces.length;d<b;d++){var g=this.faces[d];g.__originalFaceNormal?g.__originalFaceNormal.copy(g.normal):g.__originalFaceNormal=g.normal.clone();g.__originalVertexNormals||(g.__originalVertexNormals=[]);var t=0;for(a=g.vertexNormals.length;t<a;t++)g.__originalVertexNormals[t]?g.__originalVertexNormals[t].copy(g.vertexNormals[t]):g.__originalVertexNormals[t]=g.vertexNormals[t].clone()}var w=new pb;w.faces=this.faces;t=0;for(a=this.morphTargets.length;t<a;t++){if(!this.morphNormals[t]){this.morphNormals[t]=
{};this.morphNormals[t].faceNormals=[];this.morphNormals[t].vertexNormals=[];g=this.morphNormals[t].faceNormals;var y=this.morphNormals[t].vertexNormals;d=0;for(b=this.faces.length;d<b;d++){var F=new r;var K={a:new r,b:new r,c:new r};g.push(F);y.push(K)}}y=this.morphNormals[t];w.vertices=this.morphTargets[t].vertices;w.computeFaceNormals();w.computeVertexNormals();d=0;for(b=this.faces.length;d<b;d++)g=this.faces[d],F=y.faceNormals[d],K=y.vertexNormals[d],F.copy(g.normal),K.a.copy(g.vertexNormals[0]),
K.b.copy(g.vertexNormals[1]),K.c.copy(g.vertexNormals[2])}d=0;for(b=this.faces.length;d<b;d++)g=this.faces[d],g.normal=g.__originalFaceNormal,g.vertexNormals=g.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var a=0,b=this.vertices,d=0,g=b.length;d<g;d++)0<d&&(a+=b[d].distanceTo(b[d-1])),this.lineDistances[d]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ab);
this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new rb);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,d){if(!1===(a&&a.isGeometry))console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);else{var g,t=this.vertices.length,w=this.vertices,y=a.vertices,F=this.faces,K=a.faces,M=this.faceVertexUvs[0],T=a.faceVertexUvs[0],Q=this.colors,P=a.colors;void 0===d&&(d=0);void 0!==
b&&(g=(new Mb).getNormalMatrix(b));a=0;for(var Z=y.length;a<Z;a++){var ca=y[a].clone();void 0!==b&&ca.applyMatrix4(b);w.push(ca)}a=0;for(Z=P.length;a<Z;a++)Q.push(P[a].clone());a=0;for(Z=K.length;a<Z;a++){y=K[a];var ja=y.vertexNormals;P=y.vertexColors;Q=new Pb(y.a+t,y.b+t,y.c+t);Q.normal.copy(y.normal);void 0!==g&&Q.normal.applyMatrix3(g).normalize();b=0;for(w=ja.length;b<w;b++)ca=ja[b].clone(),void 0!==g&&ca.applyMatrix3(g).normalize(),Q.vertexNormals.push(ca);Q.color.copy(y.color);b=0;for(w=P.length;b<
w;b++)ca=P[b],Q.vertexColors.push(ca.clone());Q.materialIndex=y.materialIndex+d;F.push(Q)}a=0;for(Z=T.length;a<Z;a++)if(d=T[a],g=[],void 0!==d){b=0;for(w=d.length;b<w;b++)g.push(d[b].clone());M.push(g)}}},mergeMesh:function(a){!1===(a&&a.isMesh)?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a):(a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix))},mergeVertices:function(){var a={},b=[],d=[],g=Math.pow(10,4),t;var w=0;for(t=this.vertices.length;w<
t;w++){var y=this.vertices[w];y=Math.round(y.x*g)+"_"+Math.round(y.y*g)+"_"+Math.round(y.z*g);void 0===a[y]?(a[y]=w,b.push(this.vertices[w]),d[w]=b.length-1):d[w]=d[a[y]]}a=[];w=0;for(t=this.faces.length;w<t;w++)for(g=this.faces[w],g.a=d[g.a],g.b=d[g.b],g.c=d[g.c],g=[g.a,g.b,g.c],y=0;3>y;y++)if(g[y]===g[(y+1)%3]){a.push(w);break}for(w=a.length-1;0<=w;w--)for(g=a[w],this.faces.splice(g,1),d=0,t=this.faceVertexUvs.length;d<t;d++)this.faceVertexUvs[d].splice(g,1);w=this.vertices.length-b.length;this.vertices=
b;return w},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,d=0;d<b;d++)a[d]._id=d;a.sort(function(K,M){return K.materialIndex-M.materialIndex});var g=this.faceVertexUvs[0],t=this.faceVertexUvs[1],w,y;g&&g.length===b&&(w=[]);t&&t.length===b&&(y=[]);for(d=0;d<b;d++){var F=a[d]._id;w&&w.push(g[F]);y&&y.push(t[F])}w&&(this.faceVertexUvs[0]=w);y&&(this.faceVertexUvs[1]=y)},toJSON:function(){function a(ua,ta,Aa){return Aa?ua|1<<ta:ua&~(1<<ta)}function b(ua){var ta=ua.x.toString()+ua.y.toString()+
ua.z.toString();if(void 0!==M[ta])return M[ta];M[ta]=K.length/3;K.push(ua.x,ua.y,ua.z);return M[ta]}function d(ua){var ta=ua.r.toString()+ua.g.toString()+ua.b.toString();if(void 0!==Q[ta])return Q[ta];Q[ta]=T.length;T.push(ua.getHex());return Q[ta]}function g(ua){var ta=ua.x.toString()+ua.y.toString();if(void 0!==Z[ta])return Z[ta];Z[ta]=P.length/2;P.push(ua.x,ua.y);return Z[ta]}var t={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};t.uuid=this.uuid;t.type=this.type;""!==this.name&&
(t.name=this.name);if(void 0!==this.parameters){var w=this.parameters,y;for(y in w)void 0!==w[y]&&(t[y]=w[y]);return t}w=[];for(y=0;y<this.vertices.length;y++){var F=this.vertices[y];w.push(F.x,F.y,F.z)}F=[];var K=[],M={},T=[],Q={},P=[],Z={};for(y=0;y<this.faces.length;y++){var ca=this.faces[y],ja=void 0!==this.faceVertexUvs[0][y],oa=0<ca.normal.length(),ra=0<ca.vertexNormals.length,aa=1!==ca.color.r||1!==ca.color.g||1!==ca.color.b,qa=0<ca.vertexColors.length,na=0;na=a(na,0,0);na=a(na,1,!0);na=a(na,
2,!1);na=a(na,3,ja);na=a(na,4,oa);na=a(na,5,ra);na=a(na,6,aa);na=a(na,7,qa);F.push(na);F.push(ca.a,ca.b,ca.c);F.push(ca.materialIndex);ja&&(ja=this.faceVertexUvs[0][y],F.push(g(ja[0]),g(ja[1]),g(ja[2])));oa&&F.push(b(ca.normal));ra&&(oa=ca.vertexNormals,F.push(b(oa[0]),b(oa[1]),b(oa[2])));aa&&F.push(d(ca.color));qa&&(ca=ca.vertexColors,F.push(d(ca[0]),d(ca[1]),d(ca[2])))}t.data={};t.data.vertices=w;t.data.normals=K;0<T.length&&(t.data.colors=T);0<P.length&&(t.data.uvs=[P]);t.data.faces=F;return t},
clone:function(){return(new pb).copy(this)},copy:function(a){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];this.colors=[];for(var b=a.vertices,d=0,g=b.length;d<g;d++)this.vertices.push(b[d].clone());b=a.colors;d=0;for(g=b.length;d<g;d++)this.colors.push(b[d].clone());b=a.faces;d=0;for(g=b.length;d<g;d++)this.faces.push(b[d].clone());d=0;for(g=a.faceVertexUvs.length;d<g;d++){b=a.faceVertexUvs[d];void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=[]);for(var t=0,w=b.length;t<w;t++){for(var y=
b[t],F=[],K=0,M=y.length;K<M;K++)F.push(y[K].clone());this.faceVertexUvs[d].push(F)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Oe=0;Object.assign(ce.prototype,h.prototype,{computeBoundingBox:pb.prototype.computeBoundingBox,computeBoundingSphere:pb.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},
computeGroups:function(a){var b=[];a=a.faces;for(var d=0;d<a.length;d++){var g=a[d];if(g.materialIndex!==t){var t=g.materialIndex;void 0!==w&&(w.count=3*d-w.start,b.push(w));var w={start:3*d,materialIndex:t}}}void 0!==w&&(w.count=3*d-w.start,b.push(w));this.groups=b},fromGeometry:function(a){var b=a.faces,d=a.vertices,g=a.faceVertexUvs,t=g[0]&&0<g[0].length,w=g[1]&&0<g[1].length,y=a.morphTargets,F=y.length;if(0<F){var K=[];for(var M=0;M<F;M++)K[M]=[];this.morphTargets.position=K}var T=a.morphNormals,
Q=T.length;if(0<Q){var P=[];for(M=0;M<Q;M++)P[M]=[];this.morphTargets.normal=P}var Z=a.skinIndices,ca=a.skinWeights,ja=Z.length===d.length,oa=ca.length===d.length;for(M=0;M<b.length;M++){var ra=b[M];this.vertices.push(d[ra.a],d[ra.b],d[ra.c]);var aa=ra.vertexNormals;3===aa.length?this.normals.push(aa[0],aa[1],aa[2]):(aa=ra.normal,this.normals.push(aa,aa,aa));aa=ra.vertexColors;3===aa.length?this.colors.push(aa[0],aa[1],aa[2]):(aa=ra.color,this.colors.push(aa,aa,aa));!0===t&&(aa=g[0][M],void 0!==aa?
this.uvs.push(aa[0],aa[1],aa[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",M),this.uvs.push(new n,new n,new n)));!0===w&&(aa=g[1][M],void 0!==aa?this.uvs2.push(aa[0],aa[1],aa[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",M),this.uvs2.push(new n,new n,new n)));for(aa=0;aa<F;aa++){var qa=y[aa].vertices;K[aa].push(qa[ra.a],qa[ra.b],qa[ra.c])}for(aa=0;aa<Q;aa++)qa=T[aa].vertexNormals[M],P[aa].push(qa.a,qa.b,qa.c);ja&&this.skinIndices.push(Z[ra.a],
Z[ra.b],Z[ra.c]);oa&&this.skinWeights.push(ca[ra.a],ca[ra.b],ca[ra.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.assign(qb.prototype,h.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(a){this.index=
a},addAttribute:function(a,b,d){if(!1===(b&&b.isBufferAttribute)&&!1===(b&&b.isInterleavedBufferAttribute))console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(a,new gb(b,d));else if("index"===a)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(b);else return this.attributes[a]=b,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},
addGroup:function(a,b,d){this.groups.push({start:a,count:b,materialIndex:void 0!==d?d:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new Mb).getNormalMatrix(a).applyToVector3Array(b.array),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&
this.computeBoundingSphere();return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new z);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new z);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===a&&(a=new z);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,d,g){void 0===a&&(a=new z);a.makeTranslation(b,d,g);
this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,d,g){void 0===a&&(a=new z);a.makeScale(b,d,g);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new jb);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),center:function(){this.computeBoundingBox();var a=this.boundingBox.getCenter().negate();this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var b=a.geometry;if(a&&a.isPoints||a&&a.isLine){a=new Qb(3*b.vertices.length,
3);var d=new Qb(3*b.colors.length,3);this.addAttribute("position",a.copyVector3sArray(b.vertices));this.addAttribute("color",d.copyColorsArray(b.colors));b.lineDistances&&b.lineDistances.length===b.vertices.length&&(a=new Qb(b.lineDistances.length,1),this.addAttribute("lineDistance",a.copyArray(b.lineDistances)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a&&a.isMesh&&b&&b.isGeometry&&this.fromGeometry(b);
return this},updateFromObject:function(a){var b=a.geometry;if(a&&a.isMesh){var d=b.__directGeometry;!0===b.elementsNeedUpdate&&(d=void 0,b.elementsNeedUpdate=!1);if(void 0===d)return this.fromGeometry(b);d.verticesNeedUpdate=b.verticesNeedUpdate;d.normalsNeedUpdate=b.normalsNeedUpdate;d.colorsNeedUpdate=b.colorsNeedUpdate;d.uvsNeedUpdate=b.uvsNeedUpdate;d.groupsNeedUpdate=b.groupsNeedUpdate;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=
!1;b=d}!0===b.verticesNeedUpdate&&(d=this.attributes.position,void 0!==d&&(d.copyVector3sArray(b.vertices),d.needsUpdate=!0),b.verticesNeedUpdate=!1);!0===b.normalsNeedUpdate&&(d=this.attributes.normal,void 0!==d&&(d.copyVector3sArray(b.normals),d.needsUpdate=!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(d=this.attributes.color,void 0!==d&&(d.copyColorsArray(b.colors),d.needsUpdate=!0),b.colorsNeedUpdate=!1);b.uvsNeedUpdate&&(d=this.attributes.uv,void 0!==d&&(d.copyVector2sArray(b.uvs),d.needsUpdate=
!0),b.uvsNeedUpdate=!1);b.lineDistancesNeedUpdate&&(d=this.attributes.lineDistance,void 0!==d&&(d.copyArray(b.lineDistances),d.needsUpdate=!0),b.lineDistancesNeedUpdate=!1);b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=b.groups,b.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new ce).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);this.addAttribute("position",
(new gb(b,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(b=new Float32Array(3*a.normals.length),this.addAttribute("normal",(new gb(b,3)).copyVector3sArray(a.normals)));0<a.colors.length&&(b=new Float32Array(3*a.colors.length),this.addAttribute("color",(new gb(b,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(b=new Float32Array(2*a.uvs.length),this.addAttribute("uv",(new gb(b,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(b=new Float32Array(2*a.uvs2.length),this.addAttribute("uv2",(new gb(b,
2)).copyVector2sArray(a.uvs2)));0<a.indices.length&&(b=new (65535<a.vertices.length?Uint32Array:Uint16Array)(3*a.indices.length),this.setIndex((new gb(b,1)).copyIndicesArray(a.indices)));this.groups=a.groups;for(var d in a.morphTargets){b=[];for(var g=a.morphTargets[d],t=0,w=g.length;t<w;t++){var y=g[t],F=new Qb(3*y.length,3);b.push(F.copyVector3sArray(y))}this.morphAttributes[d]=b}0<a.skinIndices.length&&(d=new Qb(4*a.skinIndices.length,4),this.addAttribute("skinIndex",d.copyVector4sArray(a.skinIndices)));
0<a.skinWeights.length&&(d=new Qb(4*a.skinWeights.length,4),this.addAttribute("skinWeight",d.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ab);var a=this.attributes.position.array;void 0!==a?this.boundingBox.setFromArray(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||
isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var a=new Ab,b=new r;return function(){null===this.boundingSphere&&(this.boundingSphere=new rb);var d=this.attributes.position;if(d){d=d.array;var g=this.boundingSphere.center;a.setFromArray(d);a.getCenter(g);for(var t=0,w=0,y=d.length;w<y;w+=3)b.fromArray(d,w),t=Math.max(t,g.distanceToSquared(b));
this.boundingSphere.radius=Math.sqrt(t);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.attributes,d=this.groups;if(b.position){var g=b.position.array;if(void 0===b.normal)this.addAttribute("normal",new gb(new Float32Array(g.length),3));else for(var t=b.normal.array,w=0,y=t.length;w<
y;w++)t[w]=0;t=b.normal.array;var F=new r,K=new r,M=new r,T=new r,Q=new r;if(a){a=a.array;0===d.length&&this.addGroup(0,a.length);for(var P=0,Z=d.length;P<Z;++P){w=d[P];y=w.start;var ca=w.count;w=y;for(y+=ca;w<y;w+=3){ca=3*a[w+0];var ja=3*a[w+1];var oa=3*a[w+2];F.fromArray(g,ca);K.fromArray(g,ja);M.fromArray(g,oa);T.subVectors(M,K);Q.subVectors(F,K);T.cross(Q);t[ca]+=T.x;t[ca+1]+=T.y;t[ca+2]+=T.z;t[ja]+=T.x;t[ja+1]+=T.y;t[ja+2]+=T.z;t[oa]+=T.x;t[oa+1]+=T.y;t[oa+2]+=T.z}}}else for(w=0,y=g.length;w<
y;w+=9)F.fromArray(g,w),K.fromArray(g,w+3),M.fromArray(g,w+6),T.subVectors(M,K),Q.subVectors(F,K),T.cross(Q),t[w]=T.x,t[w+1]=T.y,t[w+2]=T.z,t[w+3]=T.x,t[w+4]=T.y,t[w+5]=T.z,t[w+6]=T.x,t[w+7]=T.y,t[w+8]=T.z;this.normalizeNormals();b.normal.needsUpdate=!0}},merge:function(a,b){if(!1===(a&&a.isBufferGeometry))console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a);else{void 0===b&&(b=0);var d=this.attributes,g;for(g in d)if(void 0!==a.attributes[g]){var t=d[g].array,
w=a.attributes[g],y=w.array,F=0;for(w=w.itemSize*b;F<y.length;F++,w++)t[w]=y[F]}return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,d,g,t=0,w=a.length;t<w;t+=3)b=a[t],d=a[t+1],g=a[t+2],b=1/Math.sqrt(b*b+d*d+g*g),a[t]*=b,a[t+1]*=b,a[t+2]*=b},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var a=new qb,b=this.index.array,d=this.attributes,g;for(g in d){var t=d[g],w=t.array;t=
t.itemSize;for(var y=new w.constructor(b.length*t),F,K=0,M=0,T=b.length;M<T;M++){F=b[M]*t;for(var Q=0;Q<t;Q++)y[K++]=w[F++]}a.addAttribute(g,new gb(y,t))}return a},toJSON:function(){var a={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var b=this.parameters;for(t in b)void 0!==b[t]&&(a[t]=b[t]);return a}a.data={attributes:{}};var d=this.index;null!==d&&(b=Array.prototype.slice.call(d.array),
a.data.index={type:d.array.constructor.name,array:b});d=this.attributes;for(t in d){var g=d[t];b=Array.prototype.slice.call(g.array);a.data.attributes[t]={itemSize:g.itemSize,type:g.array.constructor.name,array:b,normalized:g.normalized}}var t=this.groups;0<t.length&&(a.data.groups=JSON.parse(JSON.stringify(t)));t=this.boundingSphere;null!==t&&(a.data.boundingSphere={center:t.center.toArray(),radius:t.radius});return a},clone:function(){return(new qb).copy(this)},copy:function(a){var b=a.index;null!==
b&&this.setIndex(b.clone());b=a.attributes;for(var d in b)this.addAttribute(d,b[d].clone());a=a.groups;d=0;for(b=a.length;d<b;d++){var g=a[d];this.addGroup(g.start,g.count,g.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});qb.MaxIndex=65535;Rb.prototype=Object.assign(Object.create(jb.prototype),{constructor:Rb,isMesh:!0,setDrawMode:function(a){this.drawMode=a},copy:function(a){jb.prototype.copy.call(this,a);this.drawMode=a.drawMode;return this},updateMorphTargets:function(){var a=
this.geometry.morphTargets;if(void 0!==a&&0<a.length){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var b=0,d=a.length;b<d;b++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[a[b].name]=b}},raycast:function(){function a(aa,qa,na,ua,ta,Aa,Ka){uc.barycoordFromPoint(aa,qa,na,ua,ja);ta.multiplyScalar(ja.x);Aa.multiplyScalar(ja.y);Ka.multiplyScalar(ja.z);ta.add(Aa).add(Ka);return ta.clone()}function b(aa,qa,na,ua,ta,Aa,Ka){var Ia=aa.material;if(null===(1===Ia.side?na.intersectTriangle(Aa,
ta,ua,!0,Ka):na.intersectTriangle(ua,ta,Aa,2!==Ia.side,Ka)))return null;ra.copy(Ka);ra.applyMatrix4(aa.matrixWorld);na=qa.ray.origin.distanceTo(ra);return na<qa.near||na>qa.far?null:{distance:na,point:ra.clone(),object:aa}}function d(aa,qa,na,ua,ta,Aa,Ka,Ia){y.fromArray(ua,3*Aa);F.fromArray(ua,3*Ka);K.fromArray(ua,3*Ia);if(aa=b(aa,qa,na,y,F,K,oa))ta&&(P.fromArray(ta,2*Aa),Z.fromArray(ta,2*Ka),ca.fromArray(ta,2*Ia),aa.uv=a(oa,y,F,K,P,Z,ca)),aa.face=new Pb(Aa,Ka,Ia,uc.normal(y,F,K)),aa.faceIndex=Aa;
return aa}var g=new z,t=new sc,w=new rb,y=new r,F=new r,K=new r,M=new r,T=new r,Q=new r,P=new n,Z=new n,ca=new n,ja=new r,oa=new r,ra=new r;return function(aa,qa){var na=this.geometry,ua=this.material,ta=this.matrixWorld;if(void 0!==ua&&(null===na.boundingSphere&&na.computeBoundingSphere(),w.copy(na.boundingSphere),w.applyMatrix4(ta),!1!==aa.ray.intersectsSphere(w)&&(g.getInverse(ta),t.copy(aa.ray).applyMatrix4(g),null===na.boundingBox||!1!==t.intersectsBox(na.boundingBox)))){var Aa;if(na&&na.isBufferGeometry){ua=
na.index;ta=na.attributes;na=ta.position.array;if(void 0!==ta.uv)var Ka=ta.uv.array;if(null!==ua){ta=ua.array;for(var Ia=0,Oa=ta.length;Ia<Oa;Ia+=3){ua=ta[Ia];var Ta=ta[Ia+1];var Na=ta[Ia+2];if(Aa=d(this,aa,t,na,Ka,ua,Ta,Na))Aa.faceIndex=Math.floor(Ia/3),qa.push(Aa)}}else for(Ia=0,Oa=na.length;Ia<Oa;Ia+=9)if(ua=Ia/3,Ta=ua+1,Na=ua+2,Aa=d(this,aa,t,na,Ka,ua,Ta,Na))Aa.index=ua,qa.push(Aa)}else if(na&&na.isGeometry){ta=ua&&ua.isMultiMaterial;Ia=!0===ta?ua.materials:null;Oa=na.vertices;Ta=na.faces;Na=
na.faceVertexUvs[0];0<Na.length&&(Ka=Na);for(var Ua=0,ab=Ta.length;Ua<ab;Ua++){var Pa=Ta[Ua];Aa=!0===ta?Ia[Pa.materialIndex]:ua;if(void 0!==Aa){Na=Oa[Pa.a];var Ma=Oa[Pa.b];var Wa=Oa[Pa.c];if(!0===Aa.morphTargets){Aa=na.morphTargets;var Ja=this.morphTargetInfluences;y.set(0,0,0);F.set(0,0,0);K.set(0,0,0);for(var eb=0,Za=Aa.length;eb<Za;eb++){var tb=Ja[eb];if(0!==tb){var ub=Aa[eb].vertices;y.addScaledVector(M.subVectors(ub[Pa.a],Na),tb);F.addScaledVector(T.subVectors(ub[Pa.b],Ma),tb);K.addScaledVector(Q.subVectors(ub[Pa.c],
Wa),tb)}}y.add(Na);F.add(Ma);K.add(Wa);Na=y;Ma=F;Wa=K}if(Aa=b(this,aa,t,Na,Ma,Wa,oa))Ka&&(Ja=Ka[Ua],P.copy(Ja[0]),Z.copy(Ja[1]),ca.copy(Ja[2]),Aa.uv=a(oa,Na,Ma,Wa,P,Z,ca)),Aa.face=Pa,Aa.faceIndex=Ua,qa.push(Aa)}}}}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});Jc.prototype=Object.create(qb.prototype);Jc.prototype.constructor=Jc;vc.prototype=Object.create(qb.prototype);vc.prototype.constructor=vc;ec.prototype=Object.create(jb.prototype);ec.prototype.constructor=
ec;ec.prototype.isCamera=!0;ec.prototype.getWorldDirection=function(){var a=new u;return function(b){b=b||new r;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();ec.prototype.lookAt=function(){var a=new z;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();ec.prototype.clone=function(){return(new this.constructor).copy(this)};ec.prototype.copy=function(a){jb.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);
this.projectionMatrix.copy(a.projectionMatrix);return this};hc.prototype=Object.assign(Object.create(ec.prototype),{constructor:hc,isPerspectiveCamera:!0,copy:function(a){ec.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*c.Math.RAD2DEG*
Math.atan(a);this.updateProjectionMatrix()},getFocalLength:function(){var a=Math.tan(.5*c.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*c.Math.RAD2DEG*Math.atan(Math.tan(.5*c.Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,b,d,g,t,w){this.aspect=a/b;this.view={fullWidth:a,fullHeight:b,offsetX:d,offsetY:g,
width:t,height:w};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,b=a*Math.tan(.5*c.Math.DEG2RAD*this.fov)/this.zoom,d=2*b,g=this.aspect*d,t=-.5*g,w=this.view;if(null!==w){var y=w.fullWidth,F=w.fullHeight;t+=w.offsetX*g/y;b-=w.offsetY*d/F;g*=w.width/y;d*=w.height/F}w=this.filmOffset;0!==w&&(t+=a*w/this.getFilmWidth());this.projectionMatrix.makeFrustum(t,t+g,b-d,b,a,this.far)},toJSON:function(a){a=
jb.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});zc.prototype=Object.assign(Object.create(ec.prototype),{constructor:zc,isOrthographicCamera:!0,copy:function(a){ec.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;
this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,b,d,g,t,w){this.view={fullWidth:a,fullHeight:b,offsetX:d,offsetY:g,width:t,height:w};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),d=(this.right+this.left)/
2,g=(this.top+this.bottom)/2,t=d-a;d+=a;a=g+b;b=g-b;if(null!==this.view){d=this.zoom/(this.view.width/this.view.fullWidth);b=this.zoom/(this.view.height/this.view.fullHeight);var w=(this.right-this.left)/this.view.width;g=(this.top-this.bottom)/this.view.height;t+=this.view.offsetX/d*w;d=t+this.view.width/d*w;a-=this.view.offsetY/b*g;b=a-this.view.height/b*g}this.projectionMatrix.makeOrthographic(t,d,a,b,this.near,this.far)},toJSON:function(a){a=jb.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;
a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}});var lg=0;Wb.prototype.isFogExp2=!0;Wb.prototype.clone=function(){return new Wb(this.color.getHex(),this.density)};Wb.prototype.toJSON=function(a){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};qc.prototype.isFog=!0;qc.prototype.clone=function(){return new qc(this.color.getHex(),
this.near,this.far)};qc.prototype.toJSON=function(a){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};dc.prototype=Object.create(jb.prototype);dc.prototype.constructor=dc;dc.prototype.copy=function(a,b){jb.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;
return this};dc.prototype.toJSON=function(a){var b=jb.prototype.toJSON.call(this,a);null!==this.background&&(b.object.background=this.background.toJSON(a));null!==this.fog&&(b.object.fog=this.fog.toJSON());return b};wc.prototype=Object.assign(Object.create(jb.prototype),{constructor:wc,isLensFlare:!0,copy:function(a){jb.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var b=0,d=a.lensFlares.length;b<d;b++)this.lensFlares.push(a.lensFlares[b]);
return this},add:function(a,b,d,g,t,w){void 0===b&&(b=-1);void 0===d&&(d=0);void 0===w&&(w=1);void 0===t&&(t=new ma(16777215));void 0===g&&(g=1);d=Math.min(d,Math.max(0,d));this.lensFlares.push({texture:a,size:b,distance:d,x:0,y:0,z:0,scale:1,rotation:0,opacity:w,color:t,blending:g})},updateLensFlares:function(){var a,b=this.lensFlares.length,d=2*-this.positionScreen.x,g=2*-this.positionScreen.y;for(a=0;a<b;a++){var t=this.lensFlares[a];t.x=this.positionScreen.x+d*t.distance;t.y=this.positionScreen.y+
g*t.distance;t.wantedRotation=t.x*Math.PI*.25;t.rotation+=.25*(t.wantedRotation-t.rotation)}}});Bc.prototype=Object.create(za.prototype);Bc.prototype.constructor=Bc;Bc.prototype.copy=function(a){za.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;return this};Yc.prototype=Object.assign(Object.create(jb.prototype),{constructor:Yc,isSprite:!0,raycast:function(){var a=new r;return function(b,d){a.setFromMatrixPosition(this.matrixWorld);b=b.ray.distanceSqToPoint(a);
b>this.scale.x*this.scale.y/4||d.push({distance:Math.sqrt(b),point:this.position,face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)}});fe.prototype=Object.assign(Object.create(jb.prototype),{constructor:fe,copy:function(a){jb.prototype.copy.call(this,a,!1);a=a.levels;for(var b=0,d=a.length;b<d;b++){var g=a[b];this.addLevel(g.object.clone(),g.distance)}return this},addLevel:function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var d=this.levels,g=0;g<d.length&&
!(b<d[g].distance);g++);d.splice(g,0,{distance:b,object:a});this.add(a)},getObjectForDistance:function(a){for(var b=this.levels,d=1,g=b.length;d<g&&!(a<b[d].distance);d++);return b[d-1].object},raycast:function(){var a=new r;return function(b,d){a.setFromMatrixPosition(this.matrixWorld);var g=b.ray.origin.distanceTo(a);this.getObjectForDistance(g).raycast(b,d)}}(),update:function(){var a=new r,b=new r;return function(d){var g=this.levels;if(1<g.length){a.setFromMatrixPosition(d.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);
d=a.distanceTo(b);g[0].object.visible=!0;for(var t=1,w=g.length;t<w;t++)if(d>=g[t].distance)g[t-1].object.visible=!1,g[t].object.visible=!0;else break;for(;t<w;t++)g[t].object.visible=!1}}}(),toJSON:function(a){a=jb.prototype.toJSON.call(this,a);a.object.levels=[];for(var b=this.levels,d=0,g=b.length;d<g;d++){var t=b[d];a.object.levels.push({object:t.object.uuid,distance:t.distance})}return a}});gd.prototype=Object.create(f.prototype);gd.prototype.constructor=gd;gd.prototype.isDataTexture=!0;Object.assign(Ue.prototype,
{calculateInverses:function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var d=new z;this.bones[a]&&d.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(d)}},pose:function(){for(var a,b=0,d=this.bones.length;b<d;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);b=0;for(d=this.bones.length;b<d;b++)if(a=this.bones[b])a.parent&&a.parent.isBone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,
a.quaternion,a.scale)},update:function(){var a=new z;return function(){for(var b=0,d=this.bones.length;b<d;b++)a.multiplyMatrices(this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix,this.boneInverses[b]),a.toArray(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new Ue(this.bones,this.boneInverses,this.useVertexTexture)}});Ve.prototype=Object.assign(Object.create(jb.prototype),{constructor:Ve,isBone:!0,copy:function(a){jb.prototype.copy.call(this,
a);this.skin=a.skin;return this}});We.prototype=Object.assign(Object.create(Rb.prototype),{constructor:We,isSkinnedMesh:!0,bind:function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var b=this.geometry.skinWeights[a],
d=1/b.lengthManhattan();Infinity!==d?b.multiplyScalar(d):b.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){b=new q;var g=this.geometry.attributes.skinWeight;for(a=0;a<g.count;a++)b.x=g.getX(a),b.y=g.getY(a),b.z=g.getZ(a),b.w=g.getW(a),d=1/b.lengthManhattan(),Infinity!==d?b.multiplyScalar(d):b.set(1,0,0,0),g.setXYZW(a,b.x,b.y,b.z,b.w)}},updateMatrixWorld:function(a){Rb.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):
"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture)).copy(this)}});gc.prototype=Object.create(za.prototype);gc.prototype.constructor=gc;gc.prototype.isLineBasicMaterial=!0;gc.prototype.copy=function(a){za.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=
a.linecap;this.linejoin=a.linejoin;return this};Uc.prototype=Object.assign(Object.create(jb.prototype),{constructor:Uc,isLine:!0,raycast:function(){var a=new z,b=new sc,d=new rb;return function(g,t){var w=g.linePrecision;w*=w;var y=this.geometry,F=this.matrixWorld;null===y.boundingSphere&&y.computeBoundingSphere();d.copy(y.boundingSphere);d.applyMatrix4(F);if(!1!==g.ray.intersectsSphere(d)){a.getInverse(F);b.copy(g.ray).applyMatrix4(a);var K=new r,M=new r;F=new r;var T=new r,Q=this&&this.isLineSegments?
2:1;if(y&&y.isBufferGeometry){var P=y.index,Z=y.attributes.position.array;if(null!==P){P=P.array;y=0;for(var ca=P.length-1;y<ca;y+=Q){var ja=P[y+1];K.fromArray(Z,3*P[y]);M.fromArray(Z,3*ja);ja=b.distanceSqToSegment(K,M,T,F);ja>w||(T.applyMatrix4(this.matrixWorld),ja=g.ray.origin.distanceTo(T),ja<g.near||ja>g.far||t.push({distance:ja,point:F.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this}))}}else for(y=0,ca=Z.length/3-1;y<ca;y+=Q)K.fromArray(Z,3*y),M.fromArray(Z,
3*y+3),ja=b.distanceSqToSegment(K,M,T,F),ja>w||(T.applyMatrix4(this.matrixWorld),ja=g.ray.origin.distanceTo(T),ja<g.near||ja>g.far||t.push({distance:ja,point:F.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this}))}else if(y&&y.isGeometry)for(K=y.vertices,M=K.length,y=0;y<M-1;y+=Q)ja=b.distanceSqToSegment(K[y],K[y+1],T,F),ja>w||(T.applyMatrix4(this.matrixWorld),ja=g.ray.origin.distanceTo(T),ja<g.near||ja>g.far||t.push({distance:ja,point:F.clone().applyMatrix4(this.matrixWorld),
index:y,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});$b.prototype=Object.assign(Object.create(Uc.prototype),{constructor:$b,isLineSegments:!0});Fc.prototype=Object.create(za.prototype);Fc.prototype.constructor=Fc;Fc.prototype.isPointsMaterial=!0;Fc.prototype.copy=function(a){za.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;return this};
Fd.prototype=Object.assign(Object.create(jb.prototype),{constructor:Fd,isPoints:!0,raycast:function(){var a=new z,b=new sc,d=new rb;return function(g,t){function w(ja,oa){var ra=b.distanceSqToPoint(ja);if(ra<T){ja=b.closestPointToPoint(ja);ja.applyMatrix4(K);var aa=g.ray.origin.distanceTo(ja);aa<g.near||aa>g.far||t.push({distance:aa,distanceToRay:Math.sqrt(ra),point:ja.clone(),index:oa,face:null,object:y})}}var y=this,F=this.geometry,K=this.matrixWorld,M=g.params.Points.threshold;null===F.boundingSphere&&
F.computeBoundingSphere();d.copy(F.boundingSphere);d.applyMatrix4(K);if(!1!==g.ray.intersectsSphere(d)){a.getInverse(K);b.copy(g.ray).applyMatrix4(a);M/=(this.scale.x+this.scale.y+this.scale.z)/3;var T=M*M;M=new r;if(F&&F.isBufferGeometry){var Q=F.index;F=F.attributes.position.array;if(null!==Q){var P=Q.array;Q=0;for(var Z=P.length;Q<Z;Q++){var ca=P[Q];M.fromArray(F,3*ca);w(M,ca)}}else for(Q=0,P=F.length/3;Q<P;Q++)M.fromArray(F,3*Q),w(M,Q)}else for(M=F.vertices,Q=0,P=M.length;Q<P;Q++)w(M[Q],Q)}}}(),
clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});ge.prototype=Object.assign(Object.create(jb.prototype),{constructor:ge});Xe.prototype=Object.create(f.prototype);Xe.prototype.constructor=Xe;Gd.prototype=Object.create(f.prototype);Gd.prototype.constructor=Gd;Gd.prototype.isCompressedTexture=!0;Ye.prototype=Object.create(f.prototype);Ye.prototype.constructor=Ye;he.prototype=Object.create(f.prototype);he.prototype.constructor=he;he.prototype.isDepthTexture=!0;
Hd.prototype=Object.create(qb.prototype);Hd.prototype.constructor=Hd;Ze.prototype=Object.create(qb.prototype);Ze.prototype.constructor=Ze;ie.prototype=Object.create(pb.prototype);ie.prototype.constructor=ie;xc.prototype=Object.create(qb.prototype);xc.prototype.constructor=xc;je.prototype=Object.create(xc.prototype);je.prototype.constructor=je;ke.prototype=Object.create(pb.prototype);ke.prototype.constructor=ke;le.prototype=Object.create(xc.prototype);le.prototype.constructor=le;me.prototype=Object.create(pb.prototype);
me.prototype.constructor=me;ne.prototype=Object.create(xc.prototype);ne.prototype.constructor=ne;oe.prototype=Object.create(pb.prototype);oe.prototype.constructor=oe;pe.prototype=Object.create(xc.prototype);pe.prototype.constructor=pe;qe.prototype=Object.create(pb.prototype);qe.prototype.constructor=qe;re.prototype=Object.create(pb.prototype);re.prototype.constructor=re;Gc.prototype=Object.create(pb.prototype);Gc.prototype.constructor=Gc;Gc.NoTaper=function(a){return 1};Gc.SinusoidalTaper=function(a){return Math.sin(Math.PI*
a)};Gc.FrenetFrames=function(a,b,d){var g=new r,t=[],w=[],y=[],F=new r,K=new z;b+=1;var M;this.tangents=t;this.normals=w;this.binormals=y;for(M=0;M<b;M++){var T=M/(b-1);t[M]=a.getTangentAt(T);t[M].normalize()}w[0]=new r;y[0]=new r;a=Number.MAX_VALUE;M=Math.abs(t[0].x);T=Math.abs(t[0].y);var Q=Math.abs(t[0].z);M<=a&&(a=M,g.set(1,0,0));T<=a&&(a=T,g.set(0,1,0));Q<=a&&g.set(0,0,1);F.crossVectors(t[0],g).normalize();w[0].crossVectors(t[0],F);y[0].crossVectors(t[0],w[0]);for(M=1;M<b;M++)w[M]=w[M-1].clone(),
y[M]=y[M-1].clone(),F.crossVectors(t[M-1],t[M]),F.length()>Number.EPSILON&&(F.normalize(),g=Math.acos(c.Math.clamp(t[M-1].dot(t[M]),-1,1)),w[M].applyMatrix4(K.makeRotationAxis(F,g))),y[M].crossVectors(t[M],w[M]);if(d)for(g=Math.acos(c.Math.clamp(w[0].dot(w[b-1]),-1,1)),g/=b-1,0<t[0].dot(F.crossVectors(w[0],w[b-1]))&&(g=-g),M=1;M<b;M++)w[M].applyMatrix4(K.makeRotationAxis(t[M],g*M)),y[M].crossVectors(t[M],w[M])};Id.prototype=Object.create(qb.prototype);Id.prototype.constructor=Id;se.prototype=Object.create(pb.prototype);
se.prototype.constructor=se;Jd.prototype=Object.create(qb.prototype);Jd.prototype.constructor=Jd;te.prototype=Object.create(pb.prototype);te.prototype.constructor=te;c.ShapeUtils={area:function(a){for(var b=a.length,d=0,g=b-1,t=0;t<b;g=t++)d+=a[g].x*a[t].y-a[t].x*a[g].y;return.5*d},triangulate:function(){return function(a,b){var d=a.length;if(3>d)return null;var g=[],t=[],w=[],y;if(0<c.ShapeUtils.area(a))for(y=0;y<d;y++)t[y]=y;else for(y=0;y<d;y++)t[y]=d-1-y;var F=2*d;for(y=d-1;2<d;){if(0>=F--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");
break}var K=y;d<=K&&(K=0);y=K+1;d<=y&&(y=0);var M=y+1;d<=M&&(M=0);a:{var T;var Q=a[t[K]].x;var P=a[t[K]].y;var Z=a[t[y]].x;var ca=a[t[y]].y;var ja=a[t[M]].x;var oa=a[t[M]].y;if(Number.EPSILON>(Z-Q)*(oa-P)-(ca-P)*(ja-Q))var ra=!1;else{var aa=ja-Z;var qa=oa-ca;var na=Q-ja;var ua=P-oa;var ta=Z-Q;ra=ca-P;for(T=0;T<d;T++){var Aa=a[t[T]].x;var Ka=a[t[T]].y;if(!(Aa===Q&&Ka===P||Aa===Z&&Ka===ca||Aa===ja&&Ka===oa)){var Ia=Aa-Q;var Oa=Ka-P;var Ta=Aa-Z;var Na=Ka-ca;Aa-=ja;Ka-=oa;Na=aa*Na-qa*Ta;Oa=ta*Oa-ra*Ia;
Aa=na*Ka-ua*Aa;if(Na>=-Number.EPSILON&&Aa>=-Number.EPSILON&&Oa>=-Number.EPSILON){ra=!1;break a}}}ra=!0}}if(ra){g.push([a[t[K]],a[t[y]],a[t[M]]]);w.push([t[K],t[y],t[M]]);K=y;for(M=y+1;M<d;K++,M++)t[K]=t[M];d--;F=2*d}}return b?w:g}}(),triangulateShape:function(a,b){function d(Q){var P=Q.length;2<P&&Q[P-1].equals(Q[0])&&Q.pop()}function g(Q,P,Z){return Q.x!==P.x?Q.x<P.x?Q.x<=Z.x&&Z.x<=P.x:P.x<=Z.x&&Z.x<=Q.x:Q.y<P.y?Q.y<=Z.y&&Z.y<=P.y:P.y<=Z.y&&Z.y<=Q.y}function t(Q,P,Z,ca,ja){var oa=P.x-Q.x,ra=P.y-
Q.y,aa=ca.x-Z.x,qa=ca.y-Z.y,na=Q.x-Z.x,ua=Q.y-Z.y,ta=ra*aa-oa*qa,Aa=ra*na-oa*ua;if(Math.abs(ta)>Number.EPSILON){if(0<ta){if(0>Aa||Aa>ta)return[];aa=qa*na-aa*ua;if(0>aa||aa>ta)return[]}else{if(0<Aa||Aa<ta)return[];aa=qa*na-aa*ua;if(0<aa||aa<ta)return[]}if(0===aa)return!ja||0!==Aa&&Aa!==ta?[Q]:[];if(aa===ta)return!ja||0!==Aa&&Aa!==ta?[P]:[];if(0===Aa)return[Z];if(Aa===ta)return[ca];ja=aa/ta;return[{x:Q.x+ja*oa,y:Q.y+ja*ra}]}if(0!==Aa||qa*na!==aa*ua)return[];ra=0===oa&&0===ra;aa=0===aa&&0===qa;if(ra&&
aa)return Q.x!==Z.x||Q.y!==Z.y?[]:[Q];if(ra)return g(Z,ca,Q)?[Q]:[];if(aa)return g(Q,P,Z)?[Z]:[];0!==oa?(Q.x<P.x?(oa=Q,aa=Q.x,ra=P,Q=P.x):(oa=P,aa=P.x,ra=Q,Q=Q.x),Z.x<ca.x?(P=Z,ta=Z.x,qa=ca,Z=ca.x):(P=ca,ta=ca.x,qa=Z,Z=Z.x)):(Q.y<P.y?(oa=Q,aa=Q.y,ra=P,Q=P.y):(oa=P,aa=P.y,ra=Q,Q=Q.y),Z.y<ca.y?(P=Z,ta=Z.y,qa=ca,Z=ca.y):(P=ca,ta=ca.y,qa=Z,Z=Z.y));return aa<=ta?Q<ta?[]:Q===ta?ja?[]:[P]:Q<=Z?[P,ra]:[P,qa]:aa>Z?[]:aa===Z?ja?[]:[oa]:Q<=Z?[oa,ra]:[oa,qa]}function w(Q,P,Z,ca){var ja=P.x-Q.x,oa=P.y-Q.y;P=Z.x-
Q.x;Z=Z.y-Q.y;var ra=ca.x-Q.x;ca=ca.y-Q.y;Q=ja*Z-oa*P;ja=ja*ca-oa*ra;return Math.abs(Q)>Number.EPSILON?(P=ra*Z-ca*P,0<Q?0<=ja&&0<=P:0<=ja||0<=P):0<ja}d(a);b.forEach(d);var y,F={},K=a.concat();var M=0;for(y=b.length;M<y;M++)Array.prototype.push.apply(K,b[M]);M=0;for(y=K.length;M<y;M++){var T=K[M].x+":"+K[M].y;void 0!==F[T]&&console.warn("THREE.ShapeUtils: Duplicate point",T,M);F[T]=M}M=function(Q,P){function Z(Ua,ab){var Pa=oa.length-1,Ma=Ua-1;0>Ma&&(Ma=Pa);var Wa=Ua+1;Wa>Pa&&(Wa=0);Pa=w(oa[Ua],oa[Ma],
oa[Wa],Ta[ab]);if(!Pa)return!1;Pa=Ta.length-1;Ma=ab-1;0>Ma&&(Ma=Pa);Wa=ab+1;Wa>Pa&&(Wa=0);return(Pa=w(Ta[ab],Ta[Ma],Ta[Wa],oa[Ua]))?!0:!1}function ca(Ua,ab){var Pa;for(Pa=0;Pa<oa.length;Pa++){var Ma=Pa+1;Ma%=oa.length;Ma=t(Ua,ab,oa[Pa],oa[Ma],!0);if(0<Ma.length)return!0}return!1}function ja(Ua,ab){var Pa,Ma;for(Pa=0;Pa<ra.length;Pa++){var Wa=P[ra[Pa]];for(Ma=0;Ma<Wa.length;Ma++){var Ja=Ma+1;Ja%=Wa.length;Ja=t(Ua,ab,Wa[Ma],Wa[Ja],!0);if(0<Ja.length)return!0}}return!1}var oa=Q.concat(),ra=[],aa,qa;
Q=[];var na,ua=0;for(aa=P.length;ua<aa;ua++)ra.push(ua);var ta=0;for(var Aa=2*ra.length;0<ra.length;){Aa--;if(0>Aa){console.log("Infinite Loop! Holes left:"+ra.length+", Probably Hole outside Shape!");break}for(qa=ta;qa<oa.length;qa++){var Ka=oa[qa];aa=-1;for(ua=0;ua<ra.length;ua++){var Ia=ra[ua];var Oa=Ka.x+":"+Ka.y+":"+Ia;if(void 0===Q[Oa]){var Ta=P[Ia];for(na=0;na<Ta.length;na++)if(Ia=Ta[na],Z(qa,na)&&!ca(Ka,Ia)&&!ja(Ka,Ia)){aa=na;ra.splice(ua,1);ta=oa.slice(0,qa+1);Ia=oa.slice(qa);na=Ta.slice(aa);
var Na=Ta.slice(0,aa+1);oa=ta.concat(na).concat(Na).concat(Ia);ta=qa;break}if(0<=aa)break;Q[Oa]=!0}}if(0<=aa)break}}return oa}(a,b);K=c.ShapeUtils.triangulate(M,!1);M=0;for(y=K.length;M<y;M++)for(b=K[M],a=0;3>a;a++)T=b[a].x+":"+b[a].y,T=F[T],void 0!==T&&(b[a]=T);return K.concat()},isClockWise:function(a){return 0>c.ShapeUtils.area(a)},b2:function(){return function(a,b,d,g){var t=1-a;return t*t*b+2*(1-a)*a*d+a*a*g}}(),b3:function(){return function(a,b,d,g,t){var w=1-a,y=1-a;return w*w*w*b+3*y*y*a*
d+3*(1-a)*a*a*g+a*a*a*t}}()};Cc.prototype=Object.create(pb.prototype);Cc.prototype.constructor=Cc;Cc.prototype.addShapeList=function(a,b){for(var d=a.length,g=0;g<d;g++)this.addShape(a[g],b)};Cc.prototype.addShape=function(a,b){function d(mb,Hb,Kb){Hb||console.error("THREE.ExtrudeGeometry: vec does not exist");return Hb.clone().multiplyScalar(Kb).add(mb)}function g(mb,Hb,Kb){var Ba=mb.x-Hb.x;var db=mb.y-Hb.y;var hb=Kb.x-mb.x;var vb=Kb.y-mb.y,lb=Ba*Ba+db*db;if(Math.abs(Ba*vb-db*hb)>Number.EPSILON){var Ib=
Math.sqrt(lb),Jb=Math.sqrt(hb*hb+vb*vb);lb=Hb.x-db/Ib;Hb=Hb.y+Ba/Ib;vb=((Kb.x-vb/Jb-lb)*vb-(Kb.y+hb/Jb-Hb)*hb)/(Ba*vb-db*hb);hb=lb+Ba*vb-mb.x;Ba=Hb+db*vb-mb.y;db=hb*hb+Ba*Ba;if(2>=db)return new n(hb,Ba);db=Math.sqrt(db/2)}else mb=!1,Ba>Number.EPSILON?hb>Number.EPSILON&&(mb=!0):Ba<-Number.EPSILON?hb<-Number.EPSILON&&(mb=!0):Math.sign(db)===Math.sign(vb)&&(mb=!0),mb?(hb=-db,db=Math.sqrt(lb)):(hb=Ba,Ba=db,db=Math.sqrt(lb/2));return new n(hb/db,Ba/db)}function t(mb,Hb){for(Ja=mb.length;0<=--Ja;){var Kb=
Ja;var Ba=Ja-1;0>Ba&&(Ba=mb.length-1);var db,hb=Z+2*T;for(db=0;db<hb;db++){var vb=Pa*db,lb=Pa*(db+1),Ib=Hb+Kb+vb;vb=Hb+Ba+vb;var Jb=Hb+Ba+lb;lb=Hb+Kb+lb;Ib+=Ka;vb+=Ka;Jb+=Ka;lb+=Ka;Aa.faces.push(new Pb(Ib,vb,lb,null,null,1));Aa.faces.push(new Pb(vb,Jb,lb,null,null,1));Ib=oa.generateSideWallUV(Aa,Ib,vb,Jb,lb);Aa.faceVertexUvs[0].push([Ib[0],Ib[1],Ib[3]]);Aa.faceVertexUvs[0].push([Ib[1],Ib[2],Ib[3]])}}}function w(mb,Hb,Kb){Aa.vertices.push(new r(mb,Hb,Kb))}function y(mb,Hb,Kb){mb+=Ka;Hb+=Ka;Kb+=Ka;
Aa.faces.push(new Pb(mb,Hb,Kb,null,null,0));mb=oa.generateTopUV(Aa,mb,Hb,Kb);Aa.faceVertexUvs[0].push(mb)}var F=void 0!==b.amount?b.amount:100,K=void 0!==b.bevelThickness?b.bevelThickness:6,M=void 0!==b.bevelSize?b.bevelSize:K-2,T=void 0!==b.bevelSegments?b.bevelSegments:3,Q=void 0!==b.bevelEnabled?b.bevelEnabled:!0,P=void 0!==b.curveSegments?b.curveSegments:12,Z=void 0!==b.steps?b.steps:1,ca=b.extrudePath,ja=!1,oa=void 0!==b.UVGenerator?b.UVGenerator:Cc.WorldUVGenerator;if(ca){var ra=ca.getSpacedPoints(Z);
ja=!0;Q=!1;var aa=void 0!==b.frames?b.frames:new Gc.FrenetFrames(ca,Z,!1);var qa=new r;var na=new r;var ua=new r}Q||(M=K=T=0);var ta,Aa=this,Ka=this.vertices.length;b=a.extractPoints(P);a=b.shape;var Ia=b.holes;if(b=!c.ShapeUtils.isClockWise(a)){a=a.reverse();var Oa=0;for(ta=Ia.length;Oa<ta;Oa++){var Ta=Ia[Oa];c.ShapeUtils.isClockWise(Ta)&&(Ia[Oa]=Ta.reverse())}b=!1}var Na=c.ShapeUtils.triangulateShape(a,Ia),Ua=a;Oa=0;for(ta=Ia.length;Oa<ta;Oa++)Ta=Ia[Oa],a=a.concat(Ta);var ab,Pa=a.length,Ma,Wa=Na.length;
b=[];var Ja=0;var eb=Ua.length;var Za=eb-1;for(ab=Ja+1;Ja<eb;Ja++,Za++,ab++)Za===eb&&(Za=0),ab===eb&&(ab=0),b[Ja]=g(Ua[Ja],Ua[Za],Ua[ab]);P=[];ca=b.concat();Oa=0;for(ta=Ia.length;Oa<ta;Oa++){Ta=Ia[Oa];var tb=[];Ja=0;eb=Ta.length;Za=eb-1;for(ab=Ja+1;Ja<eb;Ja++,Za++,ab++)Za===eb&&(Za=0),ab===eb&&(ab=0),tb[Ja]=g(Ta[Ja],Ta[Za],Ta[ab]);P.push(tb);ca=ca.concat(tb)}for(Za=0;Za<T;Za++){eb=Za/T;var ub=K*Math.cos(eb*Math.PI/2);ab=M*Math.sin(eb*Math.PI/2);Ja=0;for(eb=Ua.length;Ja<eb;Ja++){var Db=d(Ua[Ja],b[Ja],
ab);w(Db.x,Db.y,-ub)}Oa=0;for(ta=Ia.length;Oa<ta;Oa++)for(Ta=Ia[Oa],tb=P[Oa],Ja=0,eb=Ta.length;Ja<eb;Ja++)Db=d(Ta[Ja],tb[Ja],ab),w(Db.x,Db.y,-ub)}ab=M;for(Ja=0;Ja<Pa;Ja++)Db=Q?d(a[Ja],ca[Ja],ab):a[Ja],ja?(na.copy(aa.normals[0]).multiplyScalar(Db.x),qa.copy(aa.binormals[0]).multiplyScalar(Db.y),ua.copy(ra[0]).add(na).add(qa),w(ua.x,ua.y,ua.z)):w(Db.x,Db.y,0);for(eb=1;eb<=Z;eb++)for(Ja=0;Ja<Pa;Ja++)Db=Q?d(a[Ja],ca[Ja],ab):a[Ja],ja?(na.copy(aa.normals[eb]).multiplyScalar(Db.x),qa.copy(aa.binormals[eb]).multiplyScalar(Db.y),
ua.copy(ra[eb]).add(na).add(qa),w(ua.x,ua.y,ua.z)):w(Db.x,Db.y,F/Z*eb);for(Za=T-1;0<=Za;Za--){eb=Za/T;ub=K*Math.cos(eb*Math.PI/2);ab=M*Math.sin(eb*Math.PI/2);Ja=0;for(eb=Ua.length;Ja<eb;Ja++)Db=d(Ua[Ja],b[Ja],ab),w(Db.x,Db.y,F+ub);Oa=0;for(ta=Ia.length;Oa<ta;Oa++)for(Ta=Ia[Oa],tb=P[Oa],Ja=0,eb=Ta.length;Ja<eb;Ja++)Db=d(Ta[Ja],tb[Ja],ab),ja?w(Db.x,Db.y+ra[Z-1].y,ra[Z-1].x+ub):w(Db.x,Db.y,F+ub)}(function(){if(Q){var mb=0*Pa;for(Ja=0;Ja<Wa;Ja++)Ma=Na[Ja],y(Ma[2]+mb,Ma[1]+mb,Ma[0]+mb);mb=Pa*(Z+2*T);for(Ja=
0;Ja<Wa;Ja++)Ma=Na[Ja],y(Ma[0]+mb,Ma[1]+mb,Ma[2]+mb)}else{for(Ja=0;Ja<Wa;Ja++)Ma=Na[Ja],y(Ma[2],Ma[1],Ma[0]);for(Ja=0;Ja<Wa;Ja++)Ma=Na[Ja],y(Ma[0]+Pa*Z,Ma[1]+Pa*Z,Ma[2]+Pa*Z)}})();(function(){var mb=0;t(Ua,mb);mb+=Ua.length;Oa=0;for(ta=Ia.length;Oa<ta;Oa++)Ta=Ia[Oa],t(Ta,mb),mb+=Ta.length})()};Cc.WorldUVGenerator={generateTopUV:function(a,b,d,g){a=a.vertices;b=a[b];d=a[d];g=a[g];return[new n(b.x,b.y),new n(d.x,d.y),new n(g.x,g.y)]},generateSideWallUV:function(a,b,d,g,t){a=a.vertices;b=a[b];d=a[d];
g=a[g];t=a[t];return.01>Math.abs(b.y-d.y)?[new n(b.x,1-b.z),new n(d.x,1-d.z),new n(g.x,1-g.z),new n(t.x,1-t.z)]:[new n(b.y,1-b.z),new n(d.y,1-d.z),new n(g.y,1-g.z),new n(t.y,1-t.z)]}};ue.prototype=Object.create(Cc.prototype);ue.prototype.constructor=ue;hd.prototype=Object.create(qb.prototype);hd.prototype.constructor=hd;Kd.prototype=Object.create(pb.prototype);Kd.prototype.constructor=Kd;Ld.prototype=Object.create(qb.prototype);Ld.prototype.constructor=Ld;ve.prototype=Object.create(pb.prototype);
ve.prototype.constructor=ve;we.prototype=Object.create(pb.prototype);we.prototype.constructor=we;Md.prototype=Object.create(qb.prototype);Md.prototype.constructor=Md;xe.prototype=Object.create(pb.prototype);xe.prototype.constructor=xe;Zc.prototype=Object.create(pb.prototype);Zc.prototype.constructor=Zc;Zc.prototype.addShapeList=function(a,b){for(var d=0,g=a.length;d<g;d++)this.addShape(a[d],b);return this};Zc.prototype.addShape=function(a,b){void 0===b&&(b={});var d=b.material,g=void 0===b.UVGenerator?
Cc.WorldUVGenerator:b.UVGenerator,t,w=this.vertices.length;a=a.extractPoints(void 0!==b.curveSegments?b.curveSegments:12);var y=a.shape,F=a.holes;if(!c.ShapeUtils.isClockWise(y))for(y=y.reverse(),a=0,t=F.length;a<t;a++){var K=F[a];c.ShapeUtils.isClockWise(K)&&(F[a]=K.reverse())}b=c.ShapeUtils.triangulateShape(y,F);a=0;for(t=F.length;a<t;a++)K=F[a],y=y.concat(K);F=y.length;t=b.length;for(a=0;a<F;a++)K=y[a],this.vertices.push(new r(K.x,K.y,0));for(a=0;a<t;a++)F=b[a],y=F[0]+w,K=F[1]+w,F=F[2]+w,this.faces.push(new Pb(y,
K,F,null,null,d)),this.faceVertexUvs[0].push(g.generateTopUV(this,y,K,F))};Nd.prototype=Object.create(qb.prototype);Nd.prototype.constructor=Nd;$c.prototype=Object.create(qb.prototype);$c.prototype.constructor=$c;id.prototype=Object.create(pb.prototype);id.prototype.constructor=id;ye.prototype=Object.create(id.prototype);ye.prototype.constructor=ye;ze.prototype=Object.create(qb.prototype);ze.prototype.constructor=ze;Od.prototype=Object.create(qb.prototype);Od.prototype.constructor=Od;Ae.prototype=
Object.create(pb.prototype);Ae.prototype.constructor=Ae;jd.prototype=Object.create(pb.prototype);jd.prototype.constructor=jd;var Ic=Object.freeze({WireframeGeometry:Hd,ParametricGeometry:ie,TetrahedronGeometry:ke,TetrahedronBufferGeometry:je,OctahedronGeometry:me,OctahedronBufferGeometry:le,IcosahedronGeometry:oe,IcosahedronBufferGeometry:ne,DodecahedronGeometry:qe,DodecahedronBufferGeometry:pe,PolyhedronGeometry:re,PolyhedronBufferGeometry:xc,TubeGeometry:Gc,TorusKnotGeometry:se,TorusKnotBufferGeometry:Id,
TorusGeometry:te,TorusBufferGeometry:Jd,TextGeometry:ue,SphereBufferGeometry:hd,SphereGeometry:Kd,RingGeometry:ve,RingBufferGeometry:Ld,PlaneBufferGeometry:vc,PlaneGeometry:we,LatheGeometry:xe,LatheBufferGeometry:Md,ShapeGeometry:Zc,ExtrudeGeometry:Cc,EdgesGeometry:Nd,ConeGeometry:ye,ConeBufferGeometry:ze,CylinderGeometry:id,CylinderBufferGeometry:$c,CircleBufferGeometry:Od,CircleGeometry:Ae,BoxBufferGeometry:Jc,BoxGeometry:jd});Pd.prototype=Object.create(ob.prototype);Pd.prototype.constructor=Pd;
Pd.prototype.isShadowMaterial=!0;Qd.prototype=Object.create(ob.prototype);Qd.prototype.constructor=Qd;Qd.prototype.isRawShaderMaterial=!0;Be.prototype={constructor:Be,isMultiMaterial:!0,toJSON:function(a){for(var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},d=this.materials,g=0,t=d.length;g<t;g++){var w=d[g].toJSON(a);delete w.metadata;b.materials.push(w)}b.visible=this.visible;return b},clone:function(){for(var a=new this.constructor,
b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return a}};Mc.prototype=Object.create(za.prototype);Mc.prototype.constructor=Mc;Mc.prototype.isMeshStandardMaterial=!0;Mc.prototype.copy=function(a){za.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=
a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;
this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};kd.prototype=Object.create(Mc.prototype);kd.prototype.constructor=kd;kd.prototype.isMeshPhysicalMaterial=!0;kd.prototype.copy=function(a){Mc.prototype.copy.call(this,a);this.defines={PHYSICAL:""};this.reflectivity=
a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return this};ad.prototype=Object.create(za.prototype);ad.prototype.constructor=ad;ad.prototype.isMeshPhongMaterial=!0;ad.prototype.copy=function(a){za.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);
this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;
this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};ld.prototype=Object.create(za.prototype);ld.prototype.constructor=ld;ld.prototype.isMeshNormalMaterial=!0;ld.prototype.copy=function(a){za.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};md.prototype=Object.create(za.prototype);
md.prototype.constructor=md;md.prototype.isMeshLambertMaterial=!0;md.prototype.copy=function(a){za.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=
a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};nd.prototype=Object.create(za.prototype);nd.prototype.constructor=nd;nd.prototype.isLineDashedMaterial=!0;nd.prototype.copy=function(a){za.prototype.copy.call(this,a);this.color.copy(a.color);
this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return this};var rg=Object.freeze({ShadowMaterial:Pd,SpriteMaterial:Bc,RawShaderMaterial:Qd,ShaderMaterial:ob,PointsMaterial:Fc,MultiMaterial:Be,MeshPhysicalMaterial:kd,MeshStandardMaterial:Mc,MeshPhongMaterial:ad,MeshNormalMaterial:ld,MeshLambertMaterial:md,MeshDepthMaterial:nb,MeshBasicMaterial:bc,LineDashedMaterial:nd,LineBasicMaterial:gc,Material:za});c.Cache={enabled:!1,files:{},add:function(a,b){!1!==
this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};c.DefaultLoadingManager=new vf;Object.assign(Hc.prototype,{load:function(a,b,d,g){void 0!==this.path&&(a=this.path+a);var t=this,w=c.Cache.get(a);if(void 0!==w)return t.manager.itemStart(a),setTimeout(function(){b&&b(w);t.manager.itemEnd(a)},0),w;var y=new XMLHttpRequest;y.open("GET",a,!0);y.addEventListener("load",function(F){var K=
F.target.response;c.Cache.add(a,K);200===this.status?(b&&b(K),t.manager.itemEnd(a)):0===this.status?(console.warn("THREE.XHRLoader: HTTP Status 0 received."),b&&b(K),t.manager.itemEnd(a)):(g&&g(F),t.manager.itemError(a))},!1);void 0!==d&&y.addEventListener("progress",function(F){d(F)},!1);y.addEventListener("error",function(F){g&&g(F);t.manager.itemError(a)},!1);void 0!==this.responseType&&(y.responseType=this.responseType);void 0!==this.withCredentials&&(y.withCredentials=this.withCredentials);y.overrideMimeType&&
y.overrideMimeType("text/plain");y.send(null);t.manager.itemStart(a);return y},setPath:function(a){this.path=a;return this},setResponseType:function(a){this.responseType=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this}});Object.assign(ag.prototype,{load:function(a,b,d,g){function t(P){K.load(a[P],function(Z){Z=w._parser(Z,!0);y[P]={width:Z.width,height:Z.height,format:Z.format,mipmaps:Z.mipmaps};M+=1;6===M&&(1===Z.mipmapCount&&(F.minFilter=1006),F.format=Z.format,
F.needsUpdate=!0,b&&b(F))},d,g)}var w=this,y=[],F=new Gd;F.image=y;var K=new Hc(this.manager);K.setPath(this.path);K.setResponseType("arraybuffer");if(Array.isArray(a))for(var M=0,T=0,Q=a.length;T<Q;++T)t(T);else K.load(a,function(P){P=w._parser(P,!0);if(P.isCubemap)for(var Z=P.mipmaps.length/P.mipmapCount,ca=0;ca<Z;ca++){y[ca]={mipmaps:[]};for(var ja=0;ja<P.mipmapCount;ja++)y[ca].mipmaps.push(P.mipmaps[ca*P.mipmapCount+ja]),y[ca].format=P.format,y[ca].width=P.width,y[ca].height=P.height}else F.image.width=
P.width,F.image.height=P.height,F.mipmaps=P.mipmaps;1===P.mipmapCount&&(F.minFilter=1006);F.format=P.format;F.needsUpdate=!0;b&&b(F)},d,g);return F},setPath:function(a){this.path=a;return this}});Object.assign(wf.prototype,{load:function(a,b,d,g){var t=this,w=new gd,y=new Hc(this.manager);y.setResponseType("arraybuffer");y.load(a,function(F){if(F=t._parser(F))void 0!==F.image?w.image=F.image:void 0!==F.data&&(w.image.width=F.width,w.image.height=F.height,w.image.data=F.data),w.wrapS=void 0!==F.wrapS?
F.wrapS:1001,w.wrapT=void 0!==F.wrapT?F.wrapT:1001,w.magFilter=void 0!==F.magFilter?F.magFilter:1006,w.minFilter=void 0!==F.minFilter?F.minFilter:1008,w.anisotropy=void 0!==F.anisotropy?F.anisotropy:1,void 0!==F.format&&(w.format=F.format),void 0!==F.type&&(w.type=F.type),void 0!==F.mipmaps&&(w.mipmaps=F.mipmaps),1===F.mipmapCount&&(w.minFilter=1006),w.needsUpdate=!0,b&&b(w,F)},d,g);return w}});Object.assign(Ce.prototype,{load:function(a,b,d,g){var t=this,w=document.createElementNS("http://www.w3.org/1999/xhtml",
"img");w.onload=function(){w.onload=null;URL.revokeObjectURL(w.src);b&&b(w);t.manager.itemEnd(a)};if(0===a.indexOf("data:"))w.src=a;else{var y=new Hc;y.setPath(this.path);y.setResponseType("blob");y.setWithCredentials(this.withCredentials);y.load(a,function(F){w.src=URL.createObjectURL(F)},d,g)}t.manager.itemStart(a);return w},setCrossOrigin:function(a){this.crossOrigin=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setPath:function(a){this.path=a;return this}});
Object.assign(xf.prototype,{load:function(a,b,d,g){function t(K){y.load(a[K],function(M){w.images[K]=M;F++;6===F&&(w.needsUpdate=!0,b&&b(w))},void 0,g)}var w=new C,y=new Ce(this.manager);y.setCrossOrigin(this.crossOrigin);y.setPath(this.path);var F=0;for(d=0;d<a.length;++d)t(d);return w},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});Object.assign($e.prototype,{load:function(a,b,d,g){var t=new f,w=new Ce(this.manager);w.setCrossOrigin(this.crossOrigin);
w.setWithCredentials(this.withCredentials);w.setPath(this.path);w.load(a,function(y){var F=0<a.search(/\.(jpg|jpeg)$/)||0===a.search(/^data:image\/jpeg/);t.format=F?1022:1023;t.image=y;t.needsUpdate=!0;void 0!==b&&b(t)},d,g);return t},setCrossOrigin:function(a){this.crossOrigin=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setPath:function(a){this.path=a;return this}});kc.prototype=Object.assign(Object.create(jb.prototype),{constructor:kc,isLight:!0,copy:function(a){jb.prototype.copy.call(this,
a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=jb.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);void 0!==this.shadow&&
(a.object.shadow=this.shadow.toJSON());return a}});af.prototype=Object.assign(Object.create(kc.prototype),{constructor:af,isHemisphereLight:!0,copy:function(a){kc.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);return this}});Object.assign(od.prototype,{copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var a={};0!==this.bias&&(a.bias=
this.bias);1!==this.radius&&(a.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)a.mapSize=this.mapSize.toArray();a.camera=this.camera.toJSON(!1).object;delete a.camera.matrix;return a}});bf.prototype=Object.assign(Object.create(od.prototype),{constructor:bf,isSpotLightShadow:!0,update:function(a){var b=2*c.Math.RAD2DEG*a.angle,d=this.mapSize.width/this.mapSize.height;a=a.distance||500;var g=this.camera;if(b!==g.fov||d!==g.aspect||a!==g.far)g.fov=b,g.aspect=d,g.far=a,g.updateProjectionMatrix()}});
cf.prototype=Object.assign(Object.create(kc.prototype),{constructor:cf,isSpotLight:!0,copy:function(a){kc.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});df.prototype=Object.assign(Object.create(kc.prototype),{constructor:df,isPointLight:!0,copy:function(a){kc.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();
return this}});ef.prototype=Object.assign(Object.create(od.prototype),{constructor:ef});ff.prototype=Object.assign(Object.create(kc.prototype),{constructor:ff,isDirectionalLight:!0,copy:function(a){kc.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});gf.prototype=Object.assign(Object.create(kc.prototype),{constructor:gf,isAmbientLight:!0});c.AnimationUtils={arraySlice:function(a,b,d){return c.AnimationUtils.isTypedArray(a)?new a.constructor(a.subarray(b,
d)):a.slice(b,d)},convertArray:function(a,b,d){return!a||!d&&a.constructor===b?a:"number"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var b=a.length,d=Array(b),g=0;g!==b;++g)d[g]=g;d.sort(function(t,w){return a[t]-a[w]});return d},sortedArray:function(a,b,d){for(var g=a.length,t=new a.constructor(g),w=0,y=0;y!==g;++w)for(var F=d[w]*b,K=0;K!==b;++K)t[y++]=a[F+K];
return t},flattenJSON:function(a,b,d,g){for(var t=1,w=a[0];void 0!==w&&void 0===w[g];)w=a[t++];if(void 0!==w){var y=w[g];if(void 0!==y)if(Array.isArray(y)){do y=w[g],void 0!==y&&(b.push(w.time),d.push.apply(d,y)),w=a[t++];while(void 0!==w)}else if(void 0!==y.toArray){do y=w[g],void 0!==y&&(b.push(w.time),y.toArray(d,d.length)),w=a[t++];while(void 0!==w)}else{do y=w[g],void 0!==y&&(b.push(w.time),d.push(y)),w=a[t++];while(void 0!==w)}}}};yc.prototype={constructor:yc,evaluate:function(a){var b=this.parameterPositions,
d=this._cachedIndex,g=b[d],t=b[d-1];a:{b:{c:{d:if(!(a<g)){for(var w=d+2;;){if(void 0===g){if(a<t)break d;this._cachedIndex=d=b.length;return this.afterEnd_(d-1,a,t)}if(d===w)break;t=g;g=b[++d];if(a<g)break b}g=b.length;break c}if(a>=t)break a;else{w=b[1];a<w&&(d=2,t=w);for(w=d-2;;){if(void 0===t)return this._cachedIndex=0,this.beforeStart_(0,a,g);if(d===w)break;g=t;t=b[--d-1];if(a>=t)break b}g=d;d=0}}for(;d<g;)t=d+g>>>1,a<b[t]?g=t:d=t+1;g=b[d];t=b[d-1];if(void 0===t)return this._cachedIndex=0,this.beforeStart_(0,
a,g);if(void 0===g)return this._cachedIndex=d=b.length,this.afterEnd_(d-1,t,a)}this._cachedIndex=d;this.intervalChanged_(d,t,g)}return this.interpolate_(d,t,a,g)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var b=this.resultBuffer,d=this.sampleValues,g=this.valueSize;a*=g;for(var t=0;t!==g;++t)b[t]=d[a+t];return b},interpolate_:function(a,b,d,g){throw Error("call to abstract method");},intervalChanged_:function(a,
b,d){}};Object.assign(yc.prototype,{beforeStart_:yc.prototype.copySampleValue_,afterEnd_:yc.prototype.copySampleValue_});hf.prototype=Object.assign(Object.create(yc.prototype),{constructor:hf,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(a,b,d){var g=this.parameterPositions,t=a-2,w=a+1,y=g[t],F=g[w];if(void 0===y)switch(this.getSettings_().endingStart){case 2401:t=a;y=2*b-d;break;case 2402:t=g.length-2;y=b+g[t]-g[t+1];break;default:t=a,y=d}if(void 0===F)switch(this.getSettings_().endingEnd){case 2401:w=
a;F=2*d-b;break;case 2402:w=1;F=d+g[1]-g[0];break;default:w=a-1,F=b}a=.5*(d-b);g=this.valueSize;this._weightPrev=a/(b-y);this._weightNext=a/(F-d);this._offsetPrev=t*g;this._offsetNext=w*g},interpolate_:function(a,b,d,g){var t=this.resultBuffer,w=this.sampleValues,y=this.valueSize;a*=y;var F=a-y,K=this._offsetPrev,M=this._offsetNext,T=this._weightPrev,Q=this._weightNext,P=(d-b)/(g-b);d=P*P;g=d*P;b=-T*g+2*T*d-T*P;T=(1+T)*g+(-1.5-2*T)*d+(-.5+T)*P+1;P=(-1-Q)*g+(1.5+Q)*d+.5*P;Q=Q*g-Q*d;for(d=0;d!==y;++d)t[d]=
b*w[K+d]+T*w[F+d]+P*w[a+d]+Q*w[M+d];return t}});De.prototype=Object.assign(Object.create(yc.prototype),{constructor:De,interpolate_:function(a,b,d,g){var t=this.resultBuffer,w=this.sampleValues,y=this.valueSize;a*=y;var F=a-y;b=(d-b)/(g-b);d=1-b;for(g=0;g!==y;++g)t[g]=w[F+g]*d+w[a+g]*b;return t}});jf.prototype=Object.assign(Object.create(yc.prototype),{constructor:jf,interpolate_:function(a,b,d,g){return this.copySampleValue_(a-1)}});var bd={TimeBufferType:Float32Array,ValueBufferType:Float32Array,
DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(a){return new jf(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new De(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new hf(this.times,this.values,this.getValueSize(),a)},setInterpolation:function(a){switch(a){case 2300:var b=this.InterpolantFactoryMethodDiscrete;break;case 2301:b=this.InterpolantFactoryMethodLinear;break;case 2302:b=
this.InterpolantFactoryMethodSmooth}if(void 0===b){b="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(b);console.warn(b)}else this.createInterpolant=b},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},
getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,d=0,g=b.length;d!==g;++d)b[d]+=a;return this},scale:function(a){if(1!==a)for(var b=this.times,d=0,g=b.length;d!==g;++d)b[d]*=a;return this},trim:function(a,b){for(var d=this.times,g=d.length,t=0,w=g-1;t!==g&&d[t]<a;)++t;for(;-1!==w&&d[w]>b;)--w;++w;if(0!==t||w!==g)t>=w&&(w=Math.max(w,1),t=w-1),a=this.getValueSize(),this.times=c.AnimationUtils.arraySlice(d,t,w),this.values=c.AnimationUtils.arraySlice(this.values,
t*a,w*a);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error("invalid value size in track",this),a=!1);var d=this.times;b=this.values;var g=d.length;0===g&&(console.error("track is empty",this),a=!1);for(var t=null,w=0;w!==g;w++){var y=d[w];if("number"===typeof y&&isNaN(y)){console.error("time is not a valid number",this,w,y);a=!1;break}if(null!==t&&t>y){console.error("out of order keys",this,w,y,t);a=!1;break}t=y}if(void 0!==b&&c.AnimationUtils.isTypedArray(b))for(w=
0,d=b.length;w!==d;++w)if(g=b[w],isNaN(g)){console.error("value is not a valid number",this,w,g);a=!1;break}return a},optimize:function(){for(var a=this.times,b=this.values,d=this.getValueSize(),g=2302===this.getInterpolation(),t=1,w=a.length-1,y=1;y<w;++y){var F=!1,K=a[y];if(K!==a[y+1]&&(1!==y||K!==K[0]))if(g)F=!0;else{var M=y*d,T=M-d,Q=M+d;for(K=0;K!==d;++K){var P=b[M+K];if(P!==b[T+K]||P!==b[Q+K]){F=!0;break}}}if(F){if(y!==t)for(a[t]=a[y],F=y*d,M=t*d,K=0;K!==d;++K)b[M+K]=b[F+K];++t}}if(0<w){a[t]=
a[w];F=w*d;M=t*d;for(K=0;K!==d;++K)b[M+K]=b[F+K];++t}t!==a.length&&(this.times=c.AnimationUtils.arraySlice(a,0,t),this.values=c.AnimationUtils.arraySlice(b,0,t*d));return this}};Rd.prototype=Object.assign(Object.create(bd),{constructor:Rd,ValueTypeName:"vector"});kf.prototype=Object.assign(Object.create(yc.prototype),{constructor:kf,interpolate_:function(a,b,d,g){var t=this.resultBuffer,w=this.sampleValues,y=this.valueSize;a*=y;b=(d-b)/(g-b);for(d=a+y;a!==d;a+=4)u.slerpFlat(t,0,w,a-y,w,a,b);return t}});
Ee.prototype=Object.assign(Object.create(bd),{constructor:Ee,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(a){return new kf(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});Sd.prototype=Object.assign(Object.create(bd),{constructor:Sd,ValueTypeName:"number"});lf.prototype=Object.assign(Object.create(bd),{constructor:lf,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,
InterpolantFactoryMethodSmooth:void 0});mf.prototype=Object.assign(Object.create(bd),{constructor:mf,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});nf.prototype=Object.assign(Object.create(bd),{constructor:nf,ValueTypeName:"color"});qd.prototype=bd;bd.constructor=qd;Object.assign(qd,{parse:function(a){if(void 0===a.type)throw Error("track type undefined, can not parse");var b=qd._getTrackTypeForValueTypeName(a.type);
if(void 0===a.times){var d=[],g=[];c.AnimationUtils.flattenJSON(a.keys,d,g,"value");a.times=d;a.values=g}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)},toJSON:function(a){var b=a.constructor;if(void 0!==b.toJSON)b=b.toJSON(a);else{b={name:a.name,times:c.AnimationUtils.convertArray(a.times,Array),values:c.AnimationUtils.convertArray(a.values,Array)};var d=a.getInterpolation();d!==a.DefaultInterpolation&&(b.interpolation=d)}b.type=a.ValueTypeName;return b},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return Sd;
case "vector":case "vector2":case "vector3":case "vector4":return Rd;case "color":return nf;case "quaternion":return Ee;case "bool":case "boolean":return mf;case "string":return lf}throw Error("Unsupported typeName: "+a);}});Dc.prototype={constructor:Dc,resetDuration:function(){for(var a=0,b=0,d=this.tracks.length;b!==d;++b){var g=this.tracks[b];a=Math.max(a,g.times[g.times.length-1])}this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},
optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}};Object.assign(Dc,{parse:function(a){for(var b=[],d=a.tracks,g=1/(a.fps||1),t=0,w=d.length;t!==w;++t)b.push(qd.parse(d[t]).scale(g));return new Dc(a.name,a.duration,b)},toJSON:function(a){var b=[],d=a.tracks;a={name:a.name,duration:a.duration,tracks:b};for(var g=0,t=d.length;g!==t;++g)b.push(qd.toJSON(d[g]));return a},CreateFromMorphTargetSequence:function(a,b,d,g){for(var t=b.length,w=[],y=0;y<t;y++){var F=
[],K=[];F.push((y+t-1)%t,y,(y+1)%t);K.push(0,1,0);var M=c.AnimationUtils.getKeyframeOrder(F);F=c.AnimationUtils.sortedArray(F,1,M);K=c.AnimationUtils.sortedArray(K,1,M);g||0!==F[0]||(F.push(t),K.push(K[0]));w.push((new Sd(".morphTargetInfluences["+b[y].name+"]",F,K)).scale(1/d))}return new Dc(a,-1,w)},findByName:function(a,b){var d=a;Array.isArray(a)||(d=a.geometry&&a.geometry.animations||a.animations);for(a=0;a<d.length;a++)if(d[a].name===b)return d[a];return null},CreateClipsFromMorphTargetSequences:function(a,
b,d){for(var g={},t=/^([\w-]*?)([\d]+)$/,w=0,y=a.length;w<y;w++){var F=a[w],K=F.name.match(t);if(K&&1<K.length){var M=K[1];(K=g[M])||(g[M]=K=[]);K.push(F)}}a=[];for(M in g)a.push(Dc.CreateFromMorphTargetSequence(M,g[M],b,d));return a},parseAnimation:function(a,b){if(!a)return console.error("  no animation in JSONLoader data"),null;var d=function(ja,oa,ra,aa,qa){if(0!==ra.length){var na=[],ua=[];c.AnimationUtils.flattenJSON(ra,na,ua,aa);0!==na.length&&qa.push(new ja(oa,na,ua))}},g=[],t=a.name||"default",
w=a.length||-1,y=a.fps||30;a=a.hierarchy||[];for(var F=0;F<a.length;F++){var K=a[F].keys;if(K&&0!==K.length)if(K[0].morphTargets){w={};for(var M=0;M<K.length;M++)if(K[M].morphTargets)for(var T=0;T<K[M].morphTargets.length;T++)w[K[M].morphTargets[T]]=-1;for(var Q in w){var P=[],Z=[];for(T=0;T!==K[M].morphTargets.length;++T){var ca=K[M];P.push(ca.time);Z.push(ca.morphTarget===Q?1:0)}g.push(new Sd(".morphTargetInfluence["+Q+"]",P,Z))}w=w.length*(y||1)}else M=".bones["+b[F].name+"]",d(Rd,M+".position",
K,"pos",g),d(Ee,M+".quaternion",K,"rot",g),d(Rd,M+".scale",K,"scl",g)}return 0===g.length?null:new Dc(t,w,g)}});Object.assign(of.prototype,{load:function(a,b,d,g){var t=this;(new Hc(t.manager)).load(a,function(w){b(t.parse(JSON.parse(w)))},d,g)},setTextures:function(a){this.textures=a},parse:function(a){function b(y){void 0===d[y]&&console.warn("THREE.MaterialLoader: Undefined texture",y);return d[y]}var d=this.textures,g=new rg[a.type];void 0!==a.uuid&&(g.uuid=a.uuid);void 0!==a.name&&(g.name=a.name);
void 0!==a.color&&g.color.setHex(a.color);void 0!==a.roughness&&(g.roughness=a.roughness);void 0!==a.metalness&&(g.metalness=a.metalness);void 0!==a.emissive&&g.emissive.setHex(a.emissive);void 0!==a.specular&&g.specular.setHex(a.specular);void 0!==a.shininess&&(g.shininess=a.shininess);void 0!==a.uniforms&&(g.uniforms=a.uniforms);void 0!==a.vertexShader&&(g.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(g.fragmentShader=a.fragmentShader);void 0!==a.vertexColors&&(g.vertexColors=a.vertexColors);
void 0!==a.fog&&(g.fog=a.fog);void 0!==a.shading&&(g.shading=a.shading);void 0!==a.blending&&(g.blending=a.blending);void 0!==a.side&&(g.side=a.side);void 0!==a.opacity&&(g.opacity=a.opacity);void 0!==a.transparent&&(g.transparent=a.transparent);void 0!==a.alphaTest&&(g.alphaTest=a.alphaTest);void 0!==a.depthTest&&(g.depthTest=a.depthTest);void 0!==a.depthWrite&&(g.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(g.colorWrite=a.colorWrite);void 0!==a.wireframe&&(g.wireframe=a.wireframe);void 0!==
a.wireframeLinewidth&&(g.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.wireframeLinecap&&(g.wireframeLinecap=a.wireframeLinecap);void 0!==a.wireframeLinejoin&&(g.wireframeLinejoin=a.wireframeLinejoin);void 0!==a.skinning&&(g.skinning=a.skinning);void 0!==a.morphTargets&&(g.morphTargets=a.morphTargets);void 0!==a.size&&(g.size=a.size);void 0!==a.sizeAttenuation&&(g.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(g.map=b(a.map));void 0!==a.alphaMap&&(g.alphaMap=b(a.alphaMap),g.transparent=
!0);void 0!==a.bumpMap&&(g.bumpMap=b(a.bumpMap));void 0!==a.bumpScale&&(g.bumpScale=a.bumpScale);void 0!==a.normalMap&&(g.normalMap=b(a.normalMap));if(void 0!==a.normalScale){var t=a.normalScale;!1===Array.isArray(t)&&(t=[t,t]);g.normalScale=(new n).fromArray(t)}void 0!==a.displacementMap&&(g.displacementMap=b(a.displacementMap));void 0!==a.displacementScale&&(g.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(g.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(g.roughnessMap=
b(a.roughnessMap));void 0!==a.metalnessMap&&(g.metalnessMap=b(a.metalnessMap));void 0!==a.emissiveMap&&(g.emissiveMap=b(a.emissiveMap));void 0!==a.emissiveIntensity&&(g.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&(g.specularMap=b(a.specularMap));void 0!==a.envMap&&(g.envMap=b(a.envMap));void 0!==a.reflectivity&&(g.reflectivity=a.reflectivity);void 0!==a.lightMap&&(g.lightMap=b(a.lightMap));void 0!==a.lightMapIntensity&&(g.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&
(g.aoMap=b(a.aoMap));void 0!==a.aoMapIntensity&&(g.aoMapIntensity=a.aoMapIntensity);if(void 0!==a.materials){t=0;for(var w=a.materials.length;t<w;t++)g.materials.push(this.parse(a.materials[t]))}return g}});Object.assign(yf.prototype,{load:function(a,b,d,g){var t=this;(new Hc(t.manager)).load(a,function(w){b(t.parse(JSON.parse(w)))},d,g)},parse:function(a){var b=new qb,d=a.data.index,g={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};
void 0!==d&&(d=new g[d.type](d.array),b.setIndex(new gb(d,1)));var t=a.data.attributes;for(y in t){var w=t[y];d=new g[w.type](w.array);b.addAttribute(y,new gb(d,w.itemSize,w.normalized))}g=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==g){var y=0;for(d=g.length;y!==d;++y)t=g[y],b.addGroup(t.start,t.count,t.materialIndex)}a=a.data.boundingSphere;void 0!==a&&(g=new r,void 0!==a.center&&g.fromArray(a.center),b.boundingSphere=new rb(g,a.radius));return b}});rd.prototype={constructor:rd,crossOrigin:void 0,
extractUrlBase:function(a){a=a.split("/");if(1===a.length)return"./";a.pop();return a.join("/")+"/"},initMaterials:function(a,b,d){for(var g=[],t=0;t<a.length;++t)g[t]=this.createMaterial(a[t],b,d);return g},createMaterial:function(){var a,b,d;return function(g,t,w){function y(Q,P,Z,ca,ja){Q=t+Q;var oa=rd.Handlers.get(Q);null!==oa?Q=oa.load(Q):(b.setCrossOrigin(w),Q=b.load(Q));void 0!==P&&(Q.repeat.fromArray(P),1!==P[0]&&(Q.wrapS=1E3),1!==P[1]&&(Q.wrapT=1E3));void 0!==Z&&Q.offset.fromArray(Z);void 0!==
ca&&("repeat"===ca[0]&&(Q.wrapS=1E3),"mirror"===ca[0]&&(Q.wrapS=1002),"repeat"===ca[1]&&(Q.wrapT=1E3),"mirror"===ca[1]&&(Q.wrapT=1002));void 0!==ja&&(Q.anisotropy=ja);P=c.Math.generateUUID();F[P]=Q;return P}void 0===a&&(a=new ma);void 0===b&&(b=new $e);void 0===d&&(d=new of);var F={},K={uuid:c.Math.generateUUID(),type:"MeshLambertMaterial"},M;for(M in g){var T=g[M];switch(M){case "DbgColor":case "DbgIndex":case "opticalDensity":case "illumination":break;case "DbgName":K.name=T;break;case "blending":K.blending=
jg[T];break;case "colorAmbient":case "mapAmbient":console.warn("THREE.Loader.createMaterial:",M,"is no longer supported.");break;case "colorDiffuse":K.color=a.fromArray(T).getHex();break;case "colorSpecular":K.specular=a.fromArray(T).getHex();break;case "colorEmissive":K.emissive=a.fromArray(T).getHex();break;case "specularCoef":K.shininess=T;break;case "shading":"basic"===T.toLowerCase()&&(K.type="MeshBasicMaterial");"phong"===T.toLowerCase()&&(K.type="MeshPhongMaterial");"standard"===T.toLowerCase()&&
(K.type="MeshStandardMaterial");break;case "mapDiffuse":K.map=y(T,g.mapDiffuseRepeat,g.mapDiffuseOffset,g.mapDiffuseWrap,g.mapDiffuseAnisotropy);break;case "mapDiffuseRepeat":case "mapDiffuseOffset":case "mapDiffuseWrap":case "mapDiffuseAnisotropy":break;case "mapEmissive":K.emissiveMap=y(T,g.mapEmissiveRepeat,g.mapEmissiveOffset,g.mapEmissiveWrap,g.mapEmissiveAnisotropy);break;case "mapEmissiveRepeat":case "mapEmissiveOffset":case "mapEmissiveWrap":case "mapEmissiveAnisotropy":break;case "mapLight":K.lightMap=
y(T,g.mapLightRepeat,g.mapLightOffset,g.mapLightWrap,g.mapLightAnisotropy);break;case "mapLightRepeat":case "mapLightOffset":case "mapLightWrap":case "mapLightAnisotropy":break;case "mapAO":K.aoMap=y(T,g.mapAORepeat,g.mapAOOffset,g.mapAOWrap,g.mapAOAnisotropy);break;case "mapAORepeat":case "mapAOOffset":case "mapAOWrap":case "mapAOAnisotropy":break;case "mapBump":K.bumpMap=y(T,g.mapBumpRepeat,g.mapBumpOffset,g.mapBumpWrap,g.mapBumpAnisotropy);break;case "mapBumpScale":K.bumpScale=T;break;case "mapBumpRepeat":case "mapBumpOffset":case "mapBumpWrap":case "mapBumpAnisotropy":break;
case "mapNormal":K.normalMap=y(T,g.mapNormalRepeat,g.mapNormalOffset,g.mapNormalWrap,g.mapNormalAnisotropy);break;case "mapNormalFactor":K.normalScale=[T,T];break;case "mapNormalRepeat":case "mapNormalOffset":case "mapNormalWrap":case "mapNormalAnisotropy":break;case "mapSpecular":K.specularMap=y(T,g.mapSpecularRepeat,g.mapSpecularOffset,g.mapSpecularWrap,g.mapSpecularAnisotropy);break;case "mapSpecularRepeat":case "mapSpecularOffset":case "mapSpecularWrap":case "mapSpecularAnisotropy":break;case "mapMetalness":K.metalnessMap=
y(T,g.mapMetalnessRepeat,g.mapMetalnessOffset,g.mapMetalnessWrap,g.mapMetalnessAnisotropy);break;case "mapMetalnessRepeat":case "mapMetalnessOffset":case "mapMetalnessWrap":case "mapMetalnessAnisotropy":break;case "mapRoughness":K.roughnessMap=y(T,g.mapRoughnessRepeat,g.mapRoughnessOffset,g.mapRoughnessWrap,g.mapRoughnessAnisotropy);break;case "mapRoughnessRepeat":case "mapRoughnessOffset":case "mapRoughnessWrap":case "mapRoughnessAnisotropy":break;case "mapAlpha":K.alphaMap=y(T,g.mapAlphaRepeat,
g.mapAlphaOffset,g.mapAlphaWrap,g.mapAlphaAnisotropy);break;case "mapAlphaRepeat":case "mapAlphaOffset":case "mapAlphaWrap":case "mapAlphaAnisotropy":break;case "flipSided":K.side=1;break;case "doubleSided":K.side=2;break;case "transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");K.opacity=T;break;case "depthTest":case "depthWrite":case "colorWrite":case "opacity":case "reflectivity":case "transparent":case "visible":case "wireframe":K[M]=T;break;case "vertexColors":!0===
T&&(K.vertexColors=2);"face"===T&&(K.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",M,T)}}"MeshBasicMaterial"===K.type&&delete K.emissive;"MeshPhongMaterial"!==K.type&&delete K.specular;1>K.opacity&&(K.transparent=!0);d.setTextures(F);return d.parse(K)}}()};rd.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,d=0,g=b.length;d<g;d+=2){var t=b[d+1];if(b[d].test(a))return t}return null}};Object.assign(zf.prototype,
{load:function(a,b,d,g){var t=this,w=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:rd.prototype.extractUrlBase(a),y=new Hc(this.manager);y.setWithCredentials(this.withCredentials);y.load(a,function(F){F=JSON.parse(F);var K=F.metadata;if(void 0!==K&&(K=K.type,void 0!==K)){if("object"===K.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===K.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.SceneLoader instead.");
return}}F=t.parse(F,w);b(F.geometry,F.materials)},d,g)},setTexturePath:function(a){this.texturePath=a},parse:function(a,b){var d=new pb,g=void 0!==a.scale?1/a.scale:1;(function(t){var w,y,F,K=a.faces;var M=a.vertices;var T=a.normals,Q=a.colors,P=0;if(void 0!==a.uvs){for(w=0;w<a.uvs.length;w++)a.uvs[w].length&&P++;for(w=0;w<P;w++)d.faceVertexUvs[w]=[]}var Z=0;for(F=M.length;Z<F;)w=new r,w.x=M[Z++]*t,w.y=M[Z++]*t,w.z=M[Z++]*t,d.vertices.push(w);Z=0;for(F=K.length;Z<F;){t=K[Z++];var ca=t&1;var ja=t&
2;w=t&8;var oa=t&16;var ra=t&32;M=t&64;t&=128;if(ca){ca=new Pb;ca.a=K[Z];ca.b=K[Z+1];ca.c=K[Z+3];var aa=new Pb;aa.a=K[Z+1];aa.b=K[Z+2];aa.c=K[Z+3];Z+=4;ja&&(ja=K[Z++],ca.materialIndex=ja,aa.materialIndex=ja);ja=d.faces.length;if(w)for(w=0;w<P;w++){var qa=a.uvs[w];d.faceVertexUvs[w][ja]=[];d.faceVertexUvs[w][ja+1]=[];for(y=0;4>y;y++){var na=K[Z++];var ua=qa[2*na];na=qa[2*na+1];ua=new n(ua,na);2!==y&&d.faceVertexUvs[w][ja].push(ua);0!==y&&d.faceVertexUvs[w][ja+1].push(ua)}}oa&&(oa=3*K[Z++],ca.normal.set(T[oa++],
T[oa++],T[oa]),aa.normal.copy(ca.normal));if(ra)for(w=0;4>w;w++)oa=3*K[Z++],ra=new r(T[oa++],T[oa++],T[oa]),2!==w&&ca.vertexNormals.push(ra),0!==w&&aa.vertexNormals.push(ra);M&&(M=K[Z++],M=Q[M],ca.color.setHex(M),aa.color.setHex(M));if(t)for(w=0;4>w;w++)M=K[Z++],M=Q[M],2!==w&&ca.vertexColors.push(new ma(M)),0!==w&&aa.vertexColors.push(new ma(M));d.faces.push(ca);d.faces.push(aa)}else{ca=new Pb;ca.a=K[Z++];ca.b=K[Z++];ca.c=K[Z++];ja&&(ja=K[Z++],ca.materialIndex=ja);ja=d.faces.length;if(w)for(w=0;w<
P;w++)for(qa=a.uvs[w],d.faceVertexUvs[w][ja]=[],y=0;3>y;y++)na=K[Z++],ua=qa[2*na],na=qa[2*na+1],ua=new n(ua,na),d.faceVertexUvs[w][ja].push(ua);oa&&(oa=3*K[Z++],ca.normal.set(T[oa++],T[oa++],T[oa]));if(ra)for(w=0;3>w;w++)oa=3*K[Z++],ra=new r(T[oa++],T[oa++],T[oa]),ca.vertexNormals.push(ra);M&&(M=K[Z++],ca.color.setHex(Q[M]));if(t)for(w=0;3>w;w++)M=K[Z++],ca.vertexColors.push(new ma(Q[M]));d.faces.push(ca)}}})(g);(function(){var t=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var w=
0,y=a.skinWeights.length;w<y;w+=t)d.skinWeights.push(new q(a.skinWeights[w],1<t?a.skinWeights[w+1]:0,2<t?a.skinWeights[w+2]:0,3<t?a.skinWeights[w+3]:0));if(a.skinIndices)for(w=0,y=a.skinIndices.length;w<y;w+=t)d.skinIndices.push(new q(a.skinIndices[w],1<t?a.skinIndices[w+1]:0,2<t?a.skinIndices[w+2]:0,3<t?a.skinIndices[w+3]:0));d.bones=a.bones;d.bones&&0<d.bones.length&&(d.skinWeights.length!==d.skinIndices.length||d.skinIndices.length!==d.vertices.length)&&console.warn("When skinning, number of vertices ("+
d.vertices.length+"), skinIndices ("+d.skinIndices.length+"), and skinWeights ("+d.skinWeights.length+") should match.")})();(function(t){if(void 0!==a.morphTargets)for(var w=0,y=a.morphTargets.length;w<y;w++){d.morphTargets[w]={};d.morphTargets[w].name=a.morphTargets[w].name;d.morphTargets[w].vertices=[];for(var F=d.morphTargets[w].vertices,K=a.morphTargets[w].vertices,M=0,T=K.length;M<T;M+=3){var Q=new r;Q.x=K[M]*t;Q.y=K[M+1]*t;Q.z=K[M+2]*t;F.push(Q)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),
t=d.faces,F=a.morphColors[0].colors,w=0,y=t.length;w<y;w++)t[w].color.fromArray(F,3*w)})(g);(function(){var t=[],w=[];void 0!==a.animation&&w.push(a.animation);void 0!==a.animations&&(a.animations.length?w=w.concat(a.animations):w.push(a.animations));for(var y=0;y<w.length;y++){var F=Dc.parseAnimation(w[y],d.bones);F&&t.push(F)}d.morphTargets&&(w=Dc.CreateClipsFromMorphTargetSequences(d.morphTargets,10),t=t.concat(w));0<t.length&&(d.animations=t)})();d.computeFaceNormals();d.computeBoundingSphere();
if(void 0===a.materials||0===a.materials.length)return{geometry:d};b=rd.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:d,materials:b}}});Object.assign(bg.prototype,{load:function(a,b,d,g){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var t=this;(new Hc(t.manager)).load(a,function(w){t.parse(JSON.parse(w),b)},d,g)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var d=this.parseGeometries(a.geometries),
g=this.parseImages(a.images,function(){void 0!==b&&b(t)});g=this.parseTextures(a.textures,g);g=this.parseMaterials(a.materials,g);var t=this.parseObject(a.object,d,g);a.animations&&(t.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===b||b(t);return t},parseGeometries:function(a){var b={};if(void 0!==a)for(var d=new zf,g=new yf,t=0,w=a.length;t<w;t++){var y=a[t];switch(y.type){case "PlaneGeometry":case "PlaneBufferGeometry":var F=new Ic[y.type](y.width,
y.height,y.widthSegments,y.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":F=new Ic[y.type](y.width,y.height,y.depth,y.widthSegments,y.heightSegments,y.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":F=new Ic[y.type](y.radius,y.segments,y.thetaStart,y.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":F=new Ic[y.type](y.radiusTop,y.radiusBottom,y.height,y.radialSegments,y.heightSegments,y.openEnded,y.thetaStart,y.thetaLength);
break;case "ConeGeometry":case "ConeBufferGeometry":F=new Ic[y.type](y.radius,y.height,y.radialSegments,y.heightSegments,y.openEnded,y.thetaStart,y.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":F=new Ic[y.type](y.radius,y.widthSegments,y.heightSegments,y.phiStart,y.phiLength,y.thetaStart,y.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":F=new Ic[y.type](y.radius,y.detail);break;case "RingGeometry":case "RingBufferGeometry":F=
new Ic[y.type](y.innerRadius,y.outerRadius,y.thetaSegments,y.phiSegments,y.thetaStart,y.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":F=new Ic[y.type](y.radius,y.tube,y.radialSegments,y.tubularSegments,y.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":F=new Ic[y.type](y.radius,y.tube,y.tubularSegments,y.radialSegments,y.p,y.q);break;case "LatheGeometry":case "LatheBufferGeometry":F=new Ic[y.type](y.points,y.segments,y.phiStart,y.phiLength);break;case "BufferGeometry":F=
g.parse(y);break;case "Geometry":F=d.parse(y.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+y.type+'"');continue}F.uuid=y.uuid;void 0!==y.name&&(F.name=y.name);b[y.uuid]=F}return b},parseMaterials:function(a,b){var d={};if(void 0!==a){var g=new of;g.setTextures(b);b=0;for(var t=a.length;b<t;b++){var w=g.parse(a[b]);d[w.uuid]=w}}return d},parseAnimations:function(a){for(var b=[],d=0;d<a.length;d++){var g=Dc.parse(a[d]);b.push(g)}return b},
parseImages:function(a,b){function d(M){g.manager.itemStart(M);return w.load(M,function(){g.manager.itemEnd(M)},void 0,function(){g.manager.itemError(M)})}var g=this,t={};if(void 0!==a&&0<a.length){b=new vf(b);var w=new Ce(b);w.setCrossOrigin(this.crossOrigin);b=0;for(var y=a.length;b<y;b++){var F=a[b],K=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(F.url)?F.url:g.texturePath+F.url;t[F.uuid]=d(K)}}return t},parseTextures:function(a,b){function d(K,M){if("number"===typeof K)return K;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",
K);return M[K]}var g={};if(void 0!==a)for(var t=0,w=a.length;t<w;t++){var y=a[t];void 0===y.image&&console.warn('THREE.ObjectLoader: No "image" specified for',y.uuid);void 0===b[y.image]&&console.warn("THREE.ObjectLoader: Undefined image",y.image);var F=new f(b[y.image]);F.needsUpdate=!0;F.uuid=y.uuid;void 0!==y.name&&(F.name=y.name);void 0!==y.mapping&&(F.mapping=d(y.mapping,kg));void 0!==y.offset&&F.offset.fromArray(y.offset);void 0!==y.repeat&&F.repeat.fromArray(y.repeat);void 0!==y.wrap&&(F.wrapS=
d(y.wrap[0],Qf),F.wrapT=d(y.wrap[1],Qf));void 0!==y.minFilter&&(F.minFilter=d(y.minFilter,Rf));void 0!==y.magFilter&&(F.magFilter=d(y.magFilter,Rf));void 0!==y.anisotropy&&(F.anisotropy=y.anisotropy);void 0!==y.flipY&&(F.flipY=y.flipY);g[y.uuid]=F}return g},parseObject:function(){var a=new z;return function(b,d,g){function t(T){void 0===d[T]&&console.warn("THREE.ObjectLoader: Undefined geometry",T);return d[T]}function w(T){if(void 0!==T)return void 0===g[T]&&console.warn("THREE.ObjectLoader: Undefined material",
T),g[T]}switch(b.type){case "Scene":var y=new dc;void 0!==b.background&&Number.isInteger(b.background)&&(y.background=new ma(b.background));void 0!==b.fog&&("Fog"===b.fog.type?y.fog=new qc(b.fog.color,b.fog.near,b.fog.far):"FogExp2"===b.fog.type&&(y.fog=new Wb(b.fog.color,b.fog.density)));break;case "PerspectiveCamera":y=new hc(b.fov,b.aspect,b.near,b.far);void 0!==b.focus&&(y.focus=b.focus);void 0!==b.zoom&&(y.zoom=b.zoom);void 0!==b.filmGauge&&(y.filmGauge=b.filmGauge);void 0!==b.filmOffset&&(y.filmOffset=
b.filmOffset);void 0!==b.view&&(y.view=Object.assign({},b.view));break;case "OrthographicCamera":y=new zc(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case "AmbientLight":y=new gf(b.color,b.intensity);break;case "DirectionalLight":y=new ff(b.color,b.intensity);break;case "PointLight":y=new df(b.color,b.intensity,b.distance,b.decay);break;case "SpotLight":y=new cf(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case "HemisphereLight":y=new af(b.color,b.groundColor,b.intensity);
break;case "Mesh":y=t(b.geometry);var F=w(b.material);y=y.bones&&0<y.bones.length?new We(y,F):new Rb(y,F);break;case "LOD":y=new fe;break;case "Line":y=new Uc(t(b.geometry),w(b.material),b.mode);break;case "LineSegments":y=new $b(t(b.geometry),w(b.material));break;case "PointCloud":case "Points":y=new Fd(t(b.geometry),w(b.material));break;case "Sprite":y=new Yc(w(b.material));break;case "Group":y=new ge;break;default:y=new jb}y.uuid=b.uuid;void 0!==b.name&&(y.name=b.name);void 0!==b.matrix?(a.fromArray(b.matrix),
a.decompose(y.position,y.quaternion,y.scale)):(void 0!==b.position&&y.position.fromArray(b.position),void 0!==b.rotation&&y.rotation.fromArray(b.rotation),void 0!==b.quaternion&&y.quaternion.fromArray(b.quaternion),void 0!==b.scale&&y.scale.fromArray(b.scale));void 0!==b.castShadow&&(y.castShadow=b.castShadow);void 0!==b.receiveShadow&&(y.receiveShadow=b.receiveShadow);b.shadow&&(void 0!==b.shadow.bias&&(y.shadow.bias=b.shadow.bias),void 0!==b.shadow.radius&&(y.shadow.radius=b.shadow.radius),void 0!==
b.shadow.mapSize&&y.shadow.mapSize.fromArray(b.shadow.mapSize),void 0!==b.shadow.camera&&(y.shadow.camera=this.parseObject(b.shadow.camera)));void 0!==b.visible&&(y.visible=b.visible);void 0!==b.userData&&(y.userData=b.userData);if(void 0!==b.children)for(var K in b.children)y.add(this.parseObject(b.children[K],d,g));if("LOD"===b.type)for(b=b.levels,F=0;F<b.length;F++){var M=b[F];K=y.getObjectByProperty("uuid",M.object);void 0!==K&&y.addLevel(K,M.distance)}return y}}()});rc.prototype={constructor:rc,
getPoint:function(a){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(a){a=this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){a||(a=5);for(var b=[],d=0;d<=a;d++)b.push(this.getPoint(d/a));return b},getSpacedPoints:function(a){a||(a=5);for(var b=[],d=0;d<=a;d++)b.push(this.getPointAt(d/a));return b},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:
200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],d=this.getPoint(0),g,t=0;b.push(0);for(g=1;g<=a;g++){var w=this.getPoint(g/a);t+=w.distanceTo(d);b.push(t);d=w}return this.cacheArcLengths=b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var d=this.getLengths(),g=d.length;b=b?b:a*d[g-1];for(var t=0,w=g-1,y;t<=w;)if(a=Math.floor(t+(w-t)/2),y=d[a]-b,0>y)t=a+1;else if(0<
y)w=a-1;else{w=a;break}a=w;if(d[a]===b)return a/(g-1);t=d[a];return(a+(b-t)/(d[a+1]-t))/(g-1)},getTangent:function(a){var b=a-1E-4;a+=1E-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()},getTangentAt:function(a){a=this.getUtoTmapping(a);return this.getTangent(a)}};rc.create=function(a,b){a.prototype=Object.create(rc.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return a};Nc.prototype=Object.create(rc.prototype);Nc.prototype.constructor=Nc;
Nc.prototype.isLineCurve=!0;Nc.prototype.getPoint=function(a){if(1===a)return this.v2.clone();var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b};Nc.prototype.getPointAt=function(a){return this.getPoint(a)};Nc.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};Fe.prototype=Object.assign(Object.create(rc.prototype),{constructor:Fe,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-
1].getPoint(1);a.equals(b)||this.curves.push(new Nc(b,a))},getPoint:function(a){var b=a*this.getLength(),d=this.getCurveLengths();for(a=0;a<d.length;){if(d[a]>=b)return b=d[a]-b,a=this.curves[a],d=a.getLength(),a.getPointAt(0===d?0:1-b/d);a++}return null},getLength:function(){var a=this.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;
for(var a=[],b=0,d=0,g=this.curves.length;d<g;d++)b+=this.curves[d].getLength(),a.push(b);return this.cacheLengths=a},getSpacedPoints:function(a){a||(a=40);for(var b=[],d=0;d<=a;d++)b.push(this.getPoint(d/a));this.autoClose&&b.push(b[0]);return b},getPoints:function(a){a=a||12;for(var b=[],d,g=0,t=this.curves;g<t.length;g++){var w=t[g];w=w.getPoints(w&&w.isEllipseCurve?2*a:w&&w.isLineCurve?1:w&&w.isSplineCurve?a*w.points.length:a);for(var y=0;y<w.length;y++){var F=w[y];d&&d.equals(F)||(b.push(F),
d=F)}}this.autoClose&&1<b.length&&!b[b.length-1].equals(b[0])&&b.push(b[0]);return b},createPointsGeometry:function(a){a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){a=this.getSpacedPoints(a);return this.createGeometry(a)},createGeometry:function(a){for(var b=new pb,d=0,g=a.length;d<g;d++){var t=a[d];b.vertices.push(new r(t.x,t.y,t.z||0))}return b}});Vc.prototype=Object.create(rc.prototype);Vc.prototype.constructor=Vc;Vc.prototype.isEllipseCurve=!0;Vc.prototype.getPoint=
function(a){for(var b=2*Math.PI,d=this.aEndAngle-this.aStartAngle,g=Math.abs(d)<Number.EPSILON;0>d;)d+=b;for(;d>b;)d-=b;d<Number.EPSILON&&(d=g?0:b);!0!==this.aClockwise||g||(d=d===b?-b:d-b);b=this.aStartAngle+a*d;a=this.aX+this.xRadius*Math.cos(b);var t=this.aY+this.yRadius*Math.sin(b);0!==this.aRotation&&(b=Math.cos(this.aRotation),d=Math.sin(this.aRotation),g=a-this.aX,t-=this.aY,a=g*b-t*d+this.aX,t=g*d+t*b+this.aY);return new n(a,t)};c.CurveUtils={tangentQuadraticBezier:function(a,b,d,g){return 2*
(1-a)*(d-b)+2*a*(g-d)},tangentCubicBezier:function(a,b,d,g,t){return-3*b*(1-a)*(1-a)+3*d*(1-a)*(1-a)-6*a*d*(1-a)+6*a*g*(1-a)-3*a*a*g+3*a*a*t},tangentSpline:function(a,b,d,g,t){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,d,g,t){a=.5*(d-a);g=.5*(g-b);var w=t*t;return(2*b-2*d+a+g)*t*w+(-3*b+3*d-2*a-g)*w+a*t+b}};sd.prototype=Object.create(rc.prototype);sd.prototype.constructor=sd;sd.prototype.isSplineCurve=!0;sd.prototype.getPoint=function(a){var b=this.points;a*=
b.length-1;var d=Math.floor(a);a-=d;var g=b[0===d?d:d-1],t=b[d],w=b[d>b.length-2?b.length-1:d+1];b=b[d>b.length-3?b.length-1:d+2];d=c.CurveUtils.interpolate;return new n(d(g.x,t.x,w.x,b.x,a),d(g.y,t.y,w.y,b.y,a))};td.prototype=Object.create(rc.prototype);td.prototype.constructor=td;td.prototype.getPoint=function(a){var b=c.ShapeUtils.b3;return new n(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};td.prototype.getTangent=function(a){var b=c.CurveUtils.tangentCubicBezier;
return(new n(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};ud.prototype=Object.create(rc.prototype);ud.prototype.constructor=ud;ud.prototype.getPoint=function(a){var b=c.ShapeUtils.b2;return new n(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))};ud.prototype.getTangent=function(a){var b=c.CurveUtils.tangentQuadraticBezier;return(new n(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))).normalize()};
var Sf=Object.assign(Object.create(Fe.prototype),{fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,d=a.length;b<d;b++)this.lineTo(a[b].x,a[b].y)},moveTo:function(a,b){this.currentPoint.set(a,b)},lineTo:function(a,b){var d=new Nc(this.currentPoint.clone(),new n(a,b));this.curves.push(d);this.currentPoint.set(a,b)},quadraticCurveTo:function(a,b,d,g){a=new ud(this.currentPoint.clone(),new n(a,b),new n(d,g));this.curves.push(a);this.currentPoint.set(d,g)},bezierCurveTo:function(a,b,d,g,t,
w){a=new td(this.currentPoint.clone(),new n(a,b),new n(d,g),new n(t,w));this.curves.push(a);this.currentPoint.set(t,w)},splineThru:function(a){var b=[this.currentPoint.clone()].concat(a);b=new sd(b);this.curves.push(b);this.currentPoint.copy(a[a.length-1])},arc:function(a,b,d,g,t,w){this.absarc(a+this.currentPoint.x,b+this.currentPoint.y,d,g,t,w)},absarc:function(a,b,d,g,t,w){this.absellipse(a,b,d,d,g,t,w)},ellipse:function(a,b,d,g,t,w,y,F){this.absellipse(a+this.currentPoint.x,b+this.currentPoint.y,
d,g,t,w,y,F)},absellipse:function(a,b,d,g,t,w,y,F){a=new Vc(a,b,d,g,t,w,y,F);0<this.curves.length&&(b=a.getPoint(0),b.equals(this.currentPoint)||this.lineTo(b.x,b.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a)}});vd.prototype=Object.assign(Object.create(Sf),{constructor:vd,getPointsHoles:function(a){for(var b=[],d=0,g=this.holes.length;d<g;d++)b[d]=this.holes[d].getPoints(a);return b},extractAllPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},extractPoints:function(a){return this.extractAllPoints(a)}});
Ge.prototype=Sf;Sf.constructor=Ge;Af.prototype={moveTo:function(a,b){this.currentPath=new Ge;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,b)},lineTo:function(a,b){this.currentPath.lineTo(a,b)},quadraticCurveTo:function(a,b,d,g){this.currentPath.quadraticCurveTo(a,b,d,g)},bezierCurveTo:function(a,b,d,g,t,w){this.currentPath.bezierCurveTo(a,b,d,g,t,w)},splineThru:function(a){this.currentPath.splineThru(a)},toShapes:function(a,b){function d(oa){for(var ra=[],aa=0,qa=oa.length;aa<qa;aa++){var na=
oa[aa],ua=new vd;ua.curves=na.curves;ra.push(ua)}return ra}function g(oa,ra){for(var aa=ra.length,qa=!1,na=aa-1,ua=0;ua<aa;na=ua++){var ta=ra[na],Aa=ra[ua],Ka=Aa.x-ta.x,Ia=Aa.y-ta.y;if(Math.abs(Ia)>Number.EPSILON){if(0>Ia&&(ta=ra[ua],Ka=-Ka,Aa=ra[na],Ia=-Ia),!(oa.y<ta.y||oa.y>Aa.y))if(oa.y===ta.y){if(oa.x===ta.x)return!0}else{na=Ia*(oa.x-ta.x)-Ka*(oa.y-ta.y);if(0===na)return!0;0>na||(qa=!qa)}}else if(oa.y===ta.y&&(Aa.x<=oa.x&&oa.x<=ta.x||ta.x<=oa.x&&oa.x<=Aa.x))return!0}return qa}var t=c.ShapeUtils.isClockWise,
w=this.subPaths;if(0===w.length)return[];if(!0===b)return d(w);b=[];if(1===w.length){var y=w[0];var F=new vd;F.curves=y.curves;b.push(F);return b}var K=!t(w[0].getPoints());K=a?!K:K;F=[];var M=[],T=[],Q=0;M[Q]=void 0;T[Q]=[];for(var P=0,Z=w.length;P<Z;P++){y=w[P];var ca=y.getPoints();var ja=t(ca);(ja=a?!ja:ja)?(!K&&M[Q]&&Q++,M[Q]={s:new vd,p:ca},M[Q].s.curves=y.curves,K&&Q++,T[Q]=[]):T[Q].push({h:y,p:ca[0]})}if(!M[0])return d(w);if(1<M.length){P=!1;a=[];t=0;for(w=M.length;t<w;t++)F[t]=[];t=0;for(w=
M.length;t<w;t++)for(y=T[t],ja=0;ja<y.length;ja++){K=y[ja];Q=!0;for(ca=0;ca<M.length;ca++)g(K.p,M[ca].p)&&(t!==ca&&a.push({froms:t,tos:ca,hole:ja}),Q?(Q=!1,F[ca].push(K)):P=!0);Q&&F[t].push(K)}0<a.length&&(P||(T=F))}P=0;for(t=M.length;P<t;P++)for(F=M[P].s,b.push(F),a=T[P],w=0,y=a.length;w<y;w++)F.holes.push(a[w].h);return b}};Object.assign(Bf.prototype,{isFont:!0,generateShapes:function(a,b,d){void 0===b&&(b=100);void 0===d&&(d=4);var g=this.data;a=String(a).split("");var t=b/g.resolution,w=0;b=[];
for(var y=0;y<a.length;y++){var F;var K=t;var M=w,T=g.glyphs[a[y]]||g.glyphs["?"];if(T){var Q=new Af,P=[],Z=c.ShapeUtils.b2,ca=c.ShapeUtils.b3;if(T.o)for(var ja=T._cachedOutline||(T._cachedOutline=T.o.split(" ")),oa=0,ra=ja.length;oa<ra;)switch(ja[oa++]){case "m":var aa=ja[oa++]*K+M;var qa=ja[oa++]*K;Q.moveTo(aa,qa);break;case "l":aa=ja[oa++]*K+M;qa=ja[oa++]*K;Q.lineTo(aa,qa);break;case "q":var na=ja[oa++]*K+M;var ua=ja[oa++]*K;var ta=ja[oa++]*K+M;var Aa=ja[oa++]*K;Q.quadraticCurveTo(ta,Aa,na,ua);
if(F=P[P.length-1]){var Ka=F.x;F=F.y;for(var Ia=1;Ia<=d;Ia++){var Oa=Ia/d;Z(Oa,Ka,ta,na);Z(Oa,F,Aa,ua)}}break;case "b":if(na=ja[oa++]*K+M,ua=ja[oa++]*K,ta=ja[oa++]*K+M,Aa=ja[oa++]*K,aa=ja[oa++]*K+M,qa=ja[oa++]*K,Q.bezierCurveTo(ta,Aa,aa,qa,na,ua),F=P[P.length-1])for(Ka=F.x,F=F.y,Ia=1;Ia<=d;Ia++)Oa=Ia/d,ca(Oa,Ka,ta,aa,na),ca(Oa,F,Aa,qa,ua)}K={offset:T.ha*K,path:Q}}else K=void 0;w+=K.offset;b.push(K.path)}d=[];g=0;for(a=b.length;g<a;g++)Array.prototype.push.apply(d,b[g].toShapes());return d}});Object.assign(cg.prototype,
{load:function(a,b,d,g){var t=this;(new Hc(this.manager)).load(a,function(w){try{var y=JSON.parse(w)}catch(F){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),y=JSON.parse(w.substring(65,w.length-2))}w=t.parse(y);b&&b(w)},d,g)},parse:function(a){return new Bf(a)}});var Df;Object.assign(Ef.prototype,{load:function(a,b,d,g){var t=new Hc(this.manager);t.setResponseType("arraybuffer");t.load(a,function(w){Cf().decodeAudioData(w,function(y){b(y)})},
d,g)}});Object.assign(dg.prototype,{update:function(){var a,b,d,g,t,w,y,F=new z,K=new z;return function(M){if(a!==this||b!==M.focus||d!==M.fov||g!==M.aspect*this.aspect||t!==M.near||w!==M.far||y!==M.zoom){a=this;b=M.focus;d=M.fov;g=M.aspect*this.aspect;t=M.near;w=M.far;y=M.zoom;var T=M.projectionMatrix.clone(),Q=this.eyeSep/2,P=Q*t/b,Z=t*Math.tan(c.Math.DEG2RAD*d*.5)/y;K.elements[12]=-Q;F.elements[12]=Q;Q=-Z*g+P;var ca=Z*g+P;T.elements[0]=2*t/(ca-Q);T.elements[8]=(ca+Q)/(ca-Q);this.cameraL.projectionMatrix.copy(T);
Q=-Z*g-P;ca=Z*g-P;T.elements[0]=2*t/(ca-Q);T.elements[8]=(ca+Q)/(ca-Q);this.cameraR.projectionMatrix.copy(T)}this.cameraL.matrixWorld.copy(M.matrixWorld).multiply(K);this.cameraR.matrixWorld.copy(M.matrixWorld).multiply(F)}}()});pf.prototype=Object.create(jb.prototype);pf.prototype.constructor=pf;Ff.prototype=Object.assign(Object.create(jb.prototype),{constructor:Ff,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),
this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.value=a},updateMatrixWorld:function(){var a=
new r,b=new u,d=new r,g=new r;return function(t){jb.prototype.updateMatrixWorld.call(this,t);t=this.context.listener;var w=this.up;this.matrixWorld.decompose(a,b,d);g.set(0,0,-1).applyQuaternion(b);t.setPosition(a.x,a.y,a.z);t.setOrientation(g.x,g.y,g.z,w.x,w.y,w.z)}}()});Td.prototype=Object.assign(Object.create(jb.prototype),{constructor:Td,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this},
setBuffer:function(a){this.source.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else{var a=this.context.createBufferSource();a.buffer=this.source.buffer;a.loop=this.source.loop;a.onended=this.source.onended;a.start(0,this.startTime);a.playbackRate.value=this.playbackRate;this.isPlaying=
!0;this.source=a;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);
for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},
getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.playbackRate=a,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate),
this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.source.loop},setLoop:function(a){!1===this.hasPlaybackControl?console.warn("THREE.Audio: this Audio has no playback control."):this.source.loop=a},getVolume:function(){return this.gain.gain.value},setVolume:function(a){this.gain.gain.value=a;return this}});Gf.prototype=Object.assign(Object.create(Td.prototype),
{constructor:Gf,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=a},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=a},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=
a},updateMatrixWorld:function(){var a=new r;return function(b){jb.prototype.updateMatrixWorld.call(this,b);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}()});Object.assign(Hf.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,b=this.getFrequencyData(),d=0;d<b.length;d++)a+=b[d];return a/b.length}});qf.prototype={constructor:qf,accumulate:function(a,b){var d=this.buffer,
g=this.valueSize;a=a*g+g;var t=this.cumulativeWeight;if(0===t){for(t=0;t!==g;++t)d[a+t]=d[t];t=b}else t+=b,this._mixBufferRegion(d,a,0,b/t,g);this.cumulativeWeight=t},apply:function(a){var b=this.valueSize,d=this.buffer;a=a*b+b;var g=this.cumulativeWeight,t=this.binding;this.cumulativeWeight=0;1>g&&this._mixBufferRegion(d,a,3*b,1-g,b);g=b;for(var w=b+b;g!==w;++g)if(d[g]!==d[g+b]){t.setValue(d,a);break}},saveOriginalState:function(){var a=this.buffer,b=this.valueSize,d=3*b;this.binding.getValue(a,
d);for(var g=b;g!==d;++g)a[g]=a[d+g%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,d,g,t){if(.5<=g)for(g=0;g!==t;++g)a[b+g]=a[d+g]},_slerp:function(a,b,d,g,t){u.slerpFlat(a,b,a,b,a,d,g)},_lerp:function(a,b,d,g,t){for(var w=1-g,y=0;y!==t;++y){var F=b+y;a[F]=a[F]*w+a[d+y]*g}}};ac.prototype={constructor:ac,getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},
bind:function(){var a=this.node,b=this.parsedPath,d=b.objectName,g=b.propertyName,t=b.propertyIndex;a||(this.node=a=ac.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(d){var w=b.objectIndex;switch(d){case "materials":if(!a.material){console.error("  can not bind to material as node does not have a material",this);return}if(!a.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",
this);return}a=a.material.materials;break;case "bones":if(!a.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}a=a.skeleton.bones;for(d=0;d<a.length;d++)if(a[d].name===w){w=d;break}break;default:if(void 0===a[d]){console.error("  can not bind to objectName of node, undefined",this);return}a=a[d]}if(void 0!==w){if(void 0===a[w]){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,a);return}a=a[w]}}w=a[g];if(void 0===w)console.error("  trying to update property for track: "+
b.nodeName+"."+g+" but it wasn't found.",a);else{b=this.Versioning.None;void 0!==a.needsUpdate?(b=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);d=this.BindingType.Direct;if(void 0!==t){if("morphTargetInfluences"===g){if(!a.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);return}if(!a.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",
this);return}for(d=0;d<this.node.geometry.morphTargets.length;d++)if(a.geometry.morphTargets[d].name===t){t=d;break}}d=this.BindingType.ArrayElement;this.resolvedProperty=w;this.propertyIndex=t}else void 0!==w.fromArray&&void 0!==w.toArray?(d=this.BindingType.HasFromToArray,this.resolvedProperty=w):void 0!==w.length?(d=this.BindingType.EntireArray,this.resolvedProperty=w):this.propertyName=g;this.getValue=this.GetterByBindingType[d];this.setValue=this.SetterByBindingTypeAndVersioning[d][b]}}else console.error("  trying to update node for track: "+
this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};Object.assign(ac.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:ac.prototype.getValue,_setValue_unbound:ac.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},
function(a,b){for(var d=this.resolvedProperty,g=0,t=d.length;g!==t;++g)a[b++]=d[g]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var d=this.resolvedProperty,
g=0,t=d.length;g!==t;++g)d[g]=a[b++]},function(a,b){for(var d=this.resolvedProperty,g=0,t=d.length;g!==t;++g)d[g]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var d=this.resolvedProperty,g=0,t=d.length;g!==t;++g)d[g]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];
this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,b)},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]]});ac.Composite=function(a,b,d){d=d||ac.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,d)};ac.Composite.prototype={constructor:ac.Composite,getValue:function(a,b){this.bind();var d=this._bindings[this._targetGroup.nCachedObjects_];
void 0!==d&&d.getValue(a,b)},setValue:function(a,b){for(var d=this._bindings,g=this._targetGroup.nCachedObjects_,t=d.length;g!==t;++g)d[g].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,d=a.length;b!==d;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,d=a.length;b!==d;++b)a[b].unbind()}};ac.create=function(a,b,d){return a&&a.isAnimationObjectGroup?new ac.Composite(a,b,d):new ac(a,b,d)};ac.parseTrackName=function(a){var b=
/^((?:\w+[\/:])*)(\w+)?(?:\.(\w+)(?:\[(.+)\])?)?\.(\w+)(?:\[(.+)\])?$/.exec(a);if(!b)throw Error("cannot parse trackName at all: "+a);b={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]};if(null===b.propertyName||0===b.propertyName.length)throw Error("can not parse propertyName from trackName: "+a);return b};ac.findNode=function(a,b){if(!b||""===b||"root"===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var d=function(t){for(var w=0;w<t.bones.length;w++){var y=
t.bones[w];if(y.name===b)return y}return null}(a.skeleton);if(d)return d}if(a.children){var g=function(t){for(var w=0;w<t.length;w++){var y=t[w];if(y.name===b||y.uuid===b||(y=g(y.children)))return y}return null};if(a=g(a.children))return a}return null};If.prototype={constructor:If,isAnimationObjectGroup:!0,add:function(a){for(var b=this._objects,d=b.length,g=this.nCachedObjects_,t=this._indicesByUUID,w=this._paths,y=this._parsedPaths,F=this._bindings,K=F.length,M=0,T=arguments.length;M!==T;++M){var Q=
arguments[M],P=Q.uuid,Z=t[P];if(void 0===Z){Z=d++;t[P]=Z;b.push(Q);P=0;for(var ca=K;P!==ca;++P)F[P].push(new ac(Q,w[P],y[P]))}else if(Z<g){var ja=b[Z],oa=--g;ca=b[oa];t[ca.uuid]=Z;b[Z]=ca;t[P]=oa;b[oa]=Q;P=0;for(ca=K;P!==ca;++P){var ra=F[P],aa=ra[Z];ra[Z]=ra[oa];void 0===aa&&(aa=new ac(Q,w[P],y[P]));ra[oa]=aa}}else b[Z]!==ja&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=g},remove:function(a){for(var b=
this._objects,d=this.nCachedObjects_,g=this._indicesByUUID,t=this._bindings,w=t.length,y=0,F=arguments.length;y!==F;++y){var K=arguments[y],M=K.uuid,T=g[M];if(void 0!==T&&T>=d){var Q=d++,P=b[Q];g[P.uuid]=T;b[T]=P;g[M]=Q;b[Q]=K;K=0;for(M=w;K!==M;++K){P=t[K];var Z=P[T];P[T]=P[Q];P[Q]=Z}}}this.nCachedObjects_=d},uncache:function(a){for(var b=this._objects,d=b.length,g=this.nCachedObjects_,t=this._indicesByUUID,w=this._bindings,y=w.length,F=0,K=arguments.length;F!==K;++F){var M=arguments[F].uuid,T=t[M];
if(void 0!==T)if(delete t[M],T<g){M=--g;var Q=b[M],P=--d,Z=b[P];t[Q.uuid]=T;b[T]=Q;t[Z.uuid]=M;b[M]=Z;b.pop();Q=0;for(Z=y;Q!==Z;++Q){var ca=w[Q],ja=ca[P];ca[T]=ca[M];ca[M]=ja;ca.pop()}}else for(P=--d,Z=b[P],t[Z.uuid]=T,b[T]=Z,b.pop(),Q=0,Z=y;Q!==Z;++Q)ca=w[Q],ca[T]=ca[P],ca.pop()}this.nCachedObjects_=g},subscribe_:function(a,b){var d=this._bindingsIndicesByPath,g=d[a],t=this._bindings;if(void 0!==g)return t[g];var w=this._paths,y=this._parsedPaths,F=this._objects,K=this.nCachedObjects_,M=Array(F.length);
g=t.length;d[a]=g;w.push(a);y.push(b);t.push(M);d=K;for(g=F.length;d!==g;++d)M[d]=new ac(F[d],a,b);return M},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,d=b[a];if(void 0!==d){var g=this._paths,t=this._parsedPaths,w=this._bindings,y=w.length-1,F=w[y];b[a[y]]=d;w[d]=F;w.pop();t[d]=t[y];t.pop();g[d]=g[y];g.pop()}}};Jf.prototype={constructor:Jf,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=
!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){this._startTime=a;return this},setLoop:function(a,b){this.loop=a;this.repetitions=b;return this},setEffectiveWeight:function(a){this.weight=a;this._effectiveWeight=this.enabled?
a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,d){a.fadeOut(b);this.fadeIn(b);if(d){d=this._clip.duration;var g=a._clip.duration,t=d/g;a.warp(1,g/d,b);this.warp(t,1,b)}return this},crossFadeTo:function(a,b,d){return a.crossFadeFrom(this,b,d)},stopFading:function(){var a=this._weightInterpolant;null!==a&&(this._weightInterpolant=
null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/a;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,0,a)},warp:function(a,
b,d){var g=this._mixer,t=g.time,w=this._timeScaleInterpolant,y=this.timeScale;null===w&&(this._timeScaleInterpolant=w=g._lendControlInterpolant());g=w.parameterPositions;w=w.sampleValues;g[0]=t;g[1]=t+d;w[0]=a/y;w[1]=b/y;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||
this._mixer._root},_update:function(a,b,d,g){var t=this._startTime;if(null!==t){b=(a-t)*d;if(0>b||0===d)return;this._startTime=null;b*=d}b*=this._updateTimeScale(a);d=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;t=this._propertyBindings;for(var w=0,y=b.length;w!==y;++w)b[w].evaluate(d),t[w].accumulate(g,a)}},_updateWeight:function(a){var b=0;if(this.enabled){b=this.weight;var d=this._weightInterpolant;if(null!==d){var g=d.evaluate(a)[0];b*=g;a>d.parameterPositions[1]&&
(this.stopFading(),0===g&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){b=this.timeScale;var d=this._timeScaleInterpolant;if(null!==d){var g=d.evaluate(a)[0];b*=g;a>d.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:this.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var d=this._clip.duration,g=this.loop,t=this._loopCount;if(2200===g)a:{if(-1===t&&(this.loopCount=
0,this._setEndings(!0,!0,!1)),b>=d)b=d;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1})}else{g=2202===g;-1===t&&(0<=a?(t=0,this._setEndings(!0,0===this.repetitions,g)):this._setEndings(0===this.repetitions,!0,g));if(b>=d||0>b){var w=Math.floor(b/d);b-=d*w;t+=Math.abs(w);var y=this.repetitions-t;0>y?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=0<a?d:0,this._mixer.dispatchEvent({type:"finished",
action:this,direction:0<a?1:-1})):(0===y?(a=0>a,this._setEndings(a,!a,g)):this._setEndings(!1,!1,g),this._loopCount=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:w}))}if(g&&1===(t&1))return this.time=b,d-b}return this.time=b},_setEndings:function(a,b,d){var g=this._interpolantSettings;d?(g.endingStart=2401,g.endingEnd=2401):(g.endingStart=a?this.zeroSlopeAtStart?2401:2400:2402,g.endingEnd=b?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(a,b,d){var g=this._mixer,t=g.time,
w=this._weightInterpolant;null===w&&(this._weightInterpolant=w=g._lendControlInterpolant());g=w.parameterPositions;w=w.sampleValues;g[0]=t;w[0]=b;g[1]=t+a;w[1]=d;return this}};Object.assign(Kf.prototype,h.prototype,{clipAction:function(a,b){var d=b||this._root,g=d.uuid;d="string"===typeof a?Dc.findByName(d,a):a;a=null!==d?d.uuid:a;var t=this._actionsByClip[a],w=null;if(void 0!==t){w=t.actionByRoot[g];if(void 0!==w)return w;w=t.knownActions[0];null===d&&(d=w._clip)}if(null===d)return null;b=new Jf(this,
d,b);this._bindAction(b,w);this._addInactiveAction(b,a,g);return b},existingAction:function(a,b){var d=b||this._root;b=d.uuid;d="string"===typeof a?Dc.findByName(d,a):a;a=this._actionsByClip[d?d.uuid:a];return void 0!==a?a.actionByRoot[b]||null:null},stopAllAction:function(){for(var a=this._actions,b=this._nActiveActions,d=this._bindings,g=this._nActiveBindings,t=this._nActiveBindings=this._nActiveActions=0;t!==b;++t)a[t].reset();for(t=0;t!==g;++t)d[t].useCount=0;return this},update:function(a){a*=
this.timeScale;for(var b=this._actions,d=this._nActiveActions,g=this.time+=a,t=Math.sign(a),w=this._accuIndex^=1,y=0;y!==d;++y){var F=b[y];F.enabled&&F._update(g,a,t,w)}a=this._bindings;b=this._nActiveBindings;for(y=0;y!==b;++y)a[y].apply(w);return this},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions;a=a.uuid;var d=this._actionsByClip,g=d[a];if(void 0!==g){g=g.knownActions;for(var t=0,w=g.length;t!==w;++t){var y=g[t];this._deactivateAction(y);var F=y._cacheIndex,
K=b[b.length-1];y._cacheIndex=null;y._byClipCacheIndex=null;K._cacheIndex=F;b[F]=K;b.pop();this._removeInactiveBindingsForAction(y)}delete d[a]}},uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip;for(g in b){var d=b[g].actionByRoot[a];void 0!==d&&(this._deactivateAction(d),this._removeInactiveAction(d))}var g=this._bindingsByRootAndName[a];if(void 0!==g)for(var t in g)a=g[t],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){a=this.existingAction(a,b);null!==
a&&(this._deactivateAction(a),this._removeInactiveAction(a))}});Object.assign(Kf.prototype,{_bindAction:function(a,b){var d=a._localRoot||this._root,g=a._clip.tracks,t=g.length,w=a._propertyBindings;a=a._interpolants;var y=d.uuid,F=this._bindingsByRootAndName,K=F[y];void 0===K&&(K={},F[y]=K);for(F=0;F!==t;++F){var M=g[F],T=M.name,Q=K[T];if(void 0===Q){Q=w[F];if(void 0!==Q){null===Q._cacheIndex&&(++Q.referenceCount,this._addInactiveBinding(Q,y,T));continue}Q=new qf(ac.create(d,T,b&&b._propertyBindings[F].binding.parsedPath),
M.ValueTypeName,M.getValueSize());++Q.referenceCount;this._addInactiveBinding(Q,y,T)}w[F]=Q;a[F].resultBuffer=Q.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,d=a._clip.uuid,g=this._actionsByClip[d];this._bindAction(a,g&&g.knownActions[0]);this._addInactiveAction(a,d,b)}b=a._propertyBindings;d=0;for(g=b.length;d!==g;++d){var t=b[d];0===t.useCount++&&(this._lendBinding(t),t.saveOriginalState())}this._lendAction(a)}},
_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,d=0,g=b.length;d!==g;++d){var t=b[d];0===--t.useCount&&(t.restoreOriginalState(),this._takeBackBinding(t))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},
get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,b,d){var g=this._actions,t=this._actionsByClip,w=t[b];void 0===w?(w={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,t[b]=w):(b=
w.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=g.length;g.push(a);w.actionByRoot[d]=a},_removeInactiveAction:function(a){var b=this._actions,d=b[b.length-1],g=a._cacheIndex;d._cacheIndex=g;b[g]=d;b.pop();a._cacheIndex=null;d=a._clip.uuid;g=this._actionsByClip;var t=g[d],w=t.knownActions,y=w[w.length-1],F=a._byClipCacheIndex;y._byClipCacheIndex=F;w[F]=y;w.pop();a._byClipCacheIndex=null;delete t.actionByRoot[(b._localRoot||this._root).uuid];0===w.length&&delete g[d];this._removeInactiveBindingsForAction(a)},
_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,d=a.length;b!==d;++b){var g=a[b];0===--g.referenceCount&&this._removeInactiveBinding(g)}},_lendAction:function(a){var b=this._actions,d=a._cacheIndex,g=this._nActiveActions++,t=b[g];a._cacheIndex=g;b[g]=a;t._cacheIndex=d;b[d]=t},_takeBackAction:function(a){var b=this._actions,d=a._cacheIndex,g=--this._nActiveActions,t=b[g];a._cacheIndex=g;b[g]=a;t._cacheIndex=d;b[d]=t},_addInactiveBinding:function(a,b,d){var g=this._bindingsByRootAndName,
t=g[b],w=this._bindings;void 0===t&&(t={},g[b]=t);t[d]=a;a._cacheIndex=w.length;w.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,d=a.binding,g=d.rootNode.uuid;d=d.path;var t=this._bindingsByRootAndName,w=t[g],y=b[b.length-1];a=a._cacheIndex;y._cacheIndex=a;b[a]=y;b.pop();delete w[d];a:{for(var F in w)break a;delete t[g]}},_lendBinding:function(a){var b=this._bindings,d=a._cacheIndex,g=this._nActiveBindings++,t=b[g];a._cacheIndex=g;b[g]=a;t._cacheIndex=d;b[d]=t},_takeBackBinding:function(a){var b=
this._bindings,d=a._cacheIndex,g=--this._nActiveBindings,t=b[g];a._cacheIndex=g;b[g]=a;t._cacheIndex=d;b[d]=t},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,d=a[b];void 0===d&&(d=new De(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),d.__cacheIndex=b,a[b]=d);return d},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,d=a.__cacheIndex,g=--this._nActiveControlInterpolants,t=b[g];a.__cacheIndex=
g;b[g]=a;t.__cacheIndex=d;b[d]=t},_controlInterpolantsResultBuffer:new Float32Array(1)});wd.prototype=Object.create(qb.prototype);wd.prototype.constructor=wd;wd.prototype.isInstancedBufferGeometry=!0;wd.prototype.addGroup=function(a,b,d){this.groups.push({start:a,count:b,instances:d})};wd.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());b=a.attributes;for(var d in b)this.addAttribute(d,b[d].clone());a=a.groups;d=0;for(b=a.length;d<b;d++){var g=a[d];this.addGroup(g.start,
g.count,g.instances)}return this};Lf.prototype={constructor:Lf,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},setW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},
getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=d;return this},setXYZ:function(a,b,d,g){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+
1]=d;this.data.array[a+2]=g;return this},setXYZW:function(a,b,d,g,t){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=d;this.data.array[a+2]=g;this.data.array[a+3]=t;return this}};Ud.prototype={constructor:Ud,isInterleavedBuffer:!0,set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.count=a.count;this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,
b,d){a*=this.stride;d*=b.stride;for(var g=0,t=this.stride;g<t;g++)this.array[a+g]=b.array[d+g];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(){return(new this.constructor).copy(this)}};Vd.prototype=Object.create(Ud.prototype);Vd.prototype.constructor=Vd;Vd.prototype.isInstancedInterleavedBuffer=!0;Vd.prototype.copy=function(a){Ud.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};Wd.prototype=Object.create(gb.prototype);
Wd.prototype.constructor=Wd;Wd.prototype.isInstancedBufferAttribute=!0;Wd.prototype.copy=function(a){gb.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};Mf.prototype={constructor:Mf,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(a,b){b&&b.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(b.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(b).sub(this.ray.origin).normalize()):b&&b.isOrthographicCamera?(this.ray.origin.set(a.x,
a.y,(b.near+b.far)/(b.near-b.far)).unproject(b),this.ray.direction.set(0,0,-1).transformDirection(b.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,b){var d=[];Nf(a,this,d,b);d.sort(fg);return d},intersectObjects:function(a,b){var d=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),d;for(var g=0,t=a.length;g<t;g++)Nf(a[g],this,d,b);d.sort(fg);return d}};Of.prototype={constructor:Of,start:function(){this.oldTime=
this.startTime=(performance||Date).now();this.elapsedTime=0;this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=(performance||Date).now();a=(b-this.oldTime)/1E3;this.oldTime=b;this.elapsedTime+=a}return a}};Pf.prototype={constructor:Pf,set:function(a,b,d){this.radius=a;this.phi=b;this.theta=d;return this},clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.radius=a.radius;this.phi=a.phi;this.theta=a.theta;return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return this},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=Math.acos(c.Math.clamp(a.y/this.radius,-1,1)));return this}};oc.prototype=Object.create(Rb.prototype);oc.prototype.constructor=oc;oc.prototype.createAnimation=function(a,b,d,g){b={start:b,end:d,length:d-
b+1,fps:g,duration:(d-b)/g,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};oc.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)_?(\d+)/i,d,g={},t=this.geometry,w=0,y=t.morphTargets.length;w<y;w++){var F=t.morphTargets[w].name.match(b);if(F&&1<F.length){var K=F[1];g[K]||(g[K]={start:Infinity,end:-Infinity});F=g[K];w<F.start&&(F.start=w);w>F.end&&(F.end=w);d||(d=K)}}for(K in g)F=
g[K],this.createAnimation(K,F.start,F.end,a);this.firstAnimation=d};oc.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};oc.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};oc.prototype.setAnimationFPS=function(a,b){if(a=this.animationsMap[a])a.fps=b,a.duration=(a.end-a.start)/a.fps};oc.prototype.setAnimationDuration=function(a,b){if(a=this.animationsMap[a])a.duration=
b,a.fps=(a.end-a.start)/a.duration};oc.prototype.setAnimationWeight=function(a,b){if(a=this.animationsMap[a])a.weight=b};oc.prototype.setAnimationTime=function(a,b){if(a=this.animationsMap[a])a.time=b};oc.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};oc.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};oc.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("THREE.MorphBlendMesh: animation["+
a+"] undefined in .playAnimation()")};oc.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};oc.prototype.update=function(a){for(var b=0,d=this.animationsList.length;b<d;b++){var g=this.animationsList[b];if(g.active){var t=g.duration/g.length;g.time+=g.direction*a;if(g.mirroredLoop){if(g.time>g.duration||0>g.time)g.direction*=-1,g.time>g.duration&&(g.time=g.duration,g.directionBackwards=!0),0>g.time&&(g.time=0,g.directionBackwards=!1)}else g.time%=g.duration,0>g.time&&(g.time+=
g.duration);var w=g.start+c.Math.clamp(Math.floor(g.time/t),0,g.length-1),y=g.weight;w!==g.currentFrame&&(this.morphTargetInfluences[g.lastFrame]=0,this.morphTargetInfluences[g.currentFrame]=1*y,this.morphTargetInfluences[w]=0,g.lastFrame=g.currentFrame,g.currentFrame=w);t=g.time%t/t;g.directionBackwards&&(t=1-t);g.currentFrame!==g.lastFrame?(this.morphTargetInfluences[g.currentFrame]=t*y,this.morphTargetInfluences[g.lastFrame]=(1-t)*y):this.morphTargetInfluences[g.currentFrame]=y}}};He.prototype=
Object.create(jb.prototype);He.prototype.constructor=He;He.prototype.isImmediateRenderObject=!0;Ie.prototype=Object.create($b.prototype);Ie.prototype.constructor=Ie;Ie.prototype.update=function(){var a=new r,b=new r,d=new Mb;return function(){var g=["a","b","c"];this.object.updateMatrixWorld(!0);d.getNormalMatrix(this.object.matrixWorld);var t=this.object.matrixWorld,w=this.geometry.attributes.position,y=this.object.geometry;if(y&&y.isGeometry)for(var F=y.vertices,K=y.faces,M=y=0,T=K.length;M<T;M++)for(var Q=
K[M],P=0,Z=Q.vertexNormals.length;P<Z;P++){var ca=Q.vertexNormals[P];a.copy(F[Q[g[P]]]).applyMatrix4(t);b.copy(ca).applyMatrix3(d).normalize().multiplyScalar(this.size).add(a);w.setXYZ(y,a.x,a.y,a.z);y+=1;w.setXYZ(y,b.x,b.y,b.z);y+=1}else if(y&&y.isBufferGeometry)for(g=y.attributes.position,F=y.attributes.normal,P=y=0,Z=g.count;P<Z;P++)a.set(g.getX(P),g.getY(P),g.getZ(P)).applyMatrix4(t),b.set(F.getX(P),F.getY(P),F.getZ(P)),b.applyMatrix3(d).normalize().multiplyScalar(this.size).add(a),w.setXYZ(y,
a.x,a.y,a.z),y+=1,w.setXYZ(y,b.x,b.y,b.z),y+=1;w.needsUpdate=!0;return this}}();Xd.prototype=Object.create(jb.prototype);Xd.prototype.constructor=Xd;Xd.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};Xd.prototype.update=function(){var a=new r,b=new r;return function(){var d=this.light.distance?this.light.distance:1E3,g=d*Math.tan(this.light.angle);this.cone.scale.set(g,g,d);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);
this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();Yd.prototype=Object.create($b.prototype);Yd.prototype.constructor=Yd;Yd.prototype.getBoneList=function(a){var b=[];a&&a.isBone&&b.push(a);for(var d=0;d<a.children.length;d++)b.push.apply(b,this.getBoneList(a.children[d]));return b};Yd.prototype.update=function(){for(var a=this.geometry,b=(new z).getInverse(this.root.matrixWorld),d=new z,g=0,t=0;t<this.bones.length;t++){var w=this.bones[t];
w.parent&&w.parent.isBone&&(d.multiplyMatrices(b,w.matrixWorld),a.vertices[g].setFromMatrixPosition(d),d.multiplyMatrices(b,w.parent.matrixWorld),a.vertices[g+1].setFromMatrixPosition(d),g+=2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};Zd.prototype=Object.create(Rb.prototype);Zd.prototype.constructor=Zd;Zd.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};Zd.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};
$d.prototype=Object.create(jb.prototype);$d.prototype.constructor=$d;$d.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};$d.prototype.update=function(){var a=new r;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=
!0}}();Je.prototype=Object.create($b.prototype);Je.prototype.constructor=Je;Je.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Ke.prototype=Object.create($b.prototype);Ke.prototype.constructor=Ke;Ke.prototype.update=function(){var a=new r,b=new r,d=new Mb;return function(){this.object.updateMatrixWorld(!0);d.getNormalMatrix(this.object.matrixWorld);var g=this.object.matrixWorld,t=this.geometry.attributes.position,
w=this.object.geometry,y=w.vertices;w=w.faces;for(var F=0,K=0,M=w.length;K<M;K++){var T=w[K],Q=T.normal;a.copy(y[T.a]).add(y[T.b]).add(y[T.c]).divideScalar(3).applyMatrix4(g);b.copy(Q).applyMatrix3(d).normalize().multiplyScalar(this.size).add(a);t.setXYZ(F,a.x,a.y,a.z);F+=1;t.setXYZ(F,b.x,b.y,b.z);F+=1}t.needsUpdate=!0;return this}}();ae.prototype=Object.create(jb.prototype);ae.prototype.constructor=ae;ae.prototype.dispose=function(){var a=this.children[0],b=this.children[1];a.geometry.dispose();
a.material.dispose();b.geometry.dispose();b.material.dispose()};ae.prototype.update=function(){var a=new r,b=new r,d=new r;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);d.subVectors(b,a);var g=this.children[0],t=this.children[1];g.lookAt(d);g.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);t.lookAt(d);t.scale.z=d.length()}}();Le.prototype=Object.create($b.prototype);Le.prototype.constructor=Le;Le.prototype.update=
function(){function a(w,y,F,K){g.set(y,F,K).unproject(t);w=d[w];if(void 0!==w)for(y=0,F=w.length;y<F;y++)b.vertices[w[y]].copy(g)}var b,d,g=new r,t=new ec;return function(){b=this.geometry;d=this.pointMap;t.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,-1);a("u2",-.7,1.1,-1);a("u3",0,2,-1);a("cf1",-1,0,1);a("cf2",1,0,1);a("cf3",
0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);b.verticesNeedUpdate=!0}}();Me.prototype=Object.create(Rb.prototype);Me.prototype.constructor=Me;Me.prototype.update=function(){this.box.setFromObject(this.object);this.box.getSize(this.scale);this.box.getCenter(this.position)};Ne.prototype=Object.create($b.prototype);Ne.prototype.constructor=Ne;Ne.prototype.update=function(){var a=new Ab;return function(b){b&&b.isBox3?a.copy(b):a.setFromObject(b);if(!a.isEmpty()){b=
a.min;var d=a.max,g=this.geometry.attributes.position,t=g.array;t[0]=d.x;t[1]=d.y;t[2]=d.z;t[3]=b.x;t[4]=d.y;t[5]=d.z;t[6]=b.x;t[7]=b.y;t[8]=d.z;t[9]=d.x;t[10]=b.y;t[11]=d.z;t[12]=d.x;t[13]=d.y;t[14]=b.z;t[15]=b.x;t[16]=d.y;t[17]=b.z;t[18]=b.x;t[19]=b.y;t[20]=b.z;t[21]=d.x;t[22]=b.y;t[23]=b.z;g.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();var gg=new qb;gg.addAttribute("position",new Qb([0,0,0,0,1,0],3));var hg=new $c(0,.5,1,5,1);hg.translate(0,-.5,0);xd.prototype=Object.create(jb.prototype);
xd.prototype.constructor=xd;xd.prototype.setDirection=function(){var a=new r,b;return function(d){.99999<d.y?this.quaternion.set(0,0,0,1):-.99999>d.y?this.quaternion.set(1,0,0,0):(a.set(d.z,0,-d.x).normalize(),b=Math.acos(d.y),this.quaternion.setFromAxisAngle(a,b))}}();xd.prototype.setLength=function(a,b,d){void 0===b&&(b=.2*a);void 0===d&&(d=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(d,b,d);this.cone.position.y=a;this.cone.updateMatrix()};xd.prototype.setColor=
function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};rf.prototype=Object.create($b.prototype);rf.prototype.constructor=rf;c.CatmullRomCurve3=function(){function a(){}var b=new r,d=new a,g=new a,t=new a;a.prototype.init=function(w,y,F,K){this.c0=w;this.c1=F;this.c2=-3*w+3*y-2*F-K;this.c3=2*w-2*y+F+K};a.prototype.initNonuniformCatmullRom=function(w,y,F,K,M,T,Q){this.init(y,F,((y-w)/M-(F-w)/(M+T)+(F-y)/T)*T,((F-y)/T-(K-y)/(T+Q)+(K-F)/Q)*T)};a.prototype.initCatmullRom=function(w,
y,F,K,M){this.init(y,F,M*(F-w),M*(K-y))};a.prototype.calc=function(w){var y=w*w;return this.c0+this.c1*w+this.c2*y+this.c3*y*w};return rc.create(function(w){this.points=w||[];this.closed=!1},function(w){var y=this.points;var F=y.length;2>F&&console.log("duh, you need at least 2 points");w*=F-(this.closed?0:1);var K=Math.floor(w);w-=K;this.closed?K+=0<K?0:(Math.floor(Math.abs(K)/y.length)+1)*y.length:0===w&&K===F-1&&(K=F-2,w=1);if(this.closed||0<K)var M=y[(K-1)%F];else b.subVectors(y[0],y[1]).add(y[0]),
M=b;var T=y[K%F];var Q=y[(K+1)%F];this.closed||K+2<F?y=y[(K+2)%F]:(b.subVectors(y[F-1],y[F-2]).add(y[F-1]),y=b);if(void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var P="chordal"===this.type?.5:.25;F=Math.pow(M.distanceToSquared(T),P);K=Math.pow(T.distanceToSquared(Q),P);P=Math.pow(Q.distanceToSquared(y),P);1E-4>K&&(K=1);1E-4>F&&(F=K);1E-4>P&&(P=K);d.initNonuniformCatmullRom(M.x,T.x,Q.x,y.x,F,K,P);g.initNonuniformCatmullRom(M.y,T.y,Q.y,y.y,F,K,P);t.initNonuniformCatmullRom(M.z,
T.z,Q.z,y.z,F,K,P)}else"catmullrom"===this.type&&(F=void 0!==this.tension?this.tension:.5,d.initCatmullRom(M.x,T.x,Q.x,y.x,F),g.initCatmullRom(M.y,T.y,Q.y,y.y,F),t.initCatmullRom(M.z,T.z,Q.z,y.z,F));return new r(d.calc(w),g.calc(w),t.calc(w))})}();ig.prototype=Object.create(c.CatmullRomCurve3.prototype);var sg=rc.create(function(a){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=void 0===a?[]:a},function(a){var b=this.points;a*=b.length-1;var d=
Math.floor(a);a-=d;var g=b[0==d?d:d-1],t=b[d],w=b[d>b.length-2?b.length-1:d+1];b=b[d>b.length-3?b.length-1:d+2];d=c.CurveUtils.interpolate;return new r(d(g.x,t.x,w.x,b.x,a),d(g.y,t.y,w.y,b.y,a),d(g.z,t.z,w.z,b.z,a))});c.CubicBezierCurve3=rc.create(function(a,b,d,g){this.v0=a;this.v1=b;this.v2=d;this.v3=g},function(a){var b=c.ShapeUtils.b3;return new r(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});c.QuadraticBezierCurve3=
rc.create(function(a,b,d){this.v0=a;this.v1=b;this.v2=d},function(a){var b=c.ShapeUtils.b2;return new r(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))});c.LineCurve3=rc.create(function(a,b){this.v1=a;this.v2=b},function(a){if(1===a)return this.v2.clone();var b=new r;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});sf.prototype=Object.create(Vc.prototype);sf.prototype.constructor=sf;c.SceneUtils={createMultiMaterialObject:function(a,
b){for(var d=new ge,g=0,t=b.length;g<t;g++)d.add(new Rb(a,b[g]));return d},detach:function(a,b,d){a.applyMatrix(b.matrixWorld);b.remove(a);d.add(a)},attach:function(a,b,d){var g=new z;g.getInverse(d.matrixWorld);a.applyMatrix(g);b.remove(a);d.add(a)}};Object.assign(wa.prototype,{center:function(a){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},
isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},size:function(a){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(Ab.prototype,{center:function(a){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},
isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)},size:function(a){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(Pc.prototype,{center:function(a){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");
return this.getCenter(a)}});Object.assign(Mb.prototype,{multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)}});Object.assign(z.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");
return this.copyPosition(a)},setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},translate:function(a){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(a,b){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}});Object.assign(Nb.prototype,{isIntersectionLine:function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");
return this.intersectsLine(a)}});Object.assign(u.prototype,{multiplyVector3:function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)}});Object.assign(sc.prototype,{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");
return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});Object.assign(vd.prototype,{extrude:function(a){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new Cc(this,a)},makeGeometry:function(a){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new Zc(this,a)}});Object.assign(r.prototype,
{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");
return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(b,a)}});Object.assign(jb.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)},renderDepth:function(a){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(a,
b){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)}});Object.defineProperties(jb.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},
set:function(a){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(fe.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});hc.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==b&&(this.filmGauge=b);this.setFocalLength(a)};Object.defineProperties(kc.prototype,
{onlyShadow:{set:function(a){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=a}},
shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");
this.shadow.camera.far=a}},shadowCameraVisible:{set:function(a){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=a}},shadowDarkness:{set:function(a){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");
this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(gb.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length}}});Object.assign(qb.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addDrawCall:function(a,
b,d){void 0!==d&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,b)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});
Object.defineProperties(qb.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Object.defineProperties(za.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(a){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},
wrapRGB:{get:function(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new ma}}});Object.defineProperties(ad.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(a){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(ob.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");
return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});h.prototype=Object.assign(Object.create({constructor:h,apply:function(a){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in.");Object.assign(a,this)}}),h.prototype);Object.defineProperties(eg.prototype,{dynamic:{set:function(a){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},
onUpdate:{value:function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.assign(cc.prototype,{supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");
return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},
supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");
return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}});
Object.defineProperties(cc.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");
this.shadowMap.cullFace=a}}});Object.defineProperties(yd.prototype,{cullFace:{get:function(){return this.renderReverseSided?2:1},set:function(a){a=1!==a;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+a+".");this.renderReverseSided=a}}});Object.defineProperties(l.prototype,{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");
this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=
a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=
a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");
return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},
set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});Object.assign(Td.prototype,{load:function(a){console.warn("THREE.Audio: .load has been deprecated. Please use THREE.AudioLoader.");var b=this;(new Ef).load(a,function(d){b.setBuffer(d)});return this}});Object.assign(Hf.prototype,{getData:function(a){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()}});
Object.defineProperty(c,"AudioContext",{get:function(){return c.getAudioContext()}});c.WebGLRenderTargetCube=k;c.WebGLRenderTarget=l;c.WebGLRenderer=cc;c.ShaderLib=zd;c.UniformsLib=Eb;c.ShaderChunk=Lb;c.FogExp2=Wb;c.Fog=qc;c.Scene=dc;c.LensFlare=wc;c.Sprite=Yc;c.LOD=fe;c.SkinnedMesh=We;c.Skeleton=Ue;c.Bone=Ve;c.Mesh=Rb;c.LineSegments=$b;c.Line=Uc;c.Points=Fd;c.Group=ge;c.VideoTexture=Xe;c.DataTexture=gd;c.CompressedTexture=Gd;c.CubeTexture=C;c.CanvasTexture=Ye;c.DepthTexture=he;c.TextureIdCount=function(){return Tf++};
c.Texture=f;c.MaterialIdCount=function(){return Yf++};c.CompressedTextureLoader=ag;c.BinaryTextureLoader=wf;c.DataTextureLoader=wf;c.CubeTextureLoader=xf;c.TextureLoader=$e;c.ObjectLoader=bg;c.MaterialLoader=of;c.BufferGeometryLoader=yf;c.LoadingManager=vf;c.JSONLoader=zf;c.ImageLoader=Ce;c.FontLoader=cg;c.XHRLoader=Hc;c.Loader=rd;c.AudioLoader=Ef;c.SpotLightShadow=bf;c.SpotLight=cf;c.PointLight=df;c.HemisphereLight=af;c.DirectionalLightShadow=ef;c.DirectionalLight=ff;c.AmbientLight=gf;c.LightShadow=
od;c.Light=kc;c.StereoCamera=dg;c.PerspectiveCamera=hc;c.OrthographicCamera=zc;c.CubeCamera=pf;c.Camera=ec;c.AudioListener=Ff;c.PositionalAudio=Gf;c.getAudioContext=Cf;c.AudioAnalyser=Hf;c.Audio=Td;c.VectorKeyframeTrack=Rd;c.StringKeyframeTrack=lf;c.QuaternionKeyframeTrack=Ee;c.NumberKeyframeTrack=Sd;c.ColorKeyframeTrack=nf;c.BooleanKeyframeTrack=mf;c.PropertyMixer=qf;c.PropertyBinding=ac;c.KeyframeTrack=qd;c.AnimationObjectGroup=If;c.AnimationMixer=Kf;c.AnimationClip=Dc;c.Uniform=eg;c.InstancedBufferGeometry=
wd;c.BufferGeometry=qb;c.GeometryIdCount=function(){return Oe++};c.Geometry=pb;c.InterleavedBufferAttribute=Lf;c.InstancedInterleavedBuffer=Vd;c.InterleavedBuffer=Ud;c.InstancedBufferAttribute=Wd;c.DynamicBufferAttribute=function(a,b){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return(new gb(a,b)).setDynamic(!0)};c.Float64Attribute=function(a,b){return new gb(new Float64Array(a),b)};c.Float32Attribute=Qb;c.Uint32Attribute=
Ad;c.Int32Attribute=function(a,b){return new gb(new Int32Array(a),b)};c.Uint16Attribute=be;c.Int16Attribute=function(a,b){return new gb(new Int16Array(a),b)};c.Uint8ClampedAttribute=function(a,b){return new gb(new Uint8ClampedArray(a),b)};c.Uint8Attribute=function(a,b){return new gb(new Uint8Array(a),b)};c.Int8Attribute=function(a,b){return new gb(new Int8Array(a),b)};c.BufferAttribute=gb;c.Face3=Pb;c.Object3DIdCount=function(){return Zf++};c.Object3D=jb;c.Raycaster=Mf;c.Layers=Oc;c.EventDispatcher=
h;c.Clock=Of;c.QuaternionLinearInterpolant=kf;c.LinearInterpolant=De;c.DiscreteInterpolant=jf;c.CubicInterpolant=hf;c.Interpolant=yc;c.Triangle=uc;c.Spline=function(a){function b(Z,ca,ja,oa,ra,aa,qa){Z=.5*(ja-Z);oa=.5*(oa-ca);return(2*(ca-ja)+Z+oa)*qa+(-3*(ca-ja)-2*Z-oa)*aa+Z*ra+ca}this.points=a;var d=[],g={x:0,y:0,z:0},t,w,y,F,K,M,T,Q,P;this.initFromArray=function(Z){this.points=[];for(var ca=0;ca<Z.length;ca++)this.points[ca]={x:Z[ca][0],y:Z[ca][1],z:Z[ca][2]}};this.getPoint=function(Z){t=(this.points.length-
1)*Z;w=Math.floor(t);y=t-w;d[0]=0===w?w:w-1;d[1]=w;d[2]=w>this.points.length-2?this.points.length-1:w+1;d[3]=w>this.points.length-3?this.points.length-1:w+2;M=this.points[d[0]];T=this.points[d[1]];Q=this.points[d[2]];P=this.points[d[3]];F=y*y;K=y*F;g.x=b(M.x,T.x,Q.x,P.x,y,F,K);g.y=b(M.y,T.y,Q.y,P.y,y,F,K);g.z=b(M.z,T.z,Q.z,P.z,y,F,K);return g};this.getControlPointsArray=function(){var Z,ca=this.points.length,ja=[];for(Z=0;Z<ca;Z++){var oa=this.points[Z];ja[Z]=[oa.x,oa.y,oa.z]}return ja};this.getLength=
function(Z){var ca=0,ja=new r,oa=new r,ra=[],aa=0;ra[0]=0;Z||(Z=100);var qa=this.points.length*Z;ja.copy(this.points[0]);for(Z=1;Z<qa;Z++){var na=Z/qa;var ua=this.getPoint(na);oa.copy(ua);aa+=oa.distanceTo(ja);ja.copy(ua);na*=this.points.length-1;na=Math.floor(na);na!==ca&&(ra[na]=aa,ca=na)}ra[ra.length]=aa;return{chunks:ra,total:aa}};this.reparametrizeByArcLength=function(Z){var ca,ja=[],oa=new r,ra=this.getLength();ja.push(oa.copy(this.points[0]).clone());for(ca=1;ca<this.points.length;ca++){var aa=
ra.chunks[ca]-ra.chunks[ca-1];var qa=Math.ceil(Z*aa/ra.total);var na=(ca-1)/(this.points.length-1);var ua=ca/(this.points.length-1);for(aa=1;aa<qa-1;aa++){var ta=na+1/qa*aa*(ua-na);ta=this.getPoint(ta);ja.push(oa.copy(ta).clone())}ja.push(oa.copy(this.points[ca]).clone())}this.points=ja}};c.Spherical=Pf;c.Plane=Nb;c.Frustum=jc;c.Sphere=rb;c.Ray=sc;c.Matrix4=z;c.Matrix3=Mb;c.Box3=Ab;c.Box2=wa;c.Line3=Pc;c.Euler=tc;c.Vector4=q;c.Vector3=r;c.Vector2=n;c.Quaternion=u;c.Color=ma;c.MorphBlendMesh=oc;c.ImmediateRenderObject=
He;c.VertexNormalsHelper=Ie;c.SpotLightHelper=Xd;c.SkeletonHelper=Yd;c.PointLightHelper=Zd;c.HemisphereLightHelper=$d;c.GridHelper=Je;c.FaceNormalsHelper=Ke;c.DirectionalLightHelper=ae;c.CameraHelper=Le;c.BoundingBoxHelper=Me;c.BoxHelper=Ne;c.ArrowHelper=xd;c.AxisHelper=rf;c.ClosedSplineCurve3=ig;c.SplineCurve3=sg;c.ArcCurve=sf;c.EllipseCurve=Vc;c.SplineCurve=sd;c.CubicBezierCurve=td;c.QuadraticBezierCurve=ud;c.LineCurve=Nc;c.Shape=vd;c.ShapePath=Af;c.Path=Ge;c.Font=Bf;c.CurvePath=Fe;c.Curve=rc;c.WireframeGeometry=
Hd;c.ParametricGeometry=ie;c.TetrahedronGeometry=ke;c.TetrahedronBufferGeometry=je;c.OctahedronGeometry=me;c.OctahedronBufferGeometry=le;c.IcosahedronGeometry=oe;c.IcosahedronBufferGeometry=ne;c.DodecahedronGeometry=qe;c.DodecahedronBufferGeometry=pe;c.PolyhedronGeometry=re;c.PolyhedronBufferGeometry=xc;c.TubeGeometry=Gc;c.TorusKnotGeometry=se;c.TorusKnotBufferGeometry=Id;c.TorusGeometry=te;c.TorusBufferGeometry=Jd;c.TextGeometry=ue;c.SphereBufferGeometry=hd;c.SphereGeometry=Kd;c.RingGeometry=ve;
c.RingBufferGeometry=Ld;c.PlaneBufferGeometry=vc;c.PlaneGeometry=we;c.LatheGeometry=xe;c.LatheBufferGeometry=Md;c.ShapeGeometry=Zc;c.ExtrudeGeometry=Cc;c.EdgesGeometry=Nd;c.ConeGeometry=ye;c.ConeBufferGeometry=ze;c.CylinderGeometry=id;c.CylinderBufferGeometry=$c;c.CircleBufferGeometry=Od;c.CircleGeometry=Ae;c.BoxBufferGeometry=Jc;c.BoxGeometry=jd;c.ShadowMaterial=Pd;c.SpriteMaterial=Bc;c.RawShaderMaterial=Qd;c.ShaderMaterial=ob;c.PointsMaterial=Fc;c.MultiMaterial=Be;c.MeshPhysicalMaterial=kd;c.MeshStandardMaterial=
Mc;c.MeshPhongMaterial=ad;c.MeshNormalMaterial=ld;c.MeshLambertMaterial=md;c.MeshDepthMaterial=nb;c.MeshBasicMaterial=bc;c.LineDashedMaterial=nd;c.LineBasicMaterial=gc;c.Material=za;c.REVISION="82dev";c.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};c.CullFaceNone=0;c.CullFaceBack=1;c.CullFaceFront=2;c.CullFaceFrontBack=3;c.FrontFaceDirectionCW=0;c.FrontFaceDirectionCCW=1;c.BasicShadowMap=0;c.PCFShadowMap=1;c.PCFSoftShadowMap=2;c.FrontSide=0;c.BackSide=1;c.DoubleSide=2;c.FlatShading=1;c.SmoothShading=2;c.NoColors=
0;c.FaceColors=1;c.VertexColors=2;c.NoBlending=0;c.NormalBlending=1;c.AdditiveBlending=2;c.SubtractiveBlending=3;c.MultiplyBlending=4;c.CustomBlending=5;c.BlendingMode=jg;c.AddEquation=100;c.SubtractEquation=101;c.ReverseSubtractEquation=102;c.MinEquation=103;c.MaxEquation=104;c.ZeroFactor=200;c.OneFactor=201;c.SrcColorFactor=202;c.OneMinusSrcColorFactor=203;c.SrcAlphaFactor=204;c.OneMinusSrcAlphaFactor=205;c.DstAlphaFactor=206;c.OneMinusDstAlphaFactor=207;c.DstColorFactor=208;c.OneMinusDstColorFactor=
209;c.SrcAlphaSaturateFactor=210;c.NeverDepth=0;c.AlwaysDepth=1;c.LessDepth=2;c.LessEqualDepth=3;c.EqualDepth=4;c.GreaterEqualDepth=5;c.GreaterDepth=6;c.NotEqualDepth=7;c.MultiplyOperation=0;c.MixOperation=1;c.AddOperation=2;c.NoToneMapping=0;c.LinearToneMapping=1;c.ReinhardToneMapping=2;c.Uncharted2ToneMapping=3;c.CineonToneMapping=4;c.UVMapping=300;c.CubeReflectionMapping=301;c.CubeRefractionMapping=302;c.EquirectangularReflectionMapping=303;c.EquirectangularRefractionMapping=304;c.SphericalReflectionMapping=
305;c.CubeUVReflectionMapping=306;c.CubeUVRefractionMapping=307;c.TextureMapping=kg;c.RepeatWrapping=1E3;c.ClampToEdgeWrapping=1001;c.MirroredRepeatWrapping=1002;c.TextureWrapping=Qf;c.NearestFilter=1003;c.NearestMipMapNearestFilter=1004;c.NearestMipMapLinearFilter=1005;c.LinearFilter=1006;c.LinearMipMapNearestFilter=1007;c.LinearMipMapLinearFilter=1008;c.TextureFilter=Rf;c.UnsignedByteType=1009;c.ByteType=1010;c.ShortType=1011;c.UnsignedShortType=1012;c.IntType=1013;c.UnsignedIntType=1014;c.FloatType=
1015;c.HalfFloatType=1016;c.UnsignedShort4444Type=1017;c.UnsignedShort5551Type=1018;c.UnsignedShort565Type=1019;c.UnsignedInt248Type=1020;c.AlphaFormat=1021;c.RGBFormat=1022;c.RGBAFormat=1023;c.LuminanceFormat=1024;c.LuminanceAlphaFormat=1025;c.RGBEFormat=1023;c.DepthFormat=1026;c.DepthStencilFormat=1027;c.RGB_S3TC_DXT1_Format=2001;c.RGBA_S3TC_DXT1_Format=2002;c.RGBA_S3TC_DXT3_Format=2003;c.RGBA_S3TC_DXT5_Format=2004;c.RGB_PVRTC_4BPPV1_Format=2100;c.RGB_PVRTC_2BPPV1_Format=2101;c.RGBA_PVRTC_4BPPV1_Format=
2102;c.RGBA_PVRTC_2BPPV1_Format=2103;c.RGB_ETC1_Format=2151;c.LoopOnce=2200;c.LoopRepeat=2201;c.LoopPingPong=2202;c.InterpolateDiscrete=2300;c.InterpolateLinear=2301;c.InterpolateSmooth=2302;c.ZeroCurvatureEnding=2400;c.ZeroSlopeEnding=2401;c.WrapAroundEnding=2402;c.TrianglesDrawMode=0;c.TriangleStripDrawMode=1;c.TriangleFanDrawMode=2;c.LinearEncoding=3E3;c.sRGBEncoding=3001;c.GammaEncoding=3007;c.RGBEEncoding=3002;c.LogLuvEncoding=3003;c.RGBM7Encoding=3004;c.RGBM16Encoding=3005;c.RGBDEncoding=3006;
c.BasicDepthPacking=3200;c.RGBADepthPacking=3201;c.CubeGeometry=jd;c.Face4=function(a,b,d,g,t,w,y){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new Pb(a,b,d,t,w,y)};c.LineStrip=0;c.LinePieces=1;c.MeshFaceMaterial=Be;c.PointCloud=function(a,b){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Fd(a,b)};c.Particle=Yc;c.ParticleSystem=function(a,b){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Fd(a,
b)};c.PointCloudMaterial=function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new Fc(a)};c.ParticleBasicMaterial=function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new Fc(a)};c.ParticleSystemMaterial=function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Fc(a)};c.Vertex=function(a,b,d){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");
return new r(a,b,d)};c.EdgesHelper=function(a,b){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new $b(new Nd(a.geometry),new gc({color:void 0!==b?b:16777215}))};c.WireframeHelper=function(a,b){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new $b(new Hd(a.geometry),new gc({color:void 0!==b?b:16777215}))};c.GeometryUtils={merge:function(a,b,d){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");
if(b.isMesh){b.matrixAutoUpdate&&b.updateMatrix();var g=b.matrix;b=b.geometry}a.merge(b,g,d)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};c.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,d,g){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var t=new $e;t.setCrossOrigin(this.crossOrigin);a=t.load(a,d,void 0,g);b&&(a.mapping=b);return a},
loadTextureCube:function(a,b,d,g){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var t=new xf;t.setCrossOrigin(this.crossOrigin);a=t.load(a,d,void 0,g);b&&(a.mapping=b);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};
c.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};c.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");
this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};Object.defineProperty(c,"__esModule",{value:!0})});
THREE.VREffect=function(c,h){var n,f,q,l,k,u,r,z;function C(S){J=S;0<S.length?H=S[0]:h&&h("HMD not available")}function E(){var S=x.isPresenting;x.isPresenting=void 0!==H&&H.isPresenting;if(x.isPresenting){var R=H.getEyeParameters("left"),W=R.renderWidth;R=R.renderHeight;S||(m=c.getPixelRatio(),G=c.getSize(),c.setPixelRatio(1),c.setSize(2*W,R,!1))}else S&&(c.setPixelRatio(m),c.setSize(G.width,G.height,e))}function A(S,R,W,X){var V=Math.PI/180;var la=Math.tan(S.upDegrees*V);var fa=Math.tan(S.downDegrees*
V),ha=Math.tan(S.leftDegrees*V);S=Math.tan(S.rightDegrees*V);W=void 0===W?.01:W;X=void 0===X?1E4:X;V=void 0===R||R?-1:1;var ba=new THREE.Matrix4,ea=ba.elements,ka=2/(ha+S),O=2/(la+fa);R=[ka,O];la=[(ha-S)*ka*.5,(la-fa)*O*.5];ea[0]=R[0];ea[1]=0;ea[2]=la[0]*V;ea[3]=0;ea[4]=0;ea[5]=R[1];ea[6]=-la[1]*V;ea[7]=0;ea[8]=0;ea[9]=0;ea[10]=X/(W-X)*-V;ea[11]=X*W/(W-X);ea[12]=0;ea[13]=0;ea[14]=V;ea[15]=0;ba.transpose();return ba}var H,J,N=new THREE.Vector3,U=new THREE.Vector3,p=null;"VRFrameData"in window&&(p=
new VRFrameData);navigator.getVRDisplays&&navigator.getVRDisplays().then(C);this.isPresenting=!1;this.scale=1;var x=this,G=c.getSize(),e=!1,m=c.getPixelRatio();this.getVRDisplay=function(){return H};this.setVRDisplay=function(S){H=S};this.getVRDisplays=function(){console.warn("THREE.VREffect: getVRDisplays() is being deprecated.");return J};this.setSize=function(S,R,W){G={width:S,height:R};e=W;x.isPresenting?(S=H.getEyeParameters("left"),c.setPixelRatio(1),c.setSize(2*S.renderWidth,S.renderHeight,
!1)):(c.setPixelRatio(m),c.setSize(S,R,W))};var v=c.domElement,D=[0,0,.5,1],B=[.5,0,.5,1];window.addEventListener("vrdisplaypresentchange",E,!1);this.setFullScreen=function(S){return new Promise(function(R,W){void 0===H?W(Error("No VR hardware found.")):x.isPresenting===S?R():S?R(H.requestPresent([{source:v}])):R(H.exitPresent())})};this.requestPresent=function(){return this.setFullScreen(!0)};this.exitPresent=function(){return this.setFullScreen(!1)};this.requestAnimationFrame=function(S){return void 0!==
H?H.requestAnimationFrame(S):window.requestAnimationFrame(S)};this.cancelAnimationFrame=function(S){void 0!==H?H.cancelAnimationFrame(S):window.cancelAnimationFrame(S)};this.submitFrame=function(){void 0!==H&&x.isPresenting&&H.submitFrame()};this.autoSubmitFrame=!0;var I=new THREE.PerspectiveCamera;I.layers.enable(1);var L=new THREE.PerspectiveCamera;L.layers.enable(2);this.render=function(S,R,W,X){if(H&&x.isPresenting){var V=S.autoUpdate;V&&(S.updateMatrixWorld(),S.autoUpdate=!1);var la=H.getEyeParameters("left"),
fa=H.getEyeParameters("right");N.fromArray(la.offset);U.fromArray(fa.offset);Array.isArray(S)&&(console.warn("THREE.VREffect.render() no longer supports arrays. Use object.layers instead."),S=S[0]);var ha=c.getSize(),ba=H.getLayers();if(ba.length){var ea=ba[0];ba=null!==ea.leftBounds&&4===ea.leftBounds.length?ea.leftBounds:D;ea=null!==ea.rightBounds&&4===ea.rightBounds.length?ea.rightBounds:B}else ba=D,ea=B;k=Math.round(ha.width*ba[0]);u=Math.round(ha.height*ba[1]);r=Math.round(ha.width*ba[2]);z=
Math.round(ha.height*ba[3]);n=Math.round(ha.width*ea[0]);f=Math.round(ha.height*ea[1]);q=Math.round(ha.width*ea[2]);l=Math.round(ha.height*ea[3]);W?(c.setRenderTarget(W),W.scissorTest=!0):(c.setRenderTarget(null),c.setScissorTest(!0));(c.autoClear||X)&&c.clear();null===R.parent&&R.updateMatrixWorld();R.matrixWorld.decompose(I.position,I.quaternion,I.scale);R.matrixWorld.decompose(L.position,L.quaternion,L.scale);ba=this.scale;I.translateOnAxis(N,ba);L.translateOnAxis(U,ba);H.getFrameData?(H.depthNear=
R.near,H.depthFar=R.far,H.getFrameData(p),I.projectionMatrix.elements=p.leftProjectionMatrix,L.projectionMatrix.elements=p.rightProjectionMatrix):(I.projectionMatrix=A(la.fieldOfView,!0,R.near,R.far),L.projectionMatrix=A(fa.fieldOfView,!0,R.near,R.far));W?(W.viewport.set(k,u,r,z),W.scissor.set(k,u,r,z)):(c.setViewport(k,u,r,z),c.setScissor(k,u,r,z));c.render(S,I,W,X);W?(W.viewport.set(n,f,q,l),W.scissor.set(n,f,q,l)):(c.setViewport(n,f,q,l),c.setScissor(n,f,q,l));c.render(S,L,W,X);W?(W.viewport.set(0,
0,ha.width,ha.height),W.scissor.set(0,0,ha.width,ha.height),W.scissorTest=!1,c.setRenderTarget(null)):(c.setViewport(0,0,ha.width,ha.height),c.setScissorTest(!1));V&&(S.autoUpdate=!0);x.autoSubmitFrame&&x.submitFrame()}else c.render(S,R,W,X)};this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",E,!1)}};
!function(c){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=c();else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.CANNON=c()}}(function(){return function q(h,n,f){function l(r,z){if(!n[r]){if(!h[r]){var C="function"==typeof require&&require;if(!z&&C)return C(r,!0);if(k)return k(r,!0);throw Error("Cannot find module '"+r+"'");}z=n[r]={exports:{}};h[r][0].call(z.exports,function(E){var A=h[r][1][E];return l(A?
A:E)},z,z.exports,q,h,n,f)}return n[r].exports}for(var k="function"==typeof require&&require,u=0;u<f.length;u++)l(f[u]);return l}({1:[function(h,n){n.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},
bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(h,n){n.exports={version:h("../package.json").version,AABB:h("./collision/AABB"),ArrayCollisionMatrix:h("./collision/ArrayCollisionMatrix"),
Body:h("./objects/Body"),Box:h("./shapes/Box"),Broadphase:h("./collision/Broadphase"),Constraint:h("./constraints/Constraint"),ContactEquation:h("./equations/ContactEquation"),Narrowphase:h("./world/Narrowphase"),ConeTwistConstraint:h("./constraints/ConeTwistConstraint"),ContactMaterial:h("./material/ContactMaterial"),ConvexPolyhedron:h("./shapes/ConvexPolyhedron"),Cylinder:h("./shapes/Cylinder"),DistanceConstraint:h("./constraints/DistanceConstraint"),Equation:h("./equations/Equation"),EventTarget:h("./utils/EventTarget"),
FrictionEquation:h("./equations/FrictionEquation"),GSSolver:h("./solver/GSSolver"),GridBroadphase:h("./collision/GridBroadphase"),Heightfield:h("./shapes/Heightfield"),HingeConstraint:h("./constraints/HingeConstraint"),LockConstraint:h("./constraints/LockConstraint"),Mat3:h("./math/Mat3"),Material:h("./material/Material"),NaiveBroadphase:h("./collision/NaiveBroadphase"),ObjectCollisionMatrix:h("./collision/ObjectCollisionMatrix"),Pool:h("./utils/Pool"),Particle:h("./shapes/Particle"),Plane:h("./shapes/Plane"),
PointToPointConstraint:h("./constraints/PointToPointConstraint"),Quaternion:h("./math/Quaternion"),Ray:h("./collision/Ray"),RaycastVehicle:h("./objects/RaycastVehicle"),RaycastResult:h("./collision/RaycastResult"),RigidVehicle:h("./objects/RigidVehicle"),RotationalEquation:h("./equations/RotationalEquation"),RotationalMotorEquation:h("./equations/RotationalMotorEquation"),SAPBroadphase:h("./collision/SAPBroadphase"),SPHSystem:h("./objects/SPHSystem"),Shape:h("./shapes/Shape"),Solver:h("./solver/Solver"),
Sphere:h("./shapes/Sphere"),SplitSolver:h("./solver/SplitSolver"),Spring:h("./objects/Spring"),Trimesh:h("./shapes/Trimesh"),Vec3:h("./math/Vec3"),Vec3Pool:h("./utils/Vec3Pool"),World:h("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,
"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,
"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(h,n){function f(u){u=u||{};this.lowerBound=
new q;u.lowerBound&&this.lowerBound.copy(u.lowerBound);this.upperBound=new q;u.upperBound&&this.upperBound.copy(u.upperBound)}var q=h("../math/Vec3");h("../utils/Utils");n.exports=f;var l=new q;f.prototype.setFromPoints=function(u,r,z,C){var E=this.lowerBound,A=this.upperBound;E.copy(u[0]);z&&z.vmult(E,E);A.copy(E);for(var H=1;H<u.length;H++){var J=u[H];z&&(z.vmult(J,l),J=l);J.x>A.x&&(A.x=J.x);J.x<E.x&&(E.x=J.x);J.y>A.y&&(A.y=J.y);J.y<E.y&&(E.y=J.y);J.z>A.z&&(A.z=J.z);J.z<E.z&&(E.z=J.z)}return r&&
(r.vadd(E,E),r.vadd(A,A)),C&&(E.x-=C,E.y-=C,E.z-=C,A.x+=C,A.y+=C,A.z+=C),this};f.prototype.copy=function(u){return this.lowerBound.copy(u.lowerBound),this.upperBound.copy(u.upperBound),this};f.prototype.clone=function(){return(new f).copy(this)};f.prototype.extend=function(u){var r=u.lowerBound.x;this.lowerBound.x>r&&(this.lowerBound.x=r);r=u.upperBound.x;this.upperBound.x<r&&(this.upperBound.x=r);r=u.lowerBound.y;this.lowerBound.y>r&&(this.lowerBound.y=r);r=u.upperBound.y;this.upperBound.y<r&&(this.upperBound.y=
r);r=u.lowerBound.z;this.lowerBound.z>r&&(this.lowerBound.z=r);r=u.upperBound.z;this.upperBound.z<r&&(this.upperBound.z=r)};f.prototype.overlaps=function(u){var r=this.lowerBound,z=this.upperBound,C=u.lowerBound;u=u.upperBound;return(C.x<=z.x&&z.x<=u.x||r.x<=u.x&&u.x<=z.x)&&(C.y<=z.y&&z.y<=u.y||r.y<=u.y&&u.y<=z.y)&&(C.z<=z.z&&z.z<=u.z||r.z<=u.z&&u.z<=z.z)};f.prototype.contains=function(u){var r=this.lowerBound,z=this.upperBound,C=u.lowerBound;u=u.upperBound;return r.x<=C.x&&z.x>=u.x&&r.y<=C.y&&z.y>=
u.y&&r.z<=C.z&&z.z>=u.z};f.prototype.getCorners=function(u,r,z,C,E,A,H,J){var N=this.lowerBound,U=this.upperBound;u.copy(N);r.set(U.x,N.y,N.z);z.set(U.x,U.y,N.z);C.set(N.x,U.y,U.z);E.set(U.x,N.y,N.z);A.set(N.x,U.y,N.z);H.set(N.x,N.y,U.z);J.copy(U)};var k=[new q,new q,new q,new q,new q,new q,new q,new q];f.prototype.toLocalFrame=function(u,r){this.getCorners(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7]);for(var z=0;8!==z;z++){var C=k[z];u.pointToLocal(C,C)}return r.setFromPoints(k)};f.prototype.toWorldFrame=
function(u,r){this.getCorners(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7]);for(var z=0;8!==z;z++){var C=k[z];u.pointToWorld(C,C)}return r.setFromPoints(k)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(h,n){function f(){this.matrix=[]}n.exports=f;f.prototype.get=function(q,l){if(q=q.index,l=l.index,l>q){var k=l;l=q;q=k}return this.matrix[(q*(q+1)>>1)+l-1]};f.prototype.set=function(q,l,k){if(q=q.index,l=l.index,l>q){var u=l;l=q;q=u}this.matrix[(q*(q+1)>>1)+l-1]=k?1:0};f.prototype.reset=function(){for(var q=
0,l=this.matrix.length;q!==l;q++)this.matrix[q]=0};f.prototype.setNumObjects=function(q){this.matrix.length=q*(q-1)>>1}},{}],5:[function(h,n){function f(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}var q=h("../objects/Body"),l=h("../math/Vec3"),k=h("../math/Quaternion");h("../shapes/Shape");h("../shapes/Plane");n.exports=f;f.prototype.collisionPairs=function(){throw Error("collisionPairs not implemented for this BroadPhase class!");};var u=q.STATIC|q.KINEMATIC;f.prototype.needBroadphaseCollision=
function(H,J){return 0===(H.collisionFilterGroup&J.collisionFilterMask)||0===(J.collisionFilterGroup&H.collisionFilterMask)?!1:0===(H.type&u)&&H.sleepState!==q.SLEEPING||0===(J.type&u)&&J.sleepState!==q.SLEEPING?!0:!1};f.prototype.intersectionTest=function(H,J,N,U){this.useBoundingBoxes?this.doBoundingBoxBroadphase(H,J,N,U):this.doBoundingSphereBroadphase(H,J,N,U)};var r=new l;new l;new k;new l;f.prototype.doBoundingSphereBroadphase=function(H,J,N,U){J.position.vsub(H.position,r);var p=Math.pow(H.boundingRadius+
J.boundingRadius,2),x=r.norm2();p>x&&(N.push(H),U.push(J))};f.prototype.doBoundingBoxBroadphase=function(H,J,N,U){H.aabbNeedsUpdate&&H.computeAABB();J.aabbNeedsUpdate&&J.computeAABB();H.aabb.overlaps(J.aabb)&&(N.push(H),U.push(J))};var z={keys:[]},C=[],E=[];f.prototype.makePairsUnique=function(H,J){for(var N=H.length,U=0;U!==N;U++)C[U]=H[U],E[U]=J[U];H.length=0;for(U=J.length=0;U!==N;U++){var p=C[U].id,x=E[U].id;p=x>p?p+","+x:x+","+p;z[p]=U;z.keys.push(p)}for(U=0;U!==z.keys.length;U++)p=z.keys.pop(),
N=z[p],H.push(C[N]),J.push(E[N]),delete z[p]};f.prototype.setWorld=function(){};var A=new l;f.boundingSphereCheck=function(H,J){return H.position.vsub(J.position,A),Math.pow(H.shape.boundingSphereRadius+J.shape.boundingSphereRadius,2)>A.norm2()};f.prototype.aabbQuery=function(){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(h,n){function f(r,
z,C,E,A){q.apply(this);this.nx=C||10;this.ny=E||10;this.nz=A||10;this.aabbMin=r||new l(100,100,100);this.aabbMax=z||new l(-100,-100,-100);r=this.nx*this.ny*this.nz;if(0>=r)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[];this.binLengths=[];this.bins.length=r;this.binLengths.length=r;for(z=0;r>z;z++)this.bins[z]=[],this.binLengths[z]=0}n.exports=f;var q=h("./Broadphase"),l=h("../math/Vec3"),k=h("../shapes/Shape");f.prototype=new q;f.prototype.constructor=f;var u=new l;new l;f.prototype.collisionPairs=
function(r,z,C){function E(nb,Ab,rb,Mb,Nb,jc,yd){nb=(nb-B)*S|0;Ab=(Ab-I)*R|0;rb=(rb-L)*W|0;Mb=ea((Mb-B)*S);Nb=ea((Nb-I)*R);jc=ea((jc-L)*W);0>nb?nb=0:nb>=N&&(nb=N-1);0>Ab?Ab=0:Ab>=U&&(Ab=U-1);0>rb?rb=0:rb>=p&&(rb=p-1);0>Mb?Mb=0:Mb>=N&&(Mb=N-1);0>Nb?Nb=0:Nb>=U&&(Nb=U-1);0>jc?jc=0:jc>=p&&(jc=p-1);nb*=x;Ab*=G;rb*=e;Mb*=x;Nb*=G;for(jc*=e;Mb>=nb;nb+=x)for(var sc=Ab;Nb>=sc;sc+=G)for(var tc=rb;jc>=tc;tc+=e){var Oc=nb+sc+tc;ha[Oc][ba[Oc]++]=yd}}var A=r.numObjects();r=r.bodies;var H=this.aabbMax,J=this.aabbMin,
N=this.nx,U=this.ny,p=this.nz,x=U*p,G=p,e=1,m=H.x,v=H.y,D=H.z,B=J.x,I=J.y,L=J.z,S=N/(m-B),R=U/(v-I),W=p/(D-L);m=(m-B)/N;var X=(v-I)/U;D=(D-L)/p;var V=.5*Math.sqrt(m*m+X*X+D*D);v=k.types;var la=v.SPHERE,fa=v.PLANE,ha=(v.BOX,v.COMPOUND,v.CONVEXPOLYHEDRON,this.bins),ba=this.binLengths;v=this.bins.length;for(J=0;J!==v;J++)ba[J]=0;var ea=Math.ceil;J=Math.min;H=Math.max;for(J=0;J!==A;J++){H=r[J];var ka=H.shape;switch(ka.type){case la:var O=H.position.x,Y=H.position.y,da=H.position.z;ka=ka.radius;E(O-ka,
Y-ka,da-ka,O+ka,Y+ka,da+ka,H);break;case fa:ka.worldNormalNeedsUpdate&&ka.computeWorldNormal(H.quaternion);da=ka.worldNormal;ka=I+.5*X-H.position.y;var pa=L+.5*D-H.position.z,ma=u;ma.set(B+.5*m-H.position.x,ka,pa);for(var wa=O=0;O!==N;O++,wa+=x,ma.y=ka,ma.x+=m)for(var Ca=Y=0;Y!==U;Y++,Ca+=G,ma.z=pa,ma.y+=X)for(var ya=0,za=0;ya!==p;ya++,za+=e,ma.z+=D)if(ma.dot(da)<V){var ob=wa+Ca+za;ha[ob][ba[ob]++]=H}break;default:H.aabbNeedsUpdate&&H.computeAABB(),E(H.aabb.lowerBound.x,H.aabb.lowerBound.y,H.aabb.lowerBound.z,
H.aabb.upperBound.x,H.aabb.upperBound.y,H.aabb.upperBound.z,H)}}for(J=0;J!==v;J++)if(A=ba[J],1<A)for(r=ha[J],O=0;O!==A;O++)for(H=r[O],Y=0;Y!==O;Y++)m=r[Y],this.needBroadphaseCollision(H,m)&&this.intersectionTest(H,m,z,C);this.makePairsUnique(z,C)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(h,n){function f(){q.apply(this)}n.exports=f;var q=h("./Broadphase");h=h("./AABB");f.prototype=new q;f.prototype.constructor=f;f.prototype.collisionPairs=function(l,k,u){var r,z=l.bodies,
C=z.length;for(l=0;l!==C;l++)for(r=0;r!==l;r++){var E=z[l];var A=z[r];this.needBroadphaseCollision(E,A)&&this.intersectionTest(E,A,k,u)}};new h;f.prototype.aabbQuery=function(l,k,u){u=u||[];for(var r=0;r<l.bodies.length;r++){var z=l.bodies[r];z.aabbNeedsUpdate&&z.computeAABB();z.aabb.overlaps(k)&&u.push(z)}return u}},{"./AABB":3,"./Broadphase":5}],8:[function(h,n){function f(){this.matrix={}}n.exports=f;f.prototype.get=function(q,l){if(q=q.id,l=l.id,l>q){var k=l;l=q;q=k}return q+"-"+l in this.matrix};
f.prototype.set=function(q,l,k){if(q=q.id,l=l.id,l>q){var u=l;l=q;q=u}k?this.matrix[q+"-"+l]=!0:delete this.matrix[q+"-"+l]};f.prototype.reset=function(){this.matrix={}};f.prototype.setNumObjects=function(){}},{}],9:[function(h,n){function f(ha,ba){this.from=ha?ha.clone():new l;this.to=ba?ba.clone():new l;this._direction=new l;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=f.ANY;this.result=new u;this.hasHit=
!1;this.callback=function(){}}function q(ha,ba,ea,ka){ka.vsub(ba,la);ea.vsub(ba,E);ha.vsub(ba,A);var O,Y;ha=la.dot(la);ba=la.dot(E);ea=la.dot(A);ka=E.dot(E);var da=E.dot(A);return 0<=(O=ka*ea-ba*da)&&0<=(Y=ha*da-ba*ea)&&ha*ka-ba*ba>O+Y}n.exports=f;var l=h("../math/Vec3");n=h("../math/Quaternion");var k=h("../math/Transform"),u=(h("../shapes/ConvexPolyhedron"),h("../shapes/Box"),h("../collision/RaycastResult")),r=h("../shapes/Shape");h=h("../collision/AABB");f.prototype.constructor=f;f.CLOSEST=1;f.ANY=
2;f.ALL=4;var z=new h,C=[];f.prototype.intersectWorld=function(ha,ba){return this.mode=ba.mode||f.ANY,this.result=ba.result||new u,this.skipBackfaces=!!ba.skipBackfaces,this.collisionFilterMask="undefined"!=typeof ba.collisionFilterMask?ba.collisionFilterMask:-1,this.collisionFilterGroup="undefined"!=typeof ba.collisionFilterGroup?ba.collisionFilterGroup:-1,ba.from&&this.from.copy(ba.from),ba.to&&this.to.copy(ba.to),this.callback=ba.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),
this.getAABB(z),C.length=0,ha.broadphase.aabbQuery(ha,z,C),this.intersectBodies(C),this.hasHit};var E=new l,A=new l;f.pointInTriangle=q;var H=new l,J=new n;f.prototype.intersectBody=function(ha,ba){ba&&(this.result=ba,this._updateDirection());ba=this.checkCollisionResponse;if((!ba||ha.collisionResponse)&&0!==(this.collisionFilterGroup&ha.collisionFilterMask)&&0!==(ha.collisionFilterGroup&this.collisionFilterMask))for(var ea=0,ka=ha.shapes.length;ka>ea;ea++){var O=ha.shapes[ea];if((!ba||O.collisionResponse)&&
(ha.quaternion.mult(ha.shapeOrientations[ea],J),ha.quaternion.vmult(ha.shapeOffsets[ea],H),H.vadd(ha.position,H),this.intersectShape(O,J,H,ha),this.result._shouldStop))break}};f.prototype.intersectBodies=function(ha,ba){ba&&(this.result=ba,this._updateDirection());ba=0;for(var ea=ha.length;!this.result._shouldStop&&ea>ba;ba++)this.intersectBody(ha[ba])};f.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction);this._direction.normalize()};f.prototype.intersectShape=function(ha,
ba,ea,ka){var O=this.from,Y=this._direction;ea.vsub(O,la);var da=la.dot(Y);Y.mult(da,fa);fa.vadd(O,fa);ea.distanceTo(fa)>ha.boundingSphereRadius||(O=this[ha.type])&&O.call(this,ha,ba,ea,ka)};var N=(new l,new l,new l),U=new l,p=new l,x=new l;new l;new u;f.prototype.intersectBox=function(ha,ba,ea,ka){return this.intersectConvex(ha.convexPolyhedronRepresentation,ba,ea,ka)};f.prototype[r.types.BOX]=f.prototype.intersectBox;f.prototype.intersectPlane=function(ha,ba,ea,ka){var O=this.from,Y=this.to,da=
this._direction,pa=new l(0,0,1);ba.vmult(pa,pa);var ma=new l;O.vsub(ea,ma);ba=ma.dot(pa);Y.vsub(ea,ma);ma=ma.dot(pa);if(!(0<ba*ma||O.distanceTo(Y)<ba||(ma=pa.dot(da),Math.abs(ma)<this.precision))){var wa=new l;Y=new l;ba=new l;O.vsub(ea,wa);ea=-pa.dot(wa)/ma;da.scale(ea,Y);O.vadd(Y,ba);this.reportIntersection(pa,ba,ha,ka,-1)}};f.prototype[r.types.PLANE]=f.prototype.intersectPlane;f.prototype.getAABB=function(ha){var ba=this.to,ea=this.from;ha.lowerBound.x=Math.min(ba.x,ea.x);ha.lowerBound.y=Math.min(ba.y,
ea.y);ha.lowerBound.z=Math.min(ba.z,ea.z);ha.upperBound.x=Math.max(ba.x,ea.x);ha.upperBound.y=Math.max(ba.y,ea.y);ha.upperBound.z=Math.max(ba.z,ea.z)};var G={faceList:[0]};f.prototype.intersectHeightfield=function(ha,ba,ea,ka){var O=(ha.data,ha.elementSize,new l),Y=new f(this.from,this.to);k.pointToLocalFrame(ea,ba,Y.from,Y.from);k.pointToLocalFrame(ea,ba,Y.to,Y.to);var da=[],pa=null,ma=null,wa=null,Ca=null,ya=ha.getIndexOfPosition(Y.from.x,Y.from.y,da,!1);if(ya&&(pa=da[0],ma=da[1],wa=da[0],Ca=da[1]),
ya=ha.getIndexOfPosition(Y.to.x,Y.to.y,da,!1),ya&&((null===pa||da[0]<pa)&&(pa=da[0]),(null===wa||da[0]>wa)&&(wa=da[0]),(null===ma||da[1]<ma)&&(ma=da[1]),(null===Ca||da[1]>Ca)&&(Ca=da[1])),null!==pa)for(Y=[],ha.getRectMinMax(pa,ma,wa,Ca,Y),pa=(Y[0],Y[1],pa);wa>=pa;pa++)for(Y=ma;Ca>=Y;Y++){if(this.result._shouldStop||(ha.getConvexTrianglePillar(pa,Y,!1),k.pointToWorldFrame(ea,ba,ha.pillarOffset,O),this.intersectConvex(ha.pillarConvex,ba,O,ka,G),this.result._shouldStop))return;ha.getConvexTrianglePillar(pa,
Y,!0);k.pointToWorldFrame(ea,ba,ha.pillarOffset,O);this.intersectConvex(ha.pillarConvex,ba,O,ka,G)}};f.prototype[r.types.HEIGHTFIELD]=f.prototype.intersectHeightfield;var e=new l,m=new l;f.prototype.intersectSphere=function(ha,ba,ea,ka){ba=this.from;var O=this.to,Y=Math.pow(O.x-ba.x,2)+Math.pow(O.y-ba.y,2)+Math.pow(O.z-ba.z,2),da=2*((O.x-ba.x)*(ba.x-ea.x)+(O.y-ba.y)*(ba.y-ea.y)+(O.z-ba.z)*(ba.z-ea.z)),pa=Math.pow(da,2)-4*Y*(Math.pow(ba.x-ea.x,2)+Math.pow(ba.y-ea.y,2)+Math.pow(ba.z-ea.z,2)-Math.pow(ha.radius,
2));if(!(0>pa))if(0===pa)ba.lerp(O,pa,e),e.vsub(ea,m),m.normalize(),this.reportIntersection(m,e,ha,ka,-1);else{var ma=(-da-Math.sqrt(pa))/(2*Y);Y=(-da+Math.sqrt(pa))/(2*Y);(0<=ma&&1>=ma&&(ba.lerp(O,ma,e),e.vsub(ea,m),m.normalize(),this.reportIntersection(m,e,ha,ka,-1)),this.result._shouldStop)||0<=Y&&1>=Y&&(ba.lerp(O,Y,e),e.vsub(ea,m),m.normalize(),this.reportIntersection(m,e,ha,ka,-1))}};f.prototype[r.types.SPHERE]=f.prototype.intersectSphere;var v=new l,D=(new l,new l,new l);f.prototype.intersectConvex=
function(ha,ba,ea,ka,O){O=O&&O.faceList||null;for(var Y=ha.faces,da=ha.vertices,pa=ha.faceNormals,ma=this._direction,wa=this.from,Ca=wa.distanceTo(this.to),ya=O?O.length:Y.length,za=this.result,ob=0;!za._shouldStop&&ya>ob;ob++){var nb=O?O[ob]:ob,Ab=Y[nb],rb=pa[nb],Mb=ba,Nb=ea;D.copy(da[Ab[0]]);Mb.vmult(D,D);D.vadd(Nb,D);D.vsub(wa,D);Mb.vmult(rb,v);rb=ma.dot(v);if(!(Math.abs(rb)<this.precision||(rb=v.dot(D)/rb,0>rb)))for(ma.mult(rb,N),N.vadd(wa,N),U.copy(da[Ab[0]]),Mb.vmult(U,U),Nb.vadd(U,U),rb=1;!za._shouldStop&&
rb<Ab.length-1;rb++){p.copy(da[Ab[rb]]);x.copy(da[Ab[rb+1]]);Mb.vmult(p,p);Mb.vmult(x,x);Nb.vadd(p,p);Nb.vadd(x,x);var jc=N.distanceTo(wa);!q(N,U,p,x)&&!q(N,p,U,x)||jc>Ca||this.reportIntersection(v,N,ha,ka,nb)}}};f.prototype[r.types.CONVEXPOLYHEDRON]=f.prototype.intersectConvex;var B=new l,I=new l,L=new l,S=new l,R=new l,W=new l,X=(new h,[]),V=new k;f.prototype.intersectTrimesh=function(ha,ba,ea,ka,O){O=(O&&O.faceList||null,ha.indices);var Y=(ha.vertices,ha.faceNormals,this.from),da=this.to,pa=this._direction;
V.position.copy(ea);V.quaternion.copy(ba);k.vectorToLocalFrame(ea,ba,pa,I);k.pointToLocalFrame(ea,ba,Y,L);k.pointToLocalFrame(ea,ba,da,S);Y=L.distanceSquared(S);ha.tree.rayQuery(this,V,X);da=0;for(pa=X.length;!this.result._shouldStop&&da!==pa;da++){var ma=X[da];ha.getNormal(ma,B);ha.getVertex(O[3*ma],U);U.vsub(L,D);var wa=I.dot(B);wa=B.dot(D)/wa;0>wa||(I.scale(wa,N),N.vadd(L,N),ha.getVertex(O[3*ma+1],p),ha.getVertex(O[3*ma+2],x),wa=N.distanceSquared(L),!q(N,p,U,x)&&!q(N,U,p,x)||wa>Y||(k.vectorToWorldFrame(ba,
B,R),k.pointToWorldFrame(ea,ba,N,W),this.reportIntersection(R,W,ha,ka,ma)))}X.length=0};f.prototype[r.types.TRIMESH]=f.prototype.intersectTrimesh;f.prototype.reportIntersection=function(ha,ba,ea,ka,O){var Y=this.from,da=this.to,pa=Y.distanceTo(ba),ma=this.result;if(!(this.skipBackfaces&&0<ha.dot(this._direction)))switch(ma.hitFaceIndex="undefined"!=typeof O?O:-1,this.mode){case f.ALL:this.hasHit=!0;ma.set(Y,da,ha,ba,ea,ka,pa);ma.hasHit=!0;this.callback(ma);break;case f.CLOSEST:(pa<ma.distance||!ma.hasHit)&&
(this.hasHit=!0,ma.hasHit=!0,ma.set(Y,da,ha,ba,ea,ka,pa));break;case f.ANY:this.hasHit=!0,ma.hasHit=!0,ma.set(Y,da,ha,ba,ea,ka,pa),ma._shouldStop=!0}};var la=new l,fa=new l},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(h,n){function f(){this.rayFromWorld=new q;this.rayToWorld=new q;this.hitNormalWorld=new q;this.hitPointWorld=new q;this.hasHit=
!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var q=h("../math/Vec3");n.exports=f;f.prototype.reset=function(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1};f.prototype.abort=function(){this._shouldStop=!0};f.prototype.set=function(l,k,u,r,z,C,E){this.rayFromWorld.copy(l);this.rayToWorld.copy(k);this.hitNormalWorld.copy(u);
this.hitPointWorld.copy(r);this.shape=z;this.body=C;this.distance=E}},{"../math/Vec3":30}],11:[function(h,n){function f(l){q.apply(this);this.axisList=[];this.world=null;this.axisIndex=0;var k=this.axisList;this._addBodyHandler=function(u){k.push(u.body)};this._removeBodyHandler=function(u){u=k.indexOf(u.body);-1!==u&&k.splice(u,1)};l&&this.setWorld(l)}var q=(h("../shapes/Shape"),h("../collision/Broadphase"));n.exports=f;f.prototype=new q;f.prototype.setWorld=function(l){for(var k=this.axisList.length=
0;k<l.bodies.length;k++)this.axisList.push(l.bodies[k]);l.removeEventListener("addBody",this._addBodyHandler);l.removeEventListener("removeBody",this._removeBodyHandler);l.addEventListener("addBody",this._addBodyHandler);l.addEventListener("removeBody",this._removeBodyHandler);this.world=l;this.dirty=!0};f.insertionSortX=function(l){for(var k=1,u=l.length;u>k;k++){for(var r=l[k],z=k-1;0<=z&&!(l[z].aabb.lowerBound.x<=r.aabb.lowerBound.x);z--)l[z+1]=l[z];l[z+1]=r}return l};f.insertionSortY=function(l){for(var k=
1,u=l.length;u>k;k++){for(var r=l[k],z=k-1;0<=z&&!(l[z].aabb.lowerBound.y<=r.aabb.lowerBound.y);z--)l[z+1]=l[z];l[z+1]=r}return l};f.insertionSortZ=function(l){for(var k=1,u=l.length;u>k;k++){for(var r=l[k],z=k-1;0<=z&&!(l[z].aabb.lowerBound.z<=r.aabb.lowerBound.z);z--)l[z+1]=l[z];l[z+1]=r}return l};f.prototype.collisionPairs=function(l,k,u){var r,z=this.axisList,C=z.length,E=this.axisIndex;this.dirty&&(this.sortList(),this.dirty=!1);for(l=0;l!==C;l++){var A=z[l];for(r=l+1;C>r;r++){var H=z[r];if(this.needBroadphaseCollision(A,
H)){if(!f.checkBounds(A,H,E))break;this.intersectionTest(A,H,k,u)}}}};f.prototype.sortList=function(){for(var l=this.axisList,k=this.axisIndex,u=l.length,r=0;r!==u;r++){var z=l[r];z.aabbNeedsUpdate&&z.computeAABB()}0===k?f.insertionSortX(l):1===k?f.insertionSortY(l):2===k&&f.insertionSortZ(l)};f.checkBounds=function(l,k,u){var r,z;0===u?(r=l.position.x,z=k.position.x):1===u?(r=l.position.y,z=k.position.y):2===u&&(r=l.position.z,z=k.position.z);return r+l.boundingRadius>z-k.boundingRadius};f.prototype.autoDetectAxis=
function(){for(var l=0,k=0,u=0,r=0,z=0,C=0,E=this.axisList,A=E.length,H=1/A,J=0;J!==A;J++){var N=E[J],U=N.position.x;l+=U;k+=U*U;U=N.position.y;u+=U;r+=U*U;N=N.position.z;z+=N;C+=N*N}l=k-l*l*H;u=r-u*u*H;z=C-z*z*H;this.axisIndex=l>u?l>z?0:2:u>z?1:2};f.prototype.aabbQuery=function(l,k,u){u=u||[];this.dirty&&(this.sortList(),this.dirty=!1);l=this.axisIndex;var r="x";1===l&&(r="y");2===l&&(r="z");l=this.axisList;for(r=(k.lowerBound[r],k.upperBound[r],0);r<l.length;r++){var z=l[r];z.aabbNeedsUpdate&&z.computeAABB();
z.aabb.overlaps(k)&&u.push(z)}return u}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(h,n){function f(r,z,C){C=C||{};var E="undefined"!=typeof C.maxForce?C.maxForce:1E6,A=C.pivotA?C.pivotA.clone():new u,H=C.pivotB?C.pivotB.clone():new u;this.axisA=C.axisA?C.axisA.clone():new u;this.axisB=C.axisB?C.axisB.clone():new u;q.call(this,r,A,z,H,E);this.collideConnected=!!C.collideConnected;this.angle="undefined"!=typeof C.angle?C.angle:0;A=this.coneEquation=new l(r,z,C);r=this.twistEquation=
new k(r,z,C);this.twistAngle="undefined"!=typeof C.twistAngle?C.twistAngle:0;A.maxForce=0;A.minForce=-E;r.maxForce=0;r.minForce=-E;this.equations.push(A,r)}n.exports=f;var q=(h("./Constraint"),h("./PointToPointConstraint")),l=h("../equations/ConeEquation"),k=h("../equations/RotationalEquation"),u=(h("../equations/ContactEquation"),h("../math/Vec3"));f.prototype=new q;f.constructor=f;new u;new u;f.prototype.update=function(){var r=this.bodyA,z=this.bodyB,C=this.coneEquation,E=this.twistEquation;q.prototype.update.call(this);
r.vectorToWorldFrame(this.axisA,C.axisA);z.vectorToWorldFrame(this.axisB,C.axisB);this.axisA.tangents(E.axisA,E.axisA);r.vectorToWorldFrame(E.axisA,E.axisA);this.axisB.tangents(E.axisB,E.axisB);z.vectorToWorldFrame(E.axisB,E.axisB);C.angle=this.angle;E.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(h,n){function f(l,k,u){u=q.defaults(u,
{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=l;this.bodyB=k;this.id=f.idCounter++;this.collideConnected=u.collideConnected;u.wakeUpBodies&&(l&&l.wakeUp(),k&&k.wakeUp())}n.exports=f;var q=h("../utils/Utils");f.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};f.prototype.enable=function(){for(var l=this.equations,k=0;k<l.length;k++)l[k].enabled=!0};f.prototype.disable=function(){for(var l=this.equations,k=0;k<l.length;k++)l[k].enabled=
!1};f.idCounter=0},{"../utils/Utils":53}],14:[function(h,n){function f(k,u,r,z){q.call(this,k,u);"undefined"==typeof r&&(r=k.position.distanceTo(u.position));"undefined"==typeof z&&(z=1E6);this.distance=r;k=this.distanceEquation=new l(k,u);this.equations.push(k);k.minForce=-z;k.maxForce=z}n.exports=f;var q=h("./Constraint"),l=h("../equations/ContactEquation");f.prototype=new q;f.prototype.update=function(){var k=this.distanceEquation,u=.5*this.distance,r=k.ni;this.bodyB.position.vsub(this.bodyA.position,
r);r.normalize();r.mult(u,k.ri);r.mult(-u,k.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(h,n){function f(C,E,A){A=A||{};var H="undefined"!=typeof A.maxForce?A.maxForce:1E6,J=A.pivotA?A.pivotA.clone():new u,N=A.pivotB?A.pivotB.clone():new u;q.call(this,C,J,E,N,H);(this.axisA=A.axisA?A.axisA.clone():new u(1,0,0)).normalize();(this.axisB=A.axisB?A.axisB.clone():new u(1,0,0)).normalize();J=this.rotationalEquation1=new l(C,E,A);A=this.rotationalEquation2=new l(C,E,A);C=this.motorEquation=
new k(C,E,H);C.enabled=!1;this.equations.push(J,A,C)}n.exports=f;var q=(h("./Constraint"),h("./PointToPointConstraint")),l=h("../equations/RotationalEquation"),k=h("../equations/RotationalMotorEquation"),u=(h("../equations/ContactEquation"),h("../math/Vec3"));f.prototype=new q;f.constructor=f;f.prototype.enableMotor=function(){this.motorEquation.enabled=!0};f.prototype.disableMotor=function(){this.motorEquation.enabled=!1};f.prototype.setMotorSpeed=function(C){this.motorEquation.targetVelocity=C};
f.prototype.setMotorMaxForce=function(C){this.motorEquation.maxForce=C;this.motorEquation.minForce=-C};var r=new u,z=new u;f.prototype.update=function(){var C=this.bodyA,E=this.bodyB,A=this.motorEquation,H=this.rotationalEquation1,J=this.rotationalEquation2,N=this.axisA,U=this.axisB;q.prototype.update.call(this);C.quaternion.vmult(N,r);E.quaternion.vmult(U,z);r.tangents(H.axisA,J.axisA);H.axisB.copy(z);J.axisB.copy(z);this.motorEquation.enabled&&(C.quaternion.vmult(this.axisA,A.axisA),E.quaternion.vmult(this.axisB,
A.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(h,n){function f(u,r,z){z=z||{};var C="undefined"!=typeof z.maxForce?z.maxForce:1E6,E=new k,A=new k,H=new k;u.position.vadd(r.position,H);H.scale(.5,H);r.pointToLocalFrame(H,A);u.pointToLocalFrame(H,E);q.call(this,u,E,r,A,C);C=this.rotationalEquation1=new l(u,r,z);E=this.rotationalEquation2=new l(u,
r,z);u=this.rotationalEquation3=new l(u,r,z);this.equations.push(C,E,u)}n.exports=f;var q=(h("./Constraint"),h("./PointToPointConstraint")),l=h("../equations/RotationalEquation"),k=(h("../equations/RotationalMotorEquation"),h("../equations/ContactEquation"),h("../math/Vec3"));f.prototype=new q;f.constructor=f;new k;new k;f.prototype.update=function(){var u=this.bodyA,r=this.bodyB,z=(this.motorEquation,this.rotationalEquation1),C=this.rotationalEquation2,E=this.rotationalEquation3;q.prototype.update.call(this);
u.vectorToWorldFrame(k.UNIT_X,z.axisA);r.vectorToWorldFrame(k.UNIT_Y,z.axisB);u.vectorToWorldFrame(k.UNIT_Y,C.axisA);r.vectorToWorldFrame(k.UNIT_Z,C.axisB);u.vectorToWorldFrame(k.UNIT_Z,E.axisA);r.vectorToWorldFrame(k.UNIT_X,E.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(h,n){function f(u,r,z,C,E){q.call(this,u,z);E="undefined"!=typeof E?E:
1E6;this.pivotA=r?r.clone():new k;this.pivotB=C?C.clone():new k;r=this.equationX=new l(u,z);C=this.equationY=new l(u,z);u=this.equationZ=new l(u,z);this.equations.push(r,C,u);r.minForce=C.minForce=u.minForce=-E;r.maxForce=C.maxForce=u.maxForce=E;r.ni.set(1,0,0);C.ni.set(0,1,0);u.ni.set(0,0,1)}n.exports=f;var q=h("./Constraint"),l=h("../equations/ContactEquation"),k=h("../math/Vec3");f.prototype=new q;f.prototype.update=function(){var u=this.bodyB,r=this.equationX,z=this.equationY,C=this.equationZ;
this.bodyA.quaternion.vmult(this.pivotA,r.ri);u.quaternion.vmult(this.pivotB,r.rj);z.ri.copy(r.ri);z.rj.copy(r.rj);C.ri.copy(r.ri);C.rj.copy(r.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(h,n){function f(r,z,C){C=C||{};var E="undefined"!=typeof C.maxForce?C.maxForce:1E6;l.call(this,r,z,-E,E);this.axisA=C.axisA?C.axisA.clone():new q(1,0,0);this.axisB=C.axisB?C.axisB.clone():new q(0,1,0);this.angle="undefined"!=typeof C.angle?C.angle:0}n.exports=f;var q=
h("../math/Vec3"),l=(h("../math/Mat3"),h("./Equation"));f.prototype=new l;f.prototype.constructor=f;var k=new q,u=new q;f.prototype.computeB=function(r){var z=this.a,C=this.b,E=this.axisA,A=this.axisB,H=this.jacobianElementA,J=this.jacobianElementB;E.cross(A,k);A.cross(E,u);H.rotational.copy(u);J.rotational.copy(k);E=Math.cos(this.angle)-E.dot(A);A=this.computeGW();H=this.computeGiMf();return-E*z-A*C-r*H}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(h,n){function f(J,N,U){q.call(this,
J,N,0,"undefined"!=typeof U?U:1E6);this.restitution=0;this.ri=new l;this.rj=new l;this.ni=new l}n.exports=f;var q=h("./Equation"),l=h("../math/Vec3");h("../math/Mat3");f.prototype=new q;f.prototype.constructor=f;var k=new l,u=new l,r=new l;f.prototype.computeB=function(J){var N=this.a,U=this.b,p=this.bi,x=this.bj,G=this.ri,e=this.rj,m=p.velocity,v=p.angularVelocity,D=(p.force,p.torque,x.velocity),B=x.angularVelocity,I=(x.force,x.torque,r),L=this.jacobianElementA,S=this.jacobianElementB,R=this.ni;
G.cross(R,k);e.cross(R,u);R.negate(L.spatial);k.negate(L.rotational);S.spatial.copy(R);S.rotational.copy(u);I.copy(x.position);I.vadd(e,I);I.vsub(p.position,I);I.vsub(G,I);p=R.dot(I);x=this.restitution+1;m=x*D.dot(R)-x*m.dot(R)+B.dot(u)-v.dot(k);v=this.computeGiMf();return-p*N-m*U-J*v};var z=new l,C=new l,E=new l,A=new l,H=new l;f.prototype.getImpactVelocityAlongNormal=function(){return this.bi.position.vadd(this.ri,E),this.bj.position.vadd(this.rj,A),this.bi.getVelocityAtWorldPoint(E,z),this.bj.getVelocityAtWorldPoint(A,
C),z.vsub(C,H),this.ni.dot(H)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(h,n){function f(A,H,J,N){this.id=f.id++;this.minForce="undefined"==typeof J?-1E6:J;this.maxForce="undefined"==typeof N?1E6:N;this.bi=A;this.bj=H;this.eps=this.b=this.a=0;this.jacobianElementA=new q;this.jacobianElementB=new q;this.enabled=!0;this.setSpookParams(1E7,4,1/60)}n.exports=f;var q=h("../math/JacobianElement");h=h("../math/Vec3");f.prototype.constructor=f;f.id=0;f.prototype.setSpookParams=
function(A,H,J){this.a=4/(J*(1+4*H));this.b=4*H/(1+4*H);this.eps=4/(J*J*A*(1+4*H))};f.prototype.computeB=function(A,H,J){var N=this.computeGW(),U=this.computeGq(),p=this.computeGiMf();return-U*A-N*H-p*J};f.prototype.computeGq=function(){var A=this.jacobianElementB,H=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+A.spatial.dot(H)};var l=new h;f.prototype.computeGW=function(){var A=this.jacobianElementB,H=this.bi,J=this.bj,N=J.velocity;J=J.angularVelocity||l;return this.jacobianElementA.multiplyVectors(H.velocity,
H.angularVelocity||l)+A.multiplyVectors(N,J)};f.prototype.computeGWlambda=function(){var A=this.jacobianElementB,H=this.bi,J=this.bj,N=J.vlambda;J=J.wlambda||l;return this.jacobianElementA.multiplyVectors(H.vlambda,H.wlambda||l)+A.multiplyVectors(N,J)};var k=new h,u=new h,r=new h,z=new h;f.prototype.computeGiMf=function(){var A=this.jacobianElementA,H=this.jacobianElementB,J=this.bi,N=this.bj,U=J.force,p=J.torque,x=N.force,G=N.torque,e=J.invMassSolve,m=N.invMassSolve;return J.invInertiaWorldSolve?
J.invInertiaWorldSolve.vmult(p,r):r.set(0,0,0),N.invInertiaWorldSolve?N.invInertiaWorldSolve.vmult(G,z):z.set(0,0,0),U.mult(e,k),x.mult(m,u),A.multiplyVectors(k,r)+H.multiplyVectors(u,z)};var C=new h;f.prototype.computeGiMGt=function(){var A=this.jacobianElementA,H=this.jacobianElementB,J=this.bi,N=this.bj,U=J.invInertiaWorldSolve,p=N.invInertiaWorldSolve;J=J.invMassSolve+N.invMassSolve;return U&&(U.vmult(A.rotational,C),J+=C.dot(A.rotational)),p&&(p.vmult(H.rotational,C),J+=C.dot(H.rotational)),
J};var E=new h;new h;new h;new h;new h;new h;f.prototype.addToWlambda=function(A){var H=this.jacobianElementA,J=this.jacobianElementB,N=this.bi,U=this.bj;H.spatial.mult(N.invMassSolve*A,E);N.vlambda.vadd(E,N.vlambda);J.spatial.mult(U.invMassSolve*A,E);U.vlambda.vadd(E,U.vlambda);N.invInertiaWorldSolve&&(N.invInertiaWorldSolve.vmult(H.rotational,E),E.mult(A,E),N.wlambda.vadd(E,N.wlambda));U.invInertiaWorldSolve&&(U.invInertiaWorldSolve.vmult(J.rotational,E),E.mult(A,E),U.wlambda.vadd(E,U.wlambda))};
f.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(h,n){function f(r,z,C){q.call(this,r,z,-C,C);this.ri=new l;this.rj=new l;this.t=new l}n.exports=f;var q=h("./Equation"),l=h("../math/Vec3");h("../math/Mat3");f.prototype=new q;f.prototype.constructor=f;var k=new l,u=new l;f.prototype.computeB=function(r){var z=(this.a,this.b),C=(this.bi,this.bj,this.ri),E=this.rj,A=this.t;C.cross(A,k);E.cross(A,u);C=this.jacobianElementA;
E=this.jacobianElementB;A.negate(C.spatial);k.negate(C.rotational);E.spatial.copy(A);E.rotational.copy(u);A=this.computeGW();C=this.computeGiMf();return-A*z-r*C}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(h,n){function f(r,z,C){C=C||{};var E="undefined"!=typeof C.maxForce?C.maxForce:1E6;l.call(this,r,z,-E,E);this.axisA=C.axisA?C.axisA.clone():new q(1,0,0);this.axisB=C.axisB?C.axisB.clone():new q(0,1,0);this.maxAngle=Math.PI/2}n.exports=f;var q=h("../math/Vec3"),l=(h("../math/Mat3"),
h("./Equation"));f.prototype=new l;f.prototype.constructor=f;var k=new q,u=new q;f.prototype.computeB=function(r){var z=this.a,C=this.b,E=this.axisA,A=this.axisB,H=this.jacobianElementA,J=this.jacobianElementB;E.cross(A,k);A.cross(E,u);H.rotational.copy(u);J.rotational.copy(k);E=Math.cos(this.maxAngle)-E.dot(A);A=this.computeGW();H=this.computeGiMf();return-E*z-A*C-r*H}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(h,n){function f(k,u,r){r="undefined"!=typeof r?r:1E6;l.call(this,
k,u,-r,r);this.axisA=new q;this.axisB=new q;this.targetVelocity=0}n.exports=f;var q=h("../math/Vec3"),l=(h("../math/Mat3"),h("./Equation"));f.prototype=new l;f.prototype.constructor=f;f.prototype.computeB=function(k){var u=(this.a,this.b),r=(this.bi,this.bj,this.axisA),z=this.axisB,C=this.jacobianElementB;this.jacobianElementA.rotational.copy(r);z.negate(C.rotational);r=this.computeGW()-this.targetVelocity;z=this.computeGiMf();return-r*u-k*z}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],
24:[function(h,n){function f(l,k,u){u=q.defaults(u,{friction:.3,restitution:.3,contactEquationStiffness:1E7,contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});this.id=f.idCounter++;this.materials=[l,k];this.friction=u.friction;this.restitution=u.restitution;this.contactEquationStiffness=u.contactEquationStiffness;this.contactEquationRelaxation=u.contactEquationRelaxation;this.frictionEquationStiffness=u.frictionEquationStiffness;this.frictionEquationRelaxation=
u.frictionEquationRelaxation}var q=h("../utils/Utils");n.exports=f;f.idCounter=0},{"../utils/Utils":53}],25:[function(h,n){function f(q){var l="";q=q||{};"string"==typeof q?(l=q,q={}):"object"==typeof q&&(l="");this.name=l;this.id=f.idCounter++;this.friction="undefined"!=typeof q.friction?q.friction:-1;this.restitution="undefined"!=typeof q.restitution?q.restitution:-1}n.exports=f;f.idCounter=0},{}],26:[function(h,n){function f(){this.spatial=new q;this.rotational=new q}n.exports=f;var q=h("./Vec3");
f.prototype.multiplyElement=function(l){return l.spatial.dot(this.spatial)+l.rotational.dot(this.rotational)};f.prototype.multiplyVectors=function(l,k){return l.dot(this.spatial)+k.dot(this.rotational)}},{"./Vec3":30}],27:[function(h,n){function f(l){this.elements=l?l:[0,0,0,0,0,0,0,0,0]}n.exports=f;var q=h("./Vec3");f.prototype.identity=function(){var l=this.elements;l[0]=1;l[1]=0;l[2]=0;l[3]=0;l[4]=1;l[5]=0;l[6]=0;l[7]=0;l[8]=1};f.prototype.setZero=function(){var l=this.elements;l[0]=0;l[1]=0;l[2]=
0;l[3]=0;l[4]=0;l[5]=0;l[6]=0;l[7]=0;l[8]=0};f.prototype.setTrace=function(l){var k=this.elements;k[0]=l.x;k[4]=l.y;k[8]=l.z};f.prototype.getTrace=function(l){l=l||new q;var k=this.elements;l.x=k[0];l.y=k[4];l.z=k[8]};f.prototype.vmult=function(l,k){k=k||new q;var u=this.elements,r=l.x,z=l.y;l=l.z;return k.x=u[0]*r+u[1]*z+u[2]*l,k.y=u[3]*r+u[4]*z+u[5]*l,k.z=u[6]*r+u[7]*z+u[8]*l,k};f.prototype.smult=function(l){for(var k=0;k<this.elements.length;k++)this.elements[k]*=l};f.prototype.mmult=function(l,
k){k=k||new f;for(var u=0;3>u;u++)for(var r=0;3>r;r++){for(var z=0,C=0;3>C;C++)z+=l.elements[u+3*C]*this.elements[C+3*r];k.elements[u+3*r]=z}return k};f.prototype.scale=function(l,k){k=k||new f;for(var u=this.elements,r=k.elements,z=0;3!==z;z++)r[3*z]=l.x*u[3*z],r[3*z+1]=l.y*u[3*z+1],r[3*z+2]=l.z*u[3*z+2];return k};f.prototype.solve=function(l,k){k=k||new q;for(var u=[],r=0;12>r;r++)u.push(0);var z;for(r=0;3>r;r++)for(z=0;3>z;z++)u[r+4*z]=this.elements[r+3*z];u[3]=l.x;u[7]=l.y;u[11]=l.z;var C=3,E=
C;do{if(r=E-C,0===u[r+4*r])for(z=r+1;E>z;z++)if(0!==u[r+4*z]){var A=4;do{var H=4-A;u[H+4*r]+=u[H+4*z]}while(--A);break}if(0!==u[r+4*r])for(z=r+1;E>z;z++){var J=u[r+4*z]/u[r+4*r];A=4;do H=4-A,u[H+4*z]=r>=H?0:u[H+4*z]-u[H+4*r]*J;while(--A)}}while(--C);if(k.z=u[11]/u[10],k.y=(u[7]-u[6]*k.z)/u[5],k.x=(u[3]-u[2]*k.z-u[1]*k.y)/u[0],isNaN(k.x)||isNaN(k.y)||isNaN(k.z)||1/0===k.x||1/0===k.y||1/0===k.z)throw"Could not solve equation! Got x=["+k.toString()+"], b=["+l.toString()+"], A=["+this.toString()+"]";
return k};f.prototype.e=function(l,k,u){return void 0===u?this.elements[k+3*l]:void(this.elements[k+3*l]=u)};f.prototype.copy=function(l){for(var k=0;k<l.elements.length;k++)this.elements[k]=l.elements[k];return this};f.prototype.toString=function(){for(var l="",k=0;9>k;k++)l+=this.elements[k]+",";return l};f.prototype.reverse=function(l){l=l||new f;for(var k=[],u=0;18>u;u++)k.push(0);var r;for(u=0;3>u;u++)for(r=0;3>r;r++)k[u+6*r]=this.elements[u+3*r];k[3]=1;k[9]=0;k[15]=0;k[4]=0;k[10]=1;k[16]=0;
k[5]=0;k[11]=0;k[17]=1;var z=3,C=z;do{if(u=C-z,0===k[u+6*u])for(r=u+1;C>r;r++)if(0!==k[u+6*r]){var E=6;do{var A=6-E;k[A+6*u]+=k[A+6*r]}while(--E);break}if(0!==k[u+6*u])for(r=u+1;C>r;r++){var H=k[u+6*r]/k[u+6*u];E=6;do A=6-E,k[A+6*r]=u>=A?0:k[A+6*r]-k[A+6*u]*H;while(--E)}}while(--z);u=2;do{r=u-1;do{H=k[u+6*r]/k[u+6*u];E=6;do A=6-E,k[A+6*r]-=k[A+6*u]*H;while(--E)}while(r--)}while(--u);u=2;do{H=1/k[u+6*u];E=6;do A=6-E,k[A+6*u]*=H;while(--E)}while(u--);u=2;do{r=2;do{if(A=k[3+r+6*u],isNaN(A)||1/0===A)throw"Could not reverse! A=["+
this.toString()+"]";l.e(u,r,A)}while(r--)}while(u--);return l};f.prototype.setRotationFromQuaternion=function(l){var k=l.x,u=l.y,r=l.z,z=l.w,C=k+k,E=u+u,A=r+r;l=k*C;var H=k*E;k*=A;var J=u*E;u*=A;r*=A;C*=z;E*=z;z*=A;A=this.elements;return A[0]=1-(J+r),A[1]=H-z,A[2]=k+E,A[3]=H+z,A[4]=1-(l+r),A[5]=u-C,A[6]=k-E,A[7]=u+C,A[8]=1-(l+J),this};f.prototype.transpose=function(l){l=l||new f;for(var k=l.elements,u=this.elements,r=0;3!==r;r++)for(var z=0;3!==z;z++)k[3*r+z]=u[3*z+r];return l}},{"./Vec3":30}],28:[function(h,
n){function f(C,E,A,H){this.x=void 0!==C?C:0;this.y=void 0!==E?E:0;this.z=void 0!==A?A:0;this.w=void 0!==H?H:1}n.exports=f;var q=h("./Vec3");f.prototype.set=function(C,E,A,H){this.x=C;this.y=E;this.z=A;this.w=H};f.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};f.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]};f.prototype.setFromAxisAngle=function(C,E){var A=Math.sin(.5*E);this.x=C.x*A;this.y=C.y*A;this.z=C.z*A;this.w=Math.cos(.5*E)};f.prototype.toAxisAngle=
function(C){C=C||new q;this.normalize();var E=2*Math.acos(this.w),A=Math.sqrt(1-this.w*this.w);return.001>A?(C.x=this.x,C.y=this.y,C.z=this.z):(C.x=this.x/A,C.y=this.y/A,C.z=this.z/A),[C,E]};var l=new q,k=new q;f.prototype.setFromVectors=function(C,E){if(C.isAntiparallelTo(E))C.tangents(l,k),this.setFromAxisAngle(l,Math.PI);else{var A=C.cross(E);this.x=A.x;this.y=A.y;this.z=A.z;this.w=Math.sqrt(Math.pow(C.norm(),2)*Math.pow(E.norm(),2))+C.dot(E);this.normalize()}};var u=new q,r=new q,z=new q;f.prototype.mult=
function(C,E){E=E||new f;var A=this.w;return u.set(this.x,this.y,this.z),r.set(C.x,C.y,C.z),E.w=A*C.w-u.dot(r),u.cross(r,z),E.x=A*r.x+C.w*u.x+z.x,E.y=A*r.y+C.w*u.y+z.y,E.z=A*r.z+C.w*u.z+z.z,E};f.prototype.inverse=function(C){var E=this.x,A=this.y,H=this.z,J=this.w;C=C||new f;this.conjugate(C);E=1/(E*E+A*A+H*H+J*J);return C.x*=E,C.y*=E,C.z*=E,C.w*=E,C};f.prototype.conjugate=function(C){return C=C||new f,C.x=-this.x,C.y=-this.y,C.z=-this.z,C.w=this.w,C};f.prototype.normalize=function(){var C=Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===C?(this.x=0,this.y=0,this.z=0,this.w=0):(C=1/C,this.x*=C,this.y*=C,this.z*=C,this.w*=C)};f.prototype.normalizeFast=function(){var C=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===C?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=C,this.y*=C,this.z*=C,this.w*=C)};f.prototype.vmult=function(C,E){E=E||new q;var A=C.x,H=C.y,J=C.z;C=this.x;var N=this.y,U=this.z,p=this.w,x=p*A+N*J-U*H,G=p*H+U*A-C*J,e=p*J+C*H-N*A;A=-C*A-N*H-U*J;return E.x=
x*p+A*-C+G*-U-e*-N,E.y=G*p+A*-N+e*-C-x*-U,E.z=e*p+A*-U+x*-N-G*-C,E};f.prototype.copy=function(C){return this.x=C.x,this.y=C.y,this.z=C.z,this.w=C.w,this};f.prototype.toEuler=function(C,E){E=E||"YZX";var A,H,J,N=this.x,U=this.y,p=this.z,x=this.w;switch(E){case "YZX":E=N*U+p*x;if(.499<E&&(A=2*Math.atan2(N,x),H=Math.PI/2,J=0),-.499>E&&(A=-2*Math.atan2(N,x),H=-Math.PI/2,J=0),isNaN(A))J=p*p,A=Math.atan2(2*U*x-2*N*p,1-2*U*U-2*J),H=Math.asin(2*E),J=Math.atan2(2*N*x-2*U*p,1-2*N*N-2*J);break;default:throw Error("Euler order "+
E+" not supported yet.");}C.y=A;C.z=H;C.x=J};f.prototype.setFromEuler=function(C,E,A,H){H=H||"XYZ";var J=Math.cos(C/2),N=Math.cos(E/2),U=Math.cos(A/2);C=Math.sin(C/2);E=Math.sin(E/2);A=Math.sin(A/2);return"XYZ"===H?(this.x=C*N*U+J*E*A,this.y=J*E*U-C*N*A,this.z=J*N*A+C*E*U,this.w=J*N*U-C*E*A):"YXZ"===H?(this.x=C*N*U+J*E*A,this.y=J*E*U-C*N*A,this.z=J*N*A-C*E*U,this.w=J*N*U+C*E*A):"ZXY"===H?(this.x=C*N*U-J*E*A,this.y=J*E*U+C*N*A,this.z=J*N*A+C*E*U,this.w=J*N*U-C*E*A):"ZYX"===H?(this.x=C*N*U-J*E*A,this.y=
J*E*U+C*N*A,this.z=J*N*A-C*E*U,this.w=J*N*U+C*E*A):"YZX"===H?(this.x=C*N*U+J*E*A,this.y=J*E*U+C*N*A,this.z=J*N*A-C*E*U,this.w=J*N*U-C*E*A):"XZY"===H&&(this.x=C*N*U-J*E*A,this.y=J*E*U-C*N*A,this.z=J*N*A+C*E*U,this.w=J*N*U+C*E*A),this};f.prototype.clone=function(){return new f(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(h,n){function f(u){u=u||{};this.position=new q;u.position&&this.position.copy(u.position);this.quaternion=new l;u.quaternion&&this.quaternion.copy(u.quaternion)}var q=
h("./Vec3"),l=h("./Quaternion");n.exports=f;var k=new l;f.pointToLocalFrame=function(u,r,z,C){C=C||new q;return z.vsub(u,C),r.conjugate(k),k.vmult(C,C),C};f.prototype.pointToLocal=function(u,r){return f.pointToLocalFrame(this.position,this.quaternion,u,r)};f.pointToWorldFrame=function(u,r,z,C){C=C||new q;return r.vmult(z,C),C.vadd(u,C),C};f.prototype.pointToWorld=function(u,r){return f.pointToWorldFrame(this.position,this.quaternion,u,r)};f.prototype.vectorToWorldFrame=function(u,r){r=r||new q;return this.quaternion.vmult(u,
r),r};f.vectorToWorldFrame=function(u,r,z){return u.vmult(r,z),z};f.vectorToLocalFrame=function(u,r,z,C){C=C||new q;return r.w*=-1,r.vmult(z,C),r.w*=-1,C}},{"./Quaternion":28,"./Vec3":30}],30:[function(h,n){function f(r,z,C){this.x=r||0;this.y=z||0;this.z=C||0}n.exports=f;var q=h("./Mat3");f.ZERO=new f(0,0,0);f.UNIT_X=new f(1,0,0);f.UNIT_Y=new f(0,1,0);f.UNIT_Z=new f(0,0,1);f.prototype.cross=function(r,z){var C=r.x,E=r.y;r=r.z;var A=this.x,H=this.y,J=this.z;return z=z||new f,z.x=H*r-J*E,z.y=J*C-A*
r,z.z=A*E-H*C,z};f.prototype.set=function(r,z,C){return this.x=r,this.y=z,this.z=C,this};f.prototype.setZero=function(){this.x=this.y=this.z=0};f.prototype.vadd=function(r,z){return z?(z.x=r.x+this.x,z.y=r.y+this.y,z.z=r.z+this.z,void 0):new f(this.x+r.x,this.y+r.y,this.z+r.z)};f.prototype.vsub=function(r,z){return z?(z.x=this.x-r.x,z.y=this.y-r.y,z.z=this.z-r.z,void 0):new f(this.x-r.x,this.y-r.y,this.z-r.z)};f.prototype.crossmat=function(){return new q([0,-this.z,this.y,this.z,0,-this.x,-this.y,
this.x,0])};f.prototype.normalize=function(){var r=this.x,z=this.y,C=this.z;r=Math.sqrt(r*r+z*z+C*C);0<r?(z=1/r,this.x*=z,this.y*=z,this.z*=z):this.z=this.y=this.x=0;return r};f.prototype.unit=function(r){r=r||new f;var z=this.x,C=this.y,E=this.z,A=Math.sqrt(z*z+C*C+E*E);return 0<A?(A=1/A,r.x=z*A,r.y=C*A,r.z=E*A):(r.x=1,r.y=0,r.z=0),r};f.prototype.norm=function(){var r=this.x,z=this.y,C=this.z;return Math.sqrt(r*r+z*z+C*C)};f.prototype.length=f.prototype.norm;f.prototype.norm2=function(){return this.dot(this)};
f.prototype.lengthSquared=f.prototype.norm2;f.prototype.distanceTo=function(r){var z=this.x,C=this.y,E=this.z,A=r.x,H=r.y;r=r.z;return Math.sqrt((A-z)*(A-z)+(H-C)*(H-C)+(r-E)*(r-E))};f.prototype.distanceSquared=function(r){var z=this.x,C=this.y,E=this.z,A=r.x,H=r.y;r=r.z;return(A-z)*(A-z)+(H-C)*(H-C)+(r-E)*(r-E)};f.prototype.mult=function(r,z){z=z||new f;var C=this.y,E=this.z;return z.x=r*this.x,z.y=r*C,z.z=r*E,z};f.prototype.scale=f.prototype.mult;f.prototype.dot=function(r){return this.x*r.x+this.y*
r.y+this.z*r.z};f.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z};f.prototype.negate=function(r){return r=r||new f,r.x=-this.x,r.y=-this.y,r.z=-this.z,r};var l=new f,k=new f;f.prototype.tangents=function(r,z){var C=this.norm();0<C?(C=1/C,l.set(this.x*C,this.y*C,this.z*C),.9>Math.abs(l.x)?(k.set(1,0,0),l.cross(k,r)):(k.set(0,1,0),l.cross(k,r)),l.cross(r,z)):(r.set(1,0,0),z.set(0,1,0))};f.prototype.toString=function(){return this.x+","+this.y+","+this.z};f.prototype.toArray=function(){return[this.x,
this.y,this.z]};f.prototype.copy=function(r){return this.x=r.x,this.y=r.y,this.z=r.z,this};f.prototype.lerp=function(r,z,C){var E=this.x,A=this.y,H=this.z;C.x=E+(r.x-E)*z;C.y=A+(r.y-A)*z;C.z=H+(r.z-H)*z};f.prototype.almostEquals=function(r,z){return void 0===z&&(z=1E-6),Math.abs(this.x-r.x)>z||Math.abs(this.y-r.y)>z||Math.abs(this.z-r.z)>z?!1:!0};f.prototype.almostZero=function(r){return void 0===r&&(r=1E-6),Math.abs(this.x)>r||Math.abs(this.y)>r||Math.abs(this.z)>r?!1:!0};var u=new f;f.prototype.isAntiparallelTo=
function(r,z){return this.negate(u),u.almostEquals(r,z)};f.prototype.clone=function(){return new f(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(h,n){function f(I){I=I||{};q.apply(this);this.id=f.idCounter++;this.postStep=this.preStep=this.world=null;this.vlambda=new l;this.collisionFilterGroup="number"==typeof I.collisionFilterGroup?I.collisionFilterGroup:1;this.collisionFilterMask="number"==typeof I.collisionFilterMask?I.collisionFilterMask:1;this.collisionResponse=!0;this.position=new l;
I.position&&this.position.copy(I.position);this.previousPosition=new l;this.initPosition=new l;this.velocity=new l;I.velocity&&this.velocity.copy(I.velocity);this.initVelocity=new l;this.force=new l;var L="number"==typeof I.mass?I.mass:0;this.mass=L;this.invMass=0<L?1/L:0;this.material=I.material||null;this.linearDamping="number"==typeof I.linearDamping?I.linearDamping:.01;this.type=0>=L?f.STATIC:f.DYNAMIC;typeof I.type==typeof f.STATIC&&(this.type=I.type);this.allowSleep="undefined"!=typeof I.allowSleep?
I.allowSleep:!0;this.sleepState=0;this.sleepSpeedLimit="undefined"!=typeof I.sleepSpeedLimit?I.sleepSpeedLimit:.1;this.sleepTimeLimit="undefined"!=typeof I.sleepTimeLimit?I.sleepTimeLimit:1;this.timeLastSleepy=0;this._wakeUpAfterNarrowphase=!1;this.torque=new l;this.quaternion=new u;I.quaternion&&this.quaternion.copy(I.quaternion);this.initQuaternion=new u;this.angularVelocity=new l;I.angularVelocity&&this.angularVelocity.copy(I.angularVelocity);this.initAngularVelocity=new l;this.interpolatedPosition=
new l;this.interpolatedQuaternion=new u;this.shapes=[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=new l;this.invInertia=new l;this.invInertiaWorld=new k;this.invMassSolve=0;this.invInertiaSolve=new l;this.invInertiaWorldSolve=new k;this.fixedRotation="undefined"!=typeof I.fixedRotation?I.fixedRotation:!1;this.angularDamping="undefined"!=typeof I.angularDamping?I.angularDamping:.01;this.aabb=new r;this.aabbNeedsUpdate=!0;this.wlambda=new l;I.shape&&this.addShape(I.shape);this.updateMassProperties()}
n.exports=f;var q=h("../utils/EventTarget"),l=(h("../shapes/Shape"),h("../math/Vec3")),k=h("../math/Mat3"),u=h("../math/Quaternion"),r=(h("../material/Material"),h("../collision/AABB")),z=h("../shapes/Box");f.prototype=new q;f.prototype.constructor=f;f.DYNAMIC=1;f.STATIC=2;f.KINEMATIC=4;f.AWAKE=0;f.SLEEPY=1;f.SLEEPING=2;f.idCounter=0;f.prototype.wakeUp=function(){var I=this.sleepState;this.sleepState=0;I===f.SLEEPING&&this.dispatchEvent({type:"wakeup"})};f.prototype.sleep=function(){this.sleepState=
f.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,0,0)};f.sleepyEvent={type:"sleepy"};f.sleepEvent={type:"sleep"};f.prototype.sleepTick=function(I){if(this.allowSleep){var L=this.sleepState,S=this.velocity.norm2()+this.angularVelocity.norm2(),R=Math.pow(this.sleepSpeedLimit,2);L===f.AWAKE&&R>S?(this.sleepState=f.SLEEPY,this.timeLastSleepy=I,this.dispatchEvent(f.sleepyEvent)):L===f.SLEEPY&&S>R?this.wakeUp():L===f.SLEEPY&&I-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(f.sleepEvent))}};
f.prototype.updateSolveMassProperties=function(){this.sleepState===f.SLEEPING||this.type===f.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))};f.prototype.pointToLocalFrame=function(I,L){L=L||new l;return I.vsub(this.position,L),this.quaternion.conjugate().vmult(L,L),L};f.prototype.vectorToLocalFrame=function(I,L){L=L||new l;
return this.quaternion.conjugate().vmult(I,L),L};f.prototype.pointToWorldFrame=function(I,L){L=L||new l;return this.quaternion.vmult(I,L),L.vadd(this.position,L),L};f.prototype.vectorToWorldFrame=function(I,L){L=L||new l;return this.quaternion.vmult(I,L),L};var C=new l,E=new u;f.prototype.addShape=function(I,L,S){var R=new l,W=new u;return L&&R.copy(L),S&&W.copy(S),this.shapes.push(I),this.shapeOffsets.push(R),this.shapeOrientations.push(W),this.updateMassProperties(),this.updateBoundingRadius(),
this.aabbNeedsUpdate=!0,this};f.prototype.updateBoundingRadius=function(){for(var I=this.shapes,L=this.shapeOffsets,S=I.length,R=0,W=0;W!==S;W++){var X=I[W];X.updateBoundingSphereRadius();var V=L[W].norm();X=X.boundingSphereRadius;V+X>R&&(R=V+X)}this.boundingRadius=R};var A=new r;f.prototype.computeAABB=function(){for(var I=this.shapes,L=this.shapeOffsets,S=this.shapeOrientations,R=I.length,W=this.quaternion,X=this.aabb,V=0;V!==R;V++){var la=I[V];S[V].mult(W,E);E.vmult(L[V],C);C.vadd(this.position,
C);la.calculateWorldAABB(C,E,A.lowerBound,A.upperBound);0===V?X.copy(A):X.extend(A)}this.aabbNeedsUpdate=!1};var H=new k,J=new k;new k;f.prototype.updateInertiaWorld=function(I){var L=this.invInertia;if(L.x!==L.y||L.y!==L.z||I)H.setRotationFromQuaternion(this.quaternion),H.transpose(J),H.scale(L,H),H.mmult(J,this.invInertiaWorld)};var N=new l,U=new l;f.prototype.applyForce=function(I,L){this.type===f.DYNAMIC&&(L.vsub(this.position,N),N.cross(I,U),this.force.vadd(I,this.force),this.torque.vadd(U,this.torque))};
var p=new l,x=new l;f.prototype.applyLocalForce=function(I,L){this.type===f.DYNAMIC&&(this.vectorToWorldFrame(I,p),this.pointToWorldFrame(L,x),this.applyForce(p,x))};var G=new l,e=new l,m=new l;f.prototype.applyImpulse=function(I,L){this.type===f.DYNAMIC&&(L.vsub(this.position,G),e.copy(I),e.mult(this.invMass,e),this.velocity.vadd(e,this.velocity),G.cross(I,m),this.invInertiaWorld.vmult(m,m),this.angularVelocity.vadd(m,this.angularVelocity))};var v=new l,D=new l;f.prototype.applyLocalImpulse=function(I,
L){this.type===f.DYNAMIC&&(this.vectorToWorldFrame(I,v),this.pointToWorldFrame(L,D),this.applyImpulse(v,D))};var B=new l;f.prototype.updateMassProperties=function(){this.invMass=0<this.mass?1/this.mass:0;var I=this.inertia,L=this.fixedRotation;this.computeAABB();B.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);z.calculateInertia(B,this.mass,I);this.invInertia.set(0<I.x&&!L?1/I.x:0,0<I.y&&!L?
1/I.y:0,0<I.z&&!L?1/I.z:0);this.updateInertiaWorld(!0)};f.prototype.getVelocityAtWorldPoint=function(I,L){var S=new l;return I.vsub(this.position,S),this.angularVelocity.cross(S,L),this.velocity.vadd(L,L),L}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(h,n){function f(R){this.chassisBody=R.chassisBody;this.wheelInfos=[];this.sliding=!1;this.world=null;this.indexRightAxis=
"undefined"!=typeof R.indexRightAxis?R.indexRightAxis:1;this.indexForwardAxis="undefined"!=typeof R.indexForwardAxis?R.indexForwardAxis:0;this.indexUpAxis="undefined"!=typeof R.indexUpAxis?R.indexUpAxis:2}function q(R,W,X){var V=m,la=v,fa=D,ha=B;return W.vsub(R.position,V),V.cross(X,la),R.invInertiaWorld.vmult(la,ha),ha.cross(V,fa),R.invMass+X.dot(fa)}var l=(h("./Body"),h("../math/Vec3")),k=h("../math/Quaternion"),u=(h("../collision/RaycastResult"),h("../collision/Ray")),r=h("../objects/WheelInfo");
n.exports=f;var z=(new l,new l,new l,new l),C=new l,E=new l;new u;f.prototype.addWheel=function(R){R=R||{};R=new r(R);var W=this.wheelInfos.length;return this.wheelInfos.push(R),W};f.prototype.setSteeringValue=function(R,W){this.wheelInfos[W].steering=R};new l;f.prototype.applyEngineForce=function(R,W){this.wheelInfos[W].engineForce=R};f.prototype.setBrake=function(R,W){this.wheelInfos[W].brake=R};f.prototype.addToWorld=function(R){this.constraints;R.add(this.chassisBody);var W=this;this.preStepCallback=
function(){W.updateVehicle(R.dt)};R.addEventListener("preStep",this.preStepCallback);this.world=R};f.prototype.getVehicleAxisWorld=function(R,W){W.set(0===R?1:0,1===R?1:0,2===R?1:0);this.chassisBody.vectorToWorldFrame(W,W)};f.prototype.updateVehicle=function(R){for(var W=this.wheelInfos,X=W.length,V=this.chassisBody,la=0;X>la;la++)this.updateWheelTransform(la);this.currentVehicleSpeedKmHour=3.6*V.velocity.norm();la=new l;this.getVehicleAxisWorld(this.indexForwardAxis,la);0>la.dot(V.velocity)&&(this.currentVehicleSpeedKmHour*=
-1);for(la=0;X>la;la++)this.castRay(W[la]);this.updateSuspension(R);var fa=new l,ha=new l;for(la=0;X>la;la++){var ba=W[la],ea=ba.suspensionForce;ea>ba.maxSuspensionForce&&(ea=ba.maxSuspensionForce);ba.raycastResult.hitNormalWorld.scale(ea*R,fa);ba.raycastResult.hitPointWorld.vsub(V.position,ha);V.applyImpulse(fa,ba.raycastResult.hitPointWorld)}this.updateFriction(R);fa=new l;ha=new l;ea=new l;for(la=0;X>la;la++){ba=W[la];V.getVelocityAtWorldPoint(ba.chassisConnectionPointWorld,ea);var ka=1;switch(this.indexUpAxis){case 1:ka=
-1}if(ba.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,ha);var O=ha.dot(ba.raycastResult.hitNormalWorld);ba.raycastResult.hitNormalWorld.scale(O,fa);ha.vsub(fa,ha);O=ha.dot(ea);ba.deltaRotation=ka*O*R/ba.radius}!ba.sliding&&ba.isInContact||0===ba.engineForce||!ba.useCustomSlidingRotationalSpeed||(ba.deltaRotation=(0<ba.engineForce?1:-1)*ba.customSlidingRotationalSpeed*R);Math.abs(ba.brake)>Math.abs(ba.engineForce)&&(ba.deltaRotation=0);ba.rotation+=ba.deltaRotation;ba.deltaRotation*=
.99}};f.prototype.updateSuspension=function(){for(var R=this.chassisBody.mass,W=this.wheelInfos,X=W.length,V=0;X>V;V++){var la=W[V];if(la.isInContact){var fa=la.suspensionStiffness*(la.suspensionRestLength-la.suspensionLength)*la.clippedInvContactDotSuspension;var ha=la.suspensionRelativeVelocity;fa-=(0>ha?la.dampingCompression:la.dampingRelaxation)*ha;la.suspensionForce=fa*R;0>la.suspensionForce&&(la.suspensionForce=0)}else la.suspensionForce=0}};f.prototype.removeFromWorld=function(R){this.constraints;
R.remove(this.chassisBody);R.removeEventListener("preStep",this.preStepCallback);this.world=null};var A=new l,H=new l;f.prototype.castRay=function(R){this.updateWheelTransformWorld(R);var W=this.chassisBody,X=-1;R.directionWorld.scale(R.suspensionRestLength+R.radius,A);var V=R.chassisConnectionPointWorld;V.vadd(A,H);var la=R.raycastResult;la.reset();var fa=W.collisionResponse;W.collisionResponse=!1;this.world.rayTest(V,H,la);W.collisionResponse=fa;V=la.body;(R.raycastResult.groundObject=0,V)?(X=la.distance,
R.raycastResult.hitNormalWorld=la.hitNormalWorld,R.isInContact=!0,R.suspensionLength=la.distance-R.radius,la=R.suspensionRestLength-R.maxSuspensionTravel,V=R.suspensionRestLength+R.maxSuspensionTravel,R.suspensionLength<la&&(R.suspensionLength=la),R.suspensionLength>V&&(R.suspensionLength=V,R.raycastResult.reset()),la=R.raycastResult.hitNormalWorld.dot(R.directionWorld),V=new l,W.getVelocityAtWorldPoint(R.raycastResult.hitPointWorld,V),W=R.raycastResult.hitNormalWorld.dot(V),-.1<=la?(R.suspensionRelativeVelocity=
0,R.clippedInvContactDotSuspension=10):(la=-1/la,R.suspensionRelativeVelocity=W*la,R.clippedInvContactDotSuspension=la)):(R.suspensionLength=R.suspensionRestLength+0*R.maxSuspensionTravel,R.suspensionRelativeVelocity=0,R.directionWorld.scale(-1,R.raycastResult.hitNormalWorld),R.clippedInvContactDotSuspension=1);return X};f.prototype.updateWheelTransformWorld=function(R){R.isInContact=!1;var W=this.chassisBody;W.pointToWorldFrame(R.chassisConnectionPointLocal,R.chassisConnectionPointWorld);W.vectorToWorldFrame(R.directionLocal,
R.directionWorld);W.vectorToWorldFrame(R.axleLocal,R.axleWorld)};f.prototype.updateWheelTransform=function(R){R=this.wheelInfos[R];this.updateWheelTransformWorld(R);R.directionLocal.scale(-1,z);C.copy(R.axleLocal);z.cross(C,E);E.normalize();C.normalize();var W=R.steering,X=new k;X.setFromAxisAngle(z,W);W=new k;W.setFromAxisAngle(C,R.rotation);var V=R.worldTransform.quaternion;this.chassisBody.quaternion.mult(X,V);V.mult(W,V);V.normalize();X=R.worldTransform.position;X.copy(R.directionWorld);X.scale(R.suspensionLength,
X);X.vadd(R.chassisConnectionPointWorld,X)};var J=[new l(1,0,0),new l(0,1,0),new l(0,0,1)];f.prototype.getWheelTransformWorld=function(R){return this.wheelInfos[R].worldTransform};var N=new l,U=[],p=[];f.prototype.updateFriction=function(R){for(var W=this.wheelInfos,X=W.length,V=this.chassisBody,la=0,fa=0;X>fa;fa++){var ha=W[fa],ba=ha.raycastResult.body;ba&&la++;ha.sideImpulse=0;ha.forwardImpulse=0;p[fa]||(p[fa]=new l);U[fa]||(U[fa]=new l)}for(fa=0;X>fa;fa++)if(ha=W[fa],ba=ha.raycastResult.body){var ea=
U[fa];this.getWheelTransformWorld(fa).vectorToWorldFrame(J[this.indexRightAxis],ea);la=ha.raycastResult.hitNormalWorld;var ka=ea.dot(la);la.scale(ka,N);ea.vsub(N,ea);ea.normalize();la.cross(ea,p[fa]);p[fa].normalize();la=ha;ka=V;var O=ha.raycastResult.hitPointWorld,Y=ha.raycastResult.hitPointWorld;if(1.1<ea.norm2())ba=0;else{var da=I,pa=L,ma=S;ka.getVelocityAtWorldPoint(O,da);ba.getVelocityAtWorldPoint(Y,pa);da.vsub(pa,ma);ba=-.2*ea.dot(ma)*(1/(ka.invMass+ba.invMass))}la.sideImpulse=ba;ha.sideImpulse*=
1}this.sliding=!1;for(fa=0;X>fa;fa++){ha=W[fa];ba=ha.raycastResult.body;O=0;if(ha.slipInfo=1,ba){la=ha.brake?ha.brake:0;pa=V;Y=ba;ea=ha.raycastResult.hitPointWorld;da=p[fa];O=la;ka=0;ma=ea;var wa=x,Ca=G,ya=e;pa.getVelocityAtWorldPoint(ma,wa);Y.getVelocityAtWorldPoint(ma,Ca);wa.vsub(Ca,ya);ma=da.dot(ya);pa=q(pa,ea,da);Y=q(Y,ea,da);O=(ka=1/(pa+Y)*-ma,ka>O&&(ka=O),-O>ka&&(ka=-O),ka);O+=ha.engineForce*R;la/=O;ha.slipInfo*=la}if(ha.forwardImpulse=0,ha.skidInfo=1,ba)if(ha.skidInfo=1,ba=ha.suspensionForce*
R*ha.frictionSlip,la=ba*ba,ha.forwardImpulse=O,ka=.5*ha.forwardImpulse,O=1*ha.sideImpulse,ka=ka*ka+O*O,ha.sliding=!1,ka>la)this.sliding=!0,ha.sliding=!0,la=ba/Math.sqrt(ka),ha.skidInfo*=la}if(this.sliding)for(fa=0;X>fa;fa++)ha=W[fa],0!==ha.sideImpulse&&1>ha.skidInfo&&(ha.forwardImpulse*=ha.skidInfo,ha.sideImpulse*=ha.skidInfo);for(fa=0;X>fa;fa++){ha=W[fa];R=new l;if(R.copy(ha.raycastResult.hitPointWorld),0!==ha.forwardImpulse)ba=new l,p[fa].scale(ha.forwardImpulse,ba),V.applyImpulse(ba,R);0!==ha.sideImpulse&&
(ba=ha.raycastResult.body,la=new l,la.copy(ha.raycastResult.hitPointWorld),ka=new l,U[fa].scale(ha.sideImpulse,ka),V.pointToLocalFrame(R,R),R["xyz"[this.indexUpAxis]]*=ha.rollInfluence,V.pointToWorldFrame(R,R),V.applyImpulse(ka,R),ka.scale(-1,ka),ba.applyImpulse(ka,la))}};var x=new l,G=new l,e=new l,m=new l,v=new l,D=new l,B=new l,I=new l,L=new l,S=new l},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(h,
n){function f(E){(this.wheelBodies=[],this.coordinateSystem="undefined"==typeof E.coordinateSystem?new u(1,2,3):E.coordinateSystem.clone(),this.chassisBody=E.chassisBody,this.chassisBody)||(E=new k(new u(5,2,.5)),this.chassisBody=new q(1,E));this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}var q=h("./Body"),l=h("../shapes/Sphere"),k=h("../shapes/Box"),u=h("../math/Vec3"),r=h("../constraints/HingeConstraint");n.exports=f;f.prototype.addWheel=function(E){E=E||{};var A=E.body;A||(A=new q(1,
new l(1.2)));this.wheelBodies.push(A);this.wheelForces.push(0);var H=(new u,"undefined"!=typeof E.position?E.position.clone():new u),J=new u;this.chassisBody.pointToWorldFrame(H,J);A.position.set(J.x,J.y,J.z);E="undefined"!=typeof E.axis?E.axis.clone():new u(0,1,0);this.wheelAxes.push(E);A=new r(this.chassisBody,A,{pivotA:H,axisA:E,pivotB:u.ZERO,axisB:E,collideConnected:!1});return this.constraints.push(A),this.wheelBodies.length-1};f.prototype.setSteeringValue=function(E,A){var H=this.wheelAxes[A],
J=Math.cos(E);E=Math.sin(E);var N=H.x;H=H.y;this.constraints[A].axisA.set(J*N-E*H,E*N+J*H,0)};f.prototype.setMotorSpeed=function(E,A){A=this.constraints[A];A.enableMotor();A.motorTargetVelocity=E};f.prototype.disableMotor=function(E){this.constraints[E].disableMotor()};var z=new u;f.prototype.setWheelForce=function(E,A){this.wheelForces[A]=E};f.prototype.applyWheelForce=function(E,A){var H=this.wheelBodies[A],J=H.torque;this.wheelAxes[A].scale(E,z);H.vectorToWorldFrame(z,z);J.vadd(z,J)};f.prototype.addToWorld=
function(E){for(var A=this.constraints,H=this.wheelBodies.concat([this.chassisBody]),J=0;J<H.length;J++)E.add(H[J]);for(J=0;J<A.length;J++)E.addConstraint(A[J]);E.addEventListener("preStep",this._update.bind(this))};f.prototype._update=function(){for(var E=this.wheelForces,A=0;A<E.length;A++)this.applyWheelForce(E[A],A)};f.prototype.removeFromWorld=function(E){for(var A=this.constraints,H=this.wheelBodies.concat([this.chassisBody]),J=0;J<H.length;J++)E.remove(H[J]);for(J=0;J<A.length;J++)E.removeConstraint(A[J])};
var C=new u;f.prototype.getWheelSpeed=function(E){var A=this.wheelBodies[E].angularVelocity;return this.chassisBody.vectorToWorldFrame(this.wheelAxes[E],C),A.dot(C)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(h,n){function f(){this.particles=[];this.speedOfSound=this.smoothingRadius=this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=[]}n.exports=f;n=(h("../shapes/Shape"),
h("../math/Vec3"));h("../math/Quaternion");h("../shapes/Particle");h("../objects/Body");h("../material/Material");f.prototype.add=function(E){this.particles.push(E);this.neighbors.length<this.particles.length&&this.neighbors.push([])};f.prototype.remove=function(E){E=this.particles.indexOf(E);-1!==E&&(this.particles.splice(E,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var q=new n;f.prototype.getNeighbors=function(E,A){for(var H=this.particles.length,J=E.id,N=this.smoothingRadius*
this.smoothingRadius,U=0;U!==H;U++){var p=this.particles[U];p.position.vsub(E.position,q);J!==p.id&&q.norm2()<N&&A.push(p)}};var l=new n,k=new n,u=new n,r=new n,z=new n,C=new n;f.prototype.update=function(){for(var E=this.particles.length,A=this.speedOfSound,H=this.eps,J=0;J!==E;J++){var N=this.particles[J],U=this.neighbors[J];U.length=0;this.getNeighbors(N,U);U.push(this.particles[J]);for(var p=U.length,x=0,G=0;G!==p;G++){N.position.vsub(U[G].position,l);var e=l.norm();e=this.w(e);x+=U[G].mass*e}this.densities[J]=
x;this.pressures[J]=A*A*(this.densities[J]-this.density)}for(J=0;J!==E;J++){A=this.particles[J];k.set(0,0,0);u.set(0,0,0);U=this.neighbors[J];p=U.length;for(G=0;G!==p;G++)x=U[G],A.position.vsub(x.position,z),e=z.norm(),N=-x.mass*(this.pressures[J]/(this.densities[J]*this.densities[J]+H)+this.pressures[G]/(this.densities[G]*this.densities[G]+H)),this.gradw(z,r),r.mult(N,r),k.vadd(r,k),x.velocity.vsub(A.velocity,C),C.mult(1/(1E-4+this.densities[J]*this.densities[G])*this.viscosity*x.mass,C),N=this.nablaw(e),
C.mult(N,C),u.vadd(C,u);u.mult(A.mass,u);k.mult(A.mass,k);A.force.vadd(u,A.force);A.force.vadd(k,A.force)}};f.prototype.w=function(E){var A=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(A,9))*Math.pow(A*A-E*E,3)};f.prototype.gradw=function(E,A){var H=E.norm(),J=this.smoothingRadius;E.mult(945/(32*Math.PI*Math.pow(J,9))*Math.pow(J*J-H*H,2),A)};f.prototype.nablaw=function(E){var A=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(A,9))*(A*A-E*E)*(7*E*E-3*A*A)}},{"../material/Material":25,
"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(h,n){function f(U,p,x){x=x||{};this.restLength="number"==typeof x.restLength?x.restLength:1;this.stiffness=x.stiffness||100;this.damping=x.damping||1;this.bodyA=U;this.bodyB=p;this.localAnchorA=new q;this.localAnchorB=new q;x.localAnchorA&&this.localAnchorA.copy(x.localAnchorA);x.localAnchorB&&this.localAnchorB.copy(x.localAnchorB);x.worldAnchorA&&this.setWorldAnchorA(x.worldAnchorA);
x.worldAnchorB&&this.setWorldAnchorB(x.worldAnchorB)}var q=h("../math/Vec3");n.exports=f;f.prototype.setWorldAnchorA=function(U){this.bodyA.pointToLocalFrame(U,this.localAnchorA)};f.prototype.setWorldAnchorB=function(U){this.bodyB.pointToLocalFrame(U,this.localAnchorB)};f.prototype.getWorldAnchorA=function(U){this.bodyA.pointToWorldFrame(this.localAnchorA,U)};f.prototype.getWorldAnchorB=function(U){this.bodyB.pointToWorldFrame(this.localAnchorB,U)};var l=new q,k=new q,u=new q,r=new q,z=new q,C=new q,
E=new q,A=new q,H=new q,J=new q,N=new q;f.prototype.applyForce=function(){var U=this.stiffness,p=this.damping,x=this.restLength,G=this.bodyA,e=this.bodyB;this.getWorldAnchorA(z);this.getWorldAnchorB(C);z.vsub(G.position,E);C.vsub(e.position,A);C.vsub(z,l);var m=l.norm();k.copy(l);k.normalize();e.velocity.vsub(G.velocity,u);e.angularVelocity.cross(A,N);u.vadd(N,u);G.angularVelocity.cross(E,N);u.vsub(N,u);k.mult(-U*(m-x)-p*u.dot(k),r);G.force.vsub(r,G.force);e.force.vadd(r,e.force);E.cross(r,H);A.cross(r,
J);G.torque.vsub(H,G.torque);e.torque.vadd(J,e.torque)}},{"../math/Vec3":30}],36:[function(h,n){function f(C){C=u.defaults(C,{chassisConnectionPointLocal:new q,chassisConnectionPointWorld:new q,directionLocal:new q,directionWorld:new q,axleLocal:new q,axleWorld:new q,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1E4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,
clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=C.maxSuspensionTravel;this.customSlidingRotationalSpeed=C.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=C.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=C.chassisConnectionPointLocal.clone();this.chassisConnectionPointWorld=
C.chassisConnectionPointWorld.clone();this.directionLocal=C.directionLocal.clone();this.directionWorld=C.directionWorld.clone();this.axleLocal=C.axleLocal.clone();this.axleWorld=C.axleWorld.clone();this.suspensionRestLength=C.suspensionRestLength;this.suspensionMaxLength=C.suspensionMaxLength;this.radius=C.radius;this.suspensionStiffness=C.suspensionStiffness;this.dampingCompression=C.dampingCompression;this.dampingRelaxation=C.dampingRelaxation;this.frictionSlip=C.frictionSlip;this.deltaRotation=
this.rotation=this.steering=0;this.rollInfluence=C.rollInfluence;this.maxSuspensionForce=C.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=C.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=this.suspensionLength=this.skidInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new k;this.worldTransform=new l;this.isInContact=!1}var q=h("../math/Vec3"),l=h("../math/Transform"),k=h("../collision/RaycastResult"),u=h("../utils/Utils");
n.exports=f;var r=new q,z=new q;r=new q;f.prototype.updateWheel=function(C){var E=this.raycastResult;if(this.isInContact){var A=E.hitNormalWorld.dot(E.directionWorld);E.hitPointWorld.vsub(C.position,z);C.getVelocityAtWorldPoint(z,r);C=E.hitNormalWorld.dot(r);-.1<=A?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(A=-1/A,this.suspensionRelativeVelocity=C*A,this.clippedInvContactDotSuspension=A)}else E.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=
0,E.directionWorld.scale(-1,E.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(h,n){function f(z){q.call(this);this.type=q.types.BOX;this.halfExtents=z;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}n.exports=f;var q=h("./Shape"),l=h("../math/Vec3"),k=h("./ConvexPolyhedron");f.prototype=new q;f.prototype.constructor=
f;f.prototype.updateConvexPolyhedronRepresentation=function(){var z=this.halfExtents.x,C=this.halfExtents.y,E=this.halfExtents.z;z=[new l(-z,-C,-E),new l(z,-C,-E),new l(z,C,-E),new l(-z,C,-E),new l(-z,-C,E),new l(z,-C,E),new l(z,C,E),new l(-z,C,E)];this.convexPolyhedronRepresentation=z=(new l(0,0,1),new l(0,1,0),new l(1,0,0),new k(z,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));z.material=this.material};f.prototype.calculateLocalInertia=function(z,C){return C=C||new l,f.calculateInertia(this.halfExtents,
z,C),C};f.calculateInertia=function(z,C,E){E.x=1/12*C*(4*z.y*z.y+4*z.z*z.z);E.y=1/12*C*(4*z.x*z.x+4*z.z*z.z);E.z=1/12*C*(4*z.y*z.y+4*z.x*z.x)};f.prototype.getSideNormals=function(z,C){var E=this.halfExtents;if(z[0].set(E.x,0,0),z[1].set(0,E.y,0),z[2].set(0,0,E.z),z[3].set(-E.x,0,0),z[4].set(0,-E.y,0),z[5].set(0,0,-E.z),void 0!==C)for(E=0;E!==z.length;E++)C.vmult(z[E],z[E]);return z};f.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};f.prototype.updateBoundingSphereRadius=
function(){this.boundingSphereRadius=this.halfExtents.norm()};var u=new l;new l;f.prototype.forEachWorldCorner=function(z,C,E){var A=this.halfExtents;A=[[A.x,A.y,A.z],[-A.x,A.y,A.z],[-A.x,-A.y,A.z],[-A.x,-A.y,-A.z],[A.x,-A.y,-A.z],[A.x,A.y,-A.z],[-A.x,A.y,-A.z],[A.x,-A.y,A.z]];for(var H=0;H<A.length;H++)u.set(A[H][0],A[H][1],A[H][2]),C.vmult(u,u),z.vadd(u,u),E(u.x,u.y,u.z)};var r=[new l,new l,new l,new l,new l,new l,new l,new l];f.prototype.calculateWorldAABB=function(z,C,E,A){var H=this.halfExtents;
r[0].set(H.x,H.y,H.z);r[1].set(-H.x,H.y,H.z);r[2].set(-H.x,-H.y,H.z);r[3].set(-H.x,-H.y,-H.z);r[4].set(H.x,-H.y,-H.z);r[5].set(H.x,H.y,-H.z);r[6].set(-H.x,H.y,-H.z);r[7].set(H.x,-H.y,H.z);var J=r[0];C.vmult(J,J);z.vadd(J,J);A.copy(J);E.copy(J);for(H=1;8>H;H++){J=r[H];C.vmult(J,J);z.vadd(J,J);var N=J.x,U=J.y;J=J.z;N>A.x&&(A.x=N);U>A.y&&(A.y=U);J>A.z&&(A.z=J);N<E.x&&(E.x=N);U<E.y&&(E.y=U);J<E.z&&(E.z=J)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(h,n){function f(ba,ea,
ka){q.call(this);this.type=q.types.CONVEXPOLYHEDRON;this.vertices=ba||[];this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.faces=ea||[];this.faceNormals=[];this.computeNormals();this.worldFaceNormalsNeedsUpdate=!0;this.worldFaceNormals=[];this.uniqueEdges=[];this.uniqueAxes=ka?ka.slice():null;this.computeEdges();this.updateBoundingSphereRadius()}n.exports=f;var q=h("./Shape"),l=h("../math/Vec3"),k=(h("../math/Quaternion"),h("../math/Transform"));f.prototype=new q;f.prototype.constructor=
f;var u=new l;f.prototype.computeEdges=function(){for(var ba=this.faces,ea=this.vertices,ka=(ea.length,this.uniqueEdges),O=ka.length=0;O!==ba.length;O++)for(var Y=ba[O],da=Y.length,pa=0;pa!==da;pa++){ea[Y[pa]].vsub(ea[Y[(pa+1)%da]],u);u.normalize();for(var ma=!1,wa=0;wa!==ka.length;wa++)if(ka[wa].almostEquals(u)||ka[wa].almostEquals(u)){ma=!0;break}ma||ka.push(u.clone())}};f.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var ba=0;ba<this.faces.length;ba++){for(var ea=
0;ea<this.faces[ba].length;ea++)if(!this.vertices[this.faces[ba][ea]])throw Error("Vertex "+this.faces[ba][ea]+" not found!");ea=this.faceNormals[ba]||new l;this.getFaceNormal(ba,ea);ea.negate(ea);this.faceNormals[ba]=ea;if(0>ea.dot(this.vertices[this.faces[ba][0]]))for(console.error(".faceNormals["+ba+"] = Vec3("+ea.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),ea=0;ea<this.faces[ba].length;ea++)console.warn(".vertices["+
this.faces[ba][ea]+"] = Vec3("+this.vertices[this.faces[ba][ea]].toString()+")")}};var r=new l,z=new l;f.computeNormal=function(ba,ea,ka,O){ea.vsub(ba,z);ka.vsub(ea,r);r.cross(z,O);O.isZero()||O.normalize()};f.prototype.getFaceNormal=function(ba,ea){ba=this.faces[ba];return f.computeNormal(this.vertices[ba[0]],this.vertices[ba[1]],this.vertices[ba[2]],ea)};var C=new l;f.prototype.clipAgainstHull=function(ba,ea,ka,O,Y,da,pa,ma,wa){for(var Ca=-1,ya=-Number.MAX_VALUE,za=0;za<ka.faces.length;za++){C.copy(ka.faceNormals[za]);
Y.vmult(C,C);var ob=C.dot(da);ob>ya&&(ya=ob,Ca=za)}ya=[];za=ka.faces[Ca];ob=za.length;for(var nb=0;ob>nb;nb++){var Ab=ka.vertices[za[nb]],rb=new l;rb.copy(Ab);Y.vmult(rb,rb);O.vadd(rb,rb);ya.push(rb)}0<=Ca&&this.clipFaceAgainstHull(da,ba,ea,ya,pa,ma,wa)};var E=new l,A=new l,H=new l,J=new l,N=new l,U=new l;f.prototype.findSeparatingAxis=function(ba,ea,ka,O,Y,da,pa,ma){var wa=Number.MAX_VALUE,Ca=0;if(this.uniqueAxes)for(var ya=0;ya!==this.uniqueAxes.length;ya++){ka.vmult(this.uniqueAxes[ya],E);var za=
this.testSepAxis(E,ba,ea,ka,O,Y);if(!1===za)return!1;wa>za&&(wa=za,da.copy(E))}else{var ob=pa?pa.length:this.faces.length;for(ya=0;ob>ya;ya++){za=pa?pa[ya]:ya;E.copy(this.faceNormals[za]);ka.vmult(E,E);za=this.testSepAxis(E,ba,ea,ka,O,Y);if(!1===za)return!1;wa>za&&(wa=za,da.copy(E))}}if(ba.uniqueAxes)for(ya=0;ya!==ba.uniqueAxes.length;ya++){Y.vmult(ba.uniqueAxes[ya],A);Ca++;za=this.testSepAxis(A,ba,ea,ka,O,Y);if(!1===za)return!1;wa>za&&(wa=za,da.copy(A))}else for(pa=ma?ma.length:ba.faces.length,ya=
0;pa>ya;ya++){za=ma?ma[ya]:ya;A.copy(ba.faceNormals[za]);Y.vmult(A,A);Ca++;za=this.testSepAxis(A,ba,ea,ka,O,Y);if(!1===za)return!1;wa>za&&(wa=za,da.copy(A))}for(ma=0;ma!==this.uniqueEdges.length;ma++)for(ka.vmult(this.uniqueEdges[ma],J),Ca=0;Ca!==ba.uniqueEdges.length;Ca++)if(Y.vmult(ba.uniqueEdges[Ca],N),J.cross(N,U),!U.almostZero()){U.normalize();ya=this.testSepAxis(U,ba,ea,ka,O,Y);if(!1===ya)return!1;wa>ya&&(wa=ya,da.copy(U))}return O.vsub(ea,H),0<H.dot(da)&&da.negate(da),!0};var p=[],x=[];f.prototype.testSepAxis=
function(ba,ea,ka,O,Y,da){f.project(this,ba,ka,O,p);f.project(ea,ba,Y,da,x);ka=p[0];ba=p[1];ea=x[0];O=x[1];if(O>ka||ba>ea)return!1;ka-=O;ba=ea-ba;return ba>ka?ka:ba};var G=new l,e=new l;f.prototype.calculateLocalInertia=function(ba,ea){this.computeLocalAABB(G,e);var ka=e.x-G.x,O=e.y-G.y,Y=e.z-G.z;ea.x=1/12*ba*(4*O*O+4*Y*Y);ea.y=1/12*ba*(4*ka*ka+4*Y*Y);ea.z=1/12*ba*(4*O*O+4*ka*ka)};f.prototype.getPlaneConstantOfFace=function(ba){return-this.faceNormals[ba].dot(this.vertices[this.faces[ba][0]])};var m=
new l,v=new l,D=new l,B=new l,I=new l,L=new l,S=new l,R=new l;f.prototype.clipFaceAgainstHull=function(ba,ea,ka,O,Y,da,pa){for(var ma=[],wa=-1,Ca=Number.MAX_VALUE,ya=0;ya<this.faces.length;ya++){m.copy(this.faceNormals[ya]);ka.vmult(m,m);var za=m.dot(ba);Ca>za&&(Ca=za,wa=ya)}if(!(0>wa)){ba=this.faces[wa];ba.connectedFaces=[];for(Ca=0;Ca<this.faces.length;Ca++)for(ya=0;ya<this.faces[Ca].length;ya++)-1!==ba.indexOf(this.faces[Ca][ya])&&Ca!==wa&&-1===ba.connectedFaces.indexOf(Ca)&&ba.connectedFaces.push(Ca);
Ca=(O.length,ba.length);for(ya=0;Ca>ya;ya++){za=this.vertices[ba[ya]];za.vsub(this.vertices[ba[(ya+1)%Ca]],v);D.copy(v);ka.vmult(D,D);ea.vadd(D,D);B.copy(this.faceNormals[wa]);ka.vmult(B,B);ea.vadd(B,B);D.cross(B,I);I.negate(I);L.copy(za);ka.vmult(L,L);ea.vadd(L,L);za=(-L.dot(I),ba.connectedFaces[ya]);S.copy(this.faceNormals[za]);za=this.getPlaneConstantOfFace(za);R.copy(S);ka.vmult(R,R);za-=R.dot(ea);for(this.clipFaceAgainstPlane(O,ma,R,za);O.length;)O.shift();for(;ma.length;)O.push(ma.shift())}S.copy(this.faceNormals[wa]);
za=this.getPlaneConstantOfFace(wa);R.copy(S);ka.vmult(R,R);za-=R.dot(ea);for(Ca=0;Ca<O.length;Ca++)if(ea=R.dot(O[Ca])+za,Y>=ea&&(console.log("clamped: depth="+ea+" to minDist="+(Y+"")),ea=Y),da>=ea)ka=O[Ca],0>=ea&&pa.push({point:ka,normal:R,depth:ea})}};f.prototype.clipFaceAgainstPlane=function(ba,ea,ka,O){var Y,da=ba.length;if(2>da)return ea;var pa=ba[ba.length-1],ma=ba[0];var wa=ka.dot(pa)+O;for(var Ca=0;da>Ca;Ca++){if(ma=ba[Ca],Y=ka.dot(ma)+O,0>wa){if(0>Y){var ya=new l;ya.copy(ma)}else ya=new l,
pa.lerp(ma,wa/(wa-Y),ya);ea.push(ya)}else 0>Y&&(ya=new l,pa.lerp(ma,wa/(wa-Y),ya),ea.push(ya),ea.push(ma));pa=ma;wa=Y}return ea};f.prototype.computeWorldVertices=function(ba,ea){for(var ka=this.vertices.length;this.worldVertices.length<ka;)this.worldVertices.push(new l);for(var O=this.vertices,Y=this.worldVertices,da=0;da!==ka;da++)ea.vmult(O[da],Y[da]),ba.vadd(Y[da],Y[da]);this.worldVerticesNeedsUpdate=!1};new l;f.prototype.computeLocalAABB=function(ba,ea){var ka=this.vertices.length,O=this.vertices;
ba.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);ea.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var Y=0;ka>Y;Y++){var da=O[Y];da.x<ba.x?ba.x=da.x:da.x>ea.x&&(ea.x=da.x);da.y<ba.y?ba.y=da.y:da.y>ea.y&&(ea.y=da.y);da.z<ba.z?ba.z=da.z:da.z>ea.z&&(ea.z=da.z)}};f.prototype.computeWorldFaceNormals=function(ba){for(var ea=this.faceNormals.length;this.worldFaceNormals.length<ea;)this.worldFaceNormals.push(new l);for(var ka=this.faceNormals,O=this.worldFaceNormals,Y=0;Y!==ea;Y++)ba.vmult(ka[Y],
O[Y]);this.worldFaceNormalsNeedsUpdate=!1};f.prototype.updateBoundingSphereRadius=function(){for(var ba=0,ea=this.vertices,ka=0,O=ea.length;ka!==O;ka++){var Y=ea[ka].norm2();Y>ba&&(ba=Y)}this.boundingSphereRadius=Math.sqrt(ba)};var W=new l;f.prototype.calculateWorldAABB=function(ba,ea,ka,O){for(var Y,da,pa,ma,wa,Ca,ya=this.vertices.length,za=this.vertices,ob=0;ya>ob;ob++){W.copy(za[ob]);ea.vmult(W,W);ba.vadd(W,W);var nb=W;nb.x<Y||void 0===Y?Y=nb.x:(nb.x>ma||void 0===ma)&&(ma=nb.x);nb.y<da||void 0===
da?da=nb.y:(nb.y>wa||void 0===wa)&&(wa=nb.y);nb.z<pa||void 0===pa?pa=nb.z:(nb.z>Ca||void 0===Ca)&&(Ca=nb.z)}ka.set(Y,da,pa);O.set(ma,wa,Ca)};f.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};f.prototype.getAveragePointLocal=function(ba){ba=ba||new l;for(var ea=this.vertices.length,ka=this.vertices,O=0;ea>O;O++)ba.vadd(ka[O],ba);return ba.mult(1/ea,ba),ba};f.prototype.transformAllPoints=function(ba,ea){var ka=this.vertices.length,O=this.vertices;if(ea){for(var Y=0;ka>Y;Y++){var da=
O[Y];ea.vmult(da,da)}for(Y=0;Y<this.faceNormals.length;Y++)da=this.faceNormals[Y],ea.vmult(da,da)}if(ba)for(Y=0;ka>Y;Y++)da=O[Y],da.vadd(ba,da)};var X=new l,V=new l,la=new l;f.prototype.pointIsInside=function(ba){var ea=this.vertices,ka=this.faces,O=this.faceNormals,Y=this.faces.length;this.getAveragePointLocal(X);for(var da=0;Y>da;da++){var pa=(this.faces[da].length,O[da]);var ma=ea[ka[da][0]],wa=V;ba.vsub(ma,wa);wa=pa.dot(wa);var Ca=la;X.vsub(ma,Ca);pa=pa.dot(Ca);if(0>wa&&0<pa||0<wa&&0>pa)return!1}return-1};
var fa=(new l,new l),ha=new l;f.project=function(ba,ea,ka,O,Y){var da=ba.vertices.length;ba=ba.vertices;ha.setZero();k.vectorToLocalFrame(ka,O,ea,fa);k.pointToLocalFrame(ka,O,ha,ha);O=ha.dot(fa);ka=ea=ba[0].dot(fa);for(var pa=1;da>pa;pa++){var ma=ba[pa].dot(fa);ma>ea&&(ea=ma);ka>ma&&(ka=ma)}if(ka-=O,ea-=O,ka>ea)da=ka,ka=ea,ea=da;Y[0]=ea;Y[1]=ka}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(h,n){function f(u,r,z,C){var E=[],A=[],H=[],J=[],N=[],U=Math.cos,
p=Math.sin;E.push(new l(r*U(0),r*p(0),.5*-z));J.push(0);E.push(new l(u*U(0),u*p(0),.5*z));N.push(1);for(var x=0;C>x;x++){var G=2*Math.PI/C*(x+1),e=2*Math.PI/C*(x+.5);C-1>x?(E.push(new l(r*U(G),r*p(G),.5*-z)),J.push(2*x+2),E.push(new l(u*U(G),u*p(G),.5*z)),N.push(2*x+3),H.push([2*x+2,2*x+3,2*x+1,2*x])):H.push([0,1,2*x+1,2*x]);(1===C%2||C/2>x)&&A.push(new l(U(e),p(e),0))}H.push(N);A.push(new l(0,0,1));u=[];for(x=0;x<J.length;x++)u.push(J[J.length-x-1]);H.push(u);this.type=q.types.CONVEXPOLYHEDRON;k.call(this,
E,H,A)}n.exports=f;var q=h("./Shape"),l=h("../math/Vec3"),k=(h("../math/Quaternion"),h("./ConvexPolyhedron"));f.prototype=new k},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(h,n){function f(r,z){z=u.defaults(z,{maxValue:null,minValue:null,elementSize:1});this.data=r;this.maxValue=z.maxValue;this.minValue=z.minValue;this.elementSize=z.elementSize;null===z.minValue&&this.updateMinValue();null===z.maxValue&&this.updateMaxValue();this.cacheEnabled=!0;
q.call(this);this.pillarConvex=new l;this.pillarOffset=new k;this.type=q.types.HEIGHTFIELD;this.updateBoundingSphereRadius();this._cachedPillars={}}var q=h("./Shape"),l=h("./ConvexPolyhedron"),k=h("../math/Vec3"),u=h("../utils/Utils");n.exports=f;f.prototype=new q;f.prototype.update=function(){this._cachedPillars={}};f.prototype.updateMinValue=function(){for(var r=this.data,z=r[0][0],C=0;C!==r.length;C++)for(var E=0;E!==r[C].length;E++){var A=r[C][E];z>A&&(z=A)}this.minValue=z};f.prototype.updateMaxValue=
function(){for(var r=this.data,z=r[0][0],C=0;C!==r.length;C++)for(var E=0;E!==r[C].length;E++){var A=r[C][E];A>z&&(z=A)}this.maxValue=z};f.prototype.setHeightValueAtIndex=function(r,z,C){this.data[r][z]=C;this.clearCachedConvexTrianglePillar(r,z,!1);0<r&&(this.clearCachedConvexTrianglePillar(r-1,z,!0),this.clearCachedConvexTrianglePillar(r-1,z,!1));0<z&&(this.clearCachedConvexTrianglePillar(r,z-1,!0),this.clearCachedConvexTrianglePillar(r,z-1,!1));0<z&&0<r&&this.clearCachedConvexTrianglePillar(r-
1,z-1,!0)};f.prototype.getRectMinMax=function(r,z,C,E,A){A=A||[];for(var H=this.data,J=this.minValue;C>=r;r++)for(var N=z;E>=N;N++){var U=H[r][N];U>J&&(J=U)}A[0]=this.minValue;A[1]=J};f.prototype.getIndexOfPosition=function(r,z,C,E){var A=this.elementSize,H=this.data;r=Math.floor(r/A);z=Math.floor(z/A);return C[0]=r,C[1]=z,E&&(0>r&&(r=0),0>z&&(z=0),r>=H.length-1&&(r=H.length-1),z>=H[0].length-1&&(z=H[0].length-1)),0>r||0>z||r>=H.length-1||z>=H[0].length-1?!1:!0};f.prototype.getHeightAt=function(r,
z,C){var E=[];this.getIndexOfPosition(r,z,E,C);r=[];return this.getRectMinMax(E[0],E[1]+1,E[0],E[1]+1,r),(r[0]+r[1])/2};f.prototype.getCacheConvexTrianglePillarKey=function(r,z,C){return r+"_"+z+"_"+(C?1:0)};f.prototype.getCachedConvexTrianglePillar=function(r,z,C){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(r,z,C)]};f.prototype.setCachedConvexTrianglePillar=function(r,z,C,E,A){this._cachedPillars[this.getCacheConvexTrianglePillarKey(r,z,C)]={convex:E,offset:A}};f.prototype.clearCachedConvexTrianglePillar=
function(r,z,C){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(r,z,C)]};f.prototype.getConvexTrianglePillar=function(r,z,C){var E=this.pillarConvex,A=this.pillarOffset;if(this.cacheEnabled){var H=this.getCachedConvexTrianglePillar(r,z,C);if(H)return this.pillarConvex=H.convex,void(this.pillarOffset=H.offset);E=new l;A=new k;this.pillarConvex=E;this.pillarOffset=A}H=this.data;var J=this.elementSize,N=E.faces;E.vertices.length=6;for(var U=0;6>U;U++)E.vertices[U]||(E.vertices[U]=new k);
N.length=5;for(U=0;5>U;U++)N[U]||(N[U]=[]);U=E.vertices;var p=(Math.min(H[r][z],H[r+1][z],H[r][z+1],H[r+1][z+1])-this.minValue)/2+this.minValue;C?(A.set((r+.75)*J,(z+.75)*J,p),U[0].set(.25*J,.25*J,H[r+1][z+1]-p),U[1].set(-.75*J,.25*J,H[r][z+1]-p),U[2].set(.25*J,-.75*J,H[r+1][z]-p),U[3].set(.25*J,.25*J,-p-1),U[4].set(-.75*J,.25*J,-p-1),U[5].set(.25*J,-.75*J,-p-1),N[0][0]=0,N[0][1]=1,N[0][2]=2,N[1][0]=5,N[1][1]=4,N[1][2]=3,N[2][0]=2,N[2][1]=5,N[2][2]=3,N[2][3]=0,N[3][0]=3,N[3][1]=4,N[3][2]=1,N[3][3]=
0,N[4][0]=1,N[4][1]=4,N[4][2]=5,N[4][3]=2):(A.set((r+.25)*J,(z+.25)*J,p),U[0].set(-.25*J,-.25*J,H[r][z]-p),U[1].set(.75*J,-.25*J,H[r+1][z]-p),U[2].set(-.25*J,.75*J,H[r][z+1]-p),U[3].set(-.25*J,-.25*J,-p-1),U[4].set(.75*J,-.25*J,-p-1),U[5].set(-.25*J,.75*J,-p-1),N[0][0]=0,N[0][1]=1,N[0][2]=2,N[1][0]=5,N[1][1]=4,N[1][2]=3,N[2][0]=0,N[2][1]=2,N[2][2]=5,N[2][3]=3,N[3][0]=1,N[3][1]=0,N[3][2]=3,N[3][3]=4,N[4][0]=4,N[4][1]=5,N[4][2]=2,N[4][3]=1);E.computeNormals();E.computeEdges();E.updateBoundingSphereRadius();
this.setCachedConvexTrianglePillar(r,z,C,E,A)};f.prototype.calculateLocalInertia=function(r,z){return z=z||new k,z.set(0,0,0),z};f.prototype.volume=function(){return Number.MAX_VALUE};f.prototype.calculateWorldAABB=function(r,z,C,E){C.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);E.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};f.prototype.updateBoundingSphereRadius=function(){var r=this.data,z=this.elementSize;this.boundingSphereRadius=(new k(r.length*z,r[0].length*z,Math.max(Math.abs(this.maxValue),
Math.abs(this.minValue)))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(h,n){function f(){q.call(this);this.type=q.types.PARTICLE}n.exports=f;var q=h("./Shape"),l=h("../math/Vec3");f.prototype=new q;f.prototype.constructor=f;f.prototype.calculateLocalInertia=function(k,u){return u=u||new l,u.set(0,0,0),u};f.prototype.volume=function(){return 0};f.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0};f.prototype.calculateWorldAABB=
function(k,u,r,z){r.copy(k);z.copy(k)}},{"../math/Vec3":30,"./Shape":43}],42:[function(h,n){function f(){q.call(this);this.type=q.types.PLANE;this.worldNormal=new l;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}n.exports=f;var q=h("./Shape"),l=h("../math/Vec3");f.prototype=new q;f.prototype.constructor=f;f.prototype.computeWorldNormal=function(u){var r=this.worldNormal;r.set(0,0,1);u.vmult(r,r);this.worldNormalNeedsUpdate=!1};f.prototype.calculateLocalInertia=function(u,
r){return r||new l};f.prototype.volume=function(){return Number.MAX_VALUE};var k=new l;f.prototype.calculateWorldAABB=function(u,r,z,C){k.set(0,0,1);r.vmult(k,k);r=Number.MAX_VALUE;z.set(-r,-r,-r);C.set(r,r,r);1===k.x&&(C.x=u.x);1===k.y&&(C.y=u.y);1===k.z&&(C.z=u.z);-1===k.x&&(z.x=u.x);-1===k.y&&(z.y=u.y);-1===k.z&&(z.z=u.z)};f.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(h,n){function f(){this.id=f.idCounter++;
this.boundingSphereRadius=this.type=0;this.collisionResponse=!0;this.material=null}n.exports=f;f=h("./Shape");h("../math/Vec3");h("../math/Quaternion");h("../material/Material");f.prototype.constructor=f;f.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type;};f.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type;};f.prototype.calculateLocalInertia=function(){throw"calculateLocalInertia() not implemented for shape type "+
this.type;};f.idCounter=0;f.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(h,n){function f(k){if(q.call(this),this.radius=void 0!==k?Number(k):1,this.type=q.types.SPHERE,0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}n.exports=f;var q=h("./Shape"),l=h("../math/Vec3");f.prototype=new q;
f.prototype.constructor=f;f.prototype.calculateLocalInertia=function(k,u){u=u||new l;k=2*k*this.radius*this.radius/5;return u.x=k,u.y=k,u.z=k,u};f.prototype.volume=function(){return 4*Math.PI*this.radius/3};f.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius};f.prototype.calculateWorldAABB=function(k,u,r,z){u=this.radius;for(var C=["x","y","z"],E=0;E<C.length;E++){var A=C[E];r[A]=k[A]-u;z[A]=k[A]+u}}},{"../math/Vec3":30,"./Shape":43}],45:[function(h,n){function f(v,
D){q.call(this);this.type=q.types.TRIMESH;this.vertices=new Float32Array(v);this.indices=new Int16Array(D);this.normals=new Float32Array(D.length);this.aabb=new u;this.edges=null;this.scale=new l(1,1,1);this.tree=new r;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();this.updateTree()}n.exports=f;var q=h("./Shape"),l=h("../math/Vec3"),k=(h("../math/Quaternion"),h("../math/Transform")),u=h("../collision/AABB"),r=h("../utils/Octree");f.prototype=new q;f.prototype.constructor=
f;var z=new l;f.prototype.updateTree=function(){var v=this.tree;v.reset();v.aabb.copy(this.aabb);var D=this.scale;v.aabb.lowerBound.x*=1/D.x;v.aabb.lowerBound.y*=1/D.y;v.aabb.lowerBound.z*=1/D.z;v.aabb.upperBound.x*=1/D.x;v.aabb.upperBound.y*=1/D.y;v.aabb.upperBound.z*=1/D.z;D=new u;for(var B=new l,I=new l,L=new l,S=[B,I,L],R=0;R<this.indices.length/3;R++){var W=3*R;this._getUnscaledVertex(this.indices[W],B);this._getUnscaledVertex(this.indices[W+1],I);this._getUnscaledVertex(this.indices[W+2],L);
D.setFromPoints(S);v.insert(D,R)}v.removeEmptyNodes()};var C=new u;f.prototype.getTrianglesInAABB=function(v,D){C.copy(v);var B=this.scale;v=B.x;var I=B.y;B=B.z;var L=C.lowerBound,S=C.upperBound;return L.x/=v,L.y/=I,L.z/=B,S.x/=v,S.y/=I,S.z/=B,this.tree.aabbQuery(C,D)};f.prototype.setScale=function(v){var D=v.x===v.y===v.z;this.scale.x===this.scale.y===this.scale.z&&D||this.updateNormals();this.scale.copy(v);this.updateAABB();this.updateBoundingSphereRadius()};f.prototype.updateNormals=function(){for(var v=
this.normals,D=0;D<this.indices.length/3;D++){var B=3*D,I=this.indices[B+1],L=this.indices[B+2];this.getVertex(this.indices[B],N);this.getVertex(I,U);this.getVertex(L,p);f.computeNormal(U,N,p,z);v[B]=z.x;v[B+1]=z.y;v[B+2]=z.z}};f.prototype.updateEdges=function(){for(var v={},D=function(){v[S>L?L+"_"+S:S+"_"+L]=!0},B=0;B<this.indices.length/3;B++){var I=3*B,L=this.indices[I],S=this.indices[I+1];I=this.indices[I+2];D(L,S);D(S,I);D(I,L)}D=Object.keys(v);this.edges=new Int16Array(2*D.length);for(B=0;B<
D.length;B++)I=D[B].split("_"),this.edges[2*B]=parseInt(I[0],10),this.edges[2*B+1]=parseInt(I[1],10)};f.prototype.getEdgeVertex=function(v,D,B){this.getVertex(this.edges[2*v+(D?1:0)],B)};var E=new l,A=new l;f.prototype.getEdgeVector=function(v,D){this.getEdgeVertex(v,0,E);this.getEdgeVertex(v,1,A);A.vsub(E,D)};var H=new l,J=new l;f.computeNormal=function(v,D,B,I){D.vsub(v,J);B.vsub(D,H);H.cross(J,I);I.isZero()||I.normalize()};var N=new l,U=new l,p=new l;f.prototype.getVertex=function(v,D){var B=this.scale;
return this._getUnscaledVertex(v,D),D.x*=B.x,D.y*=B.y,D.z*=B.z,D};f.prototype._getUnscaledVertex=function(v,D){v*=3;var B=this.vertices;return D.set(B[v],B[v+1],B[v+2])};f.prototype.getWorldVertex=function(v,D,B,I){return this.getVertex(v,I),k.pointToWorldFrame(D,B,I,I),I};f.prototype.getTriangleVertices=function(v,D,B,I){v*=3;this.getVertex(this.indices[v],D);this.getVertex(this.indices[v+1],B);this.getVertex(this.indices[v+2],I)};f.prototype.getNormal=function(v,D){v*=3;return D.set(this.normals[v],
this.normals[v+1],this.normals[v+2])};var x=new u;f.prototype.calculateLocalInertia=function(v,D){this.computeLocalAABB(x);var B=x.upperBound.x-x.lowerBound.x,I=x.upperBound.y-x.lowerBound.y,L=x.upperBound.z-x.lowerBound.z;return D.set(1/12*v*(4*I*I+4*L*L),1/12*v*(4*B*B+4*L*L),1/12*v*(4*I*I+4*B*B))};var G=new l;f.prototype.computeLocalAABB=function(v){var D=v.lowerBound;v=v.upperBound;var B=this.vertices.length,I=(this.vertices,G);this.getVertex(0,I);D.copy(I);v.copy(I);for(var L=0;L!==B;L++)this.getVertex(L,
I),I.x<D.x?D.x=I.x:I.x>v.x&&(v.x=I.x),I.y<D.y?D.y=I.y:I.y>v.y&&(v.y=I.y),I.z<D.z?D.z=I.z:I.z>v.z&&(v.z=I.z)};f.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)};f.prototype.updateBoundingSphereRadius=function(){var v=0,D=this.vertices,B=new l,I=0;for(D=D.length/3;I!==D;I++){this.getVertex(I,B);var L=B.norm2();L>v&&(v=L)}this.boundingSphereRadius=Math.sqrt(v)};var e=(new l,new k),m=new u;f.prototype.calculateWorldAABB=function(v,D,B,I){e.position=v;e.quaternion=D;this.aabb.toWorldFrame(e,
m);B.copy(m.lowerBound);I.copy(m.upperBound)};f.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};f.createTorus=function(v,D,B,I,L){v=v||1;D=D||.5;B=B||8;I=I||6;L=L||2*Math.PI;for(var S=[],R=[],W=0;B>=W;W++)for(var X=0;I>=X;X++){var V=X/I*L,la=W/B*Math.PI*2;S.push((v+D*Math.cos(la))*Math.cos(V),(v+D*Math.cos(la))*Math.sin(V),D*Math.sin(la))}for(W=1;B>=W;W++)for(X=1;I>=X;X++)v=(I+1)*(W-1)+X-1,D=(I+1)*(W-1)+X,L=(I+1)*W+X,R.push((I+1)*W+X-1,v,L),R.push(v,D,L);return new f(S,R)}},
{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(h,n){function f(){q.call(this);this.iterations=10;this.tolerance=1E-7}n.exports=f;var q=(h("../math/Vec3"),h("../math/Quaternion"),h("./Solver"));f.prototype=new q;var l=[],k=[],u=[];f.prototype.solve=function(r,z){var C,E=0,A=this.iterations,H=this.tolerance*this.tolerance,J=this.equations,N=J.length;z=z.bodies;var U=z.length;if(0!==N)for(C=0;C!==U;C++)z[C].updateSolveMassProperties();
k.length=N;u.length=N;l.length=N;for(C=0;C!==N;C++){var p=J[C];l[C]=0;u[C]=p.computeB(r);k[C]=1/p.computeC()}if(0!==N){for(C=0;C!==U;C++)p=z[C],E=p.wlambda,p.vlambda.set(0,0,0),E&&E.set(0,0,0);for(E=0;E!==A;E++){for(var x=C=0;x!==N;x++){p=J[x];var G=u[x];var e=k[x];r=l[x];var m=p.computeGWlambda();G=e*(G-m-p.eps*r);r+G<p.minForce?G=p.minForce-r:r+G>p.maxForce&&(G=p.maxForce-r);l[x]+=G;C+=0<G?G:-G;p.addToWlambda(G)}if(H>C*C)break}for(C=0;C!==U;C++)p=z[C],A=p.velocity,H=p.angularVelocity,A.vadd(p.vlambda,
A),H&&H.vadd(p.wlambda,H)}return E}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(h,n){function f(){this.equations=[]}n.exports=f;f.prototype.solve=function(){return 0};f.prototype.addEquation=function(q){q.enabled&&this.equations.push(q)};f.prototype.removeEquation=function(q){var l=this.equations;q=l.indexOf(q);-1!==q&&l.splice(q,1)};f.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(h,n){function f(H){u.call(this);this.iterations=10;
this.tolerance=1E-7;this.subsolver=H;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}function q(H){for(var J=H.length,N=0;N!==J;N++){var U=H[N];if(!(U.visited||U.body.type&E))return U}return!1}function l(H,J,N){J.push(H.body);J=H.eqs.length;for(var U=0;U!==J;U++){var p=H.eqs[U];-1===N.indexOf(p)&&N.push(p)}}function k(H,J){return J.id-H.id}n.exports=f;var u=(h("../math/Vec3"),h("../math/Quaternion"),h("./Solver"));h=h("../objects/Body");f.prototype=
new u;var r=[],z=[],C={bodies:[]},E=h.STATIC,A=[];f.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}};f.prototype.solve=function(H,J){var N=this.nodePool,U=J.bodies,p=this.equations,x=p.length,G=U.length;for(J=this.subsolver;N.length<G;)N.push(this.createNode());r.length=G;for(var e=0;G>e;e++)r[e]=N[e];for(e=0;e!==G;e++)N=r[e],N.body=U[e],N.children.length=0,N.eqs.length=0,N.visited=!1;for(N=0;N!==x;N++){G=p[N];e=U.indexOf(G.bi);var m=U.indexOf(G.bj);e=r[e];m=r[m];e.children.push(m);
e.eqs.push(G);m.children.push(e);m.eqs.push(G)}U=0;p=z;J.tolerance=this.tolerance;for(J.iterations=this.iterations;e=q(r);){p.length=0;C.bodies.length=0;G=e;e=l;x=C.bodies;N=p;A.push(G);G.visited=!0;for(e(G,x,N);A.length;)for(m=A.pop();G=q(m.children);)G.visited=!0,e(G,x,N),A.push(G);x=p.length;p=p.sort(k);for(e=0;e!==x;e++)J.addEquation(p[e]);J.solve(H,C);J.removeAllEquations();U++}return U}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(h,n){h=function(){};
n.exports=h;h.prototype={constructor:h,addEventListener:function(f,q){void 0===this._listeners&&(this._listeners={});var l=this._listeners;return void 0===l[f]&&(l[f]=[]),-1===l[f].indexOf(q)&&l[f].push(q),this},hasEventListener:function(f,q){if(void 0===this._listeners)return!1;var l=this._listeners;return void 0!==l[f]&&-1!==l[f].indexOf(q)?!0:!1},removeEventListener:function(f,q){if(void 0===this._listeners)return this;var l=this._listeners;if(void 0===l[f])return this;q=l[f].indexOf(q);return-1!==
q&&l[f].splice(q,1),this},dispatchEvent:function(f){if(void 0===this._listeners)return this;var q=this._listeners[f.type];if(void 0!==q){f.target=this;for(var l=0,k=q.length;k>l;l++)q[l].call(this,f)}return this}}},{}],50:[function(h,n){function f(z){z=z||{};this.root=z.root||null;this.aabb=z.aabb?z.aabb.clone():new l;this.data=[];this.children=[]}function q(z,C){C=C||{};C.root=null;C.aabb=z;f.call(this,C);this.maxDepth="undefined"!=typeof C.maxDepth?C.maxDepth:8}var l=h("../collision/AABB"),k=h("../math/Vec3");
n.exports=q;q.prototype=new f;f.prototype.reset=function(){this.children.length=this.data.length=0};f.prototype.insert=function(z,C,E){var A=this.data;if(E=E||0,!this.aabb.contains(z))return!1;var H=this.children;if(E<(this.maxDepth||this.root.maxDepth)){var J=!1;H.length||(this.subdivide(),J=!0);for(var N=0;8!==N;N++)if(H[N].insert(z,C,E+1))return!0;J&&(H.length=0)}return A.push(C),!0};var u=new k;f.prototype.subdivide=function(){var z=this.aabb,C=z.lowerBound,E=z.upperBound;z=this.children;z.push(new f({aabb:new l({lowerBound:new k(0,
0,0)})}),new f({aabb:new l({lowerBound:new k(1,0,0)})}),new f({aabb:new l({lowerBound:new k(1,1,0)})}),new f({aabb:new l({lowerBound:new k(1,1,1)})}),new f({aabb:new l({lowerBound:new k(0,1,1)})}),new f({aabb:new l({lowerBound:new k(0,0,1)})}),new f({aabb:new l({lowerBound:new k(1,0,1)})}),new f({aabb:new l({lowerBound:new k(0,1,0)})}));E.vsub(C,u);u.scale(.5,u);E=this.root||this;for(var A=0;8!==A;A++){var H=z[A];H.root=E;var J=H.aabb.lowerBound;J.x*=u.x;J.y*=u.y;J.z*=u.z;J.vadd(C,J);J.vadd(u,H.aabb.upperBound)}};
f.prototype.aabbQuery=function(z,C){for(var E=(this.data,this.children,[this]);E.length;){var A=E.pop();A.aabb.overlaps(z)&&Array.prototype.push.apply(C,A.data);Array.prototype.push.apply(E,A.children)}return C};var r=new l;f.prototype.rayQuery=function(z,C,E){return z.getAABB(r),r.toLocalFrame(C,r),this.aabbQuery(r,E),E};f.prototype.removeEmptyNodes=function(){for(var z=[this];z.length;){for(var C=z.pop(),E=C.children.length-1;0<=E;E--)C.children[E].data.length||C.children.splice(E,1);Array.prototype.push.apply(z,
C.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(h,n){function f(){this.objects=[];this.type=Object}n.exports=f;f.prototype.release=function(){for(var q=arguments.length,l=0;l!==q;l++)this.objects.push(arguments[l])};f.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()};f.prototype.constructObject=function(){throw Error("constructObject() not implemented in this Pool subclass yet!");}},{}],52:[function(h,n){function f(){this.data=
{keys:[]}}n.exports=f;f.prototype.get=function(q,l){if(q>l){var k=l;l=q;q=k}return this.data[q+"-"+l]};f.prototype.set=function(q,l,k){if(q>l){var u=l;l=q;q=u}u=q+"-"+l;this.get(q,l)||this.data.keys.push(u);this.data[u]=k};f.prototype.reset=function(){for(var q=this.data,l=q.keys;0<l.length;){var k=l.pop();delete q[k]}}},{}],53:[function(h,n){function f(){}n.exports=f;f.defaults=function(q,l){q=q||{};for(var k in l)k in q||(q[k]=l[k]);return q}},{}],54:[function(h,n){function f(){l.call(this);this.type=
q}n.exports=f;var q=h("../math/Vec3"),l=h("./Pool");f.prototype=new l;f.prototype.constructObject=function(){return new q}},{"../math/Vec3":30,"./Pool":51}],55:[function(h,n){function f(va){this.contactPointPool=[];this.frictionEquationPool=[];this.result=[];this.frictionResult=[];this.v3pool=new z;this.world=va;this.currentContactMaterial=null;this.enableFrictionReduction=!1}n.exports=f;n=h("../collision/AABB");var q=h("../shapes/Shape"),l=h("../collision/Ray"),k=h("../math/Vec3"),u=h("../math/Transform"),
r=(h("../shapes/ConvexPolyhedron"),h("../math/Quaternion")),z=(h("../solver/Solver"),h("../utils/Vec3Pool")),C=h("../equations/ContactEquation"),E=h("../equations/FrictionEquation");f.prototype.createContactEquation=function(va,Ea,Ra,Va,Ha,La){var Sa;this.contactPointPool.length?(Sa=this.contactPointPool.pop(),Sa.bi=va,Sa.bj=Ea):Sa=new C(va,Ea);Sa.enabled=va.collisionResponse&&Ea.collisionResponse&&Ra.collisionResponse&&Va.collisionResponse;var bb=this.currentContactMaterial;Sa.restitution=bb.restitution;
Sa.setSpookParams(bb.contactEquationStiffness,bb.contactEquationRelaxation,this.world.dt);va=Ra.material||va.material;Ea=Va.material||Ea.material;return va&&Ea&&0<=va.restitution&&0<=Ea.restitution&&(Sa.restitution=va.restitution*Ea.restitution),Sa.si=Ha||Ra,Sa.sj=La||Va,Sa};f.prototype.createFrictionEquationsFromContact=function(va,Ea){var Ra=va.bi,Va=va.bj,Ha=this.world,La=this.currentContactMaterial,Sa=La.friction,bb=va.si.material||Ra.material,Xa=va.sj.material||Va.material;if(bb&&Xa&&0<=bb.friction&&
0<=Xa.friction&&(Sa=bb.friction*Xa.friction),0<Sa){Sa*=Ha.gravity.length();bb=Ra.invMass+Va.invMass;0<bb&&(bb=1/bb);var Qa=this.frictionEquationPool;Xa=Qa.length?Qa.pop():new E(Ra,Va,Sa*bb);Qa=Qa.length?Qa.pop():new E(Ra,Va,Sa*bb);return Xa.bi=Qa.bi=Ra,Xa.bj=Qa.bj=Va,Xa.minForce=Qa.minForce=-Sa*bb,Xa.maxForce=Qa.maxForce=Sa*bb,Xa.ri.copy(va.ri),Xa.rj.copy(va.rj),Qa.ri.copy(va.ri),Qa.rj.copy(va.rj),va.ni.tangents(Xa.t,Qa.t),Xa.setSpookParams(La.frictionEquationStiffness,La.frictionEquationRelaxation,
Ha.dt),Qa.setSpookParams(La.frictionEquationStiffness,La.frictionEquationRelaxation,Ha.dt),Xa.enabled=Qa.enabled=va.enabled,Ea.push(Xa,Qa),!0}return!1};var A=new k,H=new k,J=new k;f.prototype.createFrictionFromAverage=function(va){var Ea=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(Ea,this.frictionResult)&&1!==va){var Ra=this.frictionResult[this.frictionResult.length-2],Va=this.frictionResult[this.frictionResult.length-1];A.setZero();H.setZero();J.setZero();for(var Ha=
Ea.bi,La=(Ea.bj,0);La!==va;La++)Ea=this.result[this.result.length-1-La],Ea.bodyA!==Ha?(A.vadd(Ea.ni,A),H.vadd(Ea.ri,H),J.vadd(Ea.rj,J)):(A.vsub(Ea.ni,A),H.vadd(Ea.rj,H),J.vadd(Ea.ri,J));va=1/va;H.scale(va,Ra.ri);J.scale(va,Ra.rj);Va.ri.copy(Ra.ri);Va.rj.copy(Ra.rj);A.normalize();A.tangents(Ra.t,Va.t)}};var N=new k,U=new k,p=new r,x=new r;f.prototype.getContacts=function(va,Ea,Ra,Va,Ha,La,Sa){this.contactPointPool=Ha;this.frictionEquationPool=Sa;this.result=Va;this.frictionResult=La;Va=0;for(Ha=va.length;Va!==
Ha;Va++){La=va[Va];Sa=Ea[Va];var bb=null;La.material&&Sa.material&&(bb=Ra.getContactMaterial(La.material,Sa.material)||null);for(var Xa=0;Xa<La.shapes.length;Xa++){La.quaternion.mult(La.shapeOrientations[Xa],p);La.quaternion.vmult(La.shapeOffsets[Xa],N);N.vadd(La.position,N);for(var Qa=La.shapes[Xa],Ga=0;Ga<Sa.shapes.length;Ga++){Sa.quaternion.mult(Sa.shapeOrientations[Ga],x);Sa.quaternion.vmult(Sa.shapeOffsets[Ga],U);U.vadd(Sa.position,U);var fb=Sa.shapes[Ga];if(!(N.distanceTo(U)>Qa.boundingSphereRadius+
fb.boundingSphereRadius)){var cb=null;Qa.material&&fb.material&&(cb=Ra.getContactMaterial(Qa.material,fb.material)||null);this.currentContactMaterial=cb||bb||Ra.defaultContactMaterial;(cb=this[Qa.type|fb.type])&&(Qa.type<fb.type?cb.call(this,Qa,fb,N,U,p,x,La,Sa,Qa,fb):cb.call(this,fb,Qa,U,N,x,p,Sa,La,Qa,fb))}}}}};f.prototype[q.types.BOX|q.types.BOX]=f.prototype.boxBox=function(va,Ea,Ra,Va,Ha,La,Sa,bb){va.convexPolyhedronRepresentation.material=va.material;Ea.convexPolyhedronRepresentation.material=
Ea.material;va.convexPolyhedronRepresentation.collisionResponse=va.collisionResponse;Ea.convexPolyhedronRepresentation.collisionResponse=Ea.collisionResponse;this.convexConvex(va.convexPolyhedronRepresentation,Ea.convexPolyhedronRepresentation,Ra,Va,Ha,La,Sa,bb,va,Ea)};f.prototype[q.types.BOX|q.types.CONVEXPOLYHEDRON]=f.prototype.boxConvex=function(va,Ea,Ra,Va,Ha,La,Sa,bb){va.convexPolyhedronRepresentation.material=va.material;va.convexPolyhedronRepresentation.collisionResponse=va.collisionResponse;
this.convexConvex(va.convexPolyhedronRepresentation,Ea,Ra,Va,Ha,La,Sa,bb,va,Ea)};f.prototype[q.types.BOX|q.types.PARTICLE]=f.prototype.boxParticle=function(va,Ea,Ra,Va,Ha,La,Sa,bb){va.convexPolyhedronRepresentation.material=va.material;va.convexPolyhedronRepresentation.collisionResponse=va.collisionResponse;this.convexParticle(va.convexPolyhedronRepresentation,Ea,Ra,Va,Ha,La,Sa,bb,va,Ea)};f.prototype[q.types.SPHERE]=f.prototype.sphereSphere=function(va,Ea,Ra,Va,Ha,La,Sa,bb){Ha=this.createContactEquation(Sa,
bb,va,Ea);Va.vsub(Ra,Ha.ni);Ha.ni.normalize();Ha.ri.copy(Ha.ni);Ha.rj.copy(Ha.ni);Ha.ri.mult(va.radius,Ha.ri);Ha.rj.mult(-Ea.radius,Ha.rj);Ha.ri.vadd(Ra,Ha.ri);Ha.ri.vsub(Sa.position,Ha.ri);Ha.rj.vadd(Va,Ha.rj);Ha.rj.vsub(bb.position,Ha.rj);this.result.push(Ha);this.createFrictionEquationsFromContact(Ha,this.frictionResult)};var G=new k,e=new k,m=new k;f.prototype[q.types.PLANE|q.types.TRIMESH]=f.prototype.planeTrimesh=function(va,Ea,Ra,Va,Ha,La,Sa,bb){var Xa=new k;G.set(0,0,1);Ha.vmult(G,G);for(Ha=
0;Ha<Ea.vertices.length/3;Ha++){Ea.getVertex(Ha,Xa);var Qa=new k;Qa.copy(Xa);u.pointToWorldFrame(Va,La,Qa,Xa);Qa=e;Xa.vsub(Ra,Qa);if(0>=G.dot(Qa)){var Ga=this.createContactEquation(Sa,bb,va,Ea);Ga.ni.copy(G);var fb=m;G.scale(Qa.dot(G),fb);Xa.vsub(fb,fb);Ga.ri.copy(fb);Ga.ri.vsub(Sa.position,Ga.ri);Ga.rj.copy(Xa);Ga.rj.vsub(bb.position,Ga.rj);this.result.push(Ga);this.createFrictionEquationsFromContact(Ga,this.frictionResult)}}};var v=new k,D=new k,B=(new k,new k),I=new k,L=new k,S=new k,R=new k,W=
new k,X=new k,V=new k,la=new k,fa=new k,ha=new k,ba=new n,ea=[];f.prototype[q.types.SPHERE|q.types.TRIMESH]=f.prototype.sphereTrimesh=function(va,Ea,Ra,Va,Ha,La,Sa,bb){u.pointToLocalFrame(Va,La,Ra,X);Ha=va.radius;ba.lowerBound.set(X.x-Ha,X.y-Ha,X.z-Ha);ba.upperBound.set(X.x+Ha,X.y+Ha,X.z+Ha);Ea.getTrianglesInAABB(ba,ea);var Xa=va.radius*va.radius;for(Ha=0;Ha<ea.length;Ha++)for(var Qa=0;3>Qa;Qa++)if(Ea.getVertex(Ea.indices[3*ea[Ha]+Qa],B),B.vsub(X,D),D.norm2()<=Xa){I.copy(B);u.pointToWorldFrame(Va,
La,I,B);B.vsub(Ra,D);var Ga=this.createContactEquation(Sa,bb,va,Ea);Ga.ni.copy(D);Ga.ni.normalize();Ga.ri.copy(Ga.ni);Ga.ri.scale(va.radius,Ga.ri);Ga.ri.vadd(Ra,Ga.ri);Ga.ri.vsub(Sa.position,Ga.ri);Ga.rj.copy(B);Ga.rj.vsub(bb.position,Ga.rj);this.result.push(Ga);this.createFrictionEquationsFromContact(Ga,this.frictionResult)}for(Ha=0;Ha<ea.length;Ha++)for(Qa=0;3>Qa;Qa++)Ea.getVertex(Ea.indices[3*ea[Ha]+Qa],L),Ea.getVertex(Ea.indices[3*ea[Ha]+(Qa+1)%3],S),S.vsub(L,R),X.vsub(S,V),Ra=V.dot(R),X.vsub(L,
V),Ga=V.dot(R),0<Ga&&0>Ra&&(X.vsub(L,V),W.copy(R),W.normalize(),Ga=V.dot(W),W.scale(Ga,V),V.vadd(L,V),Ra=V.distanceTo(X),Ra<va.radius&&(Ga=this.createContactEquation(Sa,bb,va,Ea),V.vsub(X,Ga.ni),Ga.ni.normalize(),Ga.ni.scale(va.radius,Ga.ri),u.pointToWorldFrame(Va,La,V,V),V.vsub(bb.position,Ga.rj),u.vectorToWorldFrame(La,Ga.ni,Ga.ni),u.vectorToWorldFrame(La,Ga.ri,Ga.ri),this.result.push(Ga),this.createFrictionEquationsFromContact(Ga,this.frictionResult)));Ha=0;for(Qa=ea.length;Ha!==Qa;Ha++)if(Ea.getTriangleVertices(ea[Ha],
la,fa,ha),Ea.getNormal(ea[Ha],v),X.vsub(la,V),Ra=V.dot(v),v.scale(Ra,V),X.vsub(V,V),Ra=V.distanceTo(X),l.pointInTriangle(V,la,fa,ha)&&Ra<va.radius)Ga=this.createContactEquation(Sa,bb,va,Ea),V.vsub(X,Ga.ni),Ga.ni.normalize(),Ga.ni.scale(va.radius,Ga.ri),u.pointToWorldFrame(Va,La,V,V),V.vsub(bb.position,Ga.rj),u.vectorToWorldFrame(La,Ga.ni,Ga.ni),u.vectorToWorldFrame(La,Ga.ri,Ga.ri),this.result.push(Ga),this.createFrictionEquationsFromContact(Ga,this.frictionResult);ea.length=0};var ka=new k,O=new k;
f.prototype[q.types.SPHERE|q.types.PLANE]=f.prototype.spherePlane=function(va,Ea,Ra,Va,Ha,La,Sa,bb){Ea=this.createContactEquation(Sa,bb,va,Ea);if(Ea.ni.set(0,0,1),La.vmult(Ea.ni,Ea.ni),Ea.ni.negate(Ea.ni),Ea.ni.normalize(),Ea.ni.mult(va.radius,Ea.ri),Ra.vsub(Va,ka),Ea.ni.mult(Ea.ni.dot(ka),O),ka.vsub(O,Ea.rj),-ka.dot(Ea.ni)<=va.radius)va=Ea.ri,La=Ea.rj,va.vadd(Ra,va),va.vsub(Sa.position,va),La.vadd(Va,La),La.vsub(bb.position,La),this.result.push(Ea),this.createFrictionEquationsFromContact(Ea,this.frictionResult)};
var Y=new k,da=new k,pa=new k,ma=new k,wa=new k,Ca=new k,ya=new k,za=[new k,new k,new k,new k,new k,new k],ob=new k,nb=new k,Ab=new k,rb=new k;f.prototype[q.types.SPHERE|q.types.BOX]=f.prototype.sphereBox=function(va,Ea,Ra,Va,Ha,La,Sa,bb){Ha=this.v3pool;Ra.vsub(Va,ma);Ea.getSideNormals(za,La);La=va.radius;for(var Xa=!1,Qa=null,Ga=0,fb=0,cb=0,zb=null,Bb=0,Ob=za.length;Bb!==Ob&&!1===Xa;Bb++){var Sb=wa;Sb.copy(za[Bb]);var Ub=Sb.norm();Sb.normalize();var kb=ma.dot(Sb);if(Ub+La>kb&&0<kb){var Zb=Ca,cc=
ya;Zb.copy(za[(Bb+1)%3]);cc.copy(za[(Bb+2)%3]);var Wb=Zb.norm(),qc=cc.norm();Zb.normalize();cc.normalize();var dc=ma.dot(Zb),wc=ma.dot(cc);Wb>dc&&dc>-Wb&&qc>wc&&wc>-qc&&(kb=Math.abs(kb-Ub-La),(null===zb||zb>kb)&&(zb=kb,fb=dc,cb=wc,Qa=Ub,nb.copy(Sb),Ab.copy(Zb),rb.copy(cc),Ga++))}}Ga&&(Xa=!0,Ga=this.createContactEquation(Sa,bb,va,Ea),nb.mult(-La,Ga.ri),Ga.ni.copy(nb),Ga.ni.negate(Ga.ni),nb.mult(Qa,nb),Ab.mult(fb,Ab),nb.vadd(Ab,nb),rb.mult(cb,rb),nb.vadd(rb,Ga.rj),Ga.ri.vadd(Ra,Ga.ri),Ga.ri.vsub(Sa.position,
Ga.ri),Ga.rj.vadd(Va,Ga.rj),Ga.rj.vsub(bb.position,Ga.rj),this.result.push(Ga),this.createFrictionEquationsFromContact(Ga,this.frictionResult));kb=Ha.get();for(Qa=0;2!==Qa&&!Xa;Qa++)for(fb=0;2!==fb&&!Xa;fb++)for(cb=0;2!==cb&&!Xa;cb++)if(kb.set(0,0,0),Qa?kb.vadd(za[0],kb):kb.vsub(za[0],kb),fb?kb.vadd(za[1],kb):kb.vsub(za[1],kb),cb?kb.vadd(za[2],kb):kb.vsub(za[2],kb),Va.vadd(kb,ob),ob.vsub(Ra,ob),ob.norm2()<La*La)Xa=!0,Ga=this.createContactEquation(Sa,bb,va,Ea),Ga.ri.copy(ob),Ga.ri.normalize(),Ga.ni.copy(Ga.ri),
Ga.ri.mult(La,Ga.ri),Ga.rj.copy(kb),Ga.ri.vadd(Ra,Ga.ri),Ga.ri.vsub(Sa.position,Ga.ri),Ga.rj.vadd(Va,Ga.rj),Ga.rj.vsub(bb.position,Ga.rj),this.result.push(Ga),this.createFrictionEquationsFromContact(Ga,this.frictionResult);Ha.release(kb);zb=Ha.get();Bb=Ha.get();Ga=Ha.get();Ob=Ha.get();kb=Ha.get();Sb=za.length;for(Qa=0;Qa!==Sb&&!Xa;Qa++)for(fb=0;fb!==Sb&&!Xa;fb++)if(Qa%3!==fb%3){za[fb].cross(za[Qa],zb);zb.normalize();za[Qa].vadd(za[fb],Bb);Ga.copy(Ra);Ga.vsub(Bb,Ga);Ga.vsub(Va,Ga);Ub=Ga.dot(zb);zb.mult(Ub,
Ob);for(cb=0;cb===Qa%3||cb===fb%3;)cb++;kb.copy(Ra);kb.vsub(Ob,kb);kb.vsub(Bb,kb);kb.vsub(Va,kb);Ub=Math.abs(Ub);Zb=kb.norm();Ub<za[cb].norm()&&La>Zb&&(Xa=!0,cb=this.createContactEquation(Sa,bb,va,Ea),Bb.vadd(Ob,cb.rj),cb.rj.copy(cb.rj),kb.negate(cb.ni),cb.ni.normalize(),cb.ri.copy(cb.rj),cb.ri.vadd(Va,cb.ri),cb.ri.vsub(Ra,cb.ri),cb.ri.normalize(),cb.ri.mult(La,cb.ri),cb.ri.vadd(Ra,cb.ri),cb.ri.vsub(Sa.position,cb.ri),cb.rj.vadd(Va,cb.rj),cb.rj.vsub(bb.position,cb.rj),this.result.push(cb),this.createFrictionEquationsFromContact(cb,
this.frictionResult))}Ha.release(zb,Bb,Ga,Ob,kb)};var Mb=new k,Nb=new k,jc=new k,yd=new k,sc=new k,tc=new k,Oc=new k,jb=new k,Pc=new k,uc=new k;f.prototype[q.types.SPHERE|q.types.CONVEXPOLYHEDRON]=f.prototype.sphereConvex=function(va,Ea,Ra,Va,Ha,La,Sa,bb){Ha=this.v3pool;Ra.vsub(Va,Mb);for(var Xa=Ea.faceNormals,Qa=Ea.faces,Ga=Ea.vertices,fb=va.radius,cb=0;cb!==Ga.length;cb++){var zb=sc;La.vmult(Ga[cb],zb);Va.vadd(zb,zb);var Bb=yd;if(zb.vsub(Ra,Bb),Bb.norm2()<fb*fb)return va=this.createContactEquation(Sa,
bb,va,Ea),va.ri.copy(Bb),va.ri.normalize(),va.ni.copy(va.ri),va.ri.mult(fb,va.ri),zb.vsub(Va,va.rj),va.ri.vadd(Ra,va.ri),va.ri.vsub(Sa.position,va.ri),va.rj.vadd(Va,va.rj),va.rj.vsub(bb.position,va.rj),this.result.push(va),void this.createFrictionEquationsFromContact(va,this.frictionResult)}cb=0;for(zb=Qa.length;cb!==zb;cb++){Bb=Qa[cb];var Ob=tc;La.vmult(Xa[cb],Ob);var Sb=Oc;La.vmult(Ga[Bb[0]],Sb);Sb.vadd(Va,Sb);var Ub=jb;Ob.mult(-fb,Ub);Ra.vadd(Ub,Ub);var kb=Pc;Ub.vsub(Sb,kb);Ub=kb.dot(Ob);kb=uc;
if(Ra.vsub(Sb,kb),0>Ub&&0<kb.dot(Ob)){Sb=[];kb=0;for(var Zb=Bb.length;kb!==Zb;kb++){var cc=Ha.get();La.vmult(Ga[Bb[kb]],cc);Va.vadd(cc,cc);Sb.push(cc)}a:{kb=Sb;Zb=Ob;cc=Ra;for(var Wb=null,qc=kb.length,dc=0;dc!==qc;dc++){var wc=kb[dc],Bc=Y;kb[(dc+1)%qc].vsub(wc,Bc);var Yc=da;Bc.cross(Zb,Yc);Bc=pa;cc.vsub(wc,Bc);wc=Yc.dot(Bc);if(!(null===Wb||0<wc&&!0===Wb||0>=wc&&!1===Wb)){kb=!1;break a}null===Wb&&(Wb=0<wc)}kb=!0}if(kb){va=this.createContactEquation(Sa,bb,va,Ea);Ob.mult(-fb,va.ri);Ob.negate(va.ni);
Ea=Ha.get();Ob.mult(-Ub,Ea);La=Ha.get();Ob.mult(-fb,La);Ra.vsub(Va,va.rj);va.rj.vadd(La,va.rj);va.rj.vadd(Ea,va.rj);va.rj.vadd(Va,va.rj);va.rj.vsub(bb.position,va.rj);va.ri.vadd(Ra,va.ri);va.ri.vsub(Sa.position,va.ri);Ha.release(Ea);Ha.release(La);this.result.push(va);this.createFrictionEquationsFromContact(va,this.frictionResult);kb=0;for(Bb=Sb.length;kb!==Bb;kb++)Ha.release(Sb[kb]);break}for(kb=0;kb!==Bb.length;kb++){Ob=Ha.get();Ub=Ha.get();La.vmult(Ga[Bb[(kb+1)%Bb.length]],Ob);La.vmult(Ga[Bb[(kb+
2)%Bb.length]],Ub);Va.vadd(Ob,Ob);Va.vadd(Ub,Ub);qc=Nb;Ub.vsub(Ob,qc);Wb=jc;qc.unit(Wb);Zb=Ha.get();cc=Ha.get();Ra.vsub(Ob,cc);dc=cc.dot(Wb);Wb.mult(dc,Zb);Zb.vadd(Ob,Zb);Wb=Ha.get();if(Zb.vsub(Ra,Wb),0<dc&&dc*dc<qc.norm2()&&Wb.norm2()<fb*fb){va=this.createContactEquation(Sa,bb,va,Ea);Zb.vsub(Va,va.rj);Zb.vsub(Ra,va.ni);va.ni.normalize();va.ni.mult(fb,va.ri);va.rj.vadd(Va,va.rj);va.rj.vsub(bb.position,va.rj);va.ri.vadd(Ra,va.ri);va.ri.vsub(Sa.position,va.ri);this.result.push(va);this.createFrictionEquationsFromContact(va,
this.frictionResult);kb=0;for(Bb=Sb.length;kb!==Bb;kb++)Ha.release(Sb[kb]);return Ha.release(Ob),Ha.release(Ub),Ha.release(Zb),Ha.release(Wb),void Ha.release(cc)}Ha.release(Ob);Ha.release(Ub);Ha.release(Zb);Ha.release(Wb);Ha.release(cc)}kb=0;for(Bb=Sb.length;kb!==Bb;kb++)Ha.release(Sb[kb])}}};new k;new k;f.prototype[q.types.PLANE|q.types.BOX]=f.prototype.planeBox=function(va,Ea,Ra,Va,Ha,La,Sa,bb){Ea.convexPolyhedronRepresentation.material=Ea.material;Ea.convexPolyhedronRepresentation.collisionResponse=
Ea.collisionResponse;this.planeConvex(va,Ea.convexPolyhedronRepresentation,Ra,Va,Ha,La,Sa,bb)};var Pb=new k,bc=new k,gb=new k,be=new k;f.prototype[q.types.PLANE|q.types.CONVEXPOLYHEDRON]=f.prototype.planeConvex=function(va,Ea,Ra,Va,Ha,La,Sa,bb){bc.set(0,0,1);Ha.vmult(bc,bc);for(var Xa=Ha=0;Xa!==Ea.vertices.length;Xa++)if(Pb.copy(Ea.vertices[Xa]),La.vmult(Pb,Pb),Va.vadd(Pb,Pb),Pb.vsub(Ra,gb),0>=bc.dot(gb)){var Qa=this.createContactEquation(Sa,bb,va,Ea),Ga=be;bc.mult(bc.dot(gb),Ga);Pb.vsub(Ga,Ga);Ga.vsub(Ra,
Qa.ri);Qa.ni.copy(bc);Pb.vsub(Va,Qa.rj);Qa.ri.vadd(Ra,Qa.ri);Qa.ri.vsub(Sa.position,Qa.ri);Qa.rj.vadd(Va,Qa.rj);Qa.rj.vsub(bb.position,Qa.rj);this.result.push(Qa);Ha++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(Qa,this.frictionResult)}this.enableFrictionReduction&&Ha&&this.createFrictionFromAverage(Ha)};var Ad=new k,Qb=new k;f.prototype[q.types.CONVEXPOLYHEDRON]=f.prototype.convexConvex=function(va,Ea,Ra,Va,Ha,La,Sa,bb,Xa,Qa,Ga,fb){if(!(Ra.distanceTo(Va)>va.boundingSphereRadius+
Ea.boundingSphereRadius)&&va.findSeparatingAxis(Ea,Ra,Ha,Va,La,Ad,Ga,fb)){Ga=[];va.clipAgainstHull(Ra,Ha,Ea,Va,La,Ad,-100,100,Ga);for(La=Ha=0;La!==Ga.length;La++){fb=this.createContactEquation(Sa,bb,va,Ea,Xa,Qa);var cb=fb.ri,zb=fb.rj;Ad.negate(fb.ni);Ga[La].normal.negate(Qb);Qb.mult(Ga[La].depth,Qb);Ga[La].point.vadd(Qb,cb);zb.copy(Ga[La].point);cb.vsub(Ra,cb);zb.vsub(Va,zb);cb.vadd(Ra,cb);cb.vsub(Sa.position,cb);zb.vadd(Va,zb);zb.vsub(bb.position,zb);this.result.push(fb);Ha++;this.enableFrictionReduction||
this.createFrictionEquationsFromContact(fb,this.frictionResult)}this.enableFrictionReduction&&Ha&&this.createFrictionFromAverage(Ha)}};var pb=new k,ce=new k,qb=new k;f.prototype[q.types.PLANE|q.types.PARTICLE]=f.prototype.planeParticle=function(va,Ea,Ra,Va,Ha,La,Sa,bb){pb.set(0,0,1);Sa.quaternion.vmult(pb,pb);Va.vsub(Sa.position,ce);0>=pb.dot(ce)&&(va=this.createContactEquation(bb,Sa,Ea,va),va.ni.copy(pb),va.ni.negate(va.ni),va.ri.set(0,0,0),pb.mult(pb.dot(Va),qb),Va.vsub(qb,qb),va.rj.copy(qb),this.result.push(va),
this.createFrictionEquationsFromContact(va,this.frictionResult))};var Rb=new k;f.prototype[q.types.PARTICLE|q.types.SPHERE]=f.prototype.sphereParticle=function(va,Ea,Ra,Va,Ha,La,Sa,bb){Rb.set(0,0,1);Va.vsub(Ra,Rb);Rb.norm2()<=va.radius*va.radius&&(Ea=this.createContactEquation(bb,Sa,Ea,va),Rb.normalize(),Ea.rj.copy(Rb),Ea.rj.mult(va.radius,Ea.rj),Ea.ni.copy(Rb),Ea.ni.negate(Ea.ni),Ea.ri.set(0,0,0),this.result.push(Ea),this.createFrictionEquationsFromContact(Ea,this.frictionResult))};var Jc=new r,
vc=new k,ec=(new k,new k),hc=new k,zc=new k;f.prototype[q.types.PARTICLE|q.types.CONVEXPOLYHEDRON]=f.prototype.convexParticle=function(va,Ea,Ra,Va,Ha,La,Sa,bb){var Xa=-1;La=null;var Qa=0;if(vc.copy(Va),vc.vsub(Ra,vc),Ha.conjugate(Jc),Jc.vmult(vc,vc),va.pointIsInside(vc)){va.worldVerticesNeedsUpdate&&va.computeWorldVertices(Ra,Ha);va.worldFaceNormalsNeedsUpdate&&va.computeWorldFaceNormals(Ha);Ha=0;for(var Ga=va.faces.length;Ha!==Ga;Ha++){var fb=va.worldFaceNormals[Ha];Va.vsub(va.worldVertices[va.faces[Ha][0]],
hc);var cb=-fb.dot(hc);(null===La||Math.abs(cb)<Math.abs(La))&&(La=cb,Xa=Ha,ec.copy(fb),Qa++)}-1!==Xa?(va=this.createContactEquation(bb,Sa,Ea,va),ec.mult(La,zc),zc.vadd(Va,zc),zc.vsub(Ra,zc),va.rj.copy(zc),ec.negate(va.ni),va.ri.set(0,0,0),Ea=va.ri,La=va.rj,Ea.vadd(Va,Ea),Ea.vsub(bb.position,Ea),La.vadd(Ra,La),La.vsub(Sa.position,La),this.result.push(va),this.createFrictionEquationsFromContact(va,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}};
f.prototype[q.types.BOX|q.types.HEIGHTFIELD]=f.prototype.boxHeightfield=function(va,Ea,Ra,Va,Ha,La,Sa,bb){va.convexPolyhedronRepresentation.material=va.material;va.convexPolyhedronRepresentation.collisionResponse=va.collisionResponse;this.convexHeightfield(va.convexPolyhedronRepresentation,Ea,Ra,Va,Ha,La,Sa,bb)};var Qc=new k,Wc=new k,Pe=[0];f.prototype[q.types.CONVEXPOLYHEDRON|q.types.HEIGHTFIELD]=f.prototype.convexHeightfield=function(va,Ea,Ra,Va,Ha,La,Sa,bb){var Xa=Ea.data,Qa=Ea.elementSize,Ga=
va.boundingSphereRadius;u.pointToLocalFrame(Va,La,Ra,Qc);var fb=Math.floor((Qc.x-Ga)/Qa)-1,cb=Math.ceil((Qc.x+Ga)/Qa)+1,zb=Math.floor((Qc.y-Ga)/Qa)-1;Qa=Math.ceil((Qc.y+Ga)/Qa)+1;if(!(0>cb||0>Qa||fb>Xa.length||zb>Xa[0].length)){0>fb&&(fb=0);0>cb&&(cb=0);0>zb&&(zb=0);0>Qa&&(Qa=0);fb>=Xa.length&&(fb=Xa.length-1);cb>=Xa.length&&(cb=Xa.length-1);Qa>=Xa[0].length&&(Qa=Xa[0].length-1);zb>=Xa[0].length&&(zb=Xa[0].length-1);Xa=[];Ea.getRectMinMax(fb,zb,cb,Qa,Xa);var Bb=Xa[0];if(!(Qc.z-Ga>Xa[1]||Qc.z+Ga<Bb))for(Ga=
fb;cb>Ga;Ga++)for(fb=zb;Qa>fb;fb++)Ea.getConvexTrianglePillar(Ga,fb,!1),u.pointToWorldFrame(Va,La,Ea.pillarOffset,Wc),Ra.distanceTo(Wc)<Ea.pillarConvex.boundingSphereRadius+va.boundingSphereRadius&&this.convexConvex(va,Ea.pillarConvex,Ra,Wc,Ha,La,Sa,bb,null,null,Pe,null),Ea.getConvexTrianglePillar(Ga,fb,!0),u.pointToWorldFrame(Va,La,Ea.pillarOffset,Wc),Ra.distanceTo(Wc)<Ea.pillarConvex.boundingSphereRadius+va.boundingSphereRadius&&this.convexConvex(va,Ea.pillarConvex,Ra,Wc,Ha,La,Sa,bb,null,null,Pe,
null)}};var Rc=new k,Sc=new k;f.prototype[q.types.SPHERE|q.types.HEIGHTFIELD]=f.prototype.sphereHeightfield=function(va,Ea,Ra,Va,Ha,La,Sa,bb){var Xa=Ea.data,Qa=va.radius,Ga=Ea.elementSize;u.pointToLocalFrame(Va,La,Ra,Rc);var fb=Math.floor((Rc.x-Qa)/Ga)-1,cb=Math.ceil((Rc.x+Qa)/Ga)+1,zb=Math.floor((Rc.y-Qa)/Ga)-1;Ga=Math.ceil((Rc.y+Qa)/Ga)+1;if(!(0>cb||0>Ga||fb>Xa.length||Ga>Xa[0].length)){0>fb&&(fb=0);0>cb&&(cb=0);0>zb&&(zb=0);0>Ga&&(Ga=0);fb>=Xa.length&&(fb=Xa.length-1);cb>=Xa.length&&(cb=Xa.length-
1);Ga>=Xa[0].length&&(Ga=Xa[0].length-1);zb>=Xa[0].length&&(zb=Xa[0].length-1);Xa=[];Ea.getRectMinMax(fb,zb,cb,Ga,Xa);var Bb=Xa[0];if(!(Rc.z-Qa>Xa[1]||Rc.z+Qa<Bb))for(Qa=this.result;cb>fb;fb++)for(Xa=zb;Ga>Xa;Xa++)if(Bb=Qa.length,Ea.getConvexTrianglePillar(fb,Xa,!1),u.pointToWorldFrame(Va,La,Ea.pillarOffset,Sc),Ra.distanceTo(Sc)<Ea.pillarConvex.boundingSphereRadius+va.boundingSphereRadius&&this.sphereConvex(va,Ea.pillarConvex,Ra,Sc,Ha,La,Sa,bb),Ea.getConvexTrianglePillar(fb,Xa,!0),u.pointToWorldFrame(Va,
La,Ea.pillarOffset,Sc),Ra.distanceTo(Sc)<Ea.pillarConvex.boundingSphereRadius+va.boundingSphereRadius&&this.sphereConvex(va,Ea.pillarConvex,Ra,Sc,Ha,La,Sa,bb),2<Qa.length-Bb)return}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(h,n){function f(){r.apply(this);
this.dt=-1;this.allowSleep=!1;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=new l;this.broadphase=new p;this.bodies=[];this.solver=new k;this.constraints=[];this.narrowphase=new u(this);this.collisionMatrix=new z;this.collisionMatrixPrevious=new z;this.materials=[];this.contactmaterials=[];this.contactMaterialTable=new H;this.defaultMaterial=new C("default");this.defaultContactMaterial=
new E(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null}}n.exports=f;var q=h("../shapes/Shape"),l=h("../math/Vec3");n=h("../math/Quaternion");var k=h("../solver/GSSolver"),u=(h("../utils/Vec3Pool"),h("../equations/ContactEquation"),h("../equations/FrictionEquation"),
h("./Narrowphase")),r=h("../utils/EventTarget"),z=h("../collision/ArrayCollisionMatrix"),C=h("../material/Material"),E=h("../material/ContactMaterial"),A=h("../objects/Body"),H=h("../utils/TupleDictionary"),J=h("../collision/RaycastResult"),N=h("../collision/AABB"),U=h("../collision/Ray"),p=h("../collision/NaiveBroadphase");f.prototype=new r;var x=(new N,new U);if(f.prototype.getContactMaterial=function(V,la){return this.contactMaterialTable.get(V.id,la.id)},f.prototype.numObjects=function(){return this.bodies.length},
f.prototype.collisionMatrixTick=function(){var V=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix;this.collisionMatrix=V;this.collisionMatrix.reset()},f.prototype.add=f.prototype.addBody=function(V){-1===this.bodies.indexOf(V)&&(V.index=this.bodies.length,this.bodies.push(V),V.world=this,V.initPosition.copy(V.position),V.initVelocity.copy(V.velocity),V.timeLastSleepy=this.time,V instanceof A&&(V.initAngularVelocity.copy(V.angularVelocity),V.initQuaternion.copy(V.quaternion)),
this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=V,this.dispatchEvent(this.addBodyEvent))},f.prototype.addConstraint=function(V){this.constraints.push(V)},f.prototype.removeConstraint=function(V){V=this.constraints.indexOf(V);-1!==V&&this.constraints.splice(V,1)},f.prototype.rayTest=function(V,la,fa){fa instanceof J?this.raycastClosest(V,la,{skipBackfaces:!0},fa):this.raycastAll(V,la,{skipBackfaces:!0},fa)},f.prototype.raycastAll=function(V,la,fa,ha){return fa.mode=U.ALL,
fa.from=V,fa.to=la,fa.callback=ha,x.intersectWorld(this,fa)},f.prototype.raycastAny=function(V,la,fa,ha){return fa.mode=U.ANY,fa.from=V,fa.to=la,fa.result=ha,x.intersectWorld(this,fa)},f.prototype.raycastClosest=function(V,la,fa,ha){return fa.mode=U.CLOSEST,fa.from=V,fa.to=la,fa.result=ha,x.intersectWorld(this,fa)},f.prototype.remove=function(V){V.world=null;var la=this.bodies.length-1,fa=this.bodies,ha=fa.indexOf(V);if(-1!==ha){fa.splice(ha,1);for(ha=0;ha!==fa.length;ha++)fa[ha].index=ha;this.collisionMatrix.setNumObjects(la);
this.removeBodyEvent.body=V;this.dispatchEvent(this.removeBodyEvent)}},f.prototype.removeBody=f.prototype.remove,f.prototype.addMaterial=function(V){this.materials.push(V)},f.prototype.addContactMaterial=function(V){this.contactmaterials.push(V);this.contactMaterialTable.set(V.materials[0].id,V.materials[1].id,V)},"undefined"==typeof performance&&(performance={}),!performance.now){var G=Date.now();performance.timing&&performance.timing.navigationStart&&(G=performance.timing.navigationStart);performance.now=
function(){return Date.now()-G}}var e=new l;f.prototype.step=function(V,la,fa){if(fa=fa||10,la=la||0,0===la)this.internalStep(V),this.time+=V;else{var ha=Math.floor((this.time+la)/V)-Math.floor(this.time/V);ha=Math.min(ha,fa);fa=performance.now();for(var ba=0;ba!==ha&&(this.internalStep(V),!(performance.now()-fa>1E3*V));ba++);this.time+=la;V=this.time%V/V;la=this.bodies;for(ha=0;ha!==la.length;ha++)fa=la[ha],fa.type!==A.STATIC&&fa.sleepState!==A.SLEEPING?(fa.position.vsub(fa.previousPosition,e),e.scale(V,
e),fa.position.vadd(e,fa.interpolatedPosition)):(fa.interpolatedPosition.copy(fa.position),fa.interpolatedQuaternion.copy(fa.quaternion))}};var m={type:"postStep"},v={type:"preStep"},D={type:"collide",body:null,contact:null},B=[],I=[],L=[],S=[],R=(new l,new l,new l,new l,new l,new l,new l,new l,new l,new n,new n),W=new n,X=new l;f.prototype.internalStep=function(V){this.dt=V;var la,fa=this.contacts,ha=this.numObjects(),ba=this.bodies,ea=this.solver,ka=this.gravity,O=this.doProfiling,Y=this.profile,
da=A.DYNAMIC,pa=this.constraints,ma=(ka.norm(),ka.x),wa=ka.y,Ca=ka.z;O&&(la=performance.now());for(ka=0;ka!==ha;ka++){var ya=ba[ka];if(ya.type&da){var za=ya.force;ya=ya.mass;za.x+=ya*ma;za.y+=ya*wa;za.z+=ya*Ca}}ka=0;for(ya=this.subsystems.length;ka!==ya;ka++)this.subsystems[ka].update();O&&(la=performance.now());L.length=0;S.length=0;this.broadphase.collisionPairs(this,L,S);O&&(Y.broadphase=performance.now()-la);ya=pa.length;for(ka=0;ka!==ya;ka++)if(ma=pa[ka],!ma.collideConnected)for(wa=L.length-
1;0<=wa;--wa)(ma.bodyA===L[wa]&&ma.bodyB===S[wa]||ma.bodyB===L[wa]&&ma.bodyA===S[wa])&&(L.splice(wa,1),S.splice(wa,1));this.collisionMatrixTick();O&&(la=performance.now());ya=fa.length;for(ka=0;ka!==ya;ka++)B.push(fa[ka]);fa.length=0;ya=this.frictionEquations.length;for(ka=0;ka!==ya;ka++)I.push(this.frictionEquations[ka]);this.frictionEquations.length=0;this.narrowphase.getContacts(L,S,this,fa,B,this.frictionEquations,I);O&&(Y.narrowphase=performance.now()-la);O&&(la=performance.now());for(ka=0;ka<
this.frictionEquations.length;ka++)ea.addEquation(this.frictionEquations[ka]);ka=fa.length;for(wa=0;wa!==ka;wa++)ma=fa[wa],ya=ma.bi,Ca=ma.bj,ma.si,ma.sj,ya.material&&Ca.material&&this.getContactMaterial(ya.material,Ca.material),(ya.material&&Ca.material&&0<=ya.material.restitution&&0<=Ca.material.restitution&&(ma.restitution=ya.material.restitution*Ca.material.restitution),ea.addEquation(ma),ya.allowSleep&&ya.type===A.DYNAMIC&&ya.sleepState===A.SLEEPING&&Ca.sleepState===A.AWAKE&&Ca.type!==A.STATIC)&&
Ca.velocity.norm2()+Ca.angularVelocity.norm2()>=2*Math.pow(Ca.sleepSpeedLimit,2)&&(ya._wakeUpAfterNarrowphase=!0),Ca.allowSleep&&Ca.type===A.DYNAMIC&&Ca.sleepState===A.SLEEPING&&ya.sleepState===A.AWAKE&&ya.type!==A.STATIC&&ya.velocity.norm2()+ya.angularVelocity.norm2()>=2*Math.pow(ya.sleepSpeedLimit,2)&&(Ca._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(ya,Ca,!0),this.collisionMatrixPrevious.get(ya,Ca)||(D.body=Ca,D.contact=ma,ya.dispatchEvent(D),D.body=ya,Ca.dispatchEvent(D));O&&(Y.makeContactConstraints=
performance.now()-la,la=performance.now());for(ka=0;ka!==ha;ka++)ya=ba[ka],ya._wakeUpAfterNarrowphase&&(ya.wakeUp(),ya._wakeUpAfterNarrowphase=!1);ya=pa.length;for(ka=0;ka!==ya;ka++)for(ma=pa[ka],ma.update(),wa=0,fa=ma.equations.length;wa!==fa;wa++)ea.addEquation(ma.equations[wa]);ea.solve(V,this);O&&(Y.solve=performance.now()-la);ea.removeAllEquations();ea=Math.pow;for(ka=0;ka!==ha;ka++)if(ya=ba[ka],ya.type&da&&(pa=ea(1-ya.linearDamping,V),fa=ya.velocity,fa.mult(pa,fa),pa=ya.angularVelocity))fa=
ea(1-ya.angularDamping,V),pa.mult(fa,pa);this.dispatchEvent(v);for(ka=0;ka!==ha;ka++)ya=ba[ka],ya.preStep&&ya.preStep.call(ya);O&&(la=performance.now());da=A.DYNAMIC|A.KINEMATIC;ea=0===this.stepnumber%(this.quatNormalizeSkip+1);pa=this.quatNormalizeFast;fa=.5*V;q.types.PLANE;q.types.CONVEXPOLYHEDRON;for(ka=0;ka!==ha;ka++)if(ya=ba[ka],ma=ya.force,wa=ya.torque,ya.type&da&&ya.sleepState!==A.SLEEPING){Ca=ya.velocity;za=ya.angularVelocity;var ob=ya.position,nb=ya.quaternion,Ab=ya.invMass,rb=ya.invInertiaWorld;
Ca.x+=ma.x*Ab*V;Ca.y+=ma.y*Ab*V;Ca.z+=ma.z*Ab*V;ya.angularVelocity&&(rb.vmult(wa,X),X.mult(V,X),X.vadd(za,za));ob.x+=Ca.x*V;ob.y+=Ca.y*V;ob.z+=Ca.z*V;ya.angularVelocity&&(R.set(za.x,za.y,za.z,0),R.mult(nb,W),nb.x+=fa*W.x,nb.y+=fa*W.y,nb.z+=fa*W.z,nb.w+=fa*W.w,ea&&(pa?nb.normalizeFast():nb.normalize()));ya.aabb&&(ya.aabbNeedsUpdate=!0);ya.updateInertiaWorld&&ya.updateInertiaWorld()}this.clearForces();this.broadphase.dirty=!0;O&&(Y.integrate=performance.now()-la);this.time+=V;this.stepnumber+=1;this.dispatchEvent(m);
for(ka=0;ka!==ha;ka++)ya=ba[ka],(V=ya.postStep)&&V.call(ya);if(this.allowSleep)for(ka=0;ka!==ha;ka++)ba[ka].sleepTick(this.time)};f.prototype.clearForces=function(){for(var V=this.bodies,la=V.length,fa=0;fa!==la;fa++){var ha=V[fa];ha.force;ha.torque;ha.force.set(0,0,0);ha.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,
"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)});
!function(c,h,n){function f(k,u){if(!h[k]){if(!c[k]){var r="function"==typeof require&&require;if(!u&&r)return r(k,!0);if(q)return q(k,!0);throw Error("Cannot find module '"+k+"'");}u=h[k]={exports:{}};c[k][0].call(u.exports,function(z){var C=c[k][1][z];return f(C?C:z)},u,u.exports)}return h[k].exports}for(var q="function"==typeof require&&require,l=0;l<n.length;l++)f(n[l]);return f}({1:[function(c,h){var n=(c("./pointable"),c("gl-matrix")),f=n.vec3,q=n.mat3,l=n.mat4;c=(c("underscore"),h.exports=
function(k,u){this.finger=k;this._matrix=this._center=null;this.type=u.type;this.prevJoint=u.prevJoint;this.nextJoint=u.nextJoint;this.width=u.width;k=Array(3);f.sub(k,u.nextJoint,u.prevJoint);this.length=f.length(k);this.basis=u.basis});c.prototype.left=function(){return this._left?this._left:(this._left=0>q.determinant(this.basis[0].concat(this.basis[1]).concat(this.basis[2])),this._left)};c.prototype.matrix=function(){if(this._matrix)return this._matrix;var k=this.basis,u=this._matrix=l.create();
return u[0]=k[0][0],u[1]=k[0][1],u[2]=k[0][2],u[4]=k[1][0],u[5]=k[1][1],u[6]=k[1][2],u[8]=k[2][0],u[9]=k[2][1],u[10]=k[2][2],u[3]=this.center()[0],u[7]=this.center()[1],u[11]=this.center()[2],this.left()&&(u[0]*=-1,u[1]*=-1,u[2]*=-1),this._matrix};c.prototype.lerp=function(k,u){f.lerp(k,this.prevJoint,this.nextJoint,u)};c.prototype.center=function(){if(this._center)return this._center;var k=f.create();return this.lerp(k,.5),this._center=k,k};c.prototype.direction=function(){return[-1*this.basis[2][0],
-1*this.basis[2][1],-1*this.basis[2][2]]}},{"./pointable":14,"gl-matrix":23,underscore:24}],2:[function(c,h){c=h.exports=function(n){this.pos=0;this._buf=[];this.size=n};c.prototype.get=function(n){return void 0==n&&(n=0),n>=this.size?void 0:n>=this._buf.length?void 0:this._buf[(this.pos-n-1)%this.size]};c.prototype.push=function(n){return this._buf[this.pos%this.size]=n,this.pos++}},{}],3:[function(c,h){var n=c("../protocol").chooseProtocol,f=c("events").EventEmitter,q=c("underscore"),l=h.exports=
function(k){this.opts=q.defaults(k||{},{host:"127.0.0.1",enableGestures:!1,scheme:this.getScheme(),port:this.getPort(),background:!1,optimizeHMD:!1,requestProtocolVersion:l.defaultProtocolVersion});this.host=this.opts.host;this.port=this.opts.port;this.scheme=this.opts.scheme;this.protocolVersionVerified=!1;this.optimizeHMD=this.background=null;this.on("ready",function(){this.enableGestures(this.opts.enableGestures);this.setBackground(this.opts.background);this.setOptimizeHMD(this.opts.optimizeHMD);
console.log(this.opts.optimizeHMD?"Optimized for head mounted display usage.":"Optimized for desktop usage.")})};l.defaultProtocolVersion=6;l.prototype.getUrl=function(){return this.scheme+"//"+this.host+":"+this.port+"/v"+this.opts.requestProtocolVersion+".json"};l.prototype.getScheme=function(){return"ws:"};l.prototype.getPort=function(){return 6437};l.prototype.setBackground=function(k){this.opts.background=k;this.protocol&&this.protocol.sendBackground&&this.background!==this.opts.background&&
(this.background=this.opts.background,this.protocol.sendBackground(this,this.opts.background))};l.prototype.setOptimizeHMD=function(k){this.opts.optimizeHMD=k;this.protocol&&this.protocol.sendOptimizeHMD&&this.optimizeHMD!==this.opts.optimizeHMD&&(this.optimizeHMD=this.opts.optimizeHMD,this.protocol.sendOptimizeHMD(this,this.opts.optimizeHMD))};l.prototype.handleOpen=function(){this.connected||(this.connected=!0,this.emit("connect"))};l.prototype.enableGestures=function(k){this.gesturesEnabled=k?
!0:!1;this.send(this.protocol.encode({enableGestures:this.gesturesEnabled}))};l.prototype.handleClose=function(k){this.connected&&(this.disconnect(),1001===k&&1<this.opts.requestProtocolVersion&&(this.protocolVersionVerified?this.protocolVersionVerified=!1:this.opts.requestProtocolVersion--),this.startReconnection())};l.prototype.startReconnection=function(){var k=this;this.reconnectionTimer||(this.reconnectionTimer=setInterval(function(){k.reconnect()},500))};l.prototype.stopReconnection=function(){this.reconnectionTimer=
clearInterval(this.reconnectionTimer)};l.prototype.disconnect=function(k){return k||this.stopReconnection(),this.socket?(this.socket.close(),delete this.socket,delete this.protocol,delete this.background,delete this.optimizeHMD,delete this.focusedState,this.connected&&(this.connected=!1,this.emit("disconnect")),!0):void 0};l.prototype.reconnect=function(){this.connected?this.stopReconnection():(this.disconnect(!0),this.connect())};l.prototype.handleData=function(k){var u;k=JSON.parse(k);void 0===
this.protocol?(u=this.protocol=n(k),this.protocolVersionVerified=!0,this.emit("ready")):u=this.protocol(k);this.emit(u.type,u)};l.prototype.connect=function(){return this.socket?void 0:(this.socket=this.setupSocket(),!0)};l.prototype.send=function(k){this.socket.send(k)};l.prototype.reportFocus=function(k){this.connected&&this.focusedState!==k&&(this.focusedState=k,this.emit(this.focusedState?"focus":"blur"),this.protocol&&this.protocol.sendFocused&&this.protocol.sendFocused(this,this.focusedState))};
q.extend(l.prototype,f.prototype)},{"../protocol":15,events:21,underscore:24}],4:[function(c,h){var n=h.exports=c("./base");c=c("underscore");h=h.exports=function(f){n.call(this,f);var q=this;this.on("ready",function(){q.startFocusLoop()});this.on("disconnect",function(){q.stopFocusLoop()})};c.extend(h.prototype,n.prototype);h.__proto__=n;h.prototype.useSecure=function(){return"https:"===location.protocol};h.prototype.getScheme=function(){return this.useSecure()?"wss:":"ws:"};h.prototype.getPort=
function(){return this.useSecure()?6436:6437};h.prototype.setupSocket=function(){var f=this,q=new WebSocket(this.getUrl());return q.onopen=function(){f.handleOpen()},q.onclose=function(l){f.handleClose(l.code,l.reason)},q.onmessage=function(l){f.handleData(l.data)},q.onerror=function(){f.useSecure()&&"wss:"===f.scheme&&(f.scheme="ws:",f.port=6437,f.disconnect(),f.connect())},q};h.prototype.startFocusLoop=function(){if(!this.focusDetectorTimer){var f=this,q=null;q="undefined"!=typeof document.hidden?
"hidden":"undefined"!=typeof document.mozHidden?"mozHidden":"undefined"!=typeof document.msHidden?"msHidden":"undefined"!=typeof document.webkitHidden?"webkitHidden":void 0;void 0===f.windowVisible&&(f.windowVisible=void 0===q?!0:!1===document[q]);var l=window.addEventListener("focus",function(){f.windowVisible=!0;u()}),k=window.addEventListener("blur",function(){f.windowVisible=!1;u()});this.on("disconnect",function(){window.removeEventListener("focus",l);window.removeEventListener("blur",k)});var u=
function(){f.reportFocus((void 0===q?!0:!1===document[q])&&f.windowVisible)};u();this.focusDetectorTimer=setInterval(u,100)}};h.prototype.stopFocusLoop=function(){this.focusDetectorTimer&&(clearTimeout(this.focusDetectorTimer),delete this.focusDetectorTimer)}},{"./base":3,underscore:24}],5:[function(c,h){var n=c("__browserify_process"),f=c("./frame"),q=c("./hand"),l=c("./pointable"),k=c("./finger"),u=c("./circular_buffer"),r=c("./pipeline"),z=c("events").EventEmitter,C=c("./gesture").gestureListener,
E=c("./dialog"),A=c("underscore"),H=h.exports=function(J){var N=this;J=A.defaults(J||{},{inNode:"undefined"!=typeof n&&n.versions&&n.versions.node});this.inNode=J.inNode;J=A.defaults(J||{},{frameEventName:this.useAnimationLoop()?"animationFrame":"deviceFrame",suppressAnimationLoop:!this.useAnimationLoop(),loopWhileDisconnected:!0,useAllPlugins:!1,checkVersion:!0});this.animationFrameRequested=!1;this.onAnimationFrame=function(U){N.lastConnectionFrame.valid&&N.emit("animationFrame",N.lastConnectionFrame);
N.emit("frameEnd",U);N.loopWhileDisconnected&&(!1!==N.connection.focusedState||N.connection.opts.background)?window.requestAnimationFrame(N.onAnimationFrame):N.animationFrameRequested=!1};this.suppressAnimationLoop=J.suppressAnimationLoop;this.loopWhileDisconnected=J.loopWhileDisconnected;this.frameEventName=J.frameEventName;this.useAllPlugins=J.useAllPlugins;this.history=new u(200);this.lastConnectionFrame=this.lastValidFrame=this.lastFrame=f.Invalid;this.accumulatedGestures=[];this.checkVersion=
J.checkVersion;this.connectionType=void 0===J.connectionType?c(this.inBrowser()?"./connection/browser":"./connection/node"):J.connectionType;this.connection=new this.connectionType(J);this.streamingCount=0;this.devices={};this.plugins={};this._pluginPipelineSteps={};this._pluginExtendedMethods={};J.useAllPlugins&&this.useRegisteredPlugins();this.setupFrameEvents(J);this.setupConnectionEvents();this.startAnimationLoop()};H.prototype.gesture=function(J,N){J=C(this,J);return void 0!==N&&J.stop(N),J};
H.prototype.setBackground=function(J){return this.connection.setBackground(J),this};H.prototype.setOptimizeHMD=function(J){return this.connection.setOptimizeHMD(J),this};H.prototype.inBrowser=function(){return!this.inNode};H.prototype.useAnimationLoop=function(){return this.inBrowser()&&!this.inBackgroundPage()};H.prototype.inBackgroundPage=function(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.getBackgroundPage&&chrome.extension.getBackgroundPage()===window};H.prototype.connect=
function(){return this.connection.connect(),this};H.prototype.streaming=function(){return 0<this.streamingCount};H.prototype.connected=function(){return!!this.connection.connected};H.prototype.startAnimationLoop=function(){this.suppressAnimationLoop||this.animationFrameRequested||(this.animationFrameRequested=!0,window.requestAnimationFrame(this.onAnimationFrame))};H.prototype.disconnect=function(){return this.connection.disconnect(),this};H.prototype.frame=function(J){return this.history.get(J)||
f.Invalid};H.prototype.loop=function(J){return J&&("function"==typeof J?this.on(this.frameEventName,J):this.setupFrameEvents(J)),this.connect()};H.prototype.addStep=function(J){this.pipeline||(this.pipeline=new r(this));this.pipeline.addStep(J)};H.prototype.processFrame=function(J){J.gestures&&(this.accumulatedGestures=this.accumulatedGestures.concat(J.gestures));this.lastConnectionFrame=J;this.startAnimationLoop();this.emit("deviceFrame",J)};H.prototype.processFinishedFrame=function(J){if(this.lastFrame=
J,J.valid&&(this.lastValidFrame=J),J.controller=this,J.historyIdx=this.history.push(J),J.gestures){J.gestures=this.accumulatedGestures;this.accumulatedGestures=[];for(var N=0;N!=J.gestures.length;N++)this.emit("gesture",J.gestures[N],J)}this.pipeline&&(J=this.pipeline.run(J),J||(J=f.Invalid));this.emit("frame",J);this.emitHandEvents(J)};H.prototype.emitHandEvents=function(J){for(var N=0;N<J.hands.length;N++)this.emit("hand",J.hands[N])};H.prototype.setupFrameEvents=function(J){J.frame&&this.on("frame",
J.frame);J.hand&&this.on("hand",J.hand)};H.prototype.setupConnectionEvents=function(){var J=this;this.connection.on("frame",function(p){J.processFrame(p)});this.on(this.frameEventName,function(p){J.processFinishedFrame(p)});var N=function(){if(5>J.connection.opts.requestProtocolVersion&&0==J.streamingCount){J.streamingCount=1;var p={attached:!0,streaming:!0,type:"unknown",id:"Lx00000000000"};J.devices[p.id]=p;J.emit("deviceAttached",p);J.emit("deviceStreaming",p);J.emit("streamingStarted",p);J.connection.removeListener("frame",
N)}},U=function(){if(0<J.streamingCount){for(var p in J.devices)J.emit("deviceStopped",J.devices[p]),J.emit("deviceRemoved",J.devices[p]);J.emit("streamingStopped",J.devices[p]);J.streamingCount=0;for(p in J.devices)delete J.devices[p]}};this.connection.on("focus",function(){J.loopWhileDisconnected&&J.startAnimationLoop();J.emit("focus")});this.connection.on("blur",function(){J.emit("blur")});this.connection.on("protocol",function(p){p.on("beforeFrameCreated",function(x){J.emit("beforeFrameCreated",
x)});p.on("afterFrameCreated",function(x,G){J.emit("afterFrameCreated",x,G)});J.emit("protocol",p)});this.connection.on("ready",function(){J.checkVersion&&!J.inNode&&J.checkOutOfDate();J.emit("ready")});this.connection.on("connect",function(){J.emit("connect");J.connection.removeListener("frame",N);J.connection.on("frame",N)});this.connection.on("disconnect",function(){J.emit("disconnect");U()});this.connection.on("deviceConnect",function(p){p.state?(J.emit("deviceConnected"),J.connection.removeListener("frame",
N),J.connection.on("frame",N)):(J.emit("deviceDisconnected"),U())});this.connection.on("deviceEvent",function(p){p=p.state;var x=J.devices[p.id],G={},e;for(e in p)x&&x.hasOwnProperty(e)&&x[e]==p[e]||(G[e]=!0);J.devices[p.id]=p;G.attached&&J.emit(p.attached?"deviceAttached":"deviceRemoved",p);G.streaming&&(p.streaming?(J.streamingCount++,J.emit("deviceStreaming",p),1==J.streamingCount&&J.emit("streamingStarted",p),G.attached||J.emit("deviceConnected")):G.attached&&p.attached||(J.streamingCount--,J.emit("deviceStopped",
p),0==J.streamingCount&&J.emit("streamingStopped",p),J.emit("deviceDisconnected")))});this.on("newListener",function(p){"deviceConnected"!=p&&"deviceDisconnected"!=p||console.warn(p+" events are depricated.  Consider using 'streamingStarted/streamingStopped' or 'deviceStreaming/deviceStopped' instead")})};H.prototype.checkOutOfDate=function(){console.assert(this.connection&&this.connection.protocol);var J=this.connection.protocol.serviceVersion,N=this.connection.protocol.version,U=this.connectionType.defaultProtocolVersion;
return U>N?(console.warn("Your Protocol Version is v"+N+", this app was designed for v"+U),E.warnOutOfDate({sV:J,pV:N}),!0):!1};H._pluginFactories={};H.plugin=function(J,N){return this._pluginFactories[J]&&console.warn('Plugin "'+J+'" already registered'),this._pluginFactories[J]=N};H.plugins=function(){return A.keys(this._pluginFactories)};H.prototype.use=function(J,N){var U,p;if(U="function"==typeof J?J:H._pluginFactories[J],!U)throw"Leap Plugin "+J+" not found.";if(N||(N={}),this.plugins[J])return A.extend(this.plugins[J],
N),this;this.plugins[J]=N;N=U.call(this,N);for(p in N)if(U=N[p],"function"==typeof U){var x=J,G=p;-1!=["beforeFrameCreated","afterFrameCreated"].indexOf(G)?this.on(G,U):(this.pipeline||(this.pipeline=new r(this)),this._pluginPipelineSteps[x]||(this._pluginPipelineSteps[x]=[]),this._pluginPipelineSteps[x].push(this.pipeline.addWrappedStep(G,U)))}else{x=J;G=p;switch(this._pluginExtendedMethods[x]||(this._pluginExtendedMethods[x]=[]),G){case "frame":G=f;break;case "hand":G=q;break;case "pointable":G=
l;A.extend(k.prototype,U);A.extend(k.Invalid,U);break;case "finger":G=k;break;default:throw x+' specifies invalid object type "'+G+'" for prototypical extension';}A.extend(G.prototype,U);A.extend(G.Invalid,U);this._pluginExtendedMethods[x].push([G,U])}return this};H.prototype.stopUsing=function(J){var N=this._pluginPipelineSteps[J];var U=this._pluginExtendedMethods[J],p;if(this.plugins[J]){if(N)for(p=0;p<N.length;p++)this.pipeline.removeStep(N[p]);if(U)for(p=0;p<U.length;p++){N=U[p][0];var x=U[p][1];
for(var G in x)delete N.prototype[G],delete N.Invalid[G]}return delete this.plugins[J],this}};H.prototype.useRegisteredPlugins=function(){for(var J in H._pluginFactories)this.use(J)};A.extend(H.prototype,z.prototype)},{"./circular_buffer":2,"./connection/browser":4,"./connection/node":20,"./dialog":6,"./finger":7,"./frame":8,"./gesture":9,"./hand":10,"./pipeline":13,"./pointable":14,__browserify_process:22,events:21,underscore:24}],6:[function(c,h){var n=c("__browserify_process"),f=h.exports=function(q,
l){this.options=l||{};this.message=q;this.createElement()};f.prototype.createElement=function(){this.element=document.createElement("div");this.element.className="leapjs-dialog";this.element.style.position="fixed";this.element.style.top="8px";this.element.style.left=0;this.element.style.right=0;this.element.style.textAlign="center";this.element.style.zIndex=1E3;var q=document.createElement("div");this.element.appendChild(q);q.style.className="leapjs-dialog";q.style.display="inline-block";q.style.margin=
"auto";q.style.padding="8px";q.style.color="#222";q.style.background="#eee";q.style.borderRadius="4px";q.style.border="1px solid #999";q.style.textAlign="left";q.style.cursor="pointer";q.style.whiteSpace="nowrap";q.style.transition="box-shadow 1s linear";q.innerHTML=this.message;this.options.onclick&&q.addEventListener("click",this.options.onclick);this.options.onmouseover&&q.addEventListener("mouseover",this.options.onmouseover);this.options.onmouseout&&q.addEventListener("mouseout",this.options.onmouseout);
this.options.onmousemove&&q.addEventListener("mousemove",this.options.onmousemove)};f.prototype.show=function(){return document.body.appendChild(this.element),this};f.prototype.hide=function(){return document.body.removeChild(this.element),this};f.warnOutOfDate=function(q){q||(q={});var l="http://developer.leapmotion.com?";q.returnTo=window.location.href;for(var k in q)l+=k+"="+encodeURIComponent(q[k])+"&";var u;return u=new f("This site requires Leap Motion Tracking V2.<button id='leapjs-accept-upgrade'  style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 16px;'>Upgrade</button><button id='leapjs-decline-upgrade' style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 8px; '>Not Now</button>",
{onclick:function(r){"leapjs-decline-upgrade"!=r.target.id&&(r=window.open(l,"_blank","height=800,width=1000,location=1,menubar=1,resizable=1,status=1,toolbar=1,scrollbars=1"),window.focus&&r.focus());return u.hide(),!0},onmousemove:function(r){r.target==document.getElementById("leapjs-decline-upgrade")?(document.getElementById("leapjs-decline-upgrade").style.color="#000",document.getElementById("leapjs-decline-upgrade").style.boxShadow="0px 0px 2px #5daa00",document.getElementById("leapjs-accept-upgrade").style.color=
"#444",document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"):(document.getElementById("leapjs-accept-upgrade").style.color="#000",document.getElementById("leapjs-accept-upgrade").style.boxShadow="0px 0px 2px #5daa00",document.getElementById("leapjs-decline-upgrade").style.color="#444",document.getElementById("leapjs-decline-upgrade").style.boxShadow="none")},onmouseout:function(){document.getElementById("leapjs-decline-upgrade").style.color="#444";document.getElementById("leapjs-decline-upgrade").style.boxShadow=
"none";document.getElementById("leapjs-accept-upgrade").style.color="#444";document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"}}),u.show()};f.hasWarnedBones=!1;f.warnBones=function(){this.hasWarnedBones||(this.hasWarnedBones=!0,console.warn("Your Leap Service is out of date"),"undefined"!=typeof n&&n.versions&&n.versions.node||this.warnOutOfDate({reason:"bones"}))}},{__browserify_process:22}],7:[function(c,h){var n=c("./pointable"),f=c("./bone"),q=c("./dialog");c=c("underscore");
h=h.exports=function(l){n.call(this,l);this.dipPosition=l.dipPosition;this.pipPosition=l.pipPosition;this.mcpPosition=l.mcpPosition;this.carpPosition=l.carpPosition;this.extended=l.extended;this.type=l.type;this.finger=!0;this.positions=[this.carpPosition,this.mcpPosition,this.pipPosition,this.dipPosition,this.tipPosition];l.bases?this.addBones(l):q.warnBones()};c.extend(h.prototype,n.prototype);h.prototype.addBones=function(l){this.metacarpal=new f(this,{type:0,width:this.width,prevJoint:this.carpPosition,
nextJoint:this.mcpPosition,basis:l.bases[0]});this.proximal=new f(this,{type:1,width:this.width,prevJoint:this.mcpPosition,nextJoint:this.pipPosition,basis:l.bases[1]});this.medial=new f(this,{type:2,width:this.width,prevJoint:this.pipPosition,nextJoint:this.dipPosition,basis:l.bases[2]});this.distal=new f(this,{type:3,width:this.width,prevJoint:this.dipPosition,nextJoint:l.btipPosition,basis:l.bases[3]});this.bones=[this.metacarpal,this.proximal,this.medial,this.distal]};h.prototype.toString=function(){return"Finger [ id:"+
this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"};h.Invalid={valid:!1}},{"./bone":1,"./dialog":6,"./pointable":14,underscore:24}],8:[function(c,h){var n=c("./hand"),f=c("./pointable"),q=c("./gesture").createGesture,l=c("gl-matrix"),k=l.mat3,u=l.vec3,r=c("./interaction_box"),z=c("./finger"),C=c("underscore");c=h.exports=function(E){if(this.valid=!0,this.id=E.id,this.timestamp=E.timestamp,this.hands=[],this.handsMap={},this.pointables=[],this.tools=[],this.fingers=
[],E.interactionBox&&(this.interactionBox=new r(E.interactionBox)),this.gestures=[],this.pointablesMap={},this._translation=E.t,this._rotation=C.flatten(E.r),this._scaleFactor=E.s,this.data=E,this.type="frame",this.currentFrameRate=E.currentFrameRate,E.gestures)for(var A=0,H=E.gestures.length;A!=H;A++)this.gestures.push(q(E.gestures[A]));this.postprocessData(E)};c.prototype.postprocessData=function(E){E||(E=this.data);for(var A=0,H=E.hands.length;A!=H;A++){var J=new n(E.hands[A]);J.frame=this;this.hands.push(J);
this.handsMap[J.id]=J}E.pointables=C.sortBy(E.pointables,function(N){return N.id});A=0;for(H=E.pointables.length;A!=H;A++)J=E.pointables[A],J=J.dipPosition?new z(J):new f(J),J.frame=this,this.addPointable(J)};c.prototype.addPointable=function(E){if(this.pointables.push(E),this.pointablesMap[E.id]=E,(E.tool?this.tools:this.fingers).push(E),void 0!==E.handId&&this.handsMap.hasOwnProperty(E.handId)){var A=this.handsMap[E.handId];switch(A.pointables.push(E),(E.tool?A.tools:A.fingers).push(E),E.type){case 0:A.thumb=
E;break;case 1:A.indexFinger=E;break;case 2:A.middleFinger=E;break;case 3:A.ringFinger=E;break;case 4:A.pinky=E}}};c.prototype.tool=function(E){E=this.pointable(E);return E.tool?E:f.Invalid};c.prototype.pointable=function(E){return this.pointablesMap[E]||f.Invalid};c.prototype.finger=function(E){E=this.pointable(E);return E.tool?f.Invalid:E};c.prototype.hand=function(E){return this.handsMap[E]||n.Invalid};c.prototype.rotationAngle=function(E,A){if(!this.valid||!E.valid)return 0;var H=this.rotationMatrix(E);
H=Math.acos(.5*(H[0]+H[4]+H[8]-1));if(H=isNaN(H)?0:H,void 0!==A)E=this.rotationAxis(E),H*=u.dot(E,u.normalize(u.create(),A));return H};c.prototype.rotationAxis=function(E){return this.valid&&E.valid?u.normalize(u.create(),[this._rotation[7]-E._rotation[5],this._rotation[2]-E._rotation[6],this._rotation[3]-E._rotation[1]]):u.create()};c.prototype.rotationMatrix=function(E){if(!this.valid||!E.valid)return k.create();var A=k.transpose(k.create(),this._rotation);return k.multiply(k.create(),E._rotation,
A)};c.prototype.scaleFactor=function(E){return this.valid&&E.valid?Math.exp(this._scaleFactor-E._scaleFactor):1};c.prototype.translation=function(E){return this.valid&&E.valid?u.subtract(u.create(),this._translation,E._translation):u.create()};c.prototype.toString=function(){var E="Frame [ id:"+this.id+" | timestamp:"+this.timestamp+" | Hand count:("+this.hands.length+") | Pointable count:("+this.pointables.length+")";return this.gestures&&(E+=" | Gesture count:("+this.gestures.length+")"),E+" ]"};
c.prototype.dump=function(){var E="Frame Info:<br/>"+this.toString();E+="<br/><br/>Hands:<br/>";for(var A=0,H=this.hands.length;A!=H;A++)E+="  "+this.hands[A].toString()+"<br/>";E+="<br/><br/>Pointables:<br/>";A=0;for(H=this.pointables.length;A!=H;A++)E+="  "+this.pointables[A].toString()+"<br/>";if(this.gestures)for(E+="<br/><br/>Gestures:<br/>",A=0,H=this.gestures.length;A!=H;A++)E+="  "+this.gestures[A].toString()+"<br/>";return E+="<br/><br/>Raw JSON:<br/>",E+JSON.stringify(this.data)};c.Invalid=
{valid:!1,hands:[],fingers:[],tools:[],gestures:[],pointables:[],pointable:function(){return f.Invalid},finger:function(){return f.Invalid},hand:function(){return n.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return k.create()},rotationAxis:function(){return u.create()},scaleFactor:function(){return 1},translation:function(){return u.create()}}},{"./finger":7,"./gesture":9,"./hand":10,"./interaction_box":12,
"./pointable":14,"gl-matrix":23,underscore:24}],9:[function(c,h,n){var f=c("gl-matrix").vec3;h=c("events").EventEmitter;var q=c("underscore"),l=(n.createGesture=function(C){switch(C.type){case "circle":var E=new k(C);break;case "swipe":E=new u(C);break;case "screenTap":E=new r(C);break;case "keyTap":E=new z(C);break;default:throw"unknown gesture type";}return E.id=C.id,E.handIds=C.handIds.slice(),E.pointableIds=C.pointableIds.slice(),E.duration=C.duration,E.state=C.state,E.type=C.type,E},n.gestureListener=
function(C,E){var A={},H={};C.on("gesture",function(N,U){if(N.type==E){if(("start"==N.state||"stop"==N.state)&&void 0===H[N.id]){var p=new l(N,U);H[N.id]=p;q.each(A,function(x,G){p.on(G,x)})}H[N.id].update(N,U);"stop"==N.state&&delete H[N.id]}});var J={start:function(N){return A.start=N,J},stop:function(N){return A.stop=N,J},complete:function(N){return A.stop=N,J},update:function(N){return A.update=N,J}};return J},n.Gesture=function(C,E){this.gestures=[C];this.frames=[E]});l.prototype.update=function(C,
E){this.lastGesture=C;this.lastFrame=E;this.gestures.push(C);this.frames.push(E);this.emit(C.state,this)};l.prototype.translation=function(){return f.subtract(f.create(),this.lastGesture.startPosition,this.lastGesture.position)};q.extend(l.prototype,h.prototype);var k=function(C){this.center=C.center;this.normal=C.normal;this.progress=C.progress;this.radius=C.radius};k.prototype.toString=function(){return"CircleGesture ["+JSON.stringify(this)+"]"};var u=function(C){this.startPosition=C.startPosition;
this.position=C.position;this.direction=C.direction;this.speed=C.speed};u.prototype.toString=function(){return"SwipeGesture ["+JSON.stringify(this)+"]"};var r=function(C){this.position=C.position;this.direction=C.direction;this.progress=C.progress};r.prototype.toString=function(){return"ScreenTapGesture ["+JSON.stringify(this)+"]"};var z=function(C){this.position=C.position;this.direction=C.direction;this.progress=C.progress};z.prototype.toString=function(){return"KeyTapGesture ["+JSON.stringify(this)+
"]"}},{events:21,"gl-matrix":23,underscore:24}],10:[function(c,h){var n=c("./pointable"),f=c("./bone"),q=c("gl-matrix"),l=q.mat3,k=q.vec3,u=c("underscore");c=h.exports=function(r){this.id=r.id;this.palmPosition=r.palmPosition;this.direction=r.direction;this.palmVelocity=r.palmVelocity;this.palmNormal=r.palmNormal;this.sphereCenter=r.sphereCenter;this.sphereRadius=r.sphereRadius;this.valid=!0;this.pointables=[];this.fingers=[];this.arm=r.armBasis?new f(this,{type:4,width:r.armWidth,prevJoint:r.elbow,
nextJoint:r.wrist,basis:r.armBasis}):null;this.tools=[];this._translation=r.t;this._rotation=u.flatten(r.r);this._scaleFactor=r.s;this.timeVisible=r.timeVisible;this.stabilizedPalmPosition=r.stabilizedPalmPosition;this.type=r.type;this.grabStrength=r.grabStrength;this.pinchStrength=r.pinchStrength;this.confidence=r.confidence};c.prototype.finger=function(r){return(r=this.frame.finger(r))&&r.handId==this.id?r:n.Invalid};c.prototype.rotationAngle=function(r,z){if(!this.valid||!r.valid||!r.hand(this.id).valid)return 0;
var C=this.rotationMatrix(r);C=Math.acos(.5*(C[0]+C[4]+C[8]-1));if(C=isNaN(C)?0:C,void 0!==z)r=this.rotationAxis(r),C*=k.dot(r,k.normalize(k.create(),z));return C};c.prototype.rotationAxis=function(r){if(!this.valid||!r.valid)return k.create();r=r.hand(this.id);return r.valid?k.normalize(k.create(),[this._rotation[7]-r._rotation[5],this._rotation[2]-r._rotation[6],this._rotation[3]-r._rotation[1]]):k.create()};c.prototype.rotationMatrix=function(r){if(!this.valid||!r.valid)return l.create();r=r.hand(this.id);
if(!r.valid)return l.create();var z=l.transpose(l.create(),this._rotation);return l.multiply(l.create(),r._rotation,z)};c.prototype.scaleFactor=function(r){if(!this.valid||!r.valid)return 1;r=r.hand(this.id);return r.valid?Math.exp(this._scaleFactor-r._scaleFactor):1};c.prototype.translation=function(r){if(!this.valid||!r.valid)return k.create();r=r.hand(this.id);return r.valid?[this._translation[0]-r._translation[0],this._translation[1]-r._translation[1],this._translation[2]-r._translation[2]]:k.create()};
c.prototype.toString=function(){return"Hand ("+this.type+") [ id: "+this.id+" | palm velocity:"+this.palmVelocity+" | sphere center:"+this.sphereCenter+" ] "};c.prototype.pitch=function(){return Math.atan2(this.direction[1],-this.direction[2])};c.prototype.yaw=function(){return Math.atan2(this.direction[0],-this.direction[2])};c.prototype.roll=function(){return Math.atan2(this.palmNormal[0],-this.palmNormal[1])};c.Invalid={valid:!1,fingers:[],tools:[],pointables:[],left:!1,pointable:function(){return n.Invalid},
finger:function(){return n.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return l.create()},rotationAxis:function(){return k.create()},scaleFactor:function(){return 1},translation:function(){return k.create()}}},{"./bone":1,"./pointable":14,"gl-matrix":23,underscore:24}],11:[function(c,h){h.exports={Controller:c("./controller"),Frame:c("./frame"),Gesture:c("./gesture"),Hand:c("./hand"),Pointable:c("./pointable"),
Finger:c("./finger"),InteractionBox:c("./interaction_box"),CircularBuffer:c("./circular_buffer"),UI:c("./ui"),JSONProtocol:c("./protocol").JSONProtocol,glMatrix:c("gl-matrix"),mat3:c("gl-matrix").mat3,vec3:c("gl-matrix").vec3,loopController:void 0,version:c("./version.js"),_:c("underscore"),EventEmitter:c("events").EventEmitter,loop:function(n,f){return n&&void 0===f&&"[object Function]"==={}.toString.call(n)&&(f=n,n={}),this.loopController?n&&this.loopController.setupFrameEvents(n):this.loopController=
new this.Controller(n),this.loopController.loop(f),this.loopController},plugin:function(n,f){this.Controller.plugin(n,f)}}},{"./circular_buffer":2,"./controller":5,"./finger":7,"./frame":8,"./gesture":9,"./hand":10,"./interaction_box":12,"./pointable":14,"./protocol":15,"./ui":16,"./version.js":19,events:21,"gl-matrix":23,underscore:24}],12:[function(c,h){var n=c("gl-matrix").vec3;c=h.exports=function(f){this.valid=!0;this.center=f.center;this.size=f.size;this.width=f.size[0];this.height=f.size[1];
this.depth=f.size[2]};c.prototype.denormalizePoint=function(f){return n.fromValues((f[0]-.5)*this.size[0]+this.center[0],(f[1]-.5)*this.size[1]+this.center[1],(f[2]-.5)*this.size[2]+this.center[2])};c.prototype.normalizePoint=function(f,q){f=n.fromValues((f[0]-this.center[0])/this.size[0]+.5,(f[1]-this.center[1])/this.size[1]+.5,(f[2]-this.center[2])/this.size[2]+.5);return q&&(f[0]=Math.min(Math.max(f[0],0),1),f[1]=Math.min(Math.max(f[1],0),1),f[2]=Math.min(Math.max(f[2],0),1)),f};c.prototype.toString=
function(){return"InteractionBox [ width:"+this.width+" | height:"+this.height+" | depth:"+this.depth+" ]"};c.Invalid={valid:!1}},{"gl-matrix":23}],13:[function(c,h){c=h.exports=function(n){this.steps=[];this.controller=n};c.prototype.addStep=function(n){this.steps.push(n)};c.prototype.run=function(n){for(var f=this.steps.length,q=0;q!=f&&n;q++)n=this.steps[q](n);return n};c.prototype.removeStep=function(n){n=this.steps.indexOf(n);if(-1===n)throw"Step not found in pipeline";this.steps.splice(n,1)};
c.prototype.addWrappedStep=function(n,f){var q=this.controller,l=function(k){var u;var r="frame"==n?[k]:k[n+"s"]||[];var z=0;for(u=r.length;u>z;z++)f.call(q,r[z]);return k};return this.addStep(l),l}},{}],14:[function(c,h){c=c("gl-matrix");h=(c.vec3,h.exports=function(n){this.valid=!0;this.id=n.id;this.handId=n.handId;this.length=n.length;this.tool=n.tool;this.width=n.width;this.direction=n.direction;this.stabilizedTipPosition=n.stabilizedTipPosition;this.tipPosition=n.tipPosition;this.tipVelocity=
n.tipVelocity;this.touchZone=n.touchZone;this.touchDistance=n.touchDistance;this.timeVisible=n.timeVisible});h.prototype.toString=function(){return"Pointable [ id:"+this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"};h.prototype.hand=function(){return this.frame.hand(this.handId)};h.Invalid={valid:!1}},{"gl-matrix":23}],15:[function(c,h,n){var f=c("./frame"),q=(c("./hand"),c("./pointable"),c("./finger"),c("underscore")),l=c("events").EventEmitter,k=function(r){this.type=
r.type;this.state=r.state};n.chooseProtocol=function(r){switch(r.version){case 1:case 2:case 3:case 4:case 5:case 6:var z=u(r);z.sendBackground=function(C,E){C.send(z.encode({background:E}))};z.sendFocused=function(C,E){C.send(z.encode({focused:E}))};z.sendOptimizeHMD=function(C,E){C.send(z.encode({optimizeHMD:E}))};break;default:throw"unrecognized version";}return z};var u=n.JSONProtocol=function(r){var z=function(C){if(C.event)return new k(C.event);z.emit("beforeFrameCreated",C);var E=new f(C);
return z.emit("afterFrameCreated",E,C),E};return z.encode=function(C){return JSON.stringify(C)},z.version=r.version,z.serviceVersion=r.serviceVersion,z.versionLong="Version "+r.version,z.type="protocol",q.extend(z,l.prototype),z}},{"./finger":7,"./frame":8,"./hand":10,"./pointable":14,events:21,underscore:24}],16:[function(c,h,n){n.UI={Region:c("./ui/region"),Cursor:c("./ui/cursor")}},{"./ui/cursor":17,"./ui/region":18}],17:[function(c,h){h.exports=function(){return function(n){var f=n.pointables.sort(function(q,
l){return q.z-l.z})[0];return f&&f.valid&&(n.cursorPosition=f.tipPosition),n}}},{}],18:[function(c,h){var n=c("events").EventEmitter;c=c("underscore");var f=h.exports=function(q,l){this.start=new Vector(q);this.end=new Vector(l);this.enteredFrame=null};f.prototype.hasPointables=function(q){for(var l=0;l!=q.pointables.length;l++){var k=q.pointables[l].tipPosition;if(k.x>=this.start.x&&k.x<=this.end.x&&k.y>=this.start.y&&k.y<=this.end.y&&k.z>=this.start.z&&k.z<=this.end.z)return!0}return!1};f.prototype.listener=
function(q){var l=this;return q&&q.nearThreshold&&this.setupNearRegion(q.nearThreshold),function(k){return l.updatePosition(k)}};f.prototype.clipper=function(){var q=this;return function(l){return q.updatePosition(l),q.enteredFrame?l:null}};f.prototype.setupNearRegion=function(q){q=this.nearRegion=new f([this.start.x-q,this.start.y-q,this.start.z-q],[this.end.x+q,this.end.y+q,this.end.z+q]);var l=this;q.on("enter",function(k){l.emit("near",k)});q.on("exit",function(k){l.emit("far",k)});l.on("exit",
function(k){l.emit("near",k)})};f.prototype.updatePosition=function(q){return this.nearRegion&&this.nearRegion.updatePosition(q),this.hasPointables(q)&&null==this.enteredFrame?(this.enteredFrame=q,this.emit("enter",this.enteredFrame)):this.hasPointables(q)||null==this.enteredFrame||(this.enteredFrame=null,this.emit("exit",this.enteredFrame)),q};f.prototype.normalize=function(q){return new Vector([(q.x-this.start.x)/(this.end.x-this.start.x),(q.y-this.start.y)/(this.end.y-this.start.y),(q.z-this.start.z)/
(this.end.z-this.start.z)])};f.prototype.mapToXY=function(q,l,k){q=this.normalize(q);var u=q.x,r=q.y;return 1<u?u=1:-1>u&&(u=-1),1<r?r=1:-1>r&&(r=-1),[(u+1)/2*l,(1-r)/2*k,q.z]};c.extend(f.prototype,n.prototype)},{events:21,underscore:24}],19:[function(c,h){h.exports={full:"0.6.4",major:0,minor:6,dot:4}},{}],20:[function(){},{}],21:[function(c,h,n){c=c("__browserify_process");c.EventEmitter||(c.EventEmitter=function(){});n=n.EventEmitter=c.EventEmitter;var f="function"==typeof Array.isArray?Array.isArray:
function(q){return"[object Array]"===Object.prototype.toString.call(q)};n.prototype.setMaxListeners=function(q){this._events||(this._events={});this._events.maxListeners=q};n.prototype.emit=function(q){if("error"===q&&(!this._events||!this._events.error||f(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var l=this._events[q];if(!l)return!1;if("function"==typeof l){switch(arguments.length){case 1:l.call(this);
break;case 2:l.call(this,arguments[1]);break;case 3:l.call(this,arguments[1],arguments[2]);break;default:var k=Array.prototype.slice.call(arguments,1);l.apply(this,k)}return!0}if(f(l)){k=Array.prototype.slice.call(arguments,1);l=l.slice();for(var u=0,r=l.length;r>u;u++)l[u].apply(this,k);return!0}return!1};n.prototype.addListener=function(q,l){if("function"!=typeof l)throw Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",q,l),this._events[q])if(f(this._events[q])){if(!this._events[q].warned){var k;
(k=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&0<k&&this._events[q].length>k&&(this._events[q].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[q].length),console.trace())}this._events[q].push(l)}else this._events[q]=[this._events[q],l];else this._events[q]=l;return this};n.prototype.on=n.prototype.addListener;n.prototype.once=function(q,l){var k=this;return k.on(q,
function r(){k.removeListener(q,r);l.apply(this,arguments)}),this};n.prototype.removeListener=function(q,l){if("function"!=typeof l)throw Error("removeListener only takes instances of Function");if(!this._events||!this._events[q])return this;var k=this._events[q];if(f(k)){a:if(k.indexOf)l=k.indexOf(l);else{for(var u=0;u<k.length;u++)if(l===k[u]){l=u;break a}l=-1}if(0>l)return this;k.splice(l,1);0==k.length&&delete this._events[q]}else this._events[q]===l&&delete this._events[q];return this};n.prototype.removeAllListeners=
function(q){return 0===arguments.length?(this._events={},this):(q&&this._events&&this._events[q]&&(this._events[q]=null),this)};n.prototype.listeners=function(q){return this._events||(this._events={}),this._events[q]||(this._events[q]=[]),f(this._events[q])||(this._events[q]=[this._events[q]]),this._events[q]};n.listenerCount=function(q,l){return q._events&&q._events[l]?"function"==typeof q._events[l]?1:q._events[l].length:0}},{__browserify_process:22}],22:[function(c,h){c=h.exports={};c.nextTick=
function(){if("undefined"!=typeof window&&window.setImmediate)return function(f){return window.setImmediate(f)};if("undefined"!=typeof window&&window.postMessage&&window.addEventListener){var n=[];return window.addEventListener("message",function(f){var q=f.source;(q===window||null===q)&&"process-tick"===f.data&&(f.stopPropagation(),0<n.length)&&n.shift()()},!0),function(f){n.push(f);window.postMessage("process-tick","*")}}return function(f){setTimeout(f,0)}}();c.title="browser";c.browser=!0;c.env=
{};c.argv=[];c.binding=function(){throw Error("process.binding is not supported");};c.cwd=function(){return"/"};c.chdir=function(){throw Error("process.chdir is not supported");}},{}],23:[function(c,h,n){!function(f){var q;"undefined"==typeof n?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(q={},define(function(){return q})):q="undefined"!=typeof window?window:f:q=n;(function(l){if(!k)var k=1E-6;if(!u)var u="undefined"!=typeof Float32Array?Float32Array:Array;if(!r)var r=Math.random;
var z={setMatrixArrayType:function(p){u=p}};"undefined"!=typeof l&&(l.glMatrix=z);var C=Math.PI/180;z.toRadian=function(p){return p*C};var E={create:function(){var p=new u(2);return p[0]=0,p[1]=0,p},clone:function(p){var x=new u(2);return x[0]=p[0],x[1]=p[1],x},fromValues:function(p,x){var G=new u(2);return G[0]=p,G[1]=x,G},copy:function(p,x){return p[0]=x[0],p[1]=x[1],p},set:function(p,x,G){return p[0]=x,p[1]=G,p},add:function(p,x,G){return p[0]=x[0]+G[0],p[1]=x[1]+G[1],p},subtract:function(p,x,
G){return p[0]=x[0]-G[0],p[1]=x[1]-G[1],p}};E.sub=E.subtract;E.multiply=function(p,x,G){return p[0]=x[0]*G[0],p[1]=x[1]*G[1],p};E.mul=E.multiply;E.divide=function(p,x,G){return p[0]=x[0]/G[0],p[1]=x[1]/G[1],p};E.div=E.divide;E.min=function(p,x,G){return p[0]=Math.min(x[0],G[0]),p[1]=Math.min(x[1],G[1]),p};E.max=function(p,x,G){return p[0]=Math.max(x[0],G[0]),p[1]=Math.max(x[1],G[1]),p};E.scale=function(p,x,G){return p[0]=x[0]*G,p[1]=x[1]*G,p};E.scaleAndAdd=function(p,x,G,e){return p[0]=x[0]+G[0]*
e,p[1]=x[1]+G[1]*e,p};E.distance=function(p,x){var G=x[0]-p[0];p=x[1]-p[1];return Math.sqrt(G*G+p*p)};E.dist=E.distance;E.squaredDistance=function(p,x){var G=x[0]-p[0];p=x[1]-p[1];return G*G+p*p};E.sqrDist=E.squaredDistance;E.length=function(p){var x=p[0];p=p[1];return Math.sqrt(x*x+p*p)};E.len=E.length;E.squaredLength=function(p){var x=p[0];p=p[1];return x*x+p*p};E.sqrLen=E.squaredLength;E.negate=function(p,x){return p[0]=-x[0],p[1]=-x[1],p};E.normalize=function(p,x){var G=x[0],e=x[1];G=G*G+e*e;
return 0<G&&(G=1/Math.sqrt(G),p[0]=x[0]*G,p[1]=x[1]*G),p};E.dot=function(p,x){return p[0]*x[0]+p[1]*x[1]};E.cross=function(p,x,G){x=x[0]*G[1]-x[1]*G[0];return p[0]=p[1]=0,p[2]=x,p};E.lerp=function(p,x,G,e){var m=x[0];x=x[1];return p[0]=m+e*(G[0]-m),p[1]=x+e*(G[1]-x),p};E.random=function(p,x){x=x||1;var G=2*r()*Math.PI;return p[0]=Math.cos(G)*x,p[1]=Math.sin(G)*x,p};E.transformMat2=function(p,x,G){var e=x[0];x=x[1];return p[0]=G[0]*e+G[2]*x,p[1]=G[1]*e+G[3]*x,p};E.transformMat2d=function(p,x,G){var e=
x[0];x=x[1];return p[0]=G[0]*e+G[2]*x+G[4],p[1]=G[1]*e+G[3]*x+G[5],p};E.transformMat3=function(p,x,G){var e=x[0];x=x[1];return p[0]=G[0]*e+G[3]*x+G[6],p[1]=G[1]*e+G[4]*x+G[7],p};E.transformMat4=function(p,x,G){var e=x[0];x=x[1];return p[0]=G[0]*e+G[4]*x+G[12],p[1]=G[1]*e+G[5]*x+G[13],p};E.forEach=function(){var p=E.create();return function(x,G,e,m,v,D){G||(G=2);e||(e=0);for(m=m?Math.min(m*G+e,x.length):x.length;m>e;e+=G)p[0]=x[e],p[1]=x[e+1],v(p,p,D),x[e]=p[0],x[e+1]=p[1];return x}}();E.str=function(p){return"vec2("+
p[0]+", "+p[1]+")"};"undefined"!=typeof l&&(l.vec2=E);var A={create:function(){var p=new u(3);return p[0]=0,p[1]=0,p[2]=0,p},clone:function(p){var x=new u(3);return x[0]=p[0],x[1]=p[1],x[2]=p[2],x},fromValues:function(p,x,G){var e=new u(3);return e[0]=p,e[1]=x,e[2]=G,e},copy:function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],p},set:function(p,x,G,e){return p[0]=x,p[1]=G,p[2]=e,p},add:function(p,x,G){return p[0]=x[0]+G[0],p[1]=x[1]+G[1],p[2]=x[2]+G[2],p},subtract:function(p,x,G){return p[0]=x[0]-G[0],
p[1]=x[1]-G[1],p[2]=x[2]-G[2],p}};A.sub=A.subtract;A.multiply=function(p,x,G){return p[0]=x[0]*G[0],p[1]=x[1]*G[1],p[2]=x[2]*G[2],p};A.mul=A.multiply;A.divide=function(p,x,G){return p[0]=x[0]/G[0],p[1]=x[1]/G[1],p[2]=x[2]/G[2],p};A.div=A.divide;A.min=function(p,x,G){return p[0]=Math.min(x[0],G[0]),p[1]=Math.min(x[1],G[1]),p[2]=Math.min(x[2],G[2]),p};A.max=function(p,x,G){return p[0]=Math.max(x[0],G[0]),p[1]=Math.max(x[1],G[1]),p[2]=Math.max(x[2],G[2]),p};A.scale=function(p,x,G){return p[0]=x[0]*G,
p[1]=x[1]*G,p[2]=x[2]*G,p};A.scaleAndAdd=function(p,x,G,e){return p[0]=x[0]+G[0]*e,p[1]=x[1]+G[1]*e,p[2]=x[2]+G[2]*e,p};A.distance=function(p,x){var G=x[0]-p[0],e=x[1]-p[1];p=x[2]-p[2];return Math.sqrt(G*G+e*e+p*p)};A.dist=A.distance;A.squaredDistance=function(p,x){var G=x[0]-p[0],e=x[1]-p[1];p=x[2]-p[2];return G*G+e*e+p*p};A.sqrDist=A.squaredDistance;A.length=function(p){var x=p[0],G=p[1];p=p[2];return Math.sqrt(x*x+G*G+p*p)};A.len=A.length;A.squaredLength=function(p){var x=p[0],G=p[1];p=p[2];return x*
x+G*G+p*p};A.sqrLen=A.squaredLength;A.negate=function(p,x){return p[0]=-x[0],p[1]=-x[1],p[2]=-x[2],p};A.normalize=function(p,x){var G=x[0],e=x[1],m=x[2];G=G*G+e*e+m*m;return 0<G&&(G=1/Math.sqrt(G),p[0]=x[0]*G,p[1]=x[1]*G,p[2]=x[2]*G),p};A.dot=function(p,x){return p[0]*x[0]+p[1]*x[1]+p[2]*x[2]};A.cross=function(p,x,G){var e=x[0],m=x[1];x=x[2];var v=G[0],D=G[1];G=G[2];return p[0]=m*G-x*D,p[1]=x*v-e*G,p[2]=e*D-m*v,p};A.lerp=function(p,x,G,e){var m=x[0],v=x[1];x=x[2];return p[0]=m+e*(G[0]-m),p[1]=v+e*
(G[1]-v),p[2]=x+e*(G[2]-x),p};A.random=function(p,x){x=x||1;var G=2*r()*Math.PI,e=2*r()-1,m=Math.sqrt(1-e*e)*x;return p[0]=Math.cos(G)*m,p[1]=Math.sin(G)*m,p[2]=e*x,p};A.transformMat4=function(p,x,G){var e=x[0],m=x[1];x=x[2];return p[0]=G[0]*e+G[4]*m+G[8]*x+G[12],p[1]=G[1]*e+G[5]*m+G[9]*x+G[13],p[2]=G[2]*e+G[6]*m+G[10]*x+G[14],p};A.transformMat3=function(p,x,G){var e=x[0],m=x[1];x=x[2];return p[0]=e*G[0]+m*G[3]+x*G[6],p[1]=e*G[1]+m*G[4]+x*G[7],p[2]=e*G[2]+m*G[5]+x*G[8],p};A.transformQuat=function(p,
x,G){var e=x[0],m=x[1],v=x[2];x=G[0];var D=G[1],B=G[2];G=G[3];var I=G*e+D*v-B*m,L=G*m+B*e-x*v,S=G*v+x*m-D*e;e=-x*e-D*m-B*v;return p[0]=I*G+e*-x+L*-B-S*-D,p[1]=L*G+e*-D+S*-x-I*-B,p[2]=S*G+e*-B+I*-D-L*-x,p};A.rotateX=function(p,x,G,e){var m=[],v=[];return m[0]=x[0]-G[0],m[1]=x[1]-G[1],m[2]=x[2]-G[2],v[0]=m[0],v[1]=m[1]*Math.cos(e)-m[2]*Math.sin(e),v[2]=m[1]*Math.sin(e)+m[2]*Math.cos(e),p[0]=v[0]+G[0],p[1]=v[1]+G[1],p[2]=v[2]+G[2],p};A.rotateY=function(p,x,G,e){var m=[],v=[];return m[0]=x[0]-G[0],m[1]=
x[1]-G[1],m[2]=x[2]-G[2],v[0]=m[2]*Math.sin(e)+m[0]*Math.cos(e),v[1]=m[1],v[2]=m[2]*Math.cos(e)-m[0]*Math.sin(e),p[0]=v[0]+G[0],p[1]=v[1]+G[1],p[2]=v[2]+G[2],p};A.rotateZ=function(p,x,G,e){var m=[],v=[];return m[0]=x[0]-G[0],m[1]=x[1]-G[1],m[2]=x[2]-G[2],v[0]=m[0]*Math.cos(e)-m[1]*Math.sin(e),v[1]=m[0]*Math.sin(e)+m[1]*Math.cos(e),v[2]=m[2],p[0]=v[0]+G[0],p[1]=v[1]+G[1],p[2]=v[2]+G[2],p};A.forEach=function(){var p=A.create();return function(x,G,e,m,v,D){G||(G=3);e||(e=0);for(m=m?Math.min(m*G+e,x.length):
x.length;m>e;e+=G)p[0]=x[e],p[1]=x[e+1],p[2]=x[e+2],v(p,p,D),x[e]=p[0],x[e+1]=p[1],x[e+2]=p[2];return x}}();A.str=function(p){return"vec3("+p[0]+", "+p[1]+", "+p[2]+")"};"undefined"!=typeof l&&(l.vec3=A);var H={create:function(){var p=new u(4);return p[0]=0,p[1]=0,p[2]=0,p[3]=0,p},clone:function(p){var x=new u(4);return x[0]=p[0],x[1]=p[1],x[2]=p[2],x[3]=p[3],x},fromValues:function(p,x,G,e){var m=new u(4);return m[0]=p,m[1]=x,m[2]=G,m[3]=e,m},copy:function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],
p[3]=x[3],p},set:function(p,x,G,e,m){return p[0]=x,p[1]=G,p[2]=e,p[3]=m,p},add:function(p,x,G){return p[0]=x[0]+G[0],p[1]=x[1]+G[1],p[2]=x[2]+G[2],p[3]=x[3]+G[3],p},subtract:function(p,x,G){return p[0]=x[0]-G[0],p[1]=x[1]-G[1],p[2]=x[2]-G[2],p[3]=x[3]-G[3],p}};H.sub=H.subtract;H.multiply=function(p,x,G){return p[0]=x[0]*G[0],p[1]=x[1]*G[1],p[2]=x[2]*G[2],p[3]=x[3]*G[3],p};H.mul=H.multiply;H.divide=function(p,x,G){return p[0]=x[0]/G[0],p[1]=x[1]/G[1],p[2]=x[2]/G[2],p[3]=x[3]/G[3],p};H.div=H.divide;
H.min=function(p,x,G){return p[0]=Math.min(x[0],G[0]),p[1]=Math.min(x[1],G[1]),p[2]=Math.min(x[2],G[2]),p[3]=Math.min(x[3],G[3]),p};H.max=function(p,x,G){return p[0]=Math.max(x[0],G[0]),p[1]=Math.max(x[1],G[1]),p[2]=Math.max(x[2],G[2]),p[3]=Math.max(x[3],G[3]),p};H.scale=function(p,x,G){return p[0]=x[0]*G,p[1]=x[1]*G,p[2]=x[2]*G,p[3]=x[3]*G,p};H.scaleAndAdd=function(p,x,G,e){return p[0]=x[0]+G[0]*e,p[1]=x[1]+G[1]*e,p[2]=x[2]+G[2]*e,p[3]=x[3]+G[3]*e,p};H.distance=function(p,x){var G=x[0]-p[0],e=x[1]-
p[1],m=x[2]-p[2];p=x[3]-p[3];return Math.sqrt(G*G+e*e+m*m+p*p)};H.dist=H.distance;H.squaredDistance=function(p,x){var G=x[0]-p[0],e=x[1]-p[1],m=x[2]-p[2];p=x[3]-p[3];return G*G+e*e+m*m+p*p};H.sqrDist=H.squaredDistance;H.length=function(p){var x=p[0],G=p[1],e=p[2];p=p[3];return Math.sqrt(x*x+G*G+e*e+p*p)};H.len=H.length;H.squaredLength=function(p){var x=p[0],G=p[1],e=p[2];p=p[3];return x*x+G*G+e*e+p*p};H.sqrLen=H.squaredLength;H.negate=function(p,x){return p[0]=-x[0],p[1]=-x[1],p[2]=-x[2],p[3]=-x[3],
p};H.normalize=function(p,x){var G=x[0],e=x[1],m=x[2],v=x[3];G=G*G+e*e+m*m+v*v;return 0<G&&(G=1/Math.sqrt(G),p[0]=x[0]*G,p[1]=x[1]*G,p[2]=x[2]*G,p[3]=x[3]*G),p};H.dot=function(p,x){return p[0]*x[0]+p[1]*x[1]+p[2]*x[2]+p[3]*x[3]};H.lerp=function(p,x,G,e){var m=x[0],v=x[1],D=x[2];x=x[3];return p[0]=m+e*(G[0]-m),p[1]=v+e*(G[1]-v),p[2]=D+e*(G[2]-D),p[3]=x+e*(G[3]-x),p};H.random=function(p,x){return x=x||1,p[0]=r(),p[1]=r(),p[2]=r(),p[3]=r(),H.normalize(p,p),H.scale(p,p,x),p};H.transformMat4=function(p,
x,G){var e=x[0],m=x[1],v=x[2];x=x[3];return p[0]=G[0]*e+G[4]*m+G[8]*v+G[12]*x,p[1]=G[1]*e+G[5]*m+G[9]*v+G[13]*x,p[2]=G[2]*e+G[6]*m+G[10]*v+G[14]*x,p[3]=G[3]*e+G[7]*m+G[11]*v+G[15]*x,p};H.transformQuat=function(p,x,G){var e=x[0],m=x[1],v=x[2];x=G[0];var D=G[1],B=G[2];G=G[3];var I=G*e+D*v-B*m,L=G*m+B*e-x*v,S=G*v+x*m-D*e;e=-x*e-D*m-B*v;return p[0]=I*G+e*-x+L*-B-S*-D,p[1]=L*G+e*-D+S*-x-I*-B,p[2]=S*G+e*-B+I*-D-L*-x,p};H.forEach=function(){var p=H.create();return function(x,G,e,m,v,D){G||(G=4);e||(e=0);
for(m=m?Math.min(m*G+e,x.length):x.length;m>e;e+=G)p[0]=x[e],p[1]=x[e+1],p[2]=x[e+2],p[3]=x[e+3],v(p,p,D),x[e]=p[0],x[e+1]=p[1],x[e+2]=p[2],x[e+3]=p[3];return x}}();H.str=function(p){return"vec4("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+")"};"undefined"!=typeof l&&(l.vec4=H);z={create:function(){var p=new u(4);return p[0]=1,p[1]=0,p[2]=0,p[3]=1,p},clone:function(p){var x=new u(4);return x[0]=p[0],x[1]=p[1],x[2]=p[2],x[3]=p[3],x},copy:function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[3],p},identity:function(p){return p[0]=
1,p[1]=0,p[2]=0,p[3]=1,p},transpose:function(p,x){if(p===x){var G=x[1];p[1]=x[2];p[2]=G}else p[0]=x[0],p[1]=x[2],p[2]=x[1],p[3]=x[3];return p},invert:function(p,x){var G=x[0],e=x[1],m=x[2];x=x[3];var v=G*x-m*e;return v?(v=1/v,p[0]=x*v,p[1]=-e*v,p[2]=-m*v,p[3]=G*v,p):null},adjoint:function(p,x){var G=x[0];return p[0]=x[3],p[1]=-x[1],p[2]=-x[2],p[3]=G,p},determinant:function(p){return p[0]*p[3]-p[2]*p[1]},multiply:function(p,x,G){var e=x[0],m=x[1],v=x[2];x=x[3];var D=G[0],B=G[1],I=G[2];G=G[3];return p[0]=
e*D+v*B,p[1]=m*D+x*B,p[2]=e*I+v*G,p[3]=m*I+x*G,p}};z.mul=z.multiply;z.rotate=function(p,x,G){var e=x[0],m=x[1],v=x[2];x=x[3];var D=Math.sin(G);G=Math.cos(G);return p[0]=e*G+v*D,p[1]=m*G+x*D,p[2]=e*-D+v*G,p[3]=m*-D+x*G,p};z.scale=function(p,x,G){var e=x[1],m=x[2],v=x[3],D=G[0];G=G[1];return p[0]=x[0]*D,p[1]=e*D,p[2]=m*G,p[3]=v*G,p};z.str=function(p){return"mat2("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+")"};z.frob=function(p){return Math.sqrt(Math.pow(p[0],2)+Math.pow(p[1],2)+Math.pow(p[2],2)+Math.pow(p[3],
2))};z.LDU=function(p,x,G,e){return p[2]=e[2]/e[0],G[0]=e[0],G[1]=e[1],G[3]=e[3]-p[2]*G[1],[p,x,G]};"undefined"!=typeof l&&(l.mat2=z);z={create:function(){var p=new u(6);return p[0]=1,p[1]=0,p[2]=0,p[3]=1,p[4]=0,p[5]=0,p},clone:function(p){var x=new u(6);return x[0]=p[0],x[1]=p[1],x[2]=p[2],x[3]=p[3],x[4]=p[4],x[5]=p[5],x},copy:function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[3],p[4]=x[4],p[5]=x[5],p},identity:function(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=1,p[4]=0,p[5]=0,p},invert:function(p,
x){var G=x[0],e=x[1],m=x[2],v=x[3],D=x[4];x=x[5];var B=G*v-e*m;return B?(B=1/B,p[0]=v*B,p[1]=-e*B,p[2]=-m*B,p[3]=G*B,p[4]=(m*x-v*D)*B,p[5]=(e*D-G*x)*B,p):null},determinant:function(p){return p[0]*p[3]-p[1]*p[2]},multiply:function(p,x,G){var e=x[0],m=x[1],v=x[2],D=x[3],B=x[4];x=x[5];var I=G[0],L=G[1],S=G[2],R=G[3],W=G[4];G=G[5];return p[0]=e*I+v*L,p[1]=m*I+D*L,p[2]=e*S+v*R,p[3]=m*S+D*R,p[4]=e*W+v*G+B,p[5]=m*W+D*G+x,p}};z.mul=z.multiply;z.rotate=function(p,x,G){var e=x[0],m=x[1],v=x[2],D=x[3],B=x[4];
x=x[5];var I=Math.sin(G);G=Math.cos(G);return p[0]=e*G+v*I,p[1]=m*G+D*I,p[2]=e*-I+v*G,p[3]=m*-I+D*G,p[4]=B,p[5]=x,p};z.scale=function(p,x,G){var e=x[1],m=x[2],v=x[3],D=x[4],B=x[5],I=G[0];G=G[1];return p[0]=x[0]*I,p[1]=e*I,p[2]=m*G,p[3]=v*G,p[4]=D,p[5]=B,p};z.translate=function(p,x,G){var e=x[0],m=x[1],v=x[2],D=x[3],B=x[4];x=x[5];var I=G[0];G=G[1];return p[0]=e,p[1]=m,p[2]=v,p[3]=D,p[4]=e*I+v*G+B,p[5]=m*I+D*G+x,p};z.str=function(p){return"mat2d("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+", "+p[4]+", "+p[5]+
")"};z.frob=function(p){return Math.sqrt(Math.pow(p[0],2)+Math.pow(p[1],2)+Math.pow(p[2],2)+Math.pow(p[3],2)+Math.pow(p[4],2)+Math.pow(p[5],2)+1)};"undefined"!=typeof l&&(l.mat2d=z);var J={create:function(){var p=new u(9);return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=1,p[5]=0,p[6]=0,p[7]=0,p[8]=1,p},fromMat4:function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[4],p[4]=x[5],p[5]=x[6],p[6]=x[8],p[7]=x[9],p[8]=x[10],p},clone:function(p){var x=new u(9);return x[0]=p[0],x[1]=p[1],x[2]=p[2],x[3]=p[3],x[4]=
p[4],x[5]=p[5],x[6]=p[6],x[7]=p[7],x[8]=p[8],x},copy:function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[3],p[4]=x[4],p[5]=x[5],p[6]=x[6],p[7]=x[7],p[8]=x[8],p},identity:function(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=1,p[5]=0,p[6]=0,p[7]=0,p[8]=1,p},transpose:function(p,x){if(p===x){var G=x[1],e=x[2],m=x[5];p[1]=x[3];p[2]=x[6];p[3]=G;p[5]=x[7];p[6]=e;p[7]=m}else p[0]=x[0],p[1]=x[3],p[2]=x[6],p[3]=x[1],p[4]=x[4],p[5]=x[7],p[6]=x[2],p[7]=x[5],p[8]=x[8];return p},invert:function(p,x){var G=
x[0],e=x[1],m=x[2],v=x[3],D=x[4],B=x[5],I=x[6],L=x[7];x=x[8];var S=x*D-B*L,R=-x*v+B*I,W=L*v-D*I,X=G*S+e*R+m*W;return X?(X=1/X,p[0]=S*X,p[1]=(-x*e+m*L)*X,p[2]=(B*e-m*D)*X,p[3]=R*X,p[4]=(x*G-m*I)*X,p[5]=(-B*G+m*v)*X,p[6]=W*X,p[7]=(-L*G+e*I)*X,p[8]=(D*G-e*v)*X,p):null},adjoint:function(p,x){var G=x[0],e=x[1],m=x[2],v=x[3],D=x[4],B=x[5],I=x[6],L=x[7];x=x[8];return p[0]=D*x-B*L,p[1]=m*L-e*x,p[2]=e*B-m*D,p[3]=B*I-v*x,p[4]=G*x-m*I,p[5]=m*v-G*B,p[6]=v*L-D*I,p[7]=e*I-G*L,p[8]=G*D-e*v,p},determinant:function(p){var x=
p[3],G=p[4],e=p[5],m=p[6],v=p[7],D=p[8];return p[0]*(D*G-e*v)+p[1]*(-D*x+e*m)+p[2]*(v*x-G*m)},multiply:function(p,x,G){var e=x[0],m=x[1],v=x[2],D=x[3],B=x[4],I=x[5],L=x[6],S=x[7];x=x[8];var R=G[0],W=G[1],X=G[2],V=G[3],la=G[4],fa=G[5],ha=G[6],ba=G[7];G=G[8];return p[0]=R*e+W*D+X*L,p[1]=R*m+W*B+X*S,p[2]=R*v+W*I+X*x,p[3]=V*e+la*D+fa*L,p[4]=V*m+la*B+fa*S,p[5]=V*v+la*I+fa*x,p[6]=ha*e+ba*D+G*L,p[7]=ha*m+ba*B+G*S,p[8]=ha*v+ba*I+G*x,p}};J.mul=J.multiply;J.translate=function(p,x,G){var e=x[0],m=x[1],v=x[2],
D=x[3],B=x[4],I=x[5],L=x[6],S=x[7];x=x[8];var R=G[0];G=G[1];return p[0]=e,p[1]=m,p[2]=v,p[3]=D,p[4]=B,p[5]=I,p[6]=R*e+G*D+L,p[7]=R*m+G*B+S,p[8]=R*v+G*I+x,p};J.rotate=function(p,x,G){var e=x[0],m=x[1],v=x[2],D=x[3],B=x[4],I=x[5],L=x[6],S=x[7];x=x[8];var R=Math.sin(G);G=Math.cos(G);return p[0]=G*e+R*D,p[1]=G*m+R*B,p[2]=G*v+R*I,p[3]=G*D-R*e,p[4]=G*B-R*m,p[5]=G*I-R*v,p[6]=L,p[7]=S,p[8]=x,p};J.scale=function(p,x,G){var e=G[0];G=G[1];return p[0]=e*x[0],p[1]=e*x[1],p[2]=e*x[2],p[3]=G*x[3],p[4]=G*x[4],p[5]=
G*x[5],p[6]=x[6],p[7]=x[7],p[8]=x[8],p};J.fromMat2d=function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=0,p[3]=x[2],p[4]=x[3],p[5]=0,p[6]=x[4],p[7]=x[5],p[8]=1,p};J.fromQuat=function(p,x){var G=x[0],e=x[1],m=x[2];x=x[3];var v=G+G,D=e+e,B=m+m;G*=v;var I=e*v;e*=D;var L=m*v,S=m*D;m*=B;v*=x;D*=x;x*=B;return p[0]=1-e-m,p[3]=I-x,p[6]=L+D,p[1]=I+x,p[4]=1-G-m,p[7]=S-v,p[2]=L-D,p[5]=S+v,p[8]=1-G-e,p};J.normalFromMat4=function(p,x){var G=x[0],e=x[1],m=x[2],v=x[3],D=x[4],B=x[5],I=x[6],L=x[7],S=x[8],R=x[9],W=x[10],
X=x[11],V=x[12],la=x[13],fa=x[14];x=x[15];var ha=G*B-e*D,ba=G*I-m*D,ea=G*L-v*D,ka=e*I-m*B,O=e*L-v*B,Y=m*L-v*I,da=S*la-R*V,pa=S*fa-W*V;S=S*x-X*V;var ma=R*fa-W*la;R=R*x-X*la;W=W*x-X*fa;return(X=ha*W-ba*R+ea*ma+ka*S-O*pa+Y*da)?(X=1/X,p[0]=(B*W-I*R+L*ma)*X,p[1]=(I*S-D*W-L*pa)*X,p[2]=(D*R-B*S+L*da)*X,p[3]=(m*R-e*W-v*ma)*X,p[4]=(G*W-m*S+v*pa)*X,p[5]=(e*S-G*R-v*da)*X,p[6]=(la*Y-fa*O+x*ka)*X,p[7]=(fa*ea-V*Y-x*ba)*X,p[8]=(V*O-la*ea+x*ha)*X,p):null};J.str=function(p){return"mat3("+p[0]+", "+p[1]+", "+p[2]+
", "+p[3]+", "+p[4]+", "+p[5]+", "+p[6]+", "+p[7]+", "+p[8]+")"};J.frob=function(p){return Math.sqrt(Math.pow(p[0],2)+Math.pow(p[1],2)+Math.pow(p[2],2)+Math.pow(p[3],2)+Math.pow(p[4],2)+Math.pow(p[5],2)+Math.pow(p[6],2)+Math.pow(p[7],2)+Math.pow(p[8],2))};"undefined"!=typeof l&&(l.mat3=J);var N={create:function(){var p=new u(16);return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p},clone:function(p){var x=new u(16);return x[0]=
p[0],x[1]=p[1],x[2]=p[2],x[3]=p[3],x[4]=p[4],x[5]=p[5],x[6]=p[6],x[7]=p[7],x[8]=p[8],x[9]=p[9],x[10]=p[10],x[11]=p[11],x[12]=p[12],x[13]=p[13],x[14]=p[14],x[15]=p[15],x},copy:function(p,x){return p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[3],p[4]=x[4],p[5]=x[5],p[6]=x[6],p[7]=x[7],p[8]=x[8],p[9]=x[9],p[10]=x[10],p[11]=x[11],p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15],p},identity:function(p){return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,
p[14]=0,p[15]=1,p},transpose:function(p,x){if(p===x){var G=x[1],e=x[2],m=x[3],v=x[6],D=x[7],B=x[11];p[1]=x[4];p[2]=x[8];p[3]=x[12];p[4]=G;p[6]=x[9];p[7]=x[13];p[8]=e;p[9]=v;p[11]=x[14];p[12]=m;p[13]=D;p[14]=B}else p[0]=x[0],p[1]=x[4],p[2]=x[8],p[3]=x[12],p[4]=x[1],p[5]=x[5],p[6]=x[9],p[7]=x[13],p[8]=x[2],p[9]=x[6],p[10]=x[10],p[11]=x[14],p[12]=x[3],p[13]=x[7],p[14]=x[11],p[15]=x[15];return p},invert:function(p,x){var G=x[0],e=x[1],m=x[2],v=x[3],D=x[4],B=x[5],I=x[6],L=x[7],S=x[8],R=x[9],W=x[10],X=
x[11],V=x[12],la=x[13],fa=x[14];x=x[15];var ha=G*B-e*D,ba=G*I-m*D,ea=G*L-v*D,ka=e*I-m*B,O=e*L-v*B,Y=m*L-v*I,da=S*la-R*V,pa=S*fa-W*V,ma=S*x-X*V,wa=R*fa-W*la,Ca=R*x-X*la,ya=W*x-X*fa,za=ha*ya-ba*Ca+ea*wa+ka*ma-O*pa+Y*da;return za?(za=1/za,p[0]=(B*ya-I*Ca+L*wa)*za,p[1]=(m*Ca-e*ya-v*wa)*za,p[2]=(la*Y-fa*O+x*ka)*za,p[3]=(W*O-R*Y-X*ka)*za,p[4]=(I*ma-D*ya-L*pa)*za,p[5]=(G*ya-m*ma+v*pa)*za,p[6]=(fa*ea-V*Y-x*ba)*za,p[7]=(S*Y-W*ea+X*ba)*za,p[8]=(D*Ca-B*ma+L*da)*za,p[9]=(e*ma-G*Ca-v*da)*za,p[10]=(V*O-la*ea+x*
ha)*za,p[11]=(R*ea-S*O-X*ha)*za,p[12]=(B*pa-D*wa-I*da)*za,p[13]=(G*wa-e*pa+m*da)*za,p[14]=(la*ba-V*ka-fa*ha)*za,p[15]=(S*ka-R*ba+W*ha)*za,p):null},adjoint:function(p,x){var G=x[0],e=x[1],m=x[2],v=x[3],D=x[4],B=x[5],I=x[6],L=x[7],S=x[8],R=x[9],W=x[10],X=x[11],V=x[12],la=x[13],fa=x[14];x=x[15];return p[0]=B*(W*x-X*fa)-R*(I*x-L*fa)+la*(I*X-L*W),p[1]=-(e*(W*x-X*fa)-R*(m*x-v*fa)+la*(m*X-v*W)),p[2]=e*(I*x-L*fa)-B*(m*x-v*fa)+la*(m*L-v*I),p[3]=-(e*(I*X-L*W)-B*(m*X-v*W)+R*(m*L-v*I)),p[4]=-(D*(W*x-X*fa)-S*
(I*x-L*fa)+V*(I*X-L*W)),p[5]=G*(W*x-X*fa)-S*(m*x-v*fa)+V*(m*X-v*W),p[6]=-(G*(I*x-L*fa)-D*(m*x-v*fa)+V*(m*L-v*I)),p[7]=G*(I*X-L*W)-D*(m*X-v*W)+S*(m*L-v*I),p[8]=D*(R*x-X*la)-S*(B*x-L*la)+V*(B*X-L*R),p[9]=-(G*(R*x-X*la)-S*(e*x-v*la)+V*(e*X-v*R)),p[10]=G*(B*x-L*la)-D*(e*x-v*la)+V*(e*L-v*B),p[11]=-(G*(B*X-L*R)-D*(e*X-v*R)+S*(e*L-v*B)),p[12]=-(D*(R*fa-W*la)-S*(B*fa-I*la)+V*(B*W-I*R)),p[13]=G*(R*fa-W*la)-S*(e*fa-m*la)+V*(e*W-m*R),p[14]=-(G*(B*fa-I*la)-D*(e*fa-m*la)+V*(e*I-m*B)),p[15]=G*(B*W-I*R)-D*(e*W-
m*R)+S*(e*I-m*B),p},determinant:function(p){var x=p[0],G=p[1],e=p[2],m=p[3],v=p[4],D=p[5],B=p[6],I=p[7],L=p[8],S=p[9],R=p[10],W=p[11],X=p[12],V=p[13],la=p[14];p=p[15];return(x*D-G*v)*(R*p-W*la)-(x*B-e*v)*(S*p-W*V)+(x*I-m*v)*(S*la-R*V)+(G*B-e*D)*(L*p-W*X)-(G*I-m*D)*(L*la-R*X)+(e*I-m*B)*(L*V-S*X)},multiply:function(p,x,G){var e=x[0],m=x[1],v=x[2],D=x[3],B=x[4],I=x[5],L=x[6],S=x[7],R=x[8],W=x[9],X=x[10],V=x[11],la=x[12],fa=x[13],ha=x[14];x=x[15];var ba=G[0],ea=G[1],ka=G[2],O=G[3];return p[0]=ba*e+ea*
B+ka*R+O*la,p[1]=ba*m+ea*I+ka*W+O*fa,p[2]=ba*v+ea*L+ka*X+O*ha,p[3]=ba*D+ea*S+ka*V+O*x,ba=G[4],ea=G[5],ka=G[6],O=G[7],p[4]=ba*e+ea*B+ka*R+O*la,p[5]=ba*m+ea*I+ka*W+O*fa,p[6]=ba*v+ea*L+ka*X+O*ha,p[7]=ba*D+ea*S+ka*V+O*x,ba=G[8],ea=G[9],ka=G[10],O=G[11],p[8]=ba*e+ea*B+ka*R+O*la,p[9]=ba*m+ea*I+ka*W+O*fa,p[10]=ba*v+ea*L+ka*X+O*ha,p[11]=ba*D+ea*S+ka*V+O*x,ba=G[12],ea=G[13],ka=G[14],O=G[15],p[12]=ba*e+ea*B+ka*R+O*la,p[13]=ba*m+ea*I+ka*W+O*fa,p[14]=ba*v+ea*L+ka*X+O*ha,p[15]=ba*D+ea*S+ka*V+O*x,p}};N.mul=N.multiply;
N.translate=function(p,x,G){var e,m,v,D,B,I,L,S,R,W,X,V,la=G[0],fa=G[1];G=G[2];return x===p?(p[12]=x[0]*la+x[4]*fa+x[8]*G+x[12],p[13]=x[1]*la+x[5]*fa+x[9]*G+x[13],p[14]=x[2]*la+x[6]*fa+x[10]*G+x[14],p[15]=x[3]*la+x[7]*fa+x[11]*G+x[15]):(e=x[0],m=x[1],v=x[2],D=x[3],B=x[4],I=x[5],L=x[6],S=x[7],R=x[8],W=x[9],X=x[10],V=x[11],p[0]=e,p[1]=m,p[2]=v,p[3]=D,p[4]=B,p[5]=I,p[6]=L,p[7]=S,p[8]=R,p[9]=W,p[10]=X,p[11]=V,p[12]=e*la+B*fa+R*G+x[12],p[13]=m*la+I*fa+W*G+x[13],p[14]=v*la+L*fa+X*G+x[14],p[15]=D*la+S*fa+
V*G+x[15]),p};N.scale=function(p,x,G){var e=G[0],m=G[1];G=G[2];return p[0]=x[0]*e,p[1]=x[1]*e,p[2]=x[2]*e,p[3]=x[3]*e,p[4]=x[4]*m,p[5]=x[5]*m,p[6]=x[6]*m,p[7]=x[7]*m,p[8]=x[8]*G,p[9]=x[9]*G,p[10]=x[10]*G,p[11]=x[11]*G,p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15],p};N.rotate=function(p,x,G,e){var m,v,D,B,I,L,S,R,W,X,V,la,fa,ha,ba,ea,ka,O,Y,da,pa,ma,wa,Ca,ya=e[0],za=e[1];e=e[2];var ob=Math.sqrt(ya*ya+za*za+e*e);return Math.abs(ob)<k?null:(ob=1/ob,ya*=ob,za*=ob,e*=ob,m=Math.sin(G),v=Math.cos(G),D=
1-v,B=x[0],I=x[1],L=x[2],S=x[3],R=x[4],W=x[5],X=x[6],V=x[7],la=x[8],fa=x[9],ha=x[10],ba=x[11],ea=ya*ya*D+v,ka=za*ya*D+e*m,O=e*ya*D-za*m,Y=ya*za*D-e*m,da=za*za*D+v,pa=e*za*D+ya*m,ma=ya*e*D+za*m,wa=za*e*D-ya*m,Ca=e*e*D+v,p[0]=B*ea+R*ka+la*O,p[1]=I*ea+W*ka+fa*O,p[2]=L*ea+X*ka+ha*O,p[3]=S*ea+V*ka+ba*O,p[4]=B*Y+R*da+la*pa,p[5]=I*Y+W*da+fa*pa,p[6]=L*Y+X*da+ha*pa,p[7]=S*Y+V*da+ba*pa,p[8]=B*ma+R*wa+la*Ca,p[9]=I*ma+W*wa+fa*Ca,p[10]=L*ma+X*wa+ha*Ca,p[11]=S*ma+V*wa+ba*Ca,x!==p&&(p[12]=x[12],p[13]=x[13],p[14]=
x[14],p[15]=x[15]),p)};N.rotateX=function(p,x,G){var e=Math.sin(G);G=Math.cos(G);var m=x[4],v=x[5],D=x[6],B=x[7],I=x[8],L=x[9],S=x[10],R=x[11];return x!==p&&(p[0]=x[0],p[1]=x[1],p[2]=x[2],p[3]=x[3],p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15]),p[4]=m*G+I*e,p[5]=v*G+L*e,p[6]=D*G+S*e,p[7]=B*G+R*e,p[8]=I*G-m*e,p[9]=L*G-v*e,p[10]=S*G-D*e,p[11]=R*G-B*e,p};N.rotateY=function(p,x,G){var e=Math.sin(G);G=Math.cos(G);var m=x[0],v=x[1],D=x[2],B=x[3],I=x[8],L=x[9],S=x[10],R=x[11];return x!==p&&(p[4]=x[4],
p[5]=x[5],p[6]=x[6],p[7]=x[7],p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15]),p[0]=m*G-I*e,p[1]=v*G-L*e,p[2]=D*G-S*e,p[3]=B*G-R*e,p[8]=m*e+I*G,p[9]=v*e+L*G,p[10]=D*e+S*G,p[11]=B*e+R*G,p};N.rotateZ=function(p,x,G){var e=Math.sin(G);G=Math.cos(G);var m=x[0],v=x[1],D=x[2],B=x[3],I=x[4],L=x[5],S=x[6],R=x[7];return x!==p&&(p[8]=x[8],p[9]=x[9],p[10]=x[10],p[11]=x[11],p[12]=x[12],p[13]=x[13],p[14]=x[14],p[15]=x[15]),p[0]=m*G+I*e,p[1]=v*G+L*e,p[2]=D*G+S*e,p[3]=B*G+R*e,p[4]=I*G-m*e,p[5]=L*G-v*e,p[6]=S*G-
D*e,p[7]=R*G-B*e,p};N.fromRotationTranslation=function(p,x,G){var e=x[0],m=x[1],v=x[2],D=x[3],B=e+e,I=m+m,L=v+v;x=e*B;var S=e*I;e*=L;var R=m*I;m*=L;v*=L;B*=D;I*=D;D*=L;return p[0]=1-(R+v),p[1]=S+D,p[2]=e-I,p[3]=0,p[4]=S-D,p[5]=1-(x+v),p[6]=m+B,p[7]=0,p[8]=e+I,p[9]=m-B,p[10]=1-(x+R),p[11]=0,p[12]=G[0],p[13]=G[1],p[14]=G[2],p[15]=1,p};N.fromQuat=function(p,x){var G=x[0],e=x[1],m=x[2];x=x[3];var v=G+G,D=e+e,B=m+m;G*=v;var I=e*v;e*=D;var L=m*v,S=m*D;m*=B;v*=x;D*=x;x*=B;return p[0]=1-e-m,p[1]=I+x,p[2]=
L-D,p[3]=0,p[4]=I-x,p[5]=1-G-m,p[6]=S+v,p[7]=0,p[8]=L+D,p[9]=S-v,p[10]=1-G-e,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p};N.frustum=function(p,x,G,e,m,v,D){var B=1/(G-x),I=1/(m-e),L=1/(v-D);return p[0]=2*v*B,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=2*v*I,p[6]=0,p[7]=0,p[8]=(G+x)*B,p[9]=(m+e)*I,p[10]=(D+v)*L,p[11]=-1,p[12]=0,p[13]=0,p[14]=D*v*2*L,p[15]=0,p};N.perspective=function(p,x,G,e,m){x=1/Math.tan(x/2);var v=1/(e-m);return p[0]=x/G,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=x,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=(m+
e)*v,p[11]=-1,p[12]=0,p[13]=0,p[14]=2*m*e*v,p[15]=0,p};N.ortho=function(p,x,G,e,m,v,D){var B=1/(x-G),I=1/(e-m),L=1/(v-D);return p[0]=-2*B,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=-2*I,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=2*L,p[11]=0,p[12]=(x+G)*B,p[13]=(m+e)*I,p[14]=(D+v)*L,p[15]=1,p};N.lookAt=function(p,x,G,e){var m,v,D,B,I,L,S,R,W,X,V=x[0],la=x[1];x=x[2];var fa=e[0],ha=e[1];e=e[2];var ba=G[0],ea=G[1];G=G[2];return Math.abs(V-ba)<k&&Math.abs(la-ea)<k&&Math.abs(x-G)<k?N.identity(p):(S=V-ba,R=la-ea,W=x-G,X=1/
Math.sqrt(S*S+R*R+W*W),S*=X,R*=X,W*=X,m=ha*W-e*R,v=e*S-fa*W,D=fa*R-ha*S,X=Math.sqrt(m*m+v*v+D*D),X?(X=1/X,m*=X,v*=X,D*=X):(m=0,v=0,D=0),B=R*D-W*v,I=W*m-S*D,L=S*v-R*m,X=Math.sqrt(B*B+I*I+L*L),X?(X=1/X,B*=X,I*=X,L*=X):(B=0,I=0,L=0),p[0]=m,p[1]=B,p[2]=S,p[3]=0,p[4]=v,p[5]=I,p[6]=R,p[7]=0,p[8]=D,p[9]=L,p[10]=W,p[11]=0,p[12]=-(m*V+v*la+D*x),p[13]=-(B*V+I*la+L*x),p[14]=-(S*V+R*la+W*x),p[15]=1,p)};N.str=function(p){return"mat4("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+", "+p[4]+", "+p[5]+", "+p[6]+", "+p[7]+
", "+p[8]+", "+p[9]+", "+p[10]+", "+p[11]+", "+p[12]+", "+p[13]+", "+p[14]+", "+p[15]+")"};N.frob=function(p){return Math.sqrt(Math.pow(p[0],2)+Math.pow(p[1],2)+Math.pow(p[2],2)+Math.pow(p[3],2)+Math.pow(p[4],2)+Math.pow(p[5],2)+Math.pow(p[6],2)+Math.pow(p[6],2)+Math.pow(p[7],2)+Math.pow(p[8],2)+Math.pow(p[9],2)+Math.pow(p[10],2)+Math.pow(p[11],2)+Math.pow(p[12],2)+Math.pow(p[13],2)+Math.pow(p[14],2)+Math.pow(p[15],2))};"undefined"!=typeof l&&(l.mat4=N);var U={create:function(){var p=new u(4);return p[0]=
0,p[1]=0,p[2]=0,p[3]=1,p}};U.rotationTo=function(){var p=A.create(),x=A.fromValues(1,0,0),G=A.fromValues(0,1,0);return function(e,m,v){var D=A.dot(m,v);return-.999999>D?(A.cross(p,x,m),1E-6>A.length(p)&&A.cross(p,G,m),A.normalize(p,p),U.setAxisAngle(e,p,Math.PI),e):.999999<D?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(A.cross(p,m,v),e[0]=p[0],e[1]=p[1],e[2]=p[2],e[3]=1+D,U.normalize(e,e))}}();U.setAxes=function(){var p=J.create();return function(x,G,e,m){return p[0]=e[0],p[3]=e[1],p[6]=e[2],p[1]=m[0],p[4]=m[1],
p[7]=m[2],p[2]=-G[0],p[5]=-G[1],p[8]=-G[2],U.normalize(x,U.fromMat3(x,p))}}();U.clone=H.clone;U.fromValues=H.fromValues;U.copy=H.copy;U.set=H.set;U.identity=function(p){return p[0]=0,p[1]=0,p[2]=0,p[3]=1,p};U.setAxisAngle=function(p,x,G){G*=.5;var e=Math.sin(G);return p[0]=e*x[0],p[1]=e*x[1],p[2]=e*x[2],p[3]=Math.cos(G),p};U.add=H.add;U.multiply=function(p,x,G){var e=x[0],m=x[1],v=x[2];x=x[3];var D=G[0],B=G[1],I=G[2];G=G[3];return p[0]=e*G+x*D+m*I-v*B,p[1]=m*G+x*B+v*D-e*I,p[2]=v*G+x*I+e*B-m*D,p[3]=
x*G-e*D-m*B-v*I,p};U.mul=U.multiply;U.scale=H.scale;U.rotateX=function(p,x,G){G*=.5;var e=x[0],m=x[1],v=x[2];x=x[3];var D=Math.sin(G);G=Math.cos(G);return p[0]=e*G+x*D,p[1]=m*G+v*D,p[2]=v*G-m*D,p[3]=x*G-e*D,p};U.rotateY=function(p,x,G){G*=.5;var e=x[0],m=x[1],v=x[2];x=x[3];var D=Math.sin(G);G=Math.cos(G);return p[0]=e*G-v*D,p[1]=m*G+x*D,p[2]=v*G+e*D,p[3]=x*G-m*D,p};U.rotateZ=function(p,x,G){G*=.5;var e=x[0],m=x[1],v=x[2];x=x[3];var D=Math.sin(G);G=Math.cos(G);return p[0]=e*G+m*D,p[1]=m*G-e*D,p[2]=
v*G+x*D,p[3]=x*G-v*D,p};U.calculateW=function(p,x){var G=x[0],e=x[1];x=x[2];return p[0]=G,p[1]=e,p[2]=x,p[3]=-Math.sqrt(Math.abs(1-G*G-e*e-x*x)),p};U.dot=H.dot;U.lerp=H.lerp;U.slerp=function(p,x,G,e){var m,v,D,B,I,L=x[0],S=x[1],R=x[2];x=x[3];var W=G[0],X=G[1],V=G[2];G=G[3];return v=L*W+S*X+R*V+x*G,0>v&&(v=-v,W=-W,X=-X,V=-V,G=-G),1E-6<1-v?(m=Math.acos(v),D=Math.sin(m),B=Math.sin((1-e)*m)/D,I=Math.sin(e*m)/D):(B=1-e,I=e),p[0]=B*L+I*W,p[1]=B*S+I*X,p[2]=B*R+I*V,p[3]=B*x+I*G,p};U.invert=function(p,x){var G=
x[0],e=x[1],m=x[2];x=x[3];var v=G*G+e*e+m*m+x*x;v=v?1/v:0;return p[0]=-G*v,p[1]=-e*v,p[2]=-m*v,p[3]=x*v,p};U.conjugate=function(p,x){return p[0]=-x[0],p[1]=-x[1],p[2]=-x[2],p[3]=x[3],p};U.length=H.length;U.len=U.length;U.squaredLength=H.squaredLength;U.sqrLen=U.squaredLength;U.normalize=H.normalize;U.fromMat3=function(p,x){var G=x[0]+x[4]+x[8];if(0<G)G=Math.sqrt(G+1),p[3]=.5*G,G=.5/G,p[0]=(x[7]-x[5])*G,p[1]=(x[2]-x[6])*G,p[2]=(x[3]-x[1])*G;else{var e=0;x[4]>x[0]&&(e=1);x[8]>x[3*e+e]&&(e=2);var m=
(e+1)%3,v=(e+2)%3;G=Math.sqrt(x[3*e+e]-x[3*m+m]-x[3*v+v]+1);p[e]=.5*G;G=.5/G;p[3]=(x[3*v+m]-x[3*m+v])*G;p[m]=(x[3*m+e]+x[3*e+m])*G;p[v]=(x[3*v+e]+x[3*e+v])*G}return p};U.str=function(p){return"quat("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+")"};"undefined"!=typeof l&&(l.quat=U)})(q)}(this)},{}],24:[function(c,h,n){(function(){var f=this,q=f._,l={},k=Array.prototype,u=Object.prototype,r=k.push,z=k.slice,C=k.concat,E=u.toString,A=u.hasOwnProperty,H=k.forEach,J=k.map,N=k.reduce,U=k.reduceRight,p=k.filter,
x=k.every,G=k.some,e=k.indexOf,m=k.lastIndexOf;u=Array.isArray;var v=Object.keys,D=Function.prototype.bind,B=function(O){return O instanceof B?O:this instanceof B?void(this._wrapped=O):new B(O)};"undefined"!=typeof n?("undefined"!=typeof h&&h.exports&&(n=h.exports=B),n._=B):f._=B;B.VERSION="1.4.4";var I=B.each=B.forEach=function(O,Y,da){if(null!=O)if(H&&O.forEach===H)O.forEach(Y,da);else if(O.length===+O.length)for(var pa=0,ma=O.length;ma>pa&&Y.call(da,O[pa],pa,O)!==l;pa++);else for(pa in O)if(B.has(O,
pa)&&Y.call(da,O[pa],pa,O)===l)break};B.map=B.collect=function(O,Y,da){var pa=[];return null==O?pa:J&&O.map===J?O.map(Y,da):(I(O,function(ma,wa,Ca){pa[pa.length]=Y.call(da,ma,wa,Ca)}),pa)};B.reduce=B.foldl=B.inject=function(O,Y,da,pa){var ma=2<arguments.length;if(null==O&&(O=[]),N&&O.reduce===N)return pa&&(Y=B.bind(Y,pa)),ma?O.reduce(Y,da):O.reduce(Y);if(I(O,function(wa,Ca,ya){ma?da=Y.call(pa,da,wa,Ca,ya):(da=wa,ma=!0)}),!ma)throw new TypeError("Reduce of empty array with no initial value");return da};
B.reduceRight=B.foldr=function(O,Y,da,pa){var ma=2<arguments.length;if(null==O&&(O=[]),U&&O.reduceRight===U)return pa&&(Y=B.bind(Y,pa)),ma?O.reduceRight(Y,da):O.reduceRight(Y);var wa=O.length;if(wa!==+wa){var Ca=B.keys(O);wa=Ca.length}if(I(O,function(ya,za,ob){za=Ca?Ca[--wa]:--wa;ma?da=Y.call(pa,da,O[za],za,ob):(da=O[za],ma=!0)}),!ma)throw new TypeError("Reduce of empty array with no initial value");return da};B.find=B.detect=function(O,Y,da){var pa;return L(O,function(ma,wa,Ca){return Y.call(da,
ma,wa,Ca)?(pa=ma,!0):void 0}),pa};B.filter=B.select=function(O,Y,da){var pa=[];return null==O?pa:p&&O.filter===p?O.filter(Y,da):(I(O,function(ma,wa,Ca){Y.call(da,ma,wa,Ca)&&(pa[pa.length]=ma)}),pa)};B.reject=function(O,Y,da){return B.filter(O,function(pa,ma,wa){return!Y.call(da,pa,ma,wa)},da)};B.every=B.all=function(O,Y,da){Y||(Y=B.identity);var pa=!0;return null==O?pa:x&&O.every===x?O.every(Y,da):(I(O,function(ma,wa,Ca){return(pa=pa&&Y.call(da,ma,wa,Ca))?void 0:l}),!!pa)};var L=B.some=B.any=function(O,
Y,da){Y||(Y=B.identity);var pa=!1;return null==O?pa:G&&O.some===G?O.some(Y,da):(I(O,function(ma,wa,Ca){return pa||(pa=Y.call(da,ma,wa,Ca))?l:void 0}),!!pa)};B.contains=B.include=function(O,Y){return null==O?!1:e&&O.indexOf===e?-1!=O.indexOf(Y):L(O,function(da){return da===Y})};B.invoke=function(O,Y){var da=z.call(arguments,2),pa=B.isFunction(Y);return B.map(O,function(ma){return(pa?Y:ma[Y]).apply(ma,da)})};B.pluck=function(O,Y){return B.map(O,function(da){return da[Y]})};B.where=function(O,Y,da){return B.isEmpty(Y)?
da?null:[]:B[da?"find":"filter"](O,function(pa){for(var ma in Y)if(Y[ma]!==pa[ma])return!1;return!0})};B.findWhere=function(O,Y){return B.where(O,Y,!0)};B.max=function(O,Y,da){if(!Y&&B.isArray(O)&&O[0]===+O[0]&&65535>O.length)return Math.max.apply(Math,O);if(!Y&&B.isEmpty(O))return-1/0;var pa={computed:-1/0,value:-1/0};return I(O,function(ma,wa,Ca){wa=Y?Y.call(da,ma,wa,Ca):ma;wa>=pa.computed&&(pa={value:ma,computed:wa})}),pa.value};B.min=function(O,Y,da){if(!Y&&B.isArray(O)&&O[0]===+O[0]&&65535>O.length)return Math.min.apply(Math,
O);if(!Y&&B.isEmpty(O))return 1/0;var pa={computed:1/0,value:1/0};return I(O,function(ma,wa,Ca){wa=Y?Y.call(da,ma,wa,Ca):ma;wa<pa.computed&&(pa={value:ma,computed:wa})}),pa.value};B.shuffle=function(O){var Y,da=0,pa=[];return I(O,function(ma){Y=B.random(da++);pa[da-1]=pa[Y];pa[Y]=ma}),pa};var S=function(O){return B.isFunction(O)?O:function(Y){return Y[O]}};B.sortBy=function(O,Y,da){var pa=S(Y);return B.pluck(B.map(O,function(ma,wa,Ca){return{value:ma,index:wa,criteria:pa.call(da,ma,wa,Ca)}}).sort(function(ma,
wa){var Ca=ma.criteria,ya=wa.criteria;if(Ca!==ya){if(Ca>ya||void 0===Ca)return 1;if(ya>Ca||void 0===ya)return-1}return ma.index<wa.index?-1:1}),"value")};var R=function(O,Y,da,pa){var ma={},wa=S(Y||B.identity);return I(O,function(Ca,ya){ya=wa.call(da,Ca,ya,O);pa(ma,ya,Ca)}),ma};B.groupBy=function(O,Y,da){return R(O,Y,da,function(pa,ma,wa){(B.has(pa,ma)?pa[ma]:pa[ma]=[]).push(wa)})};B.countBy=function(O,Y,da){return R(O,Y,da,function(pa,ma){B.has(pa,ma)||(pa[ma]=0);pa[ma]++})};B.sortedIndex=function(O,
Y,da,pa){da=null==da?B.identity:S(da);Y=da.call(pa,Y);for(var ma=0,wa=O.length;wa>ma;){var Ca=ma+wa>>>1;da.call(pa,O[Ca])<Y?ma=Ca+1:wa=Ca}return ma};B.toArray=function(O){return O?B.isArray(O)?z.call(O):O.length===+O.length?B.map(O,B.identity):B.values(O):[]};B.size=function(O){return null==O?0:O.length===+O.length?O.length:B.keys(O).length};B.first=B.head=B.take=function(O,Y,da){return null==O?void 0:null==Y||da?O[0]:z.call(O,0,Y)};B.initial=function(O,Y,da){return z.call(O,0,O.length-(null==Y||
da?1:Y))};B.last=function(O,Y,da){return null==O?void 0:null==Y||da?O[O.length-1]:z.call(O,Math.max(O.length-Y,0))};B.rest=B.tail=B.drop=function(O,Y,da){return z.call(O,null==Y||da?1:Y)};B.compact=function(O){return B.filter(O,B.identity)};var W=function(O,Y,da){return I(O,function(pa){B.isArray(pa)?Y?r.apply(da,pa):W(pa,Y,da):da.push(pa)}),da};B.flatten=function(O,Y){return W(O,Y,[])};B.without=function(O){return B.difference(O,z.call(arguments,1))};B.uniq=B.unique=function(O,Y,da,pa){B.isFunction(Y)&&
(pa=da,da=Y,Y=!1);da=da?B.map(O,da,pa):O;var ma=[],wa=[];return I(da,function(Ca,ya){(Y?ya&&wa[wa.length-1]===Ca:B.contains(wa,Ca))||(wa.push(Ca),ma.push(O[ya]))}),ma};B.union=function(){return B.uniq(C.apply(k,arguments))};B.intersection=function(O){var Y=z.call(arguments,1);return B.filter(B.uniq(O),function(da){return B.every(Y,function(pa){return 0<=B.indexOf(pa,da)})})};B.difference=function(O){var Y=C.apply(k,z.call(arguments,1));return B.filter(O,function(da){return!B.contains(Y,da)})};B.zip=
function(){for(var O=z.call(arguments),Y=B.max(B.pluck(O,"length")),da=Array(Y),pa=0;Y>pa;pa++)da[pa]=B.pluck(O,""+pa);return da};B.object=function(O,Y){if(null==O)return{};for(var da={},pa=0,ma=O.length;ma>pa;pa++)Y?da[O[pa]]=Y[pa]:da[O[pa][0]]=O[pa][1];return da};B.indexOf=function(O,Y,da){if(null==O)return-1;var pa=0,ma=O.length;if(da){if("number"!=typeof da)return pa=B.sortedIndex(O,Y),O[pa]===Y?pa:-1;pa=0>da?Math.max(0,ma+da):da}if(e&&O.indexOf===e)return O.indexOf(Y,da);for(;ma>pa;pa++)if(O[pa]===
Y)return pa;return-1};B.lastIndexOf=function(O,Y,da){if(null==O)return-1;var pa=null!=da;if(m&&O.lastIndexOf===m)return pa?O.lastIndexOf(Y,da):O.lastIndexOf(Y);for(da=pa?da:O.length;da--;)if(O[da]===Y)return da;return-1};B.range=function(O,Y,da){1>=arguments.length&&(Y=O||0,O=0);da=arguments[2]||1;for(var pa=Math.max(Math.ceil((Y-O)/da),0),ma=0,wa=Array(pa);pa>ma;)wa[ma++]=O,O+=da;return wa};B.bind=function(O,Y){if(O.bind===D&&D)return D.apply(O,z.call(arguments,1));var da=z.call(arguments,2);return function(){return O.apply(Y,
da.concat(z.call(arguments)))}};B.partial=function(O){var Y=z.call(arguments,1);return function(){return O.apply(this,Y.concat(z.call(arguments)))}};B.bindAll=function(O){var Y=z.call(arguments,1);return 0===Y.length&&(Y=B.functions(O)),I(Y,function(da){O[da]=B.bind(O[da],O)}),O};B.memoize=function(O,Y){var da={};return Y||(Y=B.identity),function(){var pa=Y.apply(this,arguments);return B.has(da,pa)?da[pa]:da[pa]=O.apply(this,arguments)}};B.delay=function(O,Y){var da=z.call(arguments,2);return setTimeout(function(){return O.apply(null,
da)},Y)};B.defer=function(O){return B.delay.apply(B,[O,1].concat(z.call(arguments,1)))};B.throttle=function(O,Y){var da,pa,ma,wa,Ca=0,ya=function(){Ca=new Date;ma=null;wa=O.apply(da,pa)};return function(){var za=new Date,ob=Y-(za-Ca);return da=this,pa=arguments,0>=ob?(clearTimeout(ma),ma=null,Ca=za,wa=O.apply(da,pa)):ma||(ma=setTimeout(ya,ob)),wa}};B.debounce=function(O,Y,da){var pa,ma;return function(){var wa=this,Ca=arguments,ya=da&&!pa;return clearTimeout(pa),pa=setTimeout(function(){pa=null;da||
(ma=O.apply(wa,Ca))},Y),ya&&(ma=O.apply(wa,Ca)),ma}};B.once=function(O){var Y,da=!1;return function(){return da?Y:(da=!0,Y=O.apply(this,arguments),O=null,Y)}};B.wrap=function(O,Y){return function(){var da=[O];return r.apply(da,arguments),Y.apply(this,da)}};B.compose=function(){var O=arguments;return function(){for(var Y=arguments,da=O.length-1;0<=da;da--)Y=[O[da].apply(this,Y)];return Y[0]}};B.after=function(O,Y){return 0>=O?Y():function(){return 1>--O?Y.apply(this,arguments):void 0}};B.keys=v||function(O){if(O!==
Object(O))throw new TypeError("Invalid object");var Y=[],da;for(da in O)B.has(O,da)&&(Y[Y.length]=da);return Y};B.values=function(O){var Y=[],da;for(da in O)B.has(O,da)&&Y.push(O[da]);return Y};B.pairs=function(O){var Y=[],da;for(da in O)B.has(O,da)&&Y.push([da,O[da]]);return Y};B.invert=function(O){var Y={},da;for(da in O)B.has(O,da)&&(Y[O[da]]=da);return Y};B.functions=B.methods=function(O){var Y=[],da;for(da in O)B.isFunction(O[da])&&Y.push(da);return Y.sort()};B.extend=function(O){return I(z.call(arguments,
1),function(Y){if(Y)for(var da in Y)O[da]=Y[da]}),O};B.pick=function(O){var Y={},da=C.apply(k,z.call(arguments,1));return I(da,function(pa){pa in O&&(Y[pa]=O[pa])}),Y};B.omit=function(O){var Y={},da=C.apply(k,z.call(arguments,1)),pa;for(pa in O)B.contains(da,pa)||(Y[pa]=O[pa]);return Y};B.defaults=function(O){return I(z.call(arguments,1),function(Y){if(Y)for(var da in Y)null==O[da]&&(O[da]=Y[da])}),O};B.clone=function(O){return B.isObject(O)?B.isArray(O)?O.slice():B.extend({},O):O};B.tap=function(O,
Y){return Y(O),O};var X=function(O,Y,da,pa){if(O===Y)return 0!==O||1/O==1/Y;if(null==O||null==Y)return O===Y;O instanceof B&&(O=O._wrapped);Y instanceof B&&(Y=Y._wrapped);var ma=E.call(O);if(ma!=E.call(Y))return!1;switch(ma){case "[object String]":return O==String(Y);case "[object Number]":return O!=+O?Y!=+Y:0==O?1/O==1/Y:O==+Y;case "[object Date]":case "[object Boolean]":return+O==+Y;case "[object RegExp]":return O.source==Y.source&&O.global==Y.global&&O.multiline==Y.multiline&&O.ignoreCase==Y.ignoreCase}if("object"!=
typeof O||"object"!=typeof Y)return!1;for(var wa=da.length;wa--;)if(da[wa]==O)return pa[wa]==Y;da.push(O);pa.push(Y);wa=0;var Ca=!0;if("[object Array]"==ma){if(wa=O.length,Ca=wa==Y.length)for(;wa--&&(Ca=X(O[wa],Y[wa],da,pa)););}else{ma=O.constructor;var ya=Y.constructor;if(ma!==ya&&!(B.isFunction(ma)&&ma instanceof ma&&B.isFunction(ya)&&ya instanceof ya))return!1;for(var za in O)if(B.has(O,za)&&(wa++,!(Ca=B.has(Y,za)&&X(O[za],Y[za],da,pa))))break;if(Ca){for(za in Y)if(B.has(Y,za)&&!wa--)break;Ca=
!wa}}return da.pop(),pa.pop(),Ca};B.isEqual=function(O,Y){return X(O,Y,[],[])};B.isEmpty=function(O){if(null==O)return!0;if(B.isArray(O)||B.isString(O))return 0===O.length;for(var Y in O)if(B.has(O,Y))return!1;return!0};B.isElement=function(O){return!(!O||1!==O.nodeType)};B.isArray=u||function(O){return"[object Array]"==E.call(O)};B.isObject=function(O){return O===Object(O)};I("Arguments Function String Number Date RegExp".split(" "),function(O){B["is"+O]=function(Y){return E.call(Y)=="[object "+
O+"]"}});B.isArguments(arguments)||(B.isArguments=function(O){return!(!O||!B.has(O,"callee"))});"function"!=typeof/./&&(B.isFunction=function(O){return"function"==typeof O});B.isFinite=function(O){return isFinite(O)&&!isNaN(parseFloat(O))};B.isNaN=function(O){return B.isNumber(O)&&O!=+O};B.isBoolean=function(O){return!0===O||!1===O||"[object Boolean]"==E.call(O)};B.isNull=function(O){return null===O};B.isUndefined=function(O){return void 0===O};B.has=function(O,Y){return A.call(O,Y)};B.noConflict=
function(){return f._=q,this};B.identity=function(O){return O};B.times=function(O,Y,da){for(var pa=Array(O),ma=0;O>ma;ma++)pa[ma]=Y.call(da,ma);return pa};B.random=function(O,Y){return null==Y&&(Y=O,O=0),O+Math.floor(Math.random()*(Y-O+1))};var V={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};V.unescape=B.invert(V.escape);var la={escape:new RegExp("["+B.keys(V.escape).join("")+"]","g"),unescape:new RegExp("("+B.keys(V.unescape).join("|")+")","g")};B.each(["escape",
"unescape"],function(O){B[O]=function(Y){return null==Y?"":(""+Y).replace(la[O],function(da){return V[O][da]})}});B.result=function(O,Y){if(null==O)return null;Y=O[Y];return B.isFunction(Y)?Y.call(O):Y};B.mixin=function(O){I(B.functions(O),function(Y){var da=B[Y]=O[Y];B.prototype[Y]=function(){var pa=[this._wrapped];return r.apply(pa,arguments),ka.call(this,da.apply(B,pa))}})};var fa=0;B.uniqueId=function(O){var Y=++fa+"";return O?O+Y:Y};B.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,
escape:/<%-([\s\S]+?)%>/g};var ha=/(.)^/,ba={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},ea=/\\|'|\r|\n|\t|\u2028|\u2029/g;B.template=function(O,Y,da){da=B.defaults({},da,B.templateSettings);var pa=new RegExp([(da.escape||ha).source,(da.interpolate||ha).source,(da.evaluate||ha).source].join("|")+"|$","g"),ma=0,wa="__p+='";O.replace(pa,function(ya,za,ob,nb,Ab){return wa+=O.slice(ma,Ab).replace(ea,function(rb){return"\\"+ba[rb]}),za&&(wa+="'+\n((__t=("+za+"))==null?'':_.escape(__t))+\n'"),
ob&&(wa+="'+\n((__t=("+ob+"))==null?'':__t)+\n'"),nb&&(wa+="';\n"+nb+"\n__p+='"),ma=Ab+ya.length,ya});wa+="';\n";da.variable||(wa="with(obj||{}){\n"+wa+"}\n");wa="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+wa+"return __p;\n";try{var Ca=new Function(da.variable||"obj","_",wa)}catch(ya){throw ya.source=wa,ya;}if(Y)return Ca(Y,B);Y=function(ya){return Ca.call(this,ya,B)};return Y.source="function("+(da.variable||"obj")+"){\n"+wa+"}",Y};B.chain=function(O){return B(O).chain()};
var ka=function(O){return this._chain?B(O).chain():O};B.mixin(B);I("pop push reverse shift sort splice unshift".split(" "),function(O){var Y=k[O];B.prototype[O]=function(){var da=this._wrapped;return Y.apply(da,arguments),"shift"!=O&&"splice"!=O||0!==da.length||delete da[0],ka.call(this,da)}});I(["concat","join","slice"],function(O){var Y=k[O];B.prototype[O]=function(){return ka.call(this,Y.apply(this._wrapped,arguments))}});B.extend(B.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},
{}],25:[function(c){"undefined"!=typeof window&&"function"!=typeof window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(h){setTimeout(h,1E3/60)});Leap=c("../lib/index")},{"../lib/index":11}]},{},[25]);
var Stats=function(){function c(C){f.appendChild(C.dom);return C}function h(C){for(var E=0;E<f.children.length;E++)f.children[E].style.display=E===C?"block":"none";n=C}var n=0,f=document.createElement("div");f.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";f.addEventListener("click",function(C){C.preventDefault();h(++n%f.children.length)},!1);var q=(performance||Date).now(),l=q,k=0,u=c(new Stats.Panel("FPS","#fff","#222")),r=c(new Stats.Panel("MS","#fff","#222"));
if(self.performance&&self.performance.memory)var z=c(new Stats.Panel("MB","#fff","#222"));h(0);return{REVISION:17,dom:f,addPanel:c,showPanel:h,begin:function(){q=(performance||Date).now()},end:function(){k++;var C=(performance||Date).now();r.update(C-q,200);if(C>l+1E3&&(u.update(1E3*k/(C-l),100),l=C,k=0,z)){var E=performance.memory;z.update(E.usedJSHeapSize/1048576,E.jsHeapSizeLimit/1048576)}return C},update:function(){q=this.end()},domElement:f,setMode:h}};
Stats.Panel=function(c,h,n){var f=Infinity,q=0,l=Math.round,k=l(window.devicePixelRatio||1),u=80*k,r=48*k,z=3*k,C=2*k,E=3*k,A=15*k,H=74*k,J=30*k,N=document.createElement("canvas");N.width=u;N.height=r;N.style.cssText="width:80px;height:48px";var U=N.getContext("2d");U.font="bold "+9*k+"px Helvetica,Arial,sans-serif";U.textBaseline="top";U.fillStyle=n;U.fillRect(0,0,u,r);U.fillStyle=h;U.fillText(c,z,C);U.fillRect(E,A,H,J);U.fillStyle=n;U.globalAlpha=.9;U.fillRect(E,A,H,J);return{dom:N,update:function(p,
x){f=Math.min(f,p);q=Math.max(q,p);U.fillStyle=n;U.globalAlpha=1;U.fillRect(0,0,u,A);U.fillStyle=h;U.fillText(l(p)+" "+c+" ("+l(f)+"-"+l(q)+")",z,C);U.drawImage(N,E+k,A,H-k,J,E,A,H-k,J);U.fillRect(E+H-k,A,k,J);U.fillStyle=n;U.globalAlpha=.9;U.fillRect(E+H-k,A,k,l((1-p/x)*J))}}};"object"===typeof module&&(module.exports=Stats);var SPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};
"function"==typeof define&&define.amd?define("spe",SPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=SPE);SPE.TypedArrayHelper=function(c,h,n,f){this.componentSize=n||1;this.size=h||1;this.TypedArrayConstructor=c||Float32Array;this.array=new c(h*this.componentSize);this.indexOffset=f||0};SPE.TypedArrayHelper.constructor=SPE.TypedArrayHelper;
SPE.TypedArrayHelper.prototype.setSize=function(c,h){var n=this.array.length;return h||(c*=this.componentSize),n>c?this.shrink(c):c>n?this.grow(c):void console.info("TypedArray is already of size:",c+".","Will not resize.")};SPE.TypedArrayHelper.prototype.shrink=function(c){return this.array=this.array.subarray(0,c),this.size=c,this};SPE.TypedArrayHelper.prototype.grow=function(c){var h=this.array,n=new this.TypedArrayConstructor(c);return n.set(h),this.array=n,this.size=c,this};
SPE.TypedArrayHelper.prototype.splice=function(c,h){c*=this.componentSize;h*=this.componentSize;for(var n=[],f=this.array,q=f.length,l=0;q>l;++l)(c>l||l>=h)&&n.push(f[l]);return this.setFromArray(0,n),this};SPE.TypedArrayHelper.prototype.setFromArray=function(c,h){var n=c+h.length;return n>this.array.length?this.grow(n):n<this.array.length&&this.shrink(n),this.array.set(h,this.indexOffset+c),this};SPE.TypedArrayHelper.prototype.setVec2=function(c,h){return this.setVec2Components(c,h.x,h.y)};
SPE.TypedArrayHelper.prototype.setVec2Components=function(c,h,n){var f=this.array;c=this.indexOffset+c*this.componentSize;return f[c]=h,f[c+1]=n,this};SPE.TypedArrayHelper.prototype.setVec3=function(c,h){return this.setVec3Components(c,h.x,h.y,h.z)};SPE.TypedArrayHelper.prototype.setVec3Components=function(c,h,n,f){var q=this.array;c=this.indexOffset+c*this.componentSize;return q[c]=h,q[c+1]=n,q[c+2]=f,this};
SPE.TypedArrayHelper.prototype.setVec4=function(c,h){return this.setVec4Components(c,h.x,h.y,h.z,h.w)};SPE.TypedArrayHelper.prototype.setVec4Components=function(c,h,n,f,q){var l=this.array;c=this.indexOffset+c*this.componentSize;return l[c]=h,l[c+1]=n,l[c+2]=f,l[c+3]=q,this};SPE.TypedArrayHelper.prototype.setMat3=function(c,h){return this.setFromArray(this.indexOffset+c*this.componentSize,h.elements)};
SPE.TypedArrayHelper.prototype.setMat4=function(c,h){return this.setFromArray(this.indexOffset+c*this.componentSize,h.elements)};SPE.TypedArrayHelper.prototype.setColor=function(c,h){return this.setVec3Components(c,h.r,h.g,h.b)};SPE.TypedArrayHelper.prototype.setNumber=function(c,h){return this.array[this.indexOffset+c*this.componentSize]=h,this};SPE.TypedArrayHelper.prototype.getValueAtIndex=function(c){return this.array[this.indexOffset+c]};
SPE.TypedArrayHelper.prototype.getComponentValueAtIndex=function(c){return this.array.subarray(this.indexOffset+c*this.componentSize)};SPE.ShaderAttribute=function(c,h,n){var f=SPE.ShaderAttribute.typeSizeMap;this.type="string"==typeof c&&f.hasOwnProperty(c)?c:"f";this.componentSize=f[this.type];this.arrayType=n||Float32Array;this.bufferAttribute=this.typedArray=null;this.dynamicBuffer=!!h;this.updateMax=this.updateMin=0};SPE.ShaderAttribute.constructor=SPE.ShaderAttribute;
SPE.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16};SPE.ShaderAttribute.prototype.setUpdateRange=function(c,h){this.updateMin=Math.min(c*this.componentSize,this.updateMin*this.componentSize);this.updateMax=Math.max(h*this.componentSize,this.updateMax*this.componentSize)};
SPE.ShaderAttribute.prototype.flagUpdate=function(){var c=this.bufferAttribute,h=c.updateRange;h.offset=this.updateMin;h.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length);c.needsUpdate=!0};SPE.ShaderAttribute.prototype.resetUpdateRange=function(){this.updateMax=this.updateMin=0};SPE.ShaderAttribute.prototype.resetDynamic=function(){this.bufferAttribute.dynamic=this.dynamicBuffer};
SPE.ShaderAttribute.prototype.splice=function(c,h){this.typedArray.splice(c,h);this.forceUpdateAll()};SPE.ShaderAttribute.prototype.forceUpdateAll=function(){this.bufferAttribute.array=this.typedArray.array;this.bufferAttribute.updateRange.offset=0;this.bufferAttribute.updateRange.count=-1;this.bufferAttribute.dynamic=!1;this.bufferAttribute.needsUpdate=!0};
SPE.ShaderAttribute.prototype._ensureTypedArray=function(c){null!==this.typedArray&&this.typedArray.size===c*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==c?this.typedArray.setSize(c):null===this.typedArray&&(this.typedArray=new SPE.TypedArrayHelper(this.arrayType,c,this.componentSize)))};
SPE.ShaderAttribute.prototype._createBufferAttribute=function(c){return this._ensureTypedArray(c),null!==this.bufferAttribute?(this.bufferAttribute.array=this.typedArray.array,void(this.bufferAttribute.needsUpdate=!0)):(this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),void(this.bufferAttribute.dynamic=this.dynamicBuffer))};SPE.ShaderAttribute.prototype.getLength=function(){return null===this.typedArray?0:this.typedArray.array.length};
SPE.shaderChunks={defines:"#define PACKED_COLOR_SIZE 256.0\n#define PACKED_COLOR_DIVISOR 255.0",uniforms:"uniform float deltaTime;\nuniform float runTime;\nuniform sampler2D texture;\nuniform vec4 textureAnimation;\nuniform float scale;",attributes:"attribute vec4 acceleration;\nattribute vec3 velocity;\nattribute vec4 rotation;\nattribute vec3 rotationCenter;\nattribute vec4 params;\nattribute vec4 size;\nattribute vec4 angle;\nattribute vec4 color;\nattribute vec4 opacity;",varyings:"varying vec4 vColor;\n#ifdef SHOULD_ROTATE_TEXTURE\n    varying float vAngle;\n#endif\n#ifdef SHOULD_CALCULATE_SPRITE\n    varying vec4 vSpriteSheet;\n#endif",
branchAvoidanceFunctions:"float when_gt(float x, float y) {\n    return max(sign(x - y), 0.0);\n}\nfloat when_lt(float x, float y) {\n    return min( max(1.0 - sign(x - y), 0.0), 1.0 );\n}\nfloat when_eq( float x, float y ) {\n    return 1.0 - abs( sign( x - y ) );\n}\nfloat when_ge(float x, float y) {\n  return 1.0 - when_lt(x, y);\n}\nfloat when_le(float x, float y) {\n  return 1.0 - when_gt(x, y);\n}\nfloat and(float a, float b) {\n    return a * b;\n}\nfloat or(float a, float b) {\n    return min(a + b, 1.0);\n}",
unpackColor:"vec3 unpackColor( in float hex ) {\n   vec3 c = vec3( 0.0 );\n   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float b = mod( hex, PACKED_COLOR_SIZE );\n   c.r = r / PACKED_COLOR_DIVISOR;\n   c.g = g / PACKED_COLOR_DIVISOR;\n   c.b = b / PACKED_COLOR_DIVISOR;\n   return c;\n}",unpackRotationAxis:"vec3 unpackRotationAxis( in float hex ) {\n   vec3 c = vec3( 0.0 );\n   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float b = mod( hex, PACKED_COLOR_SIZE );\n   c.r = r / PACKED_COLOR_DIVISOR;\n   c.g = g / PACKED_COLOR_DIVISOR;\n   c.b = b / PACKED_COLOR_DIVISOR;\n   c *= vec3( 2.0 );\n   c -= vec3( 1.0 );\n   return c;\n}",
floatOverLifetime:"float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {\n    highp float value = 0.0;\n    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );\n    float fIndex = 0.0;\n    float shouldApplyValue = 0.0;\n    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );\n\n    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {\n       fIndex = float( i );\n       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );\n       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );\n    }\n\n    return value;\n}",
colorOverLifetime:"vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {\n    vec3 value = vec3( 0.0 );\n    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );\n    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );\n    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );\n    return value;\n}",
paramFetchingFunctions:"float getAlive() {\n   return params.x;\n}\nfloat getAge() {\n   return params.y;\n}\nfloat getMaxAge() {\n   return params.z;\n}\nfloat getWiggle() {\n   return params.w;\n}",forceFetchingFunctions:"vec4 getPosition( in float age ) {\n   return modelViewMatrix * vec4( position, 1.0 );\n}\nvec3 getVelocity( in float age ) {\n   return velocity * age;\n}\nvec3 getAcceleration( in float age ) {\n   return acceleration.xyz * age;\n}",rotationFunctions:"#ifdef SHOULD_ROTATE_PARTICLES\n   mat4 getRotationMatrix( in vec3 axis, in float angle) {\n       axis = normalize(axis);\n       float s = sin(angle);\n       float c = cos(angle);\n       float oc = 1.0 - c;\n\n       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                   0.0,                                0.0,                                0.0,                                1.0);\n   }\n\n   vec3 getRotation( in vec3 pos, in float positionInTime ) {\n      if( rotation.y == 0.0 ) {\n           return pos;\n      }\n\n      vec3 axis = unpackRotationAxis( rotation.x );\n      vec3 center = rotationCenter;\n      vec3 translated;\n      mat4 rotationMatrix;\n      float angle = 0.0;\n      angle += when_eq( rotation.z, 0.0 ) * rotation.y;\n      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );\n      translated = rotationCenter - pos;\n      rotationMatrix = getRotationMatrix( axis, angle );\n      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );\n   }\n#endif",
rotateTexture:"    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );\n\n    #ifdef SHOULD_ROTATE_TEXTURE\n       float x = gl_PointCoord.x - 0.5;\n       float y = 1.0 - gl_PointCoord.y - 0.5;\n       float c = cos( -vAngle );\n       float s = sin( -vAngle );\n       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );\n    #endif\n\n    #ifdef SHOULD_CALCULATE_SPRITE\n        float framesX = vSpriteSheet.x;\n        float framesY = vSpriteSheet.y;\n        float columnNorm = vSpriteSheet.z;\n        float rowNorm = vSpriteSheet.w;\n        vUv.x = gl_PointCoord.x * framesX + columnNorm;\n        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);\n    #endif\n\n    vec4 rotatedTexture = texture2D( texture, vUv );"};
SPE.shaders={vertex:[SPE.shaderChunks.defines,SPE.shaderChunks.uniforms,SPE.shaderChunks.attributes,SPE.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,SPE.shaderChunks.branchAvoidanceFunctions,SPE.shaderChunks.unpackColor,SPE.shaderChunks.unpackRotationAxis,SPE.shaderChunks.floatOverLifetime,SPE.shaderChunks.colorOverLifetime,SPE.shaderChunks.paramFetchingFunctions,SPE.shaderChunks.forceFetchingFunctions,SPE.shaderChunks.rotationFunctions,"void main() {\n    highp float age = getAge();\n    highp float alive = getAlive();\n    highp float maxAge = getMaxAge();\n    highp float positionInTime = (age / maxAge);\n    highp float isAlive = when_gt( alive, 0.0 );\n    #ifdef SHOULD_WIGGLE_PARTICLES\n        float wiggleAmount = positionInTime * getWiggle();\n        float wiggleSin = isAlive * sin( wiggleAmount );\n        float wiggleCos = isAlive * cos( wiggleAmount );\n    #endif\n    vec3 vel = getVelocity( age );\n    vec3 accel = getAcceleration( age );\n    vec3 force = vec3( 0.0 );\n    vec3 pos = vec3( position );\n    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;\n    force += vel;\n    force *= drag;\n    force += accel * age;\n    pos += force;\n    #ifdef SHOULD_WIGGLE_PARTICLES\n        pos.x += wiggleSin;\n        pos.y += wiggleCos;\n        pos.z += wiggleSin;\n    #endif\n    #ifdef SHOULD_ROTATE_PARTICLES\n        pos = getRotation( pos, positionInTime );\n    #endif\n    vec4 mvPos = modelViewMatrix * vec4( pos, 1.0 );\n    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;\n    #ifdef HAS_PERSPECTIVE\n        float perspective = scale / length( mvPos.xyz );\n    #else\n        float perspective = 1.0;\n    #endif\n    float pointSizePerspective = pointSize * perspective;\n    #ifdef COLORIZE\n       vec3 c = isAlive * getColorOverLifetime(\n           positionInTime,\n           unpackColor( color.x ),\n           unpackColor( color.y ),\n           unpackColor( color.z ),\n           unpackColor( color.w )\n       );\n    #else\n       vec3 c = vec3(1.0);\n    #endif\n    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );\n    vColor = vec4( c, o );\n    #ifdef SHOULD_ROTATE_TEXTURE\n        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );\n    #endif\n    #ifdef SHOULD_CALCULATE_SPRITE\n        float framesX = textureAnimation.x;\n        float framesY = textureAnimation.y;\n        float loopCount = textureAnimation.w;\n        float totalFrames = textureAnimation.z;\n        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );\n        float column = floor(mod( frameNumber, framesX ));\n        float row = floor( (frameNumber - column) / framesX );\n        float columnNorm = column / framesX;\n        float rowNorm = row / framesY;\n        vSpriteSheet.x = 1.0 / framesX;\n        vSpriteSheet.y = 1.0 / framesY;\n        vSpriteSheet.z = columnNorm;\n        vSpriteSheet.w = rowNorm;\n    #endif\n    gl_PointSize = pointSizePerspective;\n    gl_Position = projectionMatrix * mvPos;",
THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragment:[SPE.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,SPE.shaderChunks.varyings,SPE.shaderChunks.branchAvoidanceFunctions,"void main() {\n    vec3 outgoingLight = vColor.xyz;\n    \n    #ifdef ALPHATEST\n       if ( vColor.w < float(ALPHATEST) ) discard;\n    #endif",SPE.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;",
THREE.ShaderChunk.fog_fragment,"    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );\n}"].join("\n")};
SPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(c,h,n){return typeof c===h?c:n},ensureArrayTypedArg:function(c,h,n){if(Array.isArray(c)){for(var f=c.length-1;0<=f;--f)if(typeof c[f]!==h)return n;return c}return this.ensureTypedArg(c,h,n)},ensureInstanceOf:function(c,h,n){return void 0!==h&&c instanceof h?c:n},ensureArrayInstanceOf:function(c,h,n){if(Array.isArray(c)){for(var f=c.length-1;0<=f;--f)if(void 0!==h&&0==c[f]instanceof h)return n;
return c}return this.ensureInstanceOf(c,h,n)},ensureValueOverLifetimeCompliance:function(c,h,n){h=h||3;n=n||3;!1===Array.isArray(c._value)&&(c._value=[c._value]);!1===Array.isArray(c._spread)&&(c._spread=[c._spread]);var f=this.clamp(c._value.length,h,n);h=this.clamp(c._spread.length,h,n);f=Math.max(f,h);c._value.length!==f&&(c._value=this.interpolateArray(c._value,f));c._spread.length!==f&&(c._spread=this.interpolateArray(c._spread,f))},interpolateArray:function(c,h){for(var n=c.length,f=["function"==
typeof c[0].clone?c[0].clone():c[0]],q=(n-1)/(h-1),l=1;h-1>l;++l){var k=l*q,u=Math.floor(k);f[l]=this.lerpTypeAgnostic(c[u],c[Math.ceil(k)],k-u)}return f.push("function"==typeof c[n-1].clone?c[n-1].clone():c[n-1]),f},clamp:function(c,h,n){return Math.max(h,Math.min(c,n))},zeroToEpsilon:function(c,h){var n=c;return n=h?1E-4*Math.random():1E-5,0>c&&-1E-5<c&&(n=-n),n},lerpTypeAgnostic:function(c,h,n){var f,q=this.types;return typeof c===q.NUMBER&&typeof h===q.NUMBER?c+(h-c)*n:c instanceof THREE.Vector2&&
h instanceof THREE.Vector2?(f=c.clone(),f.x=this.lerp(c.x,h.x,n),f.y=this.lerp(c.y,h.y,n),f):c instanceof THREE.Vector3&&h instanceof THREE.Vector3?(f=c.clone(),f.x=this.lerp(c.x,h.x,n),f.y=this.lerp(c.y,h.y,n),f.z=this.lerp(c.z,h.z,n),f):c instanceof THREE.Vector4&&h instanceof THREE.Vector4?(f=c.clone(),f.x=this.lerp(c.x,h.x,n),f.y=this.lerp(c.y,h.y,n),f.z=this.lerp(c.z,h.z,n),f.w=this.lerp(c.w,h.w,n),f):c instanceof THREE.Color&&h instanceof THREE.Color?(f=c.clone(),f.r=this.lerp(c.r,h.r,n),f.g=
this.lerp(c.g,h.g,n),f.b=this.lerp(c.b,h.b,n),f):void console.warn("Invalid argument types, or argument types do not match:",c,h)},lerp:function(c,h,n){return c+(h-c)*n},roundToNearestMultiple:function(c,h){var n=0;return 0===h?c:(n=Math.abs(c)%h,0===n?c:0>c?-(Math.abs(c)-n):c+h-n)},arrayValuesAreEqual:function(c){for(var h=0;h<c.length-1;++h)if(c[h]!==c[h+1])return!1;return!0},randomFloat:function(c,h){return c+h*(Math.random()-.5)},randomVector3:function(c,h,n,f,q){var l=n.x+(Math.random()*f.x-
.5*f.x),k=n.y+(Math.random()*f.y-.5*f.y);n=n.z+(Math.random()*f.z-.5*f.z);q&&(l=.5*-q.x+this.roundToNearestMultiple(l,q.x),k=.5*-q.y+this.roundToNearestMultiple(k,q.y),n=.5*-q.z+this.roundToNearestMultiple(n,q.z));c.typedArray.setVec3Components(h,l,k,n)},randomColor:function(c,h,n,f){var q=n.r+Math.random()*f.x,l=n.g+Math.random()*f.y;n=n.b+Math.random()*f.z;q=this.clamp(q,0,1);l=this.clamp(l,0,1);n=this.clamp(n,0,1);c.typedArray.setVec3Components(h,q,l,n)},randomColorAsHex:function(){var c=new THREE.Color;
return function(h,n,f,q){for(var l=f.length,k=[],u=0;l>u;++u){var r=q[u];c.copy(f[u]);c.r+=Math.random()*r.x-.5*r.x;c.g+=Math.random()*r.y-.5*r.y;c.b+=Math.random()*r.z-.5*r.z;c.r=this.clamp(c.r,0,1);c.g=this.clamp(c.g,0,1);c.b=this.clamp(c.b,0,1);k.push(c.getHex())}h.typedArray.setVec4Components(n,k[0],k[1],k[2],k[3])}}(),randomVector3OnSphere:function(c,h,n,f,q,l,k,u){u=2*Math.random()-1;var r=6.2832*Math.random(),z=Math.sqrt(1-u*u);f=this.randomFloat(f,q);k&&(f=Math.round(f/k)*k);k=z*Math.cos(r)*
f;r=z*Math.sin(r)*f;k*=l.x;r*=l.y;l=u*f*l.z;k+=n.x;r+=n.y;l+=n.z;c.typedArray.setVec3Components(h,k,r,l)},seededRandom:function(c){c=1E4*Math.sin(c);return c-(0|c)},randomVector3OnDisc:function(c,h,n,f,q,l,k){var u=6.2832*Math.random();f=Math.abs(this.randomFloat(f,q));k&&(f=Math.round(f/k)*k);k=Math.cos(u)*f;u=Math.sin(u)*f;k*=l.x;u*=l.y;k+=n.x;u+=n.y;n=0+n.z;c.typedArray.setVec3Components(h,k,u,n)},randomDirectionVector3OnSphere:function(){var c=new THREE.Vector3;return function(h,n,f,q,l,k,u,r){c.copy(k);
c.x-=f;c.y-=q;c.z-=l;c.normalize().multiplyScalar(-this.randomFloat(u,r));h.typedArray.setVec3Components(n,c.x,c.y,c.z)}}(),randomDirectionVector3OnDisc:function(){var c=new THREE.Vector3;return function(h,n,f,q,l,k,u,r){c.copy(k);c.x-=f;c.y-=q;c.z-=l;c.normalize().multiplyScalar(-this.randomFloat(u,r));h.typedArray.setVec3Components(n,c.x,c.y,0)}}(),getPackedRotationAxis:function(){var c=new THREE.Vector3,h=new THREE.Vector3,n=new THREE.Color,f=new THREE.Vector3(1,1,1);return function(q,l){return c.copy(q).normalize(),
h.copy(l).normalize(),c.x+=.5*-l.x+Math.random()*l.x,c.y+=.5*-l.y+Math.random()*l.y,c.z+=.5*-l.z+Math.random()*l.z,c.normalize().add(f).multiplyScalar(.5),n.setRGB(c.x,c.y,c.z),n.getHex()}}()};
SPE.Group=function(c){var h=SPE.utils,n=h.types;c=h.ensureTypedArg(c,n.OBJECT,{});c.texture=h.ensureTypedArg(c.texture,n.OBJECT,{});this.uuid=THREE.Math.generateUUID();this.fixedTimeStep=h.ensureTypedArg(c.fixedTimeStep,n.NUMBER,.016);this.texture=h.ensureInstanceOf(c.texture.value,THREE.Texture,null);this.textureFrames=h.ensureInstanceOf(c.texture.frames,THREE.Vector2,new THREE.Vector2(1,1));this.textureFrameCount=h.ensureTypedArg(c.texture.frameCount,n.NUMBER,this.textureFrames.x*this.textureFrames.y);
this.textureLoop=h.ensureTypedArg(c.texture.loop,n.NUMBER,1);this.textureFrames.max(new THREE.Vector2(1,1));this.hasPerspective=h.ensureTypedArg(c.hasPerspective,n.BOOLEAN,!0);this.colorize=h.ensureTypedArg(c.colorize,n.BOOLEAN,!0);this.maxParticleCount=h.ensureTypedArg(c.maxParticleCount,n.NUMBER,null);this.blending=h.ensureTypedArg(c.blending,n.NUMBER,THREE.AdditiveBlending);this.transparent=h.ensureTypedArg(c.transparent,n.BOOLEAN,!0);this.alphaTest=parseFloat(h.ensureTypedArg(c.alphaTest,n.NUMBER,
0));this.depthWrite=h.ensureTypedArg(c.depthWrite,n.BOOLEAN,!1);this.depthTest=h.ensureTypedArg(c.depthTest,n.BOOLEAN,!0);this.fog=h.ensureTypedArg(c.fog,n.BOOLEAN,!0);this.scale=h.ensureTypedArg(c.scale,n.NUMBER,300);this.emitters=[];this.emitterIDs=[];this._pool=[];this._poolCreationSettings=null;this._createNewWhenPoolEmpty=0;this._attributesNeedDynamicReset=this._attributesNeedRefresh=!1;this.particleCount=0;this.uniforms={texture:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,
this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}};this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:SPE.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,
SHOULD_CALCULATE_SPRITE:1<this.textureFrames.x||1<this.textureFrames.y};this.attributes={position:new SPE.ShaderAttribute("v3",!0),acceleration:new SPE.ShaderAttribute("v4",!0),velocity:new SPE.ShaderAttribute("v3",!0),rotation:new SPE.ShaderAttribute("v4",!0),rotationCenter:new SPE.ShaderAttribute("v3",!0),params:new SPE.ShaderAttribute("v4",!0),size:new SPE.ShaderAttribute("v4",!0),angle:new SPE.ShaderAttribute("v4",!0),color:new SPE.ShaderAttribute("v4",!0),opacity:new SPE.ShaderAttribute("v4",
!0)};this.attributeKeys=Object.keys(this.attributes);this.attributeCount=this.attributeKeys.length;this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog});this.geometry=new THREE.BufferGeometry;this.mesh=new THREE.Points(this.geometry,this.material);null===this.maxParticleCount&&
console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")};SPE.Group.constructor=SPE.Group;
SPE.Group.prototype._updateDefines=function(){var c=this.emitters,h=c.length-1,n=this.defines;for(h;0<=h;--h){var f=c[h];n.SHOULD_CALCULATE_SPRITE||(n.SHOULD_ROTATE_TEXTURE=n.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,f.angle.value),Math.max.apply(null,f.angle.spread)));n.SHOULD_ROTATE_PARTICLES=n.SHOULD_ROTATE_PARTICLES||!!Math.max(f.rotation.angle,f.rotation.angleSpread);n.SHOULD_WIGGLE_PARTICLES=n.SHOULD_WIGGLE_PARTICLES||!!Math.max(f.wiggle.value,f.wiggle.spread)}this.material.needsUpdate=
!0};SPE.Group.prototype._applyAttributesToGeometry=function(){var c,h,n=this.attributes,f=this.geometry,q=f.attributes,l;for(l in n)n.hasOwnProperty(l)&&(c=n[l],h=q[l],h?h.array=c.typedArray.array:f.addAttribute(l,c.bufferAttribute),c.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)};
SPE.Group.prototype.addEmitter=function(c){if(0==c instanceof SPE.Emitter)return void console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",c);if(-1<this.emitterIDs.indexOf(c.uuid))return void console.error("Emitter already exists in this group. Will not add again.");if(null!==c.group)return void console.error("Emitter already belongs to another group. Will not add to requested group.");var h=this.attributes,n=this.particleCount,f=n+c.particleCount;this.particleCount=
f;null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount);c._calculatePPSValue(c.maxAge._value+c.maxAge._spread);c._setBufferUpdateRanges(this.attributeKeys);c._setAttributeOffset(n);c.group=this;c.attributes=this.attributes;for(var q in h)h.hasOwnProperty(q)&&h[q]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);
for(h=n;f>h;++h)c._assignPositionValue(h),c._assignForceValue(h,"velocity"),c._assignForceValue(h,"acceleration"),c._assignAbsLifetimeValue(h,"opacity"),c._assignAbsLifetimeValue(h,"size"),c._assignAngleValue(h),c._assignRotationValue(h),c._assignParamsValue(h),c._assignColorValue(h);return this._applyAttributesToGeometry(),this.emitters.push(c),this.emitterIDs.push(c.uuid),this._updateDefines(c),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this};
SPE.Group.prototype.removeEmitter=function(c){var h=this.emitterIDs.indexOf(c.uuid);if(0==c instanceof SPE.Emitter)return void console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",c);if(-1===h)return void console.error("Emitter does not exist in this group. Will not remove.");for(var n=c.attributeOffset,f=n+c.particleCount,q=this.attributes.params.typedArray,l=n;f>l;++l)q.array[4*l]=0,q.array[4*l+1]=0;this.emitters.splice(h,1);this.emitterIDs.splice(h,1);for(var k in this.attributes)this.attributes.hasOwnProperty(k)&&
this.attributes[k].splice(n,f);this.particleCount-=c.particleCount;c._onRemove();this._attributesNeedRefresh=!0};SPE.Group.prototype.getFromPool=function(){var c=this._pool,h=this._createNewWhenPoolEmpty;return c.length?c.pop():h?new SPE.Emitter(this._poolCreationSettings):null};SPE.Group.prototype.releaseIntoPool=function(c){return 0==c instanceof SPE.Emitter?void console.error("Argument is not instanceof SPE.Emitter:",c):(c.reset(),this._pool.unshift(c),this)};SPE.Group.prototype.getPool=function(){return this._pool};
SPE.Group.prototype.addPool=function(c,h,n){this._poolCreationSettings=h;this._createNewWhenPoolEmpty=!!n;for(var f=0;c>f;++f)n=Array.isArray(h)?new SPE.Emitter(h[f]):new SPE.Emitter(h),this.addEmitter(n),this.releaseIntoPool(n);return this};
SPE.Group.prototype._triggerSingleEmitter=function(c){var h=this.getFromPool(),n=this;return null===h?void console.log("SPE.Group pool ran out."):(c instanceof THREE.Vector3&&(h.position.value.copy(c),h.position.value=h.position.value),h.enable(),setTimeout(function(){h.disable();n.releaseIntoPool(h)},1E3*Math.max(h.duration,h.maxAge.value+h.maxAge.spread)),this)};
SPE.Group.prototype.triggerPoolEmitter=function(c,h){if("number"==typeof c&&1<c)for(var n=0;c>n;++n)this._triggerSingleEmitter(h);else this._triggerSingleEmitter(h);return this};SPE.Group.prototype._updateUniforms=function(c){this.uniforms.runTime.value+=c;this.uniforms.deltaTime.value=c};SPE.Group.prototype._resetBufferRanges=function(){var c=this.attributeKeys,h=this.attributeCount-1,n=this.attributes;for(h;0<=h;--h)n[c[h]].resetUpdateRange()};
SPE.Group.prototype._updateBuffers=function(c){var h=this.attributeKeys,n=this.attributeCount-1,f=this.attributes,q=c.bufferUpdateRanges;for(n;0<=n;--n){var l=h[n];c=q[l];l=f[l];l.setUpdateRange(c.min,c.max);l.flagUpdate()}};
SPE.Group.prototype.tick=function(c){var h=this.emitters,n=h.length,f=c||this.fixedTimeStep,q=this.attributeKeys,l=this.attributes;if(this._updateUniforms(f),this._resetBufferRanges(),0!==n||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(c=0;n>c;++c){var k=h[c];k.tick(f);this._updateBuffers(k)}if(!0===this._attributesNeedDynamicReset){for(c=this.attributeCount-1;0<=c;--c)l[q[c]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(c=
this.attributeCount-1;0<=c;--c)l[q[c]].forceUpdateAll();this._attributesNeedRefresh=!1;this._attributesNeedDynamicReset=!0}}};SPE.Group.prototype.dispose=function(){return this.geometry.dispose(),this.material.dispose(),this};
SPE.Emitter=function(c){var h=SPE.utils,n=h.types,f=SPE.valueOverLifetimeLength;c=h.ensureTypedArg(c,n.OBJECT,{});c.position=h.ensureTypedArg(c.position,n.OBJECT,{});c.velocity=h.ensureTypedArg(c.velocity,n.OBJECT,{});c.acceleration=h.ensureTypedArg(c.acceleration,n.OBJECT,{});c.radius=h.ensureTypedArg(c.radius,n.OBJECT,{});c.drag=h.ensureTypedArg(c.drag,n.OBJECT,{});c.rotation=h.ensureTypedArg(c.rotation,n.OBJECT,{});c.color=h.ensureTypedArg(c.color,n.OBJECT,{});c.opacity=h.ensureTypedArg(c.opacity,
n.OBJECT,{});c.size=h.ensureTypedArg(c.size,n.OBJECT,{});c.angle=h.ensureTypedArg(c.angle,n.OBJECT,{});c.wiggle=h.ensureTypedArg(c.wiggle,n.OBJECT,{});c.maxAge=h.ensureTypedArg(c.maxAge,n.OBJECT,{});c.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime.");this.uuid=THREE.Math.generateUUID();this.type=h.ensureTypedArg(c.type,n.NUMBER,SPE.distributions.BOX);this.position={_value:h.ensureInstanceOf(c.position.value,THREE.Vector3,
new THREE.Vector3),_spread:h.ensureInstanceOf(c.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:h.ensureInstanceOf(c.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:h.ensureTypedArg(c.position.distribution,n.NUMBER,this.type),_randomise:h.ensureTypedArg(c.position.randomise,n.BOOLEAN,!1),_radius:h.ensureTypedArg(c.position.radius,n.NUMBER,10),_radiusScale:h.ensureInstanceOf(c.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:h.ensureTypedArg(c.position.distributionClamp,
n.NUMBER,0)};this.velocity={_value:h.ensureInstanceOf(c.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:h.ensureInstanceOf(c.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:h.ensureTypedArg(c.velocity.distribution,n.NUMBER,this.type),_randomise:h.ensureTypedArg(c.position.randomise,n.BOOLEAN,!1)};this.acceleration={_value:h.ensureInstanceOf(c.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:h.ensureInstanceOf(c.acceleration.spread,THREE.Vector3,new THREE.Vector3),
_distribution:h.ensureTypedArg(c.acceleration.distribution,n.NUMBER,this.type),_randomise:h.ensureTypedArg(c.position.randomise,n.BOOLEAN,!1)};this.drag={_value:h.ensureTypedArg(c.drag.value,n.NUMBER,0),_spread:h.ensureTypedArg(c.drag.spread,n.NUMBER,0),_randomise:h.ensureTypedArg(c.position.randomise,n.BOOLEAN,!1)};this.wiggle={_value:h.ensureTypedArg(c.wiggle.value,n.NUMBER,0),_spread:h.ensureTypedArg(c.wiggle.spread,n.NUMBER,0)};this.rotation={_axis:h.ensureInstanceOf(c.rotation.axis,THREE.Vector3,
new THREE.Vector3(0,1,0)),_axisSpread:h.ensureInstanceOf(c.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:h.ensureTypedArg(c.rotation.angle,n.NUMBER,0),_angleSpread:h.ensureTypedArg(c.rotation.angleSpread,n.NUMBER,0),_static:h.ensureTypedArg(c.rotation["static"],n.BOOLEAN,!1),_center:h.ensureInstanceOf(c.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:h.ensureTypedArg(c.position.randomise,n.BOOLEAN,!1)};this.maxAge={_value:h.ensureTypedArg(c.maxAge.value,n.NUMBER,
2),_spread:h.ensureTypedArg(c.maxAge.spread,n.NUMBER,0)};this.color={_value:h.ensureArrayInstanceOf(c.color.value,THREE.Color,new THREE.Color),_spread:h.ensureArrayInstanceOf(c.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:h.ensureTypedArg(c.position.randomise,n.BOOLEAN,!1)};this.opacity={_value:h.ensureArrayTypedArg(c.opacity.value,n.NUMBER,1),_spread:h.ensureArrayTypedArg(c.opacity.spread,n.NUMBER,0),_randomise:h.ensureTypedArg(c.position.randomise,n.BOOLEAN,!1)};this.size={_value:h.ensureArrayTypedArg(c.size.value,
n.NUMBER,1),_spread:h.ensureArrayTypedArg(c.size.spread,n.NUMBER,0),_randomise:h.ensureTypedArg(c.position.randomise,n.BOOLEAN,!1)};this.angle={_value:h.ensureArrayTypedArg(c.angle.value,n.NUMBER,0),_spread:h.ensureArrayTypedArg(c.angle.spread,n.NUMBER,0),_randomise:h.ensureTypedArg(c.position.randomise,n.BOOLEAN,!1)};this.particleCount=h.ensureTypedArg(c.particleCount,n.NUMBER,100);this.duration=h.ensureTypedArg(c.duration,n.NUMBER,null);this.isStatic=h.ensureTypedArg(c.isStatic,n.BOOLEAN,!1);this.activeMultiplier=
h.ensureTypedArg(c.activeMultiplier,n.NUMBER,1);this.direction=h.ensureTypedArg(c.direction,n.NUMBER,1);this.alive=h.ensureTypedArg(c.alive,n.BOOLEAN,!0);this.activeParticleCount=this.age=this.attributeEnd=this.attributeOffset=this.activationIndex=this.particlesPerSecond=0;this.paramsArray=this.attributes=this.group=null;this.resetFlags={position:h.ensureTypedArg(c.position.randomise,n.BOOLEAN,!1)||h.ensureTypedArg(c.radius.randomise,n.BOOLEAN,!1),velocity:h.ensureTypedArg(c.velocity.randomise,n.BOOLEAN,
!1),acceleration:h.ensureTypedArg(c.acceleration.randomise,n.BOOLEAN,!1)||h.ensureTypedArg(c.drag.randomise,n.BOOLEAN,!1),rotation:h.ensureTypedArg(c.rotation.randomise,n.BOOLEAN,!1),rotationCenter:h.ensureTypedArg(c.rotation.randomise,n.BOOLEAN,!1),size:h.ensureTypedArg(c.size.randomise,n.BOOLEAN,!1),color:h.ensureTypedArg(c.color.randomise,n.BOOLEAN,!1),opacity:h.ensureTypedArg(c.opacity.randomise,n.BOOLEAN,!1),angle:h.ensureTypedArg(c.angle.randomise,n.BOOLEAN,!1)};this.updateFlags={};this.updateCounts=
{};this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"};for(var q in this.updateMap)this.updateMap.hasOwnProperty(q)&&(this.updateCounts[this.updateMap[q]]=0,this.updateFlags[this.updateMap[q]]=!1,this._createGetterSetters(this[q],q));this.bufferUpdateRanges={};this.attributeKeys=null;this.attributeCount=0;h.ensureValueOverLifetimeCompliance(this.color,
f,f);h.ensureValueOverLifetimeCompliance(this.opacity,f,f);h.ensureValueOverLifetimeCompliance(this.size,f,f);h.ensureValueOverLifetimeCompliance(this.angle,f,f)};SPE.Emitter.constructor=SPE.Emitter;
SPE.Emitter.prototype._createGetterSetters=function(c,h){var n=this,f;for(f in c)if(c.hasOwnProperty(f)){var q=f.replace("_","");Object.defineProperty(c,q,{get:function(l){return function(){return this[l]}}(f),set:function(l){return function(k){var u=n.updateMap[h],r=this[l],z=SPE.valueOverLifetimeLength;"_rotationCenter"===l?(n.updateFlags.rotationCenter=!0,n.updateCounts.rotationCenter=0):"_randomise"===l?n.resetFlags[u]=k:(n.updateFlags[u]=!0,n.updateCounts[u]=0);n.group._updateDefines();this[l]=
k;Array.isArray(r)&&SPE.utils.ensureValueOverLifetimeCompliance(n[h],z,z)}}(f)})}};SPE.Emitter.prototype._setBufferUpdateRanges=function(c){this.attributeKeys=c;this.attributeCount=c.length;for(var h=this.attributeCount-1;0<=h;--h)this.bufferUpdateRanges[c[h]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}};SPE.Emitter.prototype._calculatePPSValue=function(c){var h=this.particleCount;this.duration?this.particlesPerSecond=h/(c<this.duration?c:this.duration):this.particlesPerSecond=h/c};
SPE.Emitter.prototype._setAttributeOffset=function(c){this.activationIndex=this.attributeOffset=c;this.activationEnd=c+this.particleCount};
SPE.Emitter.prototype._assignValue=function(c,h){switch(c){case "position":this._assignPositionValue(h);break;case "velocity":case "acceleration":this._assignForceValue(h,c);break;case "size":case "opacity":this._assignAbsLifetimeValue(h,c);break;case "angle":this._assignAngleValue(h);break;case "params":this._assignParamsValue(h);break;case "rotation":this._assignRotationValue(h);break;case "color":this._assignColorValue(h)}};
SPE.Emitter.prototype._assignPositionValue=function(c){var h=SPE.distributions,n=SPE.utils,f=this.position,q=this.attributes.position,l=f._value,k=f._spread;switch(f._distribution){case h.BOX:n.randomVector3(q,c,l,k,f._spreadClamp);break;case h.SPHERE:n.randomVector3OnSphere(q,c,l,f._radius,f._spread.x,f._radiusScale,f._spreadClamp.x,f._distributionClamp||this.particleCount);break;case h.DISC:n.randomVector3OnDisc(q,c,l,f._radius,f._spread.x,f._radiusScale,f._spreadClamp.x)}};
SPE.Emitter.prototype._assignForceValue=function(c,h){var n=SPE.distributions;var f=SPE.utils,q=this[h];var l=q._value;var k=q._spread;switch(q._distribution){case n.BOX:f.randomVector3(this.attributes[h],c,l,k);break;case n.SPHERE:k=this.attributes.position.typedArray.array;var u=3*c;n=k[u];l=k[u+1];k=k[u+2];f.randomDirectionVector3OnSphere(this.attributes[h],c,n,l,k,this.position._value,q._value.x,q._spread.x);break;case n.DISC:k=this.attributes.position.typedArray.array,u=3*c,n=k[u],l=k[u+1],k=
k[u+2],f.randomDirectionVector3OnDisc(this.attributes[h],c,n,l,k,this.position._value,q._value.x,q._spread.x)}"acceleration"===h&&(h=f.clamp(f.randomFloat(this.drag._value,this.drag._spread),0,1),this.attributes.acceleration.typedArray.array[4*c+3]=h)};
SPE.Emitter.prototype._assignAbsLifetimeValue=function(c,h){var n,f=this.attributes[h].typedArray;h=this[h];var q=SPE.utils;q.arrayValuesAreEqual(h._value)&&q.arrayValuesAreEqual(h._spread)?(n=Math.abs(q.randomFloat(h._value[0],h._spread[0])),f.setVec4Components(c,n,n,n,n)):f.setVec4Components(c,Math.abs(q.randomFloat(h._value[0],h._spread[0])),Math.abs(q.randomFloat(h._value[1],h._spread[1])),Math.abs(q.randomFloat(h._value[2],h._spread[2])),Math.abs(q.randomFloat(h._value[3],h._spread[3])))};
SPE.Emitter.prototype._assignAngleValue=function(c){var h,n=this.attributes.angle.typedArray,f=this.angle,q=SPE.utils;q.arrayValuesAreEqual(f._value)&&q.arrayValuesAreEqual(f._spread)?(h=q.randomFloat(f._value[0],f._spread[0]),n.setVec4Components(c,h,h,h,h)):n.setVec4Components(c,q.randomFloat(f._value[0],f._spread[0]),q.randomFloat(f._value[1],f._spread[1]),q.randomFloat(f._value[2],f._spread[2]),q.randomFloat(f._value[3],f._spread[3]))};
SPE.Emitter.prototype._assignParamsValue=function(c){this.attributes.params.typedArray.setVec4Components(c,this.isStatic?1:0,0,Math.abs(SPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),SPE.utils.randomFloat(this.wiggle._value,this.wiggle._spread))};
SPE.Emitter.prototype._assignRotationValue=function(c){this.attributes.rotation.typedArray.setVec3Components(c,SPE.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),SPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1);this.attributes.rotationCenter.typedArray.setVec3(c,this.rotation._center)};SPE.Emitter.prototype._assignColorValue=function(c){SPE.utils.randomColorAsHex(this.attributes.color,c,this.color._value,this.color._spread)};
SPE.Emitter.prototype._resetParticle=function(c){for(var h,n,f=this.resetFlags,q=this.updateFlags,l=this.updateCounts,k=this.attributeKeys,u=this.attributeCount-1;0<=u;--u)h=k[u],n=q[h],!0!==f[h]&&!0!==n||(this._assignValue(h,c),this._updateAttributeUpdateRange(h,c),!0===n&&l[h]===this.particleCount?(q[h]=!1,l[h]=0):1==n&&++l[h])};SPE.Emitter.prototype._updateAttributeUpdateRange=function(c,h){c=this.bufferUpdateRanges[c];c.min=Math.min(h,c.min);c.max=Math.max(h,c.max)};
SPE.Emitter.prototype._resetBufferRanges=function(){var c=this.bufferUpdateRanges,h=this.bufferUpdateKeys,n=this.bufferUpdateCount-1;for(n;0<=n;--n){var f=h[n];c[f].min=Number.POSITIVE_INFINITY;c[f].max=Number.NEGATIVE_INFINITY}};SPE.Emitter.prototype._onRemove=function(){this.activeParticleCount=this.activationIndex=this.attributeOffset=this.particlesPerSecond=0;this.paramsArray=this.attributes=this.group=null;this.age=0};SPE.Emitter.prototype._decrementParticleCount=function(){--this.activeParticleCount};
SPE.Emitter.prototype._incrementParticleCount=function(){++this.activeParticleCount};SPE.Emitter.prototype._checkParticleAges=function(c,h,n,f){for(var q,l,k,u=h-1;u>=c;--u)h=4*u,k=n[h],0!==k&&(l=n[h+1],q=n[h+2],1===this.direction?(l+=f,l>=q&&(l=0,k=0,this._decrementParticleCount())):(l-=f,0>=l&&(l=q,k=0,this._decrementParticleCount())),n[h]=k,n[h+1]=l,this._updateAttributeUpdateRange("params",u))};
SPE.Emitter.prototype._activateParticles=function(c,h,n,f){for(var q,l,k=this.direction,u=c;h>u;++u)q=4*u,0!=n[q]&&1!==this.particleCount||(this._incrementParticleCount(),n[q]=1,this._resetParticle(u),l=f*(u-c),n[q+1]=-1===k?n[q+2]-l:l,this._updateAttributeUpdateRange("params",u))};
SPE.Emitter.prototype.tick=function(c){if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var h=this.attributeOffset,n=h+this.particleCount,f=this.paramsArray,q=this.particlesPerSecond*this.activeMultiplier*c,l=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(h,n,f,c),!1===this.alive)return void(this.age=0);if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);l=1===this.particleCount?l:0|
l;var k=Math.min(l+q,this.activationEnd),u=k-this.activationIndex|0;this._activateParticles(l,k,f,0<u?c/u:0);this.activationIndex+=q;this.activationIndex>n&&(this.activationIndex=h);this.age+=c}};SPE.Emitter.prototype.reset=function(c){if(this.age=0,this.alive=!1,!0===c){for(var h=this.attributeOffset,n=this.paramsArray,f=this.attributes.params.bufferAttribute,q=h+this.particleCount-1;q>=h;--q)c=4*q,n[c]=0,n[c+1]=0;f.updateRange.offset=0;f.updateRange.count=-1;f.needsUpdate=!0}return this};
SPE.Emitter.prototype.enable=function(){return this.alive=!0,this};SPE.Emitter.prototype.disable=function(){return this.alive=!1,this};SPE.Emitter.prototype.remove=function(){return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this};
var __extends=this&&this.__extends||function(c,h){function n(){this.constructor=c}for(var f in h)h.hasOwnProperty(f)&&(c[f]=h[f]);c.prototype=null===h?Object.create(h):(n.prototype=h.prototype,new n)},spine;
!function(c){var h=function(){function l(k,u,r){if(null==k)throw Error("name cannot be null.");if(null==u)throw Error("timelines cannot be null.");this.name=k;this.timelines=u;this.duration=r}return l.prototype.apply=function(k,u,r,z,C){if(null==k)throw Error("skeleton cannot be null.");z&&0!=this.duration&&(r%=this.duration,0<u&&(u%=this.duration));z=this.timelines;for(var E=0,A=z.length;A>E;E++)z[E].apply(k,u,r,C,1)},l.prototype.mix=function(k,u,r,z,C,E){if(null==k)throw Error("skeleton cannot be null.");
z&&0!=this.duration&&(r%=this.duration,0<u&&(u%=this.duration));z=this.timelines;for(var A=0,H=z.length;H>A;A++)z[A].apply(k,u,r,C,E)},l.binarySearch=function(k,u,r){void 0===r&&(r=1);var z=0,C=k.length/r-2;if(0==C)return r;for(var E=C>>>1;;){if(k[(E+1)*r]<=u?z=E+1:C=E,z==C)return(z+1)*r;E=z+C>>>1}},l.linearSearch=function(k,u,r){for(var z=0,C=k.length-r;C>=z;z+=r)if(k[z]>u)return z;return-1},l}();c.Animation=h;var n=function(){function l(k){if(0>=k)throw Error("frameCount must be > 0: "+k);this.curves=
c.Utils.newFloatArray((k-1)*l.BEZIER_SIZE)}return l.prototype.getFrameCount=function(){return this.curves.length/l.BEZIER_SIZE+1},l.prototype.setLinear=function(k){this.curves[k*l.BEZIER_SIZE]=l.LINEAR},l.prototype.setStepped=function(k){this.curves[k*l.BEZIER_SIZE]=l.STEPPED},l.prototype.getCurveType=function(k){k*=l.BEZIER_SIZE;if(k==this.curves.length)return l.LINEAR;k=this.curves[k];return k==l.LINEAR?l.LINEAR:k==l.STEPPED?l.STEPPED:l.BEZIER},l.prototype.setCurve=function(k,u,r,z,C){var E=.03*
(2*-u+z),A=.03*(2*-r+C);z=.006*(3*(u-z)+1);C=.006*(3*(r-C)+1);var H=2*E+z,J=2*A+C;u=.3*u+E+.16666667*z;r=.3*r+A+.16666667*C;k*=l.BEZIER_SIZE;A=this.curves;A[k++]=l.BEZIER;E=u;for(var N=r,U=k+l.BEZIER_SIZE-1;U>k;k+=2)A[k]=E,A[k+1]=N,u+=H,r+=J,H+=z,J+=C,E+=u,N+=r},l.prototype.getCurvePercent=function(k,u){u=c.MathUtils.clamp(u,0,1);var r=this.curves;k*=l.BEZIER_SIZE;var z=r[k];if(z==l.LINEAR)return u;if(z==l.STEPPED)return 0;k++;z=0;for(var C=k,E=k+l.BEZIER_SIZE-1;E>k;k+=2)if(z=r[k],z>=u){var A=E=void 0;
return k==C?(E=0,A=0):(E=r[k-2],A=r[k-1]),A+(r[k+1]-A)*(u-E)/(z-E)}r=r[k-1];return r+(1-r)*(u-z)/(1-z)},l.LINEAR=0,l.STEPPED=1,l.BEZIER=2,l.BEZIER_SIZE=19,l}();c.CurveTimeline=n;var f=function(l){function k(u){l.call(this,u);this.frames=c.Utils.newFloatArray(u<<1)}return __extends(k,l),k.prototype.setFrame=function(u,r,z){u<<=1;this.frames[u]=r;this.frames[u+k.ROTATION]=z},k.prototype.apply=function(u,r,z,C,E){r=this.frames;if(!(z<r[0])){u=u.bones[this.boneIndex];if(z>=r[r.length-k.ENTRIES]){for(z=
u.data.rotation+r[r.length+k.PREV_ROTATION]-u.rotation;180<z;)z-=360;for(;-180>z;)z+=360;return void(u.rotation+=z*E)}var A=h.binarySearch(r,z,k.ENTRIES);C=r[A+k.PREV_ROTATION];var H=r[A];z=this.getCurvePercent((A>>1)-1,1-(z-H)/(r[A+k.PREV_TIME]-H));for(r=r[A+k.ROTATION]-C;180<r;)r-=360;for(;-180>r;)r+=360;for(r=u.data.rotation+(C+r*z)-u.rotation;180<r;)r-=360;for(;-180>r;)r+=360;u.rotation+=r*E}},k.ENTRIES=2,k.PREV_TIME=-2,k.PREV_ROTATION=-1,k.ROTATION=1,k}(n);c.RotateTimeline=f;f=function(l){function k(u){l.call(this,
u);this.frames=c.Utils.newFloatArray(u*k.ENTRIES)}return __extends(k,l),k.prototype.setFrame=function(u,r,z,C){u*=k.ENTRIES;this.frames[u]=r;this.frames[u+k.X]=z;this.frames[u+k.Y]=C},k.prototype.apply=function(u,r,z,C,E){r=this.frames;if(!(z<r[0])){u=u.bones[this.boneIndex];if(z>=r[r.length-k.ENTRIES])return u.x+=(u.data.x+r[r.length+k.PREV_X]-u.x)*E,void(u.y+=(u.data.y+r[r.length+k.PREV_Y]-u.y)*E);C=h.binarySearch(r,z,k.ENTRIES);var A=r[C+k.PREV_X],H=r[C+k.PREV_Y],J=r[C];z=this.getCurvePercent(C/
k.ENTRIES-1,1-(z-J)/(r[C+k.PREV_TIME]-J));u.x+=(u.data.x+A+(r[C+k.X]-A)*z-u.x)*E;u.y+=(u.data.y+H+(r[C+k.Y]-H)*z-u.y)*E}},k.ENTRIES=3,k.PREV_TIME=-3,k.PREV_X=-2,k.PREV_Y=-1,k.X=1,k.Y=2,k}(n);c.TranslateTimeline=f;var q=function(l){function k(u){l.call(this,u)}return __extends(k,l),k.prototype.apply=function(u,r,z,C,E){r=this.frames;if(!(z<r[0])){u=u.bones[this.boneIndex];if(z>=r[r.length-k.ENTRIES])return u.scaleX+=(u.data.scaleX*r[r.length+k.PREV_X]-u.scaleX)*E,void(u.scaleY+=(u.data.scaleY*r[r.length+
k.PREV_Y]-u.scaleY)*E);C=h.binarySearch(r,z,k.ENTRIES);var A=r[C+k.PREV_X],H=r[C+k.PREV_Y],J=r[C];z=this.getCurvePercent(C/k.ENTRIES-1,1-(z-J)/(r[C+k.PREV_TIME]-J));u.scaleX+=(u.data.scaleX*(A+(r[C+k.X]-A)*z)-u.scaleX)*E;u.scaleY+=(u.data.scaleY*(H+(r[C+k.Y]-H)*z)-u.scaleY)*E}},k}(f);c.ScaleTimeline=q;f=function(l){function k(u){l.call(this,u)}return __extends(k,l),k.prototype.apply=function(u,r,z,C,E){r=this.frames;if(!(z<r[0])){u=u.bones[this.boneIndex];if(z>=r[r.length-k.ENTRIES])return u.shearX+=
(u.data.shearX+r[r.length+k.PREV_X]-u.shearX)*E,void(u.shearY+=(u.data.shearY+r[r.length+k.PREV_Y]-u.shearY)*E);C=h.binarySearch(r,z,k.ENTRIES);var A=r[C+k.PREV_X],H=r[C+k.PREV_Y],J=r[C];z=this.getCurvePercent(C/k.ENTRIES-1,1-(z-J)/(r[C+k.PREV_TIME]-J));u.shearX+=(u.data.shearX+(A+(r[C+k.X]-A)*z)-u.shearX)*E;u.shearY+=(u.data.shearY+(H+(r[C+k.Y]-H)*z)-u.shearY)*E}},k}(f);c.ShearTimeline=f;f=function(l){function k(u){l.call(this,u);this.frames=c.Utils.newFloatArray(u*k.ENTRIES)}return __extends(k,
l),k.prototype.setFrame=function(u,r,z,C,E,A){u*=k.ENTRIES;this.frames[u]=r;this.frames[u+k.R]=z;this.frames[u+k.G]=C;this.frames[u+k.B]=E;this.frames[u+k.A]=A},k.prototype.apply=function(u,r,z,C,E){var A=this.frames;if(!(z<A[0])){if(z>=A[A.length-k.ENTRIES]){z=A.length;r=A[z+k.PREV_R];C=A[z+k.PREV_G];var H=A[z+k.PREV_B];var J=A[z+k.PREV_A]}else{var N=h.binarySearch(A,z,k.ENTRIES);r=A[N+k.PREV_R];C=A[N+k.PREV_G];H=A[N+k.PREV_B];J=A[N+k.PREV_A];var U=A[N];z=this.getCurvePercent(N/k.ENTRIES-1,1-(z-
U)/(A[N+k.PREV_TIME]-U));r+=(A[N+k.R]-r)*z;C+=(A[N+k.G]-C)*z;H+=(A[N+k.B]-H)*z;J+=(A[N+k.A]-J)*z}u=u.slots[this.slotIndex].color;1>E?u.add((r-u.r)*E,(C-u.g)*E,(H-u.b)*E,(J-u.a)*E):u.set(r,C,H,J)}},k.ENTRIES=5,k.PREV_TIME=-5,k.PREV_R=-4,k.PREV_G=-3,k.PREV_B=-2,k.PREV_A=-1,k.R=1,k.G=2,k.B=3,k.A=4,k}(n);c.ColorTimeline=f;f=function(){function l(k){this.frames=c.Utils.newFloatArray(k);this.attachmentNames=Array(k)}return l.prototype.getFrameCount=function(){return this.frames.length},l.prototype.setFrame=
function(k,u,r){this.frames[k]=u;this.attachmentNames[k]=r},l.prototype.apply=function(k,u,r,z,C){u=this.frames;r<u[0]||(r=r>=u[u.length-1]?u.length-1:h.binarySearch(u,r,1)-1,r=this.attachmentNames[r],k.slots[this.slotIndex].setAttachment(null==r?null:k.getAttachment(this.slotIndex,r)))},l}();c.AttachmentTimeline=f;f=function(){function l(k){this.frames=c.Utils.newFloatArray(k);this.events=Array(k)}return l.prototype.getFrameCount=function(){return this.frames.length},l.prototype.setFrame=function(k,
u){this.frames[k]=u.time;this.events[k]=u},l.prototype.apply=function(k,u,r,z,C){if(null!=z){var E=this.frames,A=this.frames.length;if(u>r)this.apply(k,u,Number.MAX_VALUE,z,C),u=-1;else if(u>=E[A-1])return;if(!(r<E[0])){if(u<E[0])k=0;else for(k=h.binarySearch(E,u),u=E[k];0<k&&E[k-1]==u;)k--;for(;A>k&&r>=E[k];k++)z.push(this.events[k])}}},l}();c.EventTimeline=f;f=function(){function l(k){this.frames=c.Utils.newFloatArray(k);this.drawOrders=Array(k)}return l.prototype.getFrameCount=function(){return this.frames.length},
l.prototype.setFrame=function(k,u,r){this.frames[k]=u;this.drawOrders[k]=r},l.prototype.apply=function(k,u,r,z,C){u=this.frames;if(!(r<u[0]))if(u=r>=u[u.length-1]?u.length-1:h.binarySearch(u,r)-1,r=k.drawOrder,k=k.slots,u=this.drawOrders[u],null==u)c.Utils.arrayCopy(k,0,r,0,k.length);else for(z=0,C=u.length;C>z;z++)r[z]=k[u[z]]},l}();c.DrawOrderTimeline=f;f=function(l){function k(u){l.call(this,u);this.frames=c.Utils.newFloatArray(u);this.frameVertices=Array(u)}return __extends(k,l),k.prototype.setFrame=
function(u,r,z){this.frames[u]=r;this.frameVertices[u]=z},k.prototype.apply=function(u,r,z,C,E){r=u.slots[this.slotIndex];u=r.getAttachment();if(u instanceof c.VertexAttachment&&u.applyDeform(this.attachment)){var A=this.frames;if(!(z<A[0])){var H=this.frameVertices;u=H[0].length;r=r.attachmentVertices;r.length!=u&&(E=1);r=c.Utils.setArraySize(r,u);if(z>=A[A.length-1])if(C=H[A.length-1],1>E)for(z=0;u>z;z++)r[z]+=(C[z]-r[z])*E;else c.Utils.arrayCopy(C,0,r,0,u);else{var J=h.binarySearch(A,z);C=H[J-
1];H=H[J];var N=A[J];A=this.getCurvePercent(J-1,1-(z-N)/(A[J-1]-N));if(1>E)for(z=0;u>z;z++)J=C[z],r[z]+=(J+(H[z]-J)*A-r[z])*E;else for(z=0;u>z;z++)J=C[z],r[z]=J+(H[z]-J)*A}}}},k}(n);c.DeformTimeline=f;f=function(l){function k(u){l.call(this,u);this.frames=c.Utils.newFloatArray(u*k.ENTRIES)}return __extends(k,l),k.prototype.setFrame=function(u,r,z,C){u*=k.ENTRIES;this.frames[u]=r;this.frames[u+k.MIX]=z;this.frames[u+k.BEND_DIRECTION]=C},k.prototype.apply=function(u,r,z,C,E){r=this.frames;if(!(z<r[0])){u=
u.ikConstraints[this.ikConstraintIndex];if(z>=r[r.length-k.ENTRIES])return u.mix+=(r[r.length+k.PREV_MIX]-u.mix)*E,void(u.bendDirection=Math.floor(r[r.length+k.PREV_BEND_DIRECTION]));C=h.binarySearch(r,z,k.ENTRIES);var A=r[C+k.PREV_MIX],H=r[C];z=this.getCurvePercent(C/k.ENTRIES-1,1-(z-H)/(r[C+k.PREV_TIME]-H));u.mix+=(A+(r[C+k.MIX]-A)*z-u.mix)*E;u.bendDirection=Math.floor(r[C+k.PREV_BEND_DIRECTION])}},k.ENTRIES=3,k.PREV_TIME=-3,k.PREV_MIX=-2,k.PREV_BEND_DIRECTION=-1,k.MIX=1,k.BEND_DIRECTION=2,k}(n);
c.IkConstraintTimeline=f;f=function(l){function k(u){l.call(this,u);this.frames=c.Utils.newFloatArray(u*k.ENTRIES)}return __extends(k,l),k.prototype.setFrame=function(u,r,z,C,E,A){u*=k.ENTRIES;this.frames[u]=r;this.frames[u+k.ROTATE]=z;this.frames[u+k.TRANSLATE]=C;this.frames[u+k.SCALE]=E;this.frames[u+k.SHEAR]=A},k.prototype.apply=function(u,r,z,C,E){r=this.frames;if(!(z<r[0])){u=u.transformConstraints[this.transformConstraintIndex];if(z>=r[r.length-k.ENTRIES])return C=r.length,u.rotateMix+=(r[C+
k.PREV_ROTATE]-u.rotateMix)*E,u.translateMix+=(r[C+k.PREV_TRANSLATE]-u.translateMix)*E,u.scaleMix+=(r[C+k.PREV_SCALE]-u.scaleMix)*E,void(u.shearMix+=(r[C+k.PREV_SHEAR]-u.shearMix)*E);C=h.binarySearch(r,z,k.ENTRIES);var A=r[C];z=this.getCurvePercent(C/k.ENTRIES-1,1-(z-A)/(r[C+k.PREV_TIME]-A));A=r[C+k.PREV_ROTATE];var H=r[C+k.PREV_TRANSLATE],J=r[C+k.PREV_SCALE],N=r[C+k.PREV_SHEAR];u.rotateMix+=(A+(r[C+k.ROTATE]-A)*z-u.rotateMix)*E;u.translateMix+=(H+(r[C+k.TRANSLATE]-H)*z-u.translateMix)*E;u.scaleMix+=
(J+(r[C+k.SCALE]-J)*z-u.scaleMix)*E;u.shearMix+=(N+(r[C+k.SHEAR]-N)*z-u.shearMix)*E}},k.ENTRIES=5,k.PREV_TIME=-5,k.PREV_ROTATE=-4,k.PREV_TRANSLATE=-3,k.PREV_SCALE=-2,k.PREV_SHEAR=-1,k.ROTATE=1,k.TRANSLATE=2,k.SCALE=3,k.SHEAR=4,k}(n);c.TransformConstraintTimeline=f;f=function(l){function k(u){l.call(this,u);this.frames=c.Utils.newFloatArray(u*k.ENTRIES)}return __extends(k,l),k.prototype.setFrame=function(u,r,z){u*=k.ENTRIES;this.frames[u]=r;this.frames[u+k.VALUE]=z},k.prototype.apply=function(u,r,
z,C,E){r=this.frames;if(!(z<r[0])){u=u.pathConstraints[this.pathConstraintIndex];if(z>=r[r.length-k.ENTRIES])return void(u.position+=(r[r.length+k.PREV_VALUE]-u.position)*E);C=h.binarySearch(r,z,k.ENTRIES);var A=r[C+k.PREV_VALUE],H=r[C];z=this.getCurvePercent(C/k.ENTRIES-1,1-(z-H)/(r[C+k.PREV_TIME]-H));u.position+=(A+(r[C+k.VALUE]-A)*z-u.position)*E}},k.ENTRIES=2,k.PREV_TIME=-2,k.PREV_VALUE=-1,k.VALUE=1,k}(n);c.PathConstraintPositionTimeline=f;f=function(l){function k(u){l.call(this,u)}return __extends(k,
l),k.prototype.apply=function(u,r,z,C,E){r=this.frames;if(!(z<r[0])){u=u.pathConstraints[this.pathConstraintIndex];if(z>=r[r.length-k.ENTRIES])return void(u.spacing+=(r[r.length+k.PREV_VALUE]-u.spacing)*E);C=h.binarySearch(r,z,k.ENTRIES);var A=r[C+k.PREV_VALUE],H=r[C];z=this.getCurvePercent(C/k.ENTRIES-1,1-(z-H)/(r[C+k.PREV_TIME]-H));u.spacing+=(A+(r[C+k.VALUE]-A)*z-u.spacing)*E}},k}(f);c.PathConstraintSpacingTimeline=f;n=function(l){function k(u){l.call(this,u);this.frames=c.Utils.newFloatArray(u*
k.ENTRIES)}return __extends(k,l),k.prototype.setFrame=function(u,r,z,C){u*=k.ENTRIES;this.frames[u]=r;this.frames[u+k.ROTATE]=z;this.frames[u+k.TRANSLATE]=C},k.prototype.apply=function(u,r,z,C,E){r=this.frames;if(!(z<r[0])){u=u.pathConstraints[this.pathConstraintIndex];if(z>=r[r.length-k.ENTRIES])return z=r.length,u.rotateMix+=(r[z+k.PREV_ROTATE]-u.rotateMix)*E,void(u.translateMix+=(r[z+k.PREV_TRANSLATE]-u.translateMix)*E);C=h.binarySearch(r,z,k.ENTRIES);var A=r[C+k.PREV_ROTATE],H=r[C+k.PREV_TRANSLATE],
J=r[C];z=this.getCurvePercent(C/k.ENTRIES-1,1-(z-J)/(r[C+k.PREV_TIME]-J));u.rotateMix+=(A+(r[C+k.ROTATE]-A)*z-u.rotateMix)*E;u.translateMix+=(H+(r[C+k.TRANSLATE]-H)*z-u.translateMix)*E}},k.ENTRIES=3,k.PREV_TIME=-3,k.PREV_ROTATE=-2,k.PREV_TRANSLATE=-1,k.ROTATE=1,k.TRANSLATE=2,k}(n);c.PathConstraintMixTimeline=n}(spine||(spine={}));
!function(c){var h=function(){function f(q){if(void 0===q&&(q=null),this.tracks=[],this.events=[],this.listeners=[],this.timeScale=1,null==q)throw Error("data cannot be null.");this.data=q}return f.prototype.update=function(q){q*=this.timeScale;for(var l=0;l<this.tracks.length;l++){var k=this.tracks[l];if(null!=k){var u=k.next;if(null!=u){var r=k.lastTime-u.delay;if(0<=r){var z=q*u.timeScale;u.time=r+z;k.time+=q*k.timeScale;this.setCurrent(l,u);u.time-=z;k=u}}else if(!k.loop&&k.lastTime>=k.endTime){this.clearTrack(l);
continue}if(k.time+=q*k.timeScale,null!=k.previous)u=q*k.previous.timeScale,k.previous.time+=u,k.mixTime+=u}}},f.prototype.apply=function(q){for(var l=this.events,k=this.listeners.length,u=0;u<this.tracks.length;u++){var r=this.tracks[u];if(null!=r){l.length=0;var z=r.time,C=r.lastTime,E=r.endTime,A=r.loop;!A&&z>E&&(z=E);var H=r.previous;if(null==H)r.animation.mix(q,C,z,A,l,r.mix);else{var J=H.time;!H.loop&&J>H.endTime&&(J=H.endTime);H.animation.apply(q,J,J,H.loop,null);H=r.mixTime/r.mixDuration*
r.mix;1<=H&&(H=1,r.previous=null);r.animation.mix(q,C,z,A,l,H)}H=0;for(J=l.length;J>H;H++){var N=l[H];null!=r.listener&&r.listener.event(u,N);for(var U=0;k>U;U++)this.listeners[U].event(u,N)}if(A?C%E>z%E:E>C&&z>=E)for(z=c.MathUtils.toInt(z/E),null!=r.listener&&r.listener.complete(u,z),H=0,J=this.listeners.length;J>H;H++)this.listeners[H].complete(u,z);r.lastTime=r.time}}},f.prototype.clearTracks=function(){for(var q=0,l=this.tracks.length;l>q;q++)this.clearTrack(q);this.tracks.length=0},f.prototype.clearTrack=
function(q){if(!(q>=this.tracks.length)){var l=this.tracks[q];if(null!=l){null!=l.listener&&l.listener.end(q);for(var k=0,u=this.listeners.length;u>k;k++)this.listeners[k].end(q);this.tracks[q]=null;this.freeAll(l)}}},f.prototype.freeAll=function(q){for(;null!=q;)q=q.next},f.prototype.expandToIndex=function(q){return q<this.tracks.length?this.tracks[q]:(c.Utils.setArraySize(this.tracks,q-this.tracks.length+1,null),this.tracks.length=q+1,null)},f.prototype.setCurrent=function(q,l){var k=this.expandToIndex(q);
if(null!=k){var u=k.previous;k.previous=null;null!=k.listener&&k.listener.end(q);for(var r=0,z=this.listeners.length;z>r;r++)this.listeners[r].end(q);l.mixDuration=this.data.getMix(k.animation,l.animation);0<l.mixDuration&&(l.mixTime=0,null!=u&&.5>k.mixTime/k.mixDuration?l.previous=u:l.previous=k)}this.tracks[q]=l;null!=l.listener&&l.listener.start(q);r=0;for(z=this.listeners.length;z>r;r++)this.listeners[r].start(q)},f.prototype.setAnimation=function(q,l,k){var u=this.data.skeletonData.findAnimation(l);
if(null==u)throw Error("Animation not found: "+l);return this.setAnimationWith(q,u,k)},f.prototype.setAnimationWith=function(q,l,k){var u=this.expandToIndex(q);null!=u&&this.freeAll(u.next);u=new n;return u.animation=l,u.loop=k,u.endTime=l.duration,this.setCurrent(q,u),u},f.prototype.addAnimation=function(q,l,k,u){var r=this.data.skeletonData.findAnimation(l);if(null==r)throw Error("Animation not found: "+l);return this.addAnimationWith(q,r,k,u)},f.prototype.addAnimationWith=function(q,l,k,u){var r=
new n;r.animation=l;r.loop=k;r.endTime=l.duration;k=this.expandToIndex(q);if(null!=k){for(;null!=k.next;)k=k.next;k.next=r}else this.tracks[q]=r;return 0>=u&&(null!=k?u+=k.endTime-this.data.getMix(k.animation,l):u=0),r.delay=u,r},f.prototype.getCurrent=function(q){return q>=this.tracks.length?null:this.tracks[q]},f.prototype.addListener=function(q){if(null==q)throw Error("listener cannot be null.");this.listeners.push(q)},f.prototype.removeListener=function(q){q=this.listeners.indexOf(q);0<=q&&this.listeners.splice(q,
1)},f.prototype.clearListeners=function(){this.listeners.length=0},f}();c.AnimationState=h;var n=function(){function f(){this.loop=!1;this.time=this.delay=0;this.lastTime=-1;this.endTime=0;this.timeScale=1;this.mixDuration=this.mixTime=0;this.mix=1}return f.prototype.reset=function(){this.listener=this.animation=this.previous=this.next=null;this.timeScale=1;this.lastTime=-1;this.time=0},f.prototype.isComplete=function(){return this.time>=this.endTime},f}();c.TrackEntry=n;h=function(){function f(){}
return f.prototype.event=function(q,l){},f.prototype.complete=function(q,l){},f.prototype.start=function(q){},f.prototype.end=function(q){},f}();c.AnimationStateAdapter=h}(spine||(spine={}));
!function(c){var h=function(){function n(f){if(this.animationToMixTime={},this.defaultMix=0,null==f)throw Error("skeletonData cannot be null.");this.skeletonData=f}return n.prototype.setMix=function(f,q,l){var k=this.skeletonData.findAnimation(f);if(null==k)throw Error("Animation not found: "+f);f=this.skeletonData.findAnimation(q);if(null==f)throw Error("Animation not found: "+q);this.setMixWith(k,f,l)},n.prototype.setMixWith=function(f,q,l){if(null==f)throw Error("from cannot be null.");if(null==
q)throw Error("to cannot be null.");this.animationToMixTime[f.name+q.name]=l},n.prototype.getMix=function(f,q){f=this.animationToMixTime[f.name+q.name];return void 0===f?this.defaultMix:f},n}();c.AnimationStateData=h}(spine||(spine={}));
!function(c){var h=function(){function n(f,q){void 0===q&&(q="");this.assets={};this.errors={};this.loaded=this.toLoad=0;this.textureLoader=f;this.pathPrefix=q}return n.prototype.loadText=function(f,q,l){var k=this;void 0===q&&(q=null);void 0===l&&(l=null);f=this.pathPrefix+f;this.toLoad++;var u=new XMLHttpRequest;u.onreadystatechange=function(){u.readyState==XMLHttpRequest.DONE&&(200<=u.status&&300>u.status?(q&&q(f,u.responseText),k.assets[f]=u.responseText):(l&&l(f,"Couldn't load text "+f+": status "+
u.status+", "+u.responseText),k.errors[f]="Couldn't load text "+f+": status "+u.status+", "+u.responseText),k.toLoad--,k.loaded++)};u.open("GET",f,!0);u.send()},n.prototype.loadTexture=function(f,q,l){var k=this;void 0===q&&(q=null);void 0===l&&(l=null);f=this.pathPrefix+f;this.toLoad++;var u=new Image;u.src=f;u.crossOrigin="anonymous";u.onload=function(r){q&&q(f,u);r=k.textureLoader(u);k.assets[f]=r;k.toLoad--;k.loaded++};u.onerror=function(r){l&&l(f,"Couldn't load image "+f);k.errors[f]="Couldn't load image "+
f;k.toLoad--;k.loaded++}},n.prototype.get=function(f){return f=this.pathPrefix+f,this.assets[f]},n.prototype.remove=function(f){f=this.pathPrefix+f;var q=this.assets[f];q.dispose&&q.dispose();this.assets[f]=null},n.prototype.removeAll=function(){for(var f in this.assets){var q=this.assets[f];q.dispose&&q.dispose()}this.assets={}},n.prototype.isLoadingComplete=function(){return 0==this.toLoad},n.prototype.getToLoad=function(){return this.toLoad},n.prototype.getLoaded=function(){return this.loaded},
n.prototype.dispose=function(){this.removeAll()},n.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length},n.prototype.getErrors=function(){return this.errors},n}();c.AssetManager=h}(spine||(spine={}));!function(c){var h=c.BlendMode||(c.BlendMode={});h[h.Normal=0]="Normal";h[h.Additive=1]="Additive";h[h.Multiply=2]="Multiply";h[h.Screen=3]="Screen";!0;c.BlendMode}(spine||(spine={}));
!function(c){var h=function(){function n(f,q,l){if(this.children=[],this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.appliedRotation=0,this.a=0,this.b=0,this.worldX=0,this.c=0,this.d=0,this.worldY=0,this.worldSignX=0,this.worldSignY=0,this.sorted=!1,null==f)throw Error("data cannot be null.");if(null==q)throw Error("skeleton cannot be null.");this.data=f;this.skeleton=q;this.parent=l;this.setToSetupPose()}return n.prototype.update=function(){this.updateWorldTransformWith(this.x,
this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},n.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},n.prototype.updateWorldTransformWith=function(f,q,l,k,u,r,z){this.appliedRotation=l;var C=l+90+z;z=c.MathUtils.cosDeg(l+r)*k;var E=c.MathUtils.cosDeg(C)*u;l=c.MathUtils.sinDeg(l+r)*k;r=c.MathUtils.sinDeg(C)*u;C=this.parent;if(null==C)return C=this.skeleton,C.flipX&&(f=-f,z=-z,E=
-E),C.flipY&&(q=-q,l=-l,r=-r),this.a=z,this.b=E,this.c=l,this.d=r,this.worldX=f,this.worldY=q,this.worldSignX=c.MathUtils.signum(k),void(this.worldSignY=c.MathUtils.signum(u));var A=C.a,H=C.b,J=C.c,N=C.d;if(this.worldX=A*f+H*q+C.worldX,this.worldY=J*f+N*q+C.worldY,this.worldSignX=C.worldSignX*c.MathUtils.signum(k),this.worldSignY=C.worldSignY*c.MathUtils.signum(u),this.data.inheritRotation&&this.data.inheritScale)this.a=A*z+H*l,this.b=A*E+H*r,this.c=J*z+N*l,this.d=J*E+N*r;else{if(this.data.inheritRotation){A=
1;J=H=0;N=1;do{f=c.MathUtils.cosDeg(C.appliedRotation);q=c.MathUtils.sinDeg(C.appliedRotation);var U=A*f+H*q;if(H=H*f-A*q,A=U,U=J*f+N*q,N=N*f-J*q,J=U,!C.data.inheritRotation)break;C=C.parent}while(null!=C);this.a=A*z+H*l;this.b=A*E+H*r;this.c=J*z+N*l;this.d=J*E+N*r}else if(this.data.inheritScale){A=1;J=H=0;N=1;do{f=c.MathUtils.cosDeg(C.appliedRotation);q=c.MathUtils.sinDeg(C.appliedRotation);k=C.scaleX;U=C.scaleY;u=f*k;var p=q*U,x=q*k,G=f*U;U=A*u+H*x;if(H=H*G-A*p,A=U,U=J*u+N*x,N=N*G-J*p,J=U,0<=k&&
(q=-q),U=A*f+H*q,H=H*f-A*q,A=U,U=J*f+N*q,N=N*f-J*q,J=U,!C.data.inheritScale)break;C=C.parent}while(null!=C);this.a=A*z+H*l;this.b=A*E+H*r;this.c=J*z+N*l;this.d=J*E+N*r}else this.a=z,this.b=E,this.c=l,this.d=r;this.skeleton.flipX&&(this.a=-this.a,this.b=-this.b);this.skeleton.flipY&&(this.c=-this.c,this.d=-this.d)}},n.prototype.setToSetupPose=function(){var f=this.data;this.x=f.x;this.y=f.y;this.rotation=f.rotation;this.scaleX=f.scaleX;this.scaleY=f.scaleY;this.shearX=f.shearX;this.shearY=f.shearY},
n.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*c.MathUtils.radDeg},n.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*c.MathUtils.radDeg},n.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.b*this.b)*this.worldSignX},n.prototype.getWorldScaleY=function(){return Math.sqrt(this.c*this.c+this.d*this.d)*this.worldSignY},n.prototype.worldToLocalRotationX=function(){var f=this.parent;if(null==f)return this.rotation;var q=this.a,l=this.c;
return Math.atan2(f.a*l-f.c*q,f.d*q-f.b*l)*c.MathUtils.radDeg},n.prototype.worldToLocalRotationY=function(){var f=this.parent;if(null==f)return this.rotation;var q=this.b,l=this.d;return Math.atan2(f.a*l-f.c*q,f.d*q-f.b*l)*c.MathUtils.radDeg},n.prototype.rotateWorld=function(f){var q=this.a,l=this.b,k=this.c,u=this.d,r=c.MathUtils.cosDeg(f);f=c.MathUtils.sinDeg(f);this.a=r*q-f*k;this.b=r*l-f*u;this.c=f*q+r*k;this.d=f*l+r*u},n.prototype.updateLocalTransform=function(){var f=this.parent;if(null==f){this.x=
this.worldX;this.y=this.worldY;this.rotation=Math.atan2(this.c,this.a)*c.MathUtils.radDeg;this.scaleX=Math.sqrt(this.a*this.a+this.c*this.c);this.scaleY=Math.sqrt(this.b*this.b+this.d*this.d);var q=this.a*this.d-this.b*this.c;return this.shearX=0,void(this.shearY=Math.atan2(this.a*this.b+this.c*this.d,q)*c.MathUtils.radDeg)}var l=f.a,k=f.b,u=f.c,r=f.d;q=1/(l*r-k*u);var z=this.worldX-f.worldX;f=this.worldY-f.worldY;this.x=z*r*q-f*k*q;this.y=f*l*q-z*u*q;r*=q;l*=q;k*=q;q*=u;u=r*this.a-k*this.c;k=r*this.b-
k*this.d;r=l*this.c-q*this.a;l=l*this.d-q*this.b;(this.shearX=0,this.scaleX=Math.sqrt(u*u+r*r),1E-4<this.scaleX)?(q=u*l-k*r,this.scaleY=q/this.scaleX,this.shearY=Math.atan2(u*k+r*l,q)*c.MathUtils.radDeg,this.rotation=Math.atan2(r,u)*c.MathUtils.radDeg):(this.scaleX=0,this.scaleY=Math.sqrt(k*k+l*l),this.shearY=0,this.rotation=90-Math.atan2(l,k)*c.MathUtils.radDeg);this.appliedRotation=this.rotation},n.prototype.worldToLocal=function(f){var q=this.a,l=this.b,k=this.c,u=this.d,r=1/(q*u-l*k),z=f.x-this.worldX,
C=f.y-this.worldY;return f.x=z*u*r-C*l*r,f.y=C*q*r-z*k*r,f},n.prototype.localToWorld=function(f){var q=f.x,l=f.y;return f.x=q*this.a+l*this.b+this.worldX,f.y=q*this.c+l*this.d+this.worldY,f},n}();c.Bone=h}(spine||(spine={}));
!function(c){var h=function(){return function(n,f,q){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.inheritRotation=!0,this.inheritScale=!0,0>n)throw Error("index must be >= 0.");if(null==f)throw Error("name cannot be null.");this.index=n;this.name=f;this.parent=q}}();c.BoneData=h}(spine||(spine={}));
!function(c){var h=function(){return function(n,f){if(null==f)throw Error("data cannot be null.");this.time=n;this.data=f}}();c.Event=h}(spine||(spine={}));!function(c){var h=function(){return function(n){this.name=n}}();c.EventData=h}(spine||(spine={}));
!function(c){var h=function(){function n(f,q){if(this.mix=1,this.bendDirection=0,this.level=0,null==f)throw Error("data cannot be null.");if(null==q)throw Error("skeleton cannot be null.");this.data=f;this.mix=f.mix;this.bendDirection=f.bendDirection;this.bones=[];for(var l=0;l<f.bones.length;l++)this.bones.push(q.findBone(f.bones[l].name));this.target=q.findBone(f.target.name)}return n.prototype.apply=function(){this.update()},n.prototype.update=function(){var f=this.target,q=this.bones;switch(q.length){case 1:this.apply1(q[0],
f.worldX,f.worldY,this.mix);break;case 2:this.apply2(q[0],q[1],f.worldX,f.worldY,this.bendDirection,this.mix)}},n.prototype.apply1=function(f,q,l,k){var u=f.parent,r=1/(u.a*u.d-u.b*u.c);q-=u.worldX;l-=u.worldY;u=Math.atan2((l*u.a-q*u.c)*r-f.y,(q*u.d-l*u.b)*r-f.x)*c.MathUtils.radDeg-f.shearX-f.rotation;0>f.scaleX&&(u+=180);180<u?u-=360:-180>u&&(u+=360);f.updateWorldTransformWith(f.x,f.y,f.rotation+u*k,f.scaleX,f.scaleY,f.shearX,f.shearY)},n.prototype.apply2=function(f,q,l,k,u,r){if(0==r)return void q.updateWorldTransform();
var z=f.x,C=f.y,E=f.scaleX,A=f.scaleY,H=q.scaleX,J=0,N=0,U=0;0>E?(E=-E,J=180,U=-1):(J=0,U=1);0>A&&(A=-A,U=-U);0>H?(H=-H,N=180):N=0;var p=q.x,x=0,G=0,e=0,m=f.a,v=f.b,D=f.c,B=f.d,I=1E-4>=Math.abs(E-A);I?(x=q.y,G=m*p+v*x+f.worldX,e=D*p+B*x+f.worldY):(x=0,G=m*p+f.worldX,e=D*p+f.worldY);var L=f.parent;m=L.a;v=L.b;D=L.c;B=L.d;var S=1/(m*B-v*D);l-=L.worldX;k-=L.worldY;var R=(l*B-k*v)*S-z,W=(k*m-l*D)*S-C;l=G-L.worldX;k=e-L.worldY;v=(l*B-k*v)*S-z;m=(k*m-l*D)*S-C;S=Math.sqrt(v*v+m*m);v=q.data.length*H;H=G=
0;a:if(I)v*=E,m=(R*R+W*W-S*S-v*v)/(2*S*v),-1>m?m=-1:1<m&&(m=1),H=Math.acos(m)*u,m=S+v*m,v*=Math.sin(H),G=Math.atan2(W*m-R*v,R*m+W*v);else{m=E*v;v*=A;k=m*m;e=v*v;I=R*R+W*W;R=Math.atan2(W,R);D=e*S*S+k*I-k*e;l=-2*e*S;W=e-k;if(B=l*l-4*W*D,0<=B)if(B=Math.sqrt(B),0>l&&(B=-B),B=-(l+B)/2,l=B/W,B=D/B,B=Math.abs(l)<Math.abs(B)?l:B,I>=B*B){k=Math.sqrt(I-B*B)*u;G=R-Math.atan2(k,B);H=Math.atan2(k/A,(B-S)/E);break a}E=0;A=Number.MAX_VALUE;var X=L=W=D=0,V=0,la=0;l=S+m;B=l*l;B>X&&(L=0,X=B,V=l);l=S-m;B=l*l;A>B&&(E=
c.MathUtils.PI,A=B,D=l);e=Math.acos(-m*S/(k-e));l=m*Math.cos(e)+S;k=v*Math.sin(e);B=l*l+k*k;A>B&&(E=e,A=B,D=l,W=k);B>X&&(L=e,X=B,V=l,la=k);(A+X)/2>=I?(G=R-Math.atan2(W*u,D),H=E*u):(G=R-Math.atan2(la*u,V),H=L*u)}u=Math.atan2(x,p)*U;m=f.rotation;G=(G-u)*c.MathUtils.radDeg+J-m;180<G?G-=360:-180>G&&(G+=360);f.updateWorldTransformWith(z,C,m+G*r,f.scaleX,f.scaleY,0,0);m=q.rotation;H=((H+u)*c.MathUtils.radDeg-q.shearX)*U+N-m;180<H?H-=360:-180>H&&(H+=360);q.updateWorldTransformWith(p,x,m+H*r,q.scaleX,q.scaleY,
q.shearX,q.shearY)},n}();c.IkConstraint=h}(spine||(spine={}));!function(c){var h=function(){return function(n){this.bones=[];this.mix=this.bendDirection=1;this.name=n}}();c.IkConstraintData=h}(spine||(spine={}));
!function(c){var h=function(){function n(f,q){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=[],this.positions=[],this.world=[],this.curves=[],this.lengths=[],this.segments=[],null==f)throw Error("data cannot be null.");if(null==q)throw Error("skeleton cannot be null.");this.data=f;this.bones=[];for(var l=0,k=f.bones.length;k>l;l++)this.bones.push(q.findBone(f.bones[l].name));this.target=q.findSlot(f.target.name);this.position=f.position;this.spacing=f.spacing;
this.rotateMix=f.rotateMix;this.translateMix=f.translateMix}return n.prototype.apply=function(){this.update()},n.prototype.update=function(){var f=this.target.getAttachment();if(f instanceof c.PathAttachment){var q=this.rotateMix,l=this.translateMix,k=0<q;if(0<l||k){var u=this.data,r=u.spacingMode,z=r==c.SpacingMode.Length,C=u.rotateMode,E=C==c.RotateMode.Tangent,A=C==c.RotateMode.ChainScale,H=this.bones.length,J=E?H:H+1,N=this.bones,U=c.Utils.setArraySize(this.spaces,J),p=null,x=this.spacing;if(A||
z){A&&(p=c.Utils.setArraySize(this.lengths,H));for(var G=0,e=J-1;e>G;){var m=N[G],v=m.data.length,D=v*m.a;v*=m.c;v=Math.sqrt(D*D+v*v);A&&(p[G]=v);U[++G]=z?Math.max(0,v+x):x}}else for(G=1;J>G;G++)U[G]=x;f=this.computeWorldPositions(f,J,E,u.positionMode==c.PositionMode.Percent,r==c.SpacingMode.Percent);G=this.target.bone.skeleton;r=G.x;z=G.y;J=f[0];x=f[1];u=u.offsetRotation;C=C==c.RotateMode.Chain&&0==u;G=0;for(e=3;H>G;G++,e+=3){m=N[G];m.worldX+=(J-r-m.worldX)*l;m.worldY+=(x-z-m.worldY)*l;D=f[e];v=
f[e+1];var B=D-J,I=v-x;A&&(J=p[G],0!=J&&(J=(Math.sqrt(B*B+I*I)/J-1)*q+1,m.a*=J,m.c*=J));if(J=D,x=v,k){D=m.a;v=m.b;var L=m.c,S=m.d,R=0;if(R=E?f[e-1]:0==U[G+1]?f[e+2]:Math.atan2(I,B),R-=Math.atan2(L,D)-u*c.MathUtils.degRad,C){var W=Math.cos(R);var X=Math.sin(R);var V=m.data.length;J+=(V*(W*D-X*L)-B)*q;x+=(V*(X*D+W*L)-I)*q}R>c.MathUtils.PI?R-=c.MathUtils.PI2:R<-c.MathUtils.PI&&(R+=c.MathUtils.PI2);R*=q;W=Math.cos(R);X=Math.sin(R);m.a=W*D-X*L;m.b=W*v-X*S;m.c=X*D+W*L;m.d=X*v+W*S}}}}},n.prototype.computeWorldPositions=
function(f,q,l,k,u){var r=this.target,z=this.position,C=this.spaces,E=c.Utils.setArraySize(this.positions,3*q+2),A=null,H=f.closed,J=f.worldVerticesLength,N=J/6,U=n.NONE;if(!f.constantSpeed){var p=f.lengths;N-=H?1:2;var x=p[N];if(k&&(z*=x),u)for(var G=0;q>G;G++)C[G]*=x;A=c.Utils.setArraySize(this.world,8);for(u=k=G=0;q>G;G++,k+=3){var e=C[G],m=z+=e;if(H)m%=x,0>m&&(m+=x),u=0;else{if(0>m){U!=n.BEFORE&&(U=n.BEFORE,f.computeWorldVerticesWith(r,2,4,A,0));this.addBeforePosition(m,A,0,E,k);continue}if(m>
x){U!=n.AFTER&&(U=n.AFTER,f.computeWorldVerticesWith(r,J-6,4,A,0));this.addAfterPosition(m-x,A,0,E,k);continue}}for(;;u++){var v=p[u];if(!(m>v)){if(0==u)m/=v;else{var D=p[u-1];m=(m-D)/(v-D)}break}}u!=U&&(U=u,H&&u==N?(f.computeWorldVerticesWith(r,J-4,4,A,0),f.computeWorldVerticesWith(r,0,4,A,4)):f.computeWorldVerticesWith(r,6*u+2,8,A,0));this.addCurvePosition(m,A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],E,k,l||0<G&&0==e)}return E}H?(J+=2,A=c.Utils.setArraySize(this.world,J),f.computeWorldVerticesWith(r,
2,J-4,A,0),f.computeWorldVerticesWith(r,0,2,A,J-4),A[J-2]=A[0],A[J-1]=A[1]):(N--,J-=4,A=c.Utils.setArraySize(this.world,J),f.computeWorldVerticesWith(r,2,J,A,0));f=c.Utils.setArraySize(this.curves,N);r=0;p=A[0];x=A[1];var B=v=0,I=0,L=0,S=0,R=0;G=0;for(e=2;N>G;G++,e+=6){v=A[e];B=A[e+1];I=A[e+2];L=A[e+3];S=A[e+4];R=A[e+5];var W=.1875*(p-2*v+I);var X=.1875*(x-2*B+L);D=.09375*(3*(v-I)-p+S);var V=.09375*(3*(B-L)-x+R);var la=2*W+D;var fa=2*X+V;W=.75*(v-p)+W+.16666667*D;X=.75*(B-x)+X+.16666667*V;r+=Math.sqrt(W*
W+X*X);W+=la;X+=fa;la+=D;fa+=V;r+=Math.sqrt(W*W+X*X);W+=la;X+=fa;r+=Math.sqrt(W*W+X*X);W+=la+D;X+=fa+V;r+=Math.sqrt(W*W+X*X);f[G]=r;p=S;x=R}if(k&&(z*=r),u)for(G=0;q>G;G++)C[G]*=r;N=this.segments;var ha=0;for(V=u=k=G=0;q>G;G++,k+=3){e=C[G];m=z+=e;if(H)m%=r,0>m&&(m+=r),u=0;else{if(0>m){this.addBeforePosition(m,A,0,E,k);continue}if(m>r){this.addAfterPosition(m-r,A,J-4,E,k);continue}}for(;;u++)if(la=f[u],!(m>la)){0==u?m/=la:(D=f[u-1],m=(m-D)/(la-D));break}if(u!=U){U=u;var ba=6*u;p=A[ba];x=A[ba+1];v=A[ba+
2];B=A[ba+3];I=A[ba+4];L=A[ba+5];S=A[ba+6];R=A[ba+7];W=.03*(p-2*v+I);X=.03*(x-2*B+L);D=.006*(3*(v-I)-p+S);V=.006*(3*(B-L)-x+R);la=2*W+D;fa=2*X+V;W=.3*(v-p)+W+.16666667*D;X=.3*(B-x)+X+.16666667*V;ha=Math.sqrt(W*W+X*X);N[0]=ha;for(ba=1;8>ba;ba++)W+=la,X+=fa,la+=D,fa+=V,ha+=Math.sqrt(W*W+X*X),N[ba]=ha;W+=la;X+=fa;ha+=Math.sqrt(W*W+X*X);N[8]=ha;W+=la+D;X+=fa+V;ha+=Math.sqrt(W*W+X*X);N[9]=ha;V=0}for(m*=ha;;V++)if(la=N[V],!(m>la)){0==V?m/=la:(D=N[V-1],m=V+(m-D)/(la-D));break}this.addCurvePosition(.1*m,
p,x,v,B,I,L,S,R,E,k,l||0<G&&0==e)}return E},n.prototype.addBeforePosition=function(f,q,l,k,u){var r=q[l],z=q[l+1];q=Math.atan2(q[l+3]-z,q[l+2]-r);k[u]=r+f*Math.cos(q);k[u+1]=z+f*Math.sin(q);k[u+2]=q},n.prototype.addAfterPosition=function(f,q,l,k,u){var r=q[l+2],z=q[l+3];q=Math.atan2(z-q[l+1],r-q[l]);k[u]=r+f*Math.cos(q);k[u+1]=z+f*Math.sin(q);k[u+2]=q},n.prototype.addCurvePosition=function(f,q,l,k,u,r,z,C,E,A,H,J){0==f&&(f=1E-4);var N=f*f,U=N*f,p=1-f,x=p*p,G=x*p,e=p*f,m=3*e;p*=m;f*=m;C=q*G+k*p+r*
f+C*U;E=l*G+u*p+z*f+E*U;A[H]=C;A[H+1]=E;J&&(A[H+2]=Math.atan2(E-(l*x+u*e*2+z*N),C-(q*x+k*e*2+r*N)))},n.NONE=-1,n.BEFORE=-2,n.AFTER=-3,n}();c.PathConstraint=h}(spine||(spine={}));
!function(c){var h=function(){return function(n){this.bones=[];this.name=n}}();c.PathConstraintData=h;(function(n){n[n.Fixed=0]="Fixed";n[n.Percent=1]="Percent"})(c.PositionMode||(c.PositionMode={}));c.PositionMode;!function(n){n[n.Length=0]="Length";n[n.Fixed=1]="Fixed";n[n.Percent=2]="Percent"}(c.SpacingMode||(c.SpacingMode={}));c.SpacingMode;!function(n){n[n.Tangent=0]="Tangent";n[n.Chain=1]="Chain";n[n.ChainScale=2]="ChainScale"}(c.RotateMode||(c.RotateMode={}));c.RotateMode}(spine||(spine={}));
!function(c){var h=function(){function f(q){this.toLoad=[];this.assets={};this.clientId=q}return f.prototype.loaded=function(){var q=0,l;for(l in this.assets)q++;return q},f}(),n=function(){function f(q){void 0===q&&(q="");this.clientAssets={};this.queuedAssets={};this.rawAssets={};this.errors={};this.pathPrefix=q}return f.prototype.queueAsset=function(q,l,k){var u=this.clientAssets[q];return(null===u||void 0===u)&&(u=new h(q),this.clientAssets[q]=u),null!==l&&(u.textureLoader=l),u.toLoad.push(k),
this.queuedAssets[k]===k?!1:(this.queuedAssets[k]=k,!0)},f.prototype.loadText=function(q,l){var k=this;if(l=this.pathPrefix+l,this.queueAsset(q,null,l)){var u=new XMLHttpRequest;u.onreadystatechange=function(){u.readyState==XMLHttpRequest.DONE&&(200<=u.status&&300>u.status?k.rawAssets[l]=u.responseText:k.errors[l]="Couldn't load text "+l+": status "+u.status+", "+u.responseText)};u.open("GET",l,!0);u.send()}},f.prototype.loadJson=function(q,l){var k=this;if(l=this.pathPrefix+l,this.queueAsset(q,null,
l)){var u=new XMLHttpRequest;u.onreadystatechange=function(){u.readyState==XMLHttpRequest.DONE&&(200<=u.status&&300>u.status?k.rawAssets[l]=JSON.parse(u.responseText):k.errors[l]="Couldn't load text "+l+": status "+u.status+", "+u.responseText)};u.open("GET",l,!0);u.send()}},f.prototype.loadTexture=function(q,l,k){var u=this;if(k=this.pathPrefix+k,this.queueAsset(q,l,k)){var r=new Image;r.src=k;r.crossOrigin="anonymous";r.onload=function(z){u.rawAssets[k]=r};r.onerror=function(z){u.errors[k]="Couldn't load image "+
k}}},f.prototype.get=function(q,l){l=this.pathPrefix+l;q=this.clientAssets[q];return null===q||void 0===q?!0:q.assets[l]},f.prototype.updateClientAssets=function(q){for(var l=0;l<q.toLoad.length;l++){var k=q.toLoad[l],u=q.assets[k];if(null===u||void 0===u)u=this.rawAssets[k],null!==u&&void 0!==u&&(u instanceof HTMLImageElement?q.assets[k]=q.textureLoader(u):q.assets[k]=u)}},f.prototype.isLoadingComplete=function(q){q=this.clientAssets[q];return null===q||void 0===q?!0:(this.updateClientAssets(q),
q.toLoad.length==q.loaded())},f.prototype.dispose=function(){},f.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length},f.prototype.getErrors=function(){return this.errors},f}();c.SharedAssetManager=n}(spine||(spine={}));
!function(c){var h=function(){function n(f){if(this._updateCache=[],this.time=0,this.flipX=!1,this.flipY=!1,this.x=0,this.y=0,null==f)throw Error("data cannot be null.");this.data=f;this.bones=[];for(var q=0;q<f.bones.length;q++){var l=f.bones[q];if(null==l.parent)l=new c.Bone(l,this,null);else{var k=this.bones[l.parent.index];l=new c.Bone(l,this,k);k.children.push(l)}this.bones.push(l)}this.slots=[];this.drawOrder=[];for(q=0;q<f.slots.length;q++)k=f.slots[q],l=this.bones[k.boneData.index],l=new c.Slot(k,
l),this.slots.push(l),this.drawOrder.push(l);this.ikConstraints=[];this.ikConstraintsSorted=[];for(q=0;q<f.ikConstraints.length;q++)this.ikConstraints.push(new c.IkConstraint(f.ikConstraints[q],this));this.transformConstraints=[];for(q=0;q<f.transformConstraints.length;q++)this.transformConstraints.push(new c.TransformConstraint(f.transformConstraints[q],this));this.pathConstraints=[];for(q=0;q<f.pathConstraints.length;q++)this.pathConstraints.push(new c.PathConstraint(f.pathConstraints[q],this));
this.color=new c.Color(1,1,1,1);this.updateCache()}return n.prototype.updateCache=function(){var f=this._updateCache;f.length=0;for(var q=this.bones,l=0,k=q.length;k>l;l++)q[l].sorted=!1;var u=this.ikConstraintsSorted;for(l=u.length=0;l<this.ikConstraints.length;l++)u.push(this.ikConstraints[l]);var r=u.length;l=0;var z;for(k=r;k>l;l++){var C=u[l],E=C.bones[0].parent;for(z=0;null!=E;z++)E=E.parent;C.level=z}for(l=1;r>l;l++){C=u[l];z=C.level;for(E=l-1;0<=E;E--){k=u[E];if(k.level<z)break;u[E+1]=k}u[E+
1]=C}l=0;for(k=u.length;k>l;l++)r=u[l],this.sortBone(r.target),z=r.bones,E=z[0],this.sortBone(E),f.push(r),this.sortReset(E.children),z[z.length-1].sorted=!0;u=this.pathConstraints;l=0;for(k=u.length;k>l;l++){r=u[l];C=r.target;var A=C.data.index;z=C.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,A,z);null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,A,z);E=0;for(var H=this.data.skins.length;H>E;E++)this.sortPathConstraintAttachment(this.data.skins[E],
A,z);E=C.getAttachment();E instanceof c.PathAttachment&&this.sortPathConstraintAttachmentWith(E,z);z=r.bones;C=z.length;for(E=0;C>E;E++)this.sortBone(z[E]);f.push(r);for(E=0;C>E;E++)this.sortReset(z[E].children);for(E=0;C>E;E++)z[E].sorted=!0}u=this.transformConstraints;l=0;for(k=u.length;k>l;l++){r=u[l];this.sortBone(r.target);z=r.bones;C=z.length;for(E=0;C>E;E++)this.sortBone(z[E]);f.push(r);for(E=0;C>E;E++)this.sortReset(z[E].children);for(E=0;C>E;E++)z[E].sorted=!0}l=0;for(k=q.length;k>l;l++)this.sortBone(q[l])},
n.prototype.sortPathConstraintAttachment=function(f,q,l){if(f=f.attachments[q])for(var k in f)this.sortPathConstraintAttachmentWith(f[k],l)},n.prototype.sortPathConstraintAttachmentWith=function(f,q){if(f instanceof c.PathAttachment)if(f=f.bones,null==f)this.sortBone(q);else{q=this.bones;for(var l=0;l<f.length;l++)this.sortBone(q[f[l]])}},n.prototype.sortBone=function(f){if(!f.sorted){var q=f.parent;null!=q&&this.sortBone(q);f.sorted=!0;this._updateCache.push(f)}},n.prototype.sortReset=function(f){for(var q=
0,l=f.length;l>q;q++){var k=f[q];k.sorted&&this.sortReset(k.children);k.sorted=!1}},n.prototype.updateWorldTransform=function(){for(var f=this._updateCache,q=0,l=f.length;l>q;q++)f[q].update()},n.prototype.setToSetupPose=function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},n.prototype.setBonesToSetupPose=function(){for(var f=this.bones,q=0,l=f.length;l>q;q++)f[q].setToSetupPose();var k=this.ikConstraints;q=0;for(l=k.length;l>q;q++)f=k[q],f.bendDirection=f.data.bendDirection,f.mix=f.data.mix;
var u=this.transformConstraints;q=0;for(l=u.length;l>q;q++)f=u[q],k=f.data,f.rotateMix=k.rotateMix,f.translateMix=k.translateMix,f.scaleMix=k.scaleMix,f.shearMix=k.shearMix;u=this.pathConstraints;q=0;for(l=u.length;l>q;q++)f=u[q],k=f.data,f.position=k.position,f.spacing=k.spacing,f.rotateMix=k.rotateMix,f.translateMix=k.translateMix},n.prototype.setSlotsToSetupPose=function(){var f=this.slots;c.Utils.arrayCopy(f,0,this.drawOrder,0,f.length);for(var q=0,l=f.length;l>q;q++)f[q].setToSetupPose()},n.prototype.getRootBone=
function(){return 0==this.bones.length?null:this.bones[0]},n.prototype.findBone=function(f){if(null==f)throw Error("boneName cannot be null.");for(var q=this.bones,l=0,k=q.length;k>l;l++){var u=q[l];if(u.data.name==f)return u}return null},n.prototype.findBoneIndex=function(f){if(null==f)throw Error("boneName cannot be null.");for(var q=this.bones,l=0,k=q.length;k>l;l++)if(q[l].data.name==f)return l;return-1},n.prototype.findSlot=function(f){if(null==f)throw Error("slotName cannot be null.");for(var q=
this.slots,l=0,k=q.length;k>l;l++){var u=q[l];if(u.data.name==f)return u}return null},n.prototype.findSlotIndex=function(f){if(null==f)throw Error("slotName cannot be null.");for(var q=this.slots,l=0,k=q.length;k>l;l++)if(q[l].data.name==f)return l;return-1},n.prototype.setSkinByName=function(f){var q=this.data.findSkin(f);if(null==q)throw Error("Skin not found: "+f);this.setSkin(q)},n.prototype.setSkin=function(f){if(null!=f)if(null!=this.skin)f.attachAll(this,this.skin);else for(var q=this.slots,
l=0,k=q.length;k>l;l++){var u=q[l],r=u.data.attachmentName;null!=r&&(r=f.getAttachment(l,r),null!=r&&u.setAttachment(r))}this.skin=f},n.prototype.getAttachmentByName=function(f,q){return this.getAttachment(this.data.findSlotIndex(f),q)},n.prototype.getAttachment=function(f,q){if(null==q)throw Error("attachmentName cannot be null.");if(null!=this.skin){var l=this.skin.getAttachment(f,q);if(null!=l)return l}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(f,q):null},n.prototype.setAttachment=
function(f,q){if(null==f)throw Error("slotName cannot be null.");for(var l=this.slots,k=0,u=l.length;u>k;k++){var r=l[k];if(r.data.name==f){l=null;if(null!=q&&(l=this.getAttachment(k,q),null==l))throw Error("Attachment not found: "+q+", for slot: "+f);return void r.setAttachment(l)}}throw Error("Slot not found: "+f);},n.prototype.findIkConstraint=function(f){if(null==f)throw Error("constraintName cannot be null.");for(var q=this.ikConstraints,l=0,k=q.length;k>l;l++){var u=q[l];if(u.data.name==f)return u}return null},
n.prototype.findTransformConstraint=function(f){if(null==f)throw Error("constraintName cannot be null.");for(var q=this.transformConstraints,l=0,k=q.length;k>l;l++){var u=q[l];if(u.data.name==f)return u}return null},n.prototype.findPathConstraint=function(f){if(null==f)throw Error("constraintName cannot be null.");for(var q=this.pathConstraints,l=0,k=q.length;k>l;l++){var u=q[l];if(u.data.name==f)return u}return null},n.prototype.getBounds=function(f,q){if(null==f)throw Error("offset cannot be null.");
if(null==q)throw Error("size cannot be null.");for(var l=this.drawOrder,k=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,z=Number.NEGATIVE_INFINITY,C=0,E=l.length;E>C;C++){var A=l[C],H=null,J=A.getAttachment();if(J instanceof c.RegionAttachment?H=J.updateWorldVertices(A,!1):J instanceof c.MeshAttachment&&(H=J.updateWorldVertices(A,!0)),null!=H)for(A=0,J=H.length;J>A;A+=8){var N=H[A],U=H[A+1];k=Math.min(k,N);u=Math.min(u,U);r=Math.max(r,N);z=Math.max(z,U)}}f.set(k,u);
q.set(r-k,z-u)},n.prototype.update=function(f){this.time+=f},n}();c.Skeleton=h}(spine||(spine={}));
!function(c){var h=function(){function n(){this.maxY=this.maxX=this.minY=this.minX=0;this.boundingBoxes=[];this.polygons=[];this.polygonPool=new c.Pool(function(){return c.Utils.newFloatArray(16)})}return n.prototype.update=function(f,q){if(null==f)throw Error("skeleton cannot be null.");var l=this.boundingBoxes,k=this.polygons,u=this.polygonPool;f=f.slots;var r=f.length;l.length=0;u.freeAll(k);for(var z=k.length=0;r>z;z++){var C=f[z],E=C.getAttachment();if(E instanceof c.BoundingBoxAttachment){l.push(E);
var A=u.obtain();A.length!=E.worldVerticesLength&&(A=c.Utils.newFloatArray(E.worldVerticesLength));k.push(A);E.computeWorldVertices(C,A)}}q&&this.aabbCompute()},n.prototype.aabbCompute=function(){for(var f=Number.POSITIVE_INFINITY,q=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY,u=this.polygons,r=0,z=u.length;z>r;r++){var C=u[r],E=C,A=0;for(C=C.length;C>A;A+=2){var H=E[A],J=E[A+1];f=Math.min(f,H);q=Math.min(q,J);l=Math.max(l,H);k=Math.max(k,J)}}this.minX=f;this.minY=
q;this.maxX=l;this.maxY=k},n.prototype.aabbContainsPoint=function(f,q){return f>=this.minX&&f<=this.maxX&&q>=this.minY&&q<=this.maxY},n.prototype.aabbIntersectsSegment=function(f,q,l,k){var u=this.minX,r=this.minY,z=this.maxX,C=this.maxY;if(u>=f&&u>=l||r>=q&&r>=k||f>=z&&l>=z||q>=C&&k>=C)return!1;l=(k-q)/(l-f);k=l*(u-f)+q;if(k>r&&C>k||(k=l*(z-f)+q,k>r&&C>k))return!0;r=(r-q)/l+f;return r>u&&z>r?!0:(r=(C-q)/l+f,r>u&&z>r?!0:!1)},n.prototype.aabbIntersectsSkeleton=function(f){return this.minX<f.maxX&&
this.maxX>f.minX&&this.minY<f.maxY&&this.maxY>f.minY},n.prototype.containsPoint=function(f,q){for(var l=this.polygons,k=0,u=l.length;u>k;k++)if(this.containsPointPolygon(l[k],f,q))return this.boundingBoxes[k];return null},n.prototype.containsPointPolygon=function(f,q,l){for(var k=f.length,u=k-2,r=!1,z=0;k>z;z+=2){var C=f[z+1],E=f[u+1];if(l>C&&E>=l||l>E&&C>=l){var A=f[z];A+(l-C)/(E-C)*(f[u]-A)<q&&(r=!r)}u=z}return r},n.prototype.intersectsSegment=function(f,q,l,k){for(var u=this.polygons,r=0,z=u.length;z>
r;r++)if(this.intersectsSegmentPolygon(u[r],f,q,l,k))return this.boundingBoxes[r];return null},n.prototype.intersectsSegmentPolygon=function(f,q,l,k,u){for(var r=f.length,z=q-k,C=l-u,E=q*u-l*k,A=f[r-2],H=f[r-1],J=0;r>J;J+=2){var N=f[J],U=f[J+1],p=A*U-H*N,x=A-N,G=H-U,e=z*G-C*x;x=(E*x-z*p)/e;if((x>=A&&N>=x||x>=N&&A>=x)&&(x>=q&&k>=x||x>=k&&q>=x)&&(A=(E*G-C*p)/e,(A>=H&&U>=A||A>=U&&H>=A)&&(A>=l&&u>=A||A>=u&&l>=A)))return!0;A=N;H=U}return!1},n.prototype.getPolygon=function(f){if(null==f)throw Error("boundingBox cannot be null.");
f=this.boundingBoxes.indexOf(f);return-1==f?null:this.polygons[f]},n.prototype.getWidth=function(){return this.maxX-this.minX},n.prototype.getHeight=function(){return this.maxY-this.minY},n}();c.SkeletonBounds=h}(spine||(spine={}));
!function(c){var h=function(){function n(){this.bones=[];this.slots=[];this.skins=[];this.events=[];this.animations=[];this.ikConstraints=[];this.transformConstraints=[];this.pathConstraints=[]}return n.prototype.findBone=function(f){if(null==f)throw Error("boneName cannot be null.");for(var q=this.bones,l=0,k=q.length;k>l;l++){var u=q[l];if(u.name==f)return u}return null},n.prototype.findBoneIndex=function(f){if(null==f)throw Error("boneName cannot be null.");for(var q=this.bones,l=0,k=q.length;k>
l;l++)if(q[l].name==f)return l;return-1},n.prototype.findSlot=function(f){if(null==f)throw Error("slotName cannot be null.");for(var q=this.slots,l=0,k=q.length;k>l;l++){var u=q[l];if(u.name==f)return u}return null},n.prototype.findSlotIndex=function(f){if(null==f)throw Error("slotName cannot be null.");for(var q=this.slots,l=0,k=q.length;k>l;l++)if(q[l].name==f)return l;return-1},n.prototype.findSkin=function(f){if(null==f)throw Error("skinName cannot be null.");for(var q=this.skins,l=0,k=q.length;k>
l;l++){var u=q[l];if(u.name==f)return u}return null},n.prototype.findEvent=function(f){if(null==f)throw Error("eventDataName cannot be null.");for(var q=this.events,l=0,k=q.length;k>l;l++){var u=q[l];if(u.name==f)return u}return null},n.prototype.findAnimation=function(f){if(null==f)throw Error("animationName cannot be null.");for(var q=this.animations,l=0,k=q.length;k>l;l++){var u=q[l];if(u.name==f)return u}return null},n.prototype.findIkConstraint=function(f){if(null==f)throw Error("constraintName cannot be null.");
for(var q=this.ikConstraints,l=0,k=q.length;k>l;l++){var u=q[l];if(u.name==f)return u}return null},n.prototype.findTransformConstraint=function(f){if(null==f)throw Error("constraintName cannot be null.");for(var q=this.transformConstraints,l=0,k=q.length;k>l;l++){var u=q[l];if(u.name==f)return u}return null},n.prototype.findPathConstraint=function(f){if(null==f)throw Error("constraintName cannot be null.");for(var q=this.pathConstraints,l=0,k=q.length;k>l;l++){var u=q[l];if(u.name==f)return u}return null},
n.prototype.findPathConstraintIndex=function(f){if(null==f)throw Error("pathConstraintName cannot be null.");for(var q=this.pathConstraints,l=0,k=q.length;k>l;l++)if(q[l].name==f)return l;return-1},n}();c.SkeletonData=h}(spine||(spine={}));
!function(c){var h=function(){function f(q){this.scale=1;this.linkedMeshes=[];this.attachmentLoader=q}return f.prototype.readSkeletonData=function(q){var l=this.scale,k=new c.SkeletonData;q="string"==typeof q?JSON.parse(q):q;var u=q.skeleton;if(null!=u&&(k.hash=u.hash,k.version=u.spine,k.width=u.width,k.height=u.height,k.imagesPath=u.images),q.bones)for(u=0;u<q.bones.length;u++){var r=q.bones[u],z=null,C=this.getValue(r,"parent",null);if(null!=C&&(z=k.findBone(C),null==z))throw Error("Parent bone not found: "+
C);z=new c.BoneData(k.bones.length,r.name,z);z.length=this.getValue(r,"length",0)*l;z.x=this.getValue(r,"x",0)*l;z.y=this.getValue(r,"y",0)*l;z.rotation=this.getValue(r,"rotation",0);z.scaleX=this.getValue(r,"scaleX",1);z.scaleY=this.getValue(r,"scaleY",1);z.shearX=this.getValue(r,"shearX",0);z.shearY=this.getValue(r,"shearY",0);z.inheritRotation=this.getValue(r,"inheritRotation",!0);z.inheritScale=this.getValue(r,"inheritScale",!0);k.bones.push(z)}if(q.slots)for(u=0;u<q.slots.length;u++){r=q.slots[u];
var E=r.name;C=r.bone;z=k.findBone(C);if(null==z)throw Error("Slot bone not found: "+C);z=new c.SlotData(k.slots.length,E,z);C=this.getValue(r,"color",null);null!=C&&z.color.setFromString(C);z.attachmentName=this.getValue(r,"attachment",null);z.blendMode=f.blendModeFromString(this.getValue(r,"blend","normal"));k.slots.push(z)}if(q.ik)for(u=0;u<q.ik.length;u++){r=q.ik[u];z=new c.IkConstraintData(r.name);for(var A=0;A<r.bones.length;A++){C=r.bones[A];var H=k.findBone(C);if(null==H)throw Error("IK bone not found: "+
C);z.bones.push(H)}C=r.target;if(z.target=k.findBone(C),null==z.target)throw Error("IK target bone not found: "+C);z.bendDirection=this.getValue(r,"bendPositive",!0)?1:-1;z.mix=this.getValue(r,"mix",1);k.ikConstraints.push(z)}if(q.transform)for(u=0;u<q.transform.length;u++){r=q.transform[u];z=new c.TransformConstraintData(r.name);for(A=0;A<r.bones.length;A++){C=r.bones[A];H=k.findBone(C);if(null==H)throw Error("Transform constraint bone not found: "+C);z.bones.push(H)}C=r.target;if(z.target=k.findBone(C),
null==z.target)throw Error("Transform constraint target bone not found: "+C);z.offsetRotation=this.getValue(r,"rotation",0);z.offsetX=this.getValue(r,"x",0)*l;z.offsetY=this.getValue(r,"y",0)*l;z.offsetScaleX=this.getValue(r,"scaleX",0);z.offsetScaleY=this.getValue(r,"scaleY",0);z.offsetShearY=this.getValue(r,"shearY",0);z.rotateMix=this.getValue(r,"rotateMix",1);z.translateMix=this.getValue(r,"translateMix",1);z.scaleMix=this.getValue(r,"scaleMix",1);z.shearMix=this.getValue(r,"shearMix",1);k.transformConstraints.push(z)}if(q.path)for(u=
0;u<q.path.length;u++){r=q.path[u];z=new c.PathConstraintData(r.name);for(A=0;A<r.bones.length;A++){C=r.bones[A];H=k.findBone(C);if(null==H)throw Error("Transform constraint bone not found: "+C);z.bones.push(H)}C=r.target;if(z.target=k.findSlot(C),null==z.target)throw Error("Path target slot not found: "+C);z.positionMode=f.positionModeFromString(this.getValue(r,"positionMode","percent"));z.spacingMode=f.spacingModeFromString(this.getValue(r,"spacingMode","length"));z.rotateMode=f.rotateModeFromString(this.getValue(r,
"rotateMode","tangent"));z.offsetRotation=this.getValue(r,"rotation",0);z.position=this.getValue(r,"position",0);z.positionMode==c.PositionMode.Fixed&&(z.position*=l);z.spacing=this.getValue(r,"spacing",0);z.spacingMode!=c.SpacingMode.Length&&z.spacingMode!=c.SpacingMode.Fixed||(z.spacing*=l);z.rotateMix=this.getValue(r,"rotateMix",1);z.translateMix=this.getValue(r,"translateMix",1);k.pathConstraints.push(z)}if(q.skins)for(var J in q.skins){u=q.skins[J];l=new c.Skin(J);for(E in u){z=k.findSlotIndex(E);
if(-1==z)throw Error("Slot not found: "+E);r=u[E];for(var N in r)C=this.readAttachment(r[N],l,z,N),null!=C&&l.addAttachment(z,N,C)}k.skins.push(l);"default"==l.name&&(k.defaultSkin=l)}u=0;for(E=this.linkedMeshes.length;E>u;u++){J=this.linkedMeshes[u];l=null==J.skin?k.defaultSkin:k.findSkin(J.skin);if(null==l)throw Error("Skin not found: "+J.skin);N=l.getAttachment(J.slotIndex,J.parent);if(null==N)throw Error("Parent mesh not found: "+J.parent);J.mesh.setParentMesh(N);J.mesh.updateUVs()}if(this.linkedMeshes.length=
0,q.events)for(var U in q.events)E=q.events[U],z=new c.EventData(U),z.intValue=this.getValue(E,"int",0),z.floatValue=this.getValue(E,"float",0),z.stringValue=this.getValue(E,"string",null),k.events.push(z);if(q.animations)for(var p in q.animations)this.readAnimation(q.animations[p],p,k);return k},f.prototype.readAttachment=function(q,l,k,u){var r=this.scale;u=this.getValue(q,"name",u);switch(this.getValue(q,"type","region")){case "region":var z=this.getValue(q,"path",u);k=this.attachmentLoader.newRegionAttachment(l,
u,z);if(null==k)break;k.path=z;k.x=this.getValue(q,"x",0)*r;k.y=this.getValue(q,"y",0)*r;k.scaleX=this.getValue(q,"scaleX",1);k.scaleY=this.getValue(q,"scaleY",1);k.rotation=this.getValue(q,"rotation",0);k.width=q.width*r;k.height=q.height*r;r=this.getValue(q,"color",null);return null!=r&&k.color.setFromString(r),k.updateOffset(),k;case "boundingbox":z=this.attachmentLoader.newBoundingBoxAttachment(l,u);if(null==z)break;this.readVertices(q,z,q.vertexCount<<1);r=this.getValue(q,"color",null);return null!=
r&&z.color.setFromString(r),z;case "mesh":case "linkedmesh":z=this.getValue(q,"path",u);l=this.attachmentLoader.newMeshAttachment(l,u,z);if(null==l)break;l.path=z;r=this.getValue(q,"color",null);null!=r&&l.color.setFromString(r);z=this.getValue(q,"parent",null);if(null!=z)return l.inheritDeform=this.getValue(q,"deform",!0),this.linkedMeshes.push(new n(l,this.getValue(q,"skin",null),k,z)),l;z=q.uvs;return this.readVertices(q,l,z.length),l.triangles=q.triangles,l.regionUVs=z,l.updateUVs(),l.hullLength=
2*this.getValue(q,"hull",0),l;case "path":if(z=this.attachmentLoader.newPathAttachment(l,u),null!=z){z.closed=this.getValue(q,"closed",!1);z.constantSpeed=this.getValue(q,"constantSpeed",!0);k=q.vertexCount;this.readVertices(q,z,k<<1);k=c.Utils.newArray(k/3,0);for(l=0;l<q.lengths.length;l++)k[l++]=q.lengths[l]*r;z.lengths=k;r=this.getValue(q,"color",null);return null!=r&&z.color.setFromString(r),z}}return null},f.prototype.readVertices=function(q,l,k){var u=this.scale;l.worldVerticesLength=k;q=q.vertices;
if(k==q.length){if(1!=u){k=0;for(var r=q.length;r>k;k++)q[k]*=u}return void(l.vertices=c.Utils.toFloatArray(q))}var z=[],C=[];k=0;for(r=q.length;r>k;){var E=q[k++];C.push(E);for(E=k+4*E;E>k;k+=4)C.push(q[k]),z.push(q[k+1]*u),z.push(q[k+2]*u),z.push(q[k+3])}l.bones=C;l.vertices=c.Utils.toFloatArray(z)},f.prototype.readAnimation=function(q,l,k){var u=this.scale,r=[],z=0;if(q.slots)for(var C in q.slots){var E=q.slots[C],A=k.findSlotIndex(C);if(-1==A)throw Error("Slot not found: "+C);for(var H in E){var J=
E[H];if("color"==H){var N=new c.ColorTimeline(J.length);N.slotIndex=A;for(var U=0,p=0;p<J.length;p++){var x=J[p],G=new c.Color;G.setFromString(x.color);N.setFrame(U,x.time,G.r,G.g,G.b,G.a);this.readCurve(x,N,U);U++}r.push(N);z=Math.max(z,N.frames[(N.getFrameCount()-1)*c.ColorTimeline.ENTRIES])}else{H="attachment";N=new c.AttachmentTimeline(J.length);N.slotIndex=A;for(p=U=0;p<J.length;p++)x=J[p],N.setFrame(U++,x.time,x.name);r.push(N);z=Math.max(z,N.frames[N.getFrameCount()-1])}}}if(q.bones)for(var e in q.bones){E=
q.bones[e];G=k.findBoneIndex(e);if(-1==G)throw Error("Bone not found: "+e);for(H in E)if(J=E[H],"rotate"===H){N=new c.RotateTimeline(J.length);N.boneIndex=G;for(p=U=0;p<J.length;p++)x=J[p],N.setFrame(U,x.time,x.angle),this.readCurve(x,N,U),U++;r.push(N);z=Math.max(z,N.frames[(N.getFrameCount()-1)*c.RotateTimeline.ENTRIES])}else{if("translate"!==H&&"scale"!==H&&"shear"!==H)throw Error("Invalid timeline type for a bone: "+H+" ("+e+")");N=null;A=1;"scale"===H?N=new c.ScaleTimeline(J.length):"shear"===
H?N=new c.ShearTimeline(J.length):(N=new c.TranslateTimeline(J.length),A=u);N.boneIndex=G;for(p=U=0;p<J.length;p++){x=J[p];var m=this.getValue(x,"x",0),v=this.getValue(x,"y",0);N.setFrame(U,x.time,m*A,v*A);this.readCurve(x,N,U);U++}r.push(N);z=Math.max(z,N.frames[(N.getFrameCount()-1)*c.TranslateTimeline.ENTRIES])}}if(q.ik)for(var D in q.ik){E=q.ik[D];U=k.findIkConstraint(D);N=new c.IkConstraintTimeline(E.length);N.ikConstraintIndex=k.ikConstraints.indexOf(U);for(p=U=0;p<E.length;p++)x=E[p],N.setFrame(U,
x.time,this.getValue(x,"mix",1),this.getValue(x,"bendPositive",!0)?1:-1),this.readCurve(x,N,U),U++;r.push(N);z=Math.max(z,N.frames[(N.getFrameCount()-1)*c.IkConstraintTimeline.ENTRIES])}if(q.transform)for(D in q.transform){E=q.transform[D];U=k.findTransformConstraint(D);N=new c.TransformConstraintTimeline(E.length);N.transformConstraintIndex=k.transformConstraints.indexOf(U);for(p=U=0;p<E.length;p++)x=E[p],N.setFrame(U,x.time,this.getValue(x,"rotateMix",1),this.getValue(x,"translateMix",1),this.getValue(x,
"scaleMix",1),this.getValue(x,"shearMix",1)),this.readCurve(x,N,U),U++;r.push(N);z=Math.max(z,N.frames[(N.getFrameCount()-1)*c.TransformConstraintTimeline.ENTRIES])}if(q.paths)for(D in q.paths){E=q.paths[D];e=k.findPathConstraintIndex(D);if(-1==e)throw Error("Path constraint not found: "+D);G=k.pathConstraints[e];for(H in E)if(J=E[H],"position"===H||"spacing"===H){N=null;A=1;"spacing"===H?(N=new c.PathConstraintSpacingTimeline(J.length),(G.spacingMode==c.SpacingMode.Length||G.spacingMode==c.SpacingMode.Fixed)&&
(A=u)):(N=new c.PathConstraintPositionTimeline(J.length),G.positionMode==c.PositionMode.Fixed&&(A=u));N.pathConstraintIndex=e;for(p=U=0;p<J.length;p++)x=J[p],N.setFrame(U,x.time,this.getValue(x,H,0)*A),this.readCurve(x,N,U),U++;r.push(N);z=Math.max(z,N.frames[(N.getFrameCount()-1)*c.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===H){N=new c.PathConstraintMixTimeline(J.length);N.pathConstraintIndex=e;for(p=U=0;p<J.length;p++)x=J[p],N.setFrame(U,x.time,this.getValue(x,"rotateMix",1),this.getValue(x,
"translateMix",1)),this.readCurve(x,N,U),U++;r.push(N);z=Math.max(z,N.frames[(N.getFrameCount()-1)*c.PathConstraintMixTimeline.ENTRIES])}}if(q.deform)for(var B in q.deform){e=q.deform[B];G=k.findSkin(B);if(null==G)throw Error("Skin not found: "+B);for(C in e){E=e[C];A=k.findSlotIndex(C);if(-1==A)throw Error("Slot not found: "+E.name);for(H in E){J=E[H];U=G.getAttachment(A,H);if(null==U)throw Error("Deform attachment not found: "+J.name);m=null!=U.bones;v=U.vertices;var I=m?v.length/3*2:v.length;N=
new c.DeformTimeline(J.length);N.slotIndex=A;N.attachment=U;for(D=U=0;D<J.length;D++){x=J[D];var L=this.getValue(x,"vertices",null);if(null==L)var S=m?c.Utils.newFloatArray(I):v;else{S=c.Utils.newFloatArray(I);p=this.getValue(x,"offset",0);if(c.Utils.arrayCopy(L,0,S,p,L.length),1!=u)for(L=p+L.length;L>p;p++)S[p]*=u;if(!m)for(p=0;I>p;p++)S[p]+=v[p]}N.setFrame(U,x.time,S);this.readCurve(x,N,U);U++}r.push(N);z=Math.max(z,N.frames[N.getFrameCount()-1])}}}u=q.drawOrder;if(null==u&&(u=q.draworder),null!=
u){N=new c.DrawOrderTimeline(u.length);C=k.slots.length;for(D=U=0;D<u.length;D++){H=u[D];B=null;J=this.getValue(H,"offsets",null);if(null!=J){B=c.Utils.newArray(C,-1);x=c.Utils.newArray(C-J.length,0);for(p=e=E=0;p<J.length;p++){G=J[p];A=k.findSlotIndex(G.slot);if(-1==A)throw Error("Slot not found: "+G.slot);for(;E!=A;)x[e++]=E++;B[E+G.offset]=E++}for(;C>E;)x[e++]=E++;for(p=C-1;0<=p;p--)-1==B[p]&&(B[p]=x[--e])}N.setFrame(U++,H.time,B)}r.push(N);z=Math.max(z,N.frames[N.getFrameCount()-1])}if(q.events){N=
new c.EventTimeline(q.events.length);for(p=U=0;p<q.events.length;p++){u=q.events[p];C=k.findEvent(u.name);if(null==C)throw Error("Event not found: "+u.name);A=new c.Event(u.time,C);A.intValue=this.getValue(u,"int",C.intValue);A.floatValue=this.getValue(u,"float",C.floatValue);A.stringValue=this.getValue(u,"string",C.stringValue);N.setFrame(U++,A)}r.push(N);z=Math.max(z,N.frames[N.getFrameCount()-1])}if(isNaN(z))throw Error("Error while parsing animation, duration is NaN");k.animations.push(new c.Animation(l,
r,z))},f.prototype.readCurve=function(q,l,k){q.curve&&("stepped"===q.curve?l.setStepped(k):"[object Array]"===Object.prototype.toString.call(q.curve)&&(q=q.curve,l.setCurve(k,q[0],q[1],q[2],q[3])))},f.prototype.getValue=function(q,l,k){return void 0!==q[l]?q[l]:k},f.blendModeFromString=function(q){if(q=q.toLowerCase(),"normal"==q)return c.BlendMode.Normal;if("additive"==q)return c.BlendMode.Additive;if("multiply"==q)return c.BlendMode.Multiply;if("screen"==q)return c.BlendMode.Screen;throw Error("Unknown blend mode: "+
q);},f.positionModeFromString=function(q){if(q=q.toLowerCase(),"fixed"==q)return c.PositionMode.Fixed;if("percent"==q)return c.PositionMode.Percent;throw Error("Unknown position mode: "+q);},f.spacingModeFromString=function(q){if(q=q.toLowerCase(),"length"==q)return c.SpacingMode.Length;if("fixed"==q)return c.SpacingMode.Fixed;if("percent"==q)return c.SpacingMode.Percent;throw Error("Unknown position mode: "+q);},f.rotateModeFromString=function(q){if(q=q.toLowerCase(),"tangent"==q)return c.RotateMode.Tangent;
if("chain"==q)return c.RotateMode.Chain;if("chainscale"==q)return c.RotateMode.ChainScale;throw Error("Unknown rotate mode: "+q);},f}();c.SkeletonJson=h;var n=function(){return function(f,q,l,k){this.mesh=f;this.skin=q;this.slotIndex=l;this.parent=k}}()}(spine||(spine={}));
!function(c){var h=function(){function n(f){if(this.attachments=[],null==f)throw Error("name cannot be null.");this.name=f}return n.prototype.addAttachment=function(f,q,l){if(null==l)throw Error("attachment cannot be null.");var k=this.attachments;f>=k.length&&(k.length=f+1);k[f]||(k[f]={});k[f][q]=l},n.prototype.getAttachment=function(f,q){return(f=this.attachments[f])?f[q]:null},n.prototype.attachAll=function(f,q){for(var l=0,k=0;k<f.slots.length;k++){var u=f.slots[k],r=u.getAttachment();if(r&&
l<q.attachments.length){var z=q.attachments[l],C;for(C in z)if(r==z[C]){r=this.getAttachment(l,name);null!=r&&u.setAttachment(r);break}}l++}},n}();c.Skin=h}(spine||(spine={}));
!function(c){var h=function(){function n(f,q){if(this.attachmentVertices=[],null==f)throw Error("data cannot be null.");if(null==q)throw Error("bone cannot be null.");this.data=f;this.bone=q;this.color=new c.Color;this.setToSetupPose()}return n.prototype.getAttachment=function(){return this.attachment},n.prototype.setAttachment=function(f){this.attachment!=f&&(this.attachment=f,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)},n.prototype.setAttachmentTime=function(f){this.attachmentTime=
this.bone.skeleton.time-f},n.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},n.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color);null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},n}();c.Slot=h}(spine||(spine={}));
!function(c){var h=function(){return function(n,f,q){if(this.color=new c.Color(1,1,1,1),0>n)throw Error("index must be >= 0.");if(null==f)throw Error("name cannot be null.");if(null==q)throw Error("boneData cannot be null.");this.index=n;this.name=f;this.boneData=q}}();c.SlotData=h}(spine||(spine={}));
!function(c){var h=function(){function q(l){this._image=l}return q.prototype.getImage=function(){return this._image},q.filterFromString=function(l){switch(l.toLowerCase()){case "nearest":return n.Nearest;case "linear":return n.Linear;case "mipmap":return n.MipMap;case "mipmapnearestnearest":return n.MipMapNearestNearest;case "mipmaplinearnearest":return n.MipMapLinearNearest;case "mipmapnearestlinear":return n.MipMapNearestLinear;case "mipmaplinearlinear":return n.MipMapLinearLinear;default:throw Error("Unknown texture filter "+
l);}},q.wrapFromString=function(l){switch(l.toLowerCase()){case "mirroredtepeat":return f.MirroredRepeat;case "clamptoedge":return f.ClampToEdge;case "repeat":return f.Repeat;default:throw Error("Unknown texture wrap "+l);}},q}();c.Texture=h;(function(q){q[q.Nearest=9728]="Nearest";q[q.Linear=9729]="Linear";q[q.MipMap=9987]="MipMap";q[q.MipMapNearestNearest=9984]="MipMapNearestNearest";q[q.MipMapLinearNearest=9985]="MipMapLinearNearest";q[q.MipMapNearestLinear=9986]="MipMapNearestLinear";q[q.MipMapLinearLinear=
9987]="MipMapLinearLinear"})(c.TextureFilter||(c.TextureFilter={}));var n=c.TextureFilter;!function(q){q[q.MirroredRepeat=33648]="MirroredRepeat";q[q.ClampToEdge=33071]="ClampToEdge";q[q.Repeat=10497]="Repeat"}(c.TextureWrap||(c.TextureWrap={}));var f=c.TextureWrap;h=function(){return function(){this.height=this.width=this.v2=this.u2=this.v=this.u=0;this.rotate=!1;this.originalHeight=this.originalWidth=this.offsetY=this.offsetX=0}}();c.TextureRegion=h}(spine||(spine={}));
!function(c){var h=function(){function l(k,u){this.pages=[];this.regions=[];this.load(k,u)}return l.prototype.load=function(k,u){if(null==u)throw Error("textureLoader cannot be null.");k=new n(k);for(var r=Array(4),z=null;;){var C=k.readLine();if(null==C)break;if(C=C.trim(),0==C.length)z=null;else if(z){var E=new q;E.name=C;E.page=z;E.rotate="true"==k.readValue();k.readTuple(r);C=parseInt(r[0]);var A=parseInt(r[1]);k.readTuple(r);var H=parseInt(r[0]),J=parseInt(r[1]);E.u=C/z.width;E.v=A/z.height;
E.rotate?(E.u2=(C+J)/z.width,E.v2=(A+H)/z.height):(E.u2=(C+H)/z.width,E.v2=(A+J)/z.height);E.x=C;E.y=A;E.width=Math.abs(H);E.height=Math.abs(J);4==k.readTuple(r)&&4==k.readTuple(r)&&k.readTuple(r);E.originalWidth=parseInt(r[0]);E.originalHeight=parseInt(r[1]);k.readTuple(r);E.offsetX=parseInt(r[0]);E.offsetY=parseInt(r[1]);E.index=parseInt(k.readValue());E.texture=z.texture;this.regions.push(E)}else z=new f,z.name=C,2==k.readTuple(r)&&(z.width=parseInt(r[0]),z.height=parseInt(r[1]),k.readTuple(r)),
k.readTuple(r),z.minFilter=c.Texture.filterFromString(r[0]),z.magFilter=c.Texture.filterFromString(r[1]),E=k.readValue(),z.uWrap=c.TextureWrap.ClampToEdge,z.vWrap=c.TextureWrap.ClampToEdge,"x"==E?z.uWrap=c.TextureWrap.Repeat:"y"==E?z.vWrap=c.TextureWrap.Repeat:"xy"==E&&(z.uWrap=z.vWrap=c.TextureWrap.Repeat),z.texture=u(C),z.texture.setFilters(z.minFilter,z.magFilter),z.texture.setWraps(z.uWrap,z.vWrap),z.width=z.texture.getImage().width,z.height=z.texture.getImage().height,this.pages.push(z)}},l.prototype.findRegion=
function(k){for(var u=0;u<this.regions.length;u++)if(this.regions[u].name==k)return this.regions[u];return null},l.prototype.dispose=function(){for(var k=0;k<this.pages.length;k++)this.pages[k].texture.dispose()},l}();c.TextureAtlas=h;var n=function(){function l(k){this.index=0;this.lines=k.split(/\r\n|\r|\n/)}return l.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},l.prototype.readValue=function(){var k=this.readLine(),u=k.indexOf(":");if(-1==u)throw Error("Invalid line: "+
k);return k.substring(u+1).trim()},l.prototype.readTuple=function(k){var u=this.readLine(),r=u.indexOf(":");if(-1==r)throw Error("Invalid line: "+u);var z=0;for(r+=1;3>z;z++){var C=u.indexOf(",",r);if(-1==C)break;k[z]=u.substr(r,C-r).trim();r=C+1}return k[z]=u.substring(r).trim(),z+1},l}(),f=function(){return function(){}}();c.TextureAtlasPage=f;var q=function(l){function k(){l.apply(this,arguments)}return __extends(k,l),k}(c.TextureRegion);c.TextureAtlasRegion=q}(spine||(spine={}));
!function(c){var h=function(){function n(f){this.atlas=f}return n.prototype.newRegionAttachment=function(f,q,l){f=this.atlas.findRegion(l);if(null==f)throw Error("Region not found in atlas: "+l+" (region attachment: "+q+")");f.renderObject=f;q=new c.RegionAttachment(q);return q.setRegion(f),q.region=f,q},n.prototype.newMeshAttachment=function(f,q,l){f=this.atlas.findRegion(l);if(null==f)throw Error("Region not found in atlas: "+l+" (mesh attachment: "+q+")");f.renderObject=f;q=new c.MeshAttachment(q);
return q.region=f,q},n.prototype.newBoundingBoxAttachment=function(f,q){return new c.BoundingBoxAttachment(q)},n.prototype.newPathAttachment=function(f,q){return new c.PathAttachment(q)},n}();c.TextureAtlasAttachmentLoader=h}(spine||(spine={}));
!function(c){var h=function(){function n(f,q){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new c.Vector2,null==f)throw Error("data cannot be null.");if(null==q)throw Error("skeleton cannot be null.");this.data=f;this.rotateMix=f.rotateMix;this.translateMix=f.translateMix;this.scaleMix=f.scaleMix;this.shearMix=f.shearMix;this.bones=[];for(var l=0;l<f.bones.length;l++)this.bones.push(q.findBone(f.bones[l].name));this.target=q.findBone(f.target.name)}return n.prototype.apply=
function(){this.update()},n.prototype.update=function(){for(var f=this.rotateMix,q=this.translateMix,l=this.scaleMix,k=this.shearMix,u=this.target,r=u.a,z=u.b,C=u.c,E=u.d,A=this.bones,H=0,J=A.length;J>H;H++){var N=A[H];if(0<f){var U=N.a,p=N.b,x=N.c,G=N.d,e=Math.atan2(C,r)-Math.atan2(x,U)+this.data.offsetRotation*c.MathUtils.degRad;e>c.MathUtils.PI?e-=c.MathUtils.PI2:e<-c.MathUtils.PI&&(e+=c.MathUtils.PI2);e*=f;var m=Math.cos(e);e=Math.sin(e);N.a=m*U-e*x;N.b=m*p-e*G;N.c=e*U+m*x;N.d=e*p+m*G}0<q&&(p=
this.temp,u.localToWorld(p.set(this.data.offsetX,this.data.offsetY)),N.worldX+=(p.x-N.worldX)*q,N.worldY+=(p.y-N.worldY)*q);0<l&&(p=Math.sqrt(N.a*N.a+N.c*N.c),G=Math.sqrt(r*r+C*C),p=1E-5<p?(p+(G-p+this.data.offsetScaleX)*l)/p:0,N.a*=p,N.c*=p,p=Math.sqrt(N.b*N.b+N.d*N.d),G=Math.sqrt(z*z+E*E),p=1E-5<p?(p+(G-p+this.data.offsetScaleY)*l)/p:0,N.b*=p,N.d*=p);0<k&&(p=N.b,G=N.d,U=Math.atan2(G,p),e=Math.atan2(E,z)-Math.atan2(C,r)-(U-Math.atan2(N.c,N.a)),e>c.MathUtils.PI?e-=c.MathUtils.PI2:e<-c.MathUtils.PI&&
(e+=c.MathUtils.PI2),e=U+(e+this.data.offsetShearY*c.MathUtils.degRad)*k,p=Math.sqrt(p*p+G*G),N.b=Math.cos(e)*p,N.d=Math.sin(e)*p)}},n}();c.TransformConstraint=h}(spine||(spine={}));
!function(c){var h=function(){return function(n){if(this.bones=[],this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,null==n)throw Error("name cannot be null.");this.name=n}}();c.TransformConstraintData=h}(spine||(spine={}));
!function(c){var h=function(){function n(f,q,l,k){void 0===f&&(f=0);void 0===q&&(q=0);void 0===l&&(l=0);void 0===k&&(k=0);this.r=f;this.g=q;this.b=l;this.a=k}return n.prototype.set=function(f,q,l,k){this.r=f;this.g=q;this.b=l;this.a=k;this.clamp()},n.prototype.setFromColor=function(f){this.r=f.r;this.g=f.g;this.b=f.b;this.a=f.a},n.prototype.setFromString=function(f){f="#"==f.charAt(0)?f.substr(1):f;this.r=parseInt(f.substr(0,2),16)/255;this.g=parseInt(f.substr(2,2),16)/255;this.b=parseInt(f.substr(4,
2),16)/255;this.a=(8!=f.length?255:parseInt(f.substr(6,2),16))/255},n.prototype.add=function(f,q,l,k){this.r+=f;this.g+=q;this.b+=l;this.a+=k;this.clamp()},n.prototype.clamp=function(){return 0>this.r?this.r=0:1<this.r&&(this.r=1),0>this.g?this.g=0:1<this.g&&(this.g=1),0>this.b?this.b=0:1<this.b&&(this.b=1),0>this.a?this.a=0:1<this.a&&(this.a=1),this},n.WHITE=new n(1,1,1,1),n.RED=new n(1,0,0,1),n.GREEN=new n(0,1,0,1),n.BLUE=new n(0,0,1,1),n.MAGENTA=new n(1,0,1,1),n}();c.Color=h;h=function(){function n(){}
return n.clamp=function(f,q,l){return q>f?q:f>l?l:f},n.cosDeg=function(f){return Math.cos(f*n.degRad)},n.sinDeg=function(f){return Math.sin(f*n.degRad)},n.signum=function(f){return 0<=f?1:-1},n.toInt=function(f){return 0<f?Math.floor(f):Math.ceil(f)},n.cbrt=function(f){var q=Math.pow(Math.abs(f),1/3);return 0>f?-q:q},n.PI=3.1415927,n.PI2=2*n.PI,n.radiansToDegrees=180/n.PI,n.radDeg=n.radiansToDegrees,n.degreesToRadians=n.PI/180,n.degRad=n.degreesToRadians,n}();c.MathUtils=h;h=function(){function n(){}
return n.arrayCopy=function(f,q,l,k,u){for(var r=q;q+u>r;r++,k++)l[k]=f[r]},n.setArraySize=function(f,q,l){void 0===l&&(l=0);var k=f.length;if(k==q)return f;if(f.length=q,q>k)for(;q>k;k++)f[k]=l;return f},n.newArray=function(f,q){for(var l=Array(f),k=0;f>k;k++)l[k]=q;return l},n.newFloatArray=function(f){if(n.SUPPORTS_TYPED_ARRAYS)return new Float32Array(f);f=Array(f);for(var q=0;q<f.length;q++)f[q]=0;return f},n.toFloatArray=function(f){return n.SUPPORTS_TYPED_ARRAYS?new Float32Array(f):f},n.SUPPORTS_TYPED_ARRAYS=
"undefined"!=typeof Float32Array,n}();c.Utils=h;h=function(){function n(){}return n.logBones=function(f){for(var q=0;q<f.bones.length;q++){var l=f.bones[q];console.log(l.data.name+", "+l.a+", "+l.b+", "+l.c+", "+l.d+", "+l.worldX+", "+l.worldY)}},n}();c.DebugUtils=h;h=function(){function n(f){this.items=[];this.instantiator=f}return n.prototype.obtain=function(){return 0<this.items.length?this.items.pop():this.instantiator()},n.prototype.free=function(f){this.items.push(f)},n.prototype.freeAll=function(f){for(var q=
0;q<f.length;q++)this.items[q]=f[q]},n.prototype.clear=function(){this.items.length=0},n}();c.Pool=h;h=function(){function n(f,q){void 0===f&&(f=0);void 0===q&&(q=0);this.x=f;this.y=q}return n.prototype.set=function(f,q){return this.x=f,this.y=q,this},n.prototype.length=function(){var f=this.x,q=this.y;return Math.sqrt(f*f+q*q)},n.prototype.normalize=function(){var f=this.length();return 0!=f&&(this.x/=f,this.y/=f),this},n}();c.Vector2=h;h=function(){function n(){this.maxDelta=.064;this.totalTime=
this.delta=this.framesPerSecond=0;this.lastTime=Date.now()/1E3;this.frameTime=this.frameCount=0}return n.prototype.update=function(){var f=Date.now()/1E3;this.delta=f-this.lastTime;this.frameTime+=this.delta;this.totalTime+=this.delta;this.delta>this.maxDelta&&(this.delta=this.maxDelta);this.lastTime=f;this.frameCount++;1<this.frameTime&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},n}();c.TimeKeeper=h}(spine||(spine={}));
!function(c){var h=function(){return function(n){if(null==n)throw Error("name cannot be null.");this.name=n}}();c.Attachment=h;h=function(n){function f(q){n.call(this,q);this.worldVerticesLength=0}return __extends(f,n),f.prototype.computeWorldVertices=function(q,l){this.computeWorldVerticesWith(q,0,this.worldVerticesLength,l,0)},f.prototype.computeWorldVerticesWith=function(q,l,k,u,r){k+=r;var z=q.bone.skeleton,C=z.x,E=z.y,A=q.attachmentVertices,H=this.vertices,J=this.bones;if(null!=J){for(var N=
q=0,U=0;l>U;U+=2){var p=J[q];q+=p+1;N+=p}var x=z.bones;if(0==A.length)for(z=3*N;k>r;r+=2){var G=C,e=E;p=J[q++];for(p+=q;p>q;q++,z+=3){N=x[J[q]];l=H[z];U=H[z+1];var m=H[z+2];G+=(l*N.a+U*N.b+N.worldX)*m;e+=(l*N.c+U*N.d+N.worldY)*m}u[r]=G;u[r+1]=e}else{z=3*N;for(var v=N<<1;k>r;r+=2){G=C;e=E;p=J[q++];for(p+=q;p>q;q++,z+=3,v+=2)N=x[J[q]],l=H[z]+A[v],U=H[z+1]+A[v+1],m=H[z+2],G+=(l*N.a+U*N.b+N.worldX)*m,e+=(l*N.c+U*N.d+N.worldY)*m;u[r]=G;u[r+1]=e}}}else for(0<A.length&&(H=A),N=q.bone,C+=N.worldX,E+=N.worldY,
A=N.a,z=N.b,J=N.c,q=N.d,p=l;k>r;p+=2,r+=2)l=H[p],U=H[p+1],u[r]=l*A+U*z+C,u[r+1]=l*J+U*q+E},f.prototype.applyDeform=function(q){return this==q},f}(h);c.VertexAttachment=h}(spine||(spine={}));!function(c){var h=c.AttachmentType||(c.AttachmentType={});h[h.Region=0]="Region";h[h.BoundingBox=1]="BoundingBox";h[h.Mesh=2]="Mesh";h[h.LinkedMesh=3]="LinkedMesh";h[h.Path=4]="Path";!0;c.AttachmentType}(spine||(spine={}));
!function(c){var h=function(n){function f(q){n.call(this,q);this.color=new c.Color(1,1,1,1)}return __extends(f,n),f}(c.VertexAttachment);c.BoundingBoxAttachment=h}(spine||(spine={}));
!function(c){var h=function(n){function f(q){n.call(this,q);this.color=new c.Color(1,1,1,1);this.inheritDeform=!1;this.tempColor=new c.Color(0,0,0,0)}return __extends(f,n),f.prototype.updateUVs=function(){var q=this.regionUVs,l=q.length,k=8*(l>>1);null!=this.worldVertices&&this.worldVertices.length==k||(this.worldVertices=c.Utils.newFloatArray(k));var u=k=0,r=0,z=0;if(null==this.region?(k=u=0,r=z=1):(k=this.region.u,u=this.region.v,r=this.region.u2-k,z=this.region.v2-u),this.region.rotate)for(var C=
0,E=6;l>C;C+=2,E+=8)this.worldVertices[E]=k+q[C+1]*r,this.worldVertices[E+1]=u+z-q[C]*z;else for(C=0,E=6;l>C;C+=2,E+=8)this.worldVertices[E]=k+q[C]*r,this.worldVertices[E+1]=u+q[C+1]*z},f.prototype.updateWorldVertices=function(q,l){var k=q.bone.skeleton,u=k.color,r=q.color,z=this.color,C=u.a*r.a*z.a,E=l?C:1;l=this.tempColor;l.set(u.r*r.r*z.r*E,u.g*r.g*z.g*E,u.b*r.b*z.b*E,C);u=k.x;r=k.y;var A=q.attachmentVertices;z=this.vertices;C=this.worldVertices;var H=this.bones;if(null==H){H=z.length;0<A.length&&
(z=A);var J=q.bone;u+=J.worldX;r+=J.worldY;A=J.a;q=J.b;var N=J.c;J=J.d;for(E=k=0;H>k;k+=2,E+=8){var U=z[k],p=z[k+1];C[E]=U*A+p*q+u;C[E+1]=U*N+p*J+r;C[E+2]=l.r;C[E+3]=l.g;C[E+4]=l.b;C[E+5]=l.a}return C}N=k.bones;if(0==A.length){q=k=E=0;for(var x=H.length;x>k;E+=8){for(var G=u,e=r,m=H[k++]+k;m>k;k++,q+=3){J=N[H[k]];U=z[q];p=z[q+1];var v=z[q+2];G+=(U*J.a+p*J.b+J.worldX)*v;e+=(U*J.c+p*J.d+J.worldY)*v}C[E]=G;C[E+1]=e;C[E+2]=l.r;C[E+3]=l.g;C[E+4]=l.b;C[E+5]=l.a}}else{var D=q=k=E=0;for(x=H.length;x>k;E+=
8){G=u;e=r;for(m=H[k++]+k;m>k;k++,q+=3,D+=2)J=N[H[k]],U=z[q]+A[D],p=z[q+1]+A[D+1],v=z[q+2],G+=(U*J.a+p*J.b+J.worldX)*v,e+=(U*J.c+p*J.d+J.worldY)*v;C[E]=G;C[E+1]=e;C[E+2]=l.r;C[E+3]=l.g;C[E+4]=l.b;C[E+5]=l.a}}return C},f.prototype.applyDeform=function(q){return this==q||this.inheritDeform&&this.parentMesh==q},f.prototype.getParentMesh=function(){return this.parentMesh},f.prototype.setParentMesh=function(q){this.parentMesh=q;null!=q&&(this.bones=q.bones,this.vertices=q.vertices,this.regionUVs=q.regionUVs,
this.triangles=q.triangles,this.hullLength=q.hullLength)},f}(c.VertexAttachment);c.MeshAttachment=h}(spine||(spine={}));!function(c){var h=function(n){function f(q){n.call(this,q);this.constantSpeed=this.closed=!1;this.color=new c.Color(1,1,1,1)}return __extends(f,n),f}(c.VertexAttachment);c.PathAttachment=h}(spine||(spine={}));
!function(c){var h=function(n){function f(q){n.call(this,q);this.y=this.x=0;this.scaleY=this.scaleX=1;this.height=this.width=this.rotation=0;this.color=new c.Color(1,1,1,1);this.offset=c.Utils.newFloatArray(8);this.vertices=c.Utils.newFloatArray(32);this.tempColor=new c.Color(1,1,1,1)}return __extends(f,n),f.prototype.setRegion=function(q){var l=this.vertices;q.rotate?(l[f.U2]=q.u,l[f.V2]=q.v2,l[f.U3]=q.u,l[f.V3]=q.v,l[f.U4]=q.u2,l[f.V4]=q.v,l[f.U1]=q.u2,l[f.V1]=q.v2):(l[f.U1]=q.u,l[f.V1]=q.v2,l[f.U2]=
q.u,l[f.V2]=q.v,l[f.U3]=q.u2,l[f.V3]=q.v,l[f.U4]=q.u2,l[f.V4]=q.v2)},f.prototype.updateOffset=function(){var q=this.width/this.region.originalWidth*this.scaleX,l=this.height/this.region.originalHeight*this.scaleY,k=-this.width/2*this.scaleX+this.region.offsetX*q,u=-this.height/2*this.scaleY+this.region.offsetY*l,r=k+this.region.width*q;q=u+this.region.height*l;l=this.rotation*Math.PI/180;var z=Math.cos(l),C=Math.sin(l);l=k*z+this.x;k*=C;var E=u*z+this.y;u*=C;var A=r*z+this.x;r*=C;z=q*z+this.y;q*=
C;C=this.offset;C[f.OX1]=l-u;C[f.OY1]=E+k;C[f.OX2]=l-q;C[f.OY2]=z+k;C[f.OX3]=A-q;C[f.OY3]=z+r;C[f.OX4]=A-u;C[f.OY4]=E+r},f.prototype.updateWorldVertices=function(q,l){var k=q.bone.skeleton,u=k.color,r=q.color,z=this.color,C=u.a*r.a*z.a,E=l?C:1;l=this.tempColor;l.set(u.r*r.r*z.r*E,u.g*r.g*z.g*E,u.b*r.b*z.b*E,C);u=this.vertices;r=this.offset;var A=q.bone;q=k.x+A.worldX;k=k.y+A.worldY;z=A.a;C=A.b;E=A.c;A=A.d;var H=0,J=0;return H=r[f.OX1],J=r[f.OY1],u[f.X1]=H*z+J*C+q,u[f.Y1]=H*E+J*A+k,u[f.C1R]=l.r,u[f.C1G]=
l.g,u[f.C1B]=l.b,u[f.C1A]=l.a,H=r[f.OX2],J=r[f.OY2],u[f.X2]=H*z+J*C+q,u[f.Y2]=H*E+J*A+k,u[f.C2R]=l.r,u[f.C2G]=l.g,u[f.C2B]=l.b,u[f.C2A]=l.a,H=r[f.OX3],J=r[f.OY3],u[f.X3]=H*z+J*C+q,u[f.Y3]=H*E+J*A+k,u[f.C3R]=l.r,u[f.C3G]=l.g,u[f.C3B]=l.b,u[f.C3A]=l.a,H=r[f.OX4],J=r[f.OY4],u[f.X4]=H*z+J*C+q,u[f.Y4]=H*E+J*A+k,u[f.C4R]=l.r,u[f.C4G]=l.g,u[f.C4B]=l.b,u[f.C4A]=l.a,u},f.OX1=0,f.OY1=1,f.OX2=2,f.OY2=3,f.OX3=4,f.OY3=5,f.OX4=6,f.OY4=7,f.X1=0,f.Y1=1,f.C1R=2,f.C1G=3,f.C1B=4,f.C1A=5,f.U1=6,f.V1=7,f.X2=8,f.Y2=9,
f.C2R=10,f.C2G=11,f.C2B=12,f.C2A=13,f.U2=14,f.V2=15,f.X3=16,f.Y3=17,f.C3R=18,f.C3G=19,f.C3B=20,f.C3A=21,f.U3=22,f.V3=23,f.X4=24,f.Y4=25,f.C4R=26,f.C4G=27,f.C4B=28,f.C4A=29,f.U4=30,f.V4=31,f}(c.Attachment);c.RegionAttachment=h}(spine||(spine={}));!function(c){!function(h){var n=function(f){function q(l){void 0===l&&(l="");f.call(this,function(k){return new h.ThreeJsTexture(k)},l)}return __extends(q,f),q}(c.AssetManager);h.AssetManager=n}(c.threejs||(c.threejs={}))}(spine||(spine={}));
!function(c){!function(h){var n=function(){function f(q,l){if(void 0===l&&(l=10920),this.verticesLength=0,this.indicesLength=0,10920<l)throw Error("Can't have more than 10920 triangles per batch: "+l);var k=this.vertices=new Float32Array(l*f.VERTEX_SIZE);l=this.indices=new Uint16Array(3*l);this.mesh=q;var u=new THREE.BufferGeometry;k=this.vertexBuffer=new THREE.InterleavedBuffer(k,f.VERTEX_SIZE);k.dynamic=!0;u.addAttribute("position",new THREE.InterleavedBufferAttribute(k,3,0,!1));u.addAttribute("color",
new THREE.InterleavedBufferAttribute(k,4,3,!1));u.addAttribute("uv",new THREE.InterleavedBufferAttribute(k,2,7,!1));u.setIndex(new THREE.BufferAttribute(l,1));u.getIndex().dynamic=!0;u.drawRange.start=0;u.drawRange.count=0;q.geometry=u}return f.prototype.begin=function(){this.indicesLength=this.verticesLength=0},f.prototype.batch=function(q,l,k){void 0===k&&(k=0);for(var u=this.verticesLength/f.VERTEX_SIZE,r=this.vertices,z=this.verticesLength,C=0;C<q.length;)r[z++]=q[C++],r[z++]=q[C++],r[z++]=k,
r[z++]=q[C++],r[z++]=q[C++],r[z++]=q[C++],r[z++]=q[C++],r[z++]=q[C++],r[z++]=q[C++];this.verticesLength=z;q=this.indices;z=this.indicesLength;for(C=0;C<l.length;z++,C++)q[z]=l[C]+u;this.indicesLength+=l.length},f.prototype.end=function(){this.vertexBuffer.needsUpdate=!0;this.vertexBuffer.updateRange.offset=0;this.vertexBuffer.updateRange.count=this.verticesLength;var q=this.mesh.geometry;q.getIndex().needsUpdate=!0;q.getIndex().updateRange.offset=0;q.getIndex().updateRange.count=this.indicesLength;
q.drawRange.start=0;q.drawRange.count=this.indicesLength},f.VERTEX_SIZE=9,f}();h.MeshBatcher=n}(c.threejs||(c.threejs={}))}(spine||(spine={}));
!function(c){!function(h){var n=function(f){function q(l){f.call(this);this.zOffset=.1;this.skeleton=new c.Skeleton(l);l=new c.AnimationStateData(l);this.state=new c.AnimationState(l);l=this.material=new THREE.MeshBasicMaterial;l.side=THREE.DoubleSide;l.transparent=!0;l.alphaTest=.5;this.batcher=new h.MeshBatcher(this)}return __extends(q,f),q.prototype.update=function(l){var k=this.state,u=this.skeleton;k.update(l);k.apply(u);u.updateWorldTransform();this.updateGeometry()},q.prototype.updateGeometry=
function(){this.geometry;var l=this.skeleton.drawOrder,k=this.batcher;k.begin();for(var u=0,r=this.zOffset,z=0,C=l.length;C>z;z++){var E=l[z];var A=E.getAttachment();if(A instanceof c.RegionAttachment){var H=A;E=H.updateWorldVertices(E,!1);A=q.QUAD_TRIANGLES;H=H.region.renderObject.texture}else{if(!(A instanceof c.MeshAttachment))continue;H=A;E=H.updateWorldVertices(E,!1);A=H.triangles;H=H.region.renderObject.texture}if(null!=H){if(!this.material.map){var J=this.material;J.map=H.texture;J.needsUpdate=
!0}this.batcher.batch(E,A,u);u+=r}}k.end()},q.createMesh=function(l){var k=new THREE.BufferGeometry,u=new Float32Array(1024);u.set([-200,-200,1,0,0,1,0,0,200,-200,0,1,0,1,1,0,200,200,0,0,1,1,1,1,-200,200,1,1,0,.1,0,1],0);u=new THREE.InterleavedBuffer(u,8);var r=new THREE.InterleavedBufferAttribute(u,2,0,!1);k.addAttribute("position",r);r=new THREE.InterleavedBufferAttribute(u,4,2,!1);k.addAttribute("color",r);new THREE.InterleavedBufferAttribute(u,2,6,!1);k.addAttribute("uv",r);u=new Uint16Array(1024);
u.set([0,1,2,2,3,0],0);k.setIndex(new THREE.BufferAttribute(u,1));k.drawRange.start=0;k.drawRange.count=6;u=new THREE.MeshBasicMaterial;u.vertexColors=THREE.VertexColors;u.transparent=!0;u.map=l;return new THREE.Mesh(k,u)},q.QUAD_TRIANGLES=[0,1,2,2,3,0],q}(THREE.Mesh);h.SkeletonMesh=n}(c.threejs||(c.threejs={}))}(spine||(spine={}));
!function(c){!function(h){var n=function(f){function q(l){f.call(this,l);this.texture=new THREE.Texture(l);this.texture.flipY=!1;this.texture.needsUpdate=!0}return __extends(q,f),q.prototype.setFilters=function(l,k){this.texture.minFilter=q.toThreeJsTextureFilter(l);this.texture.magFilter=q.toThreeJsTextureFilter(k)},q.prototype.setWraps=function(l,k){this.texture.wrapS=q.toThreeJsTextureWrap(l);this.texture.wrapT=q.toThreeJsTextureWrap(k)},q.prototype.dispose=function(){this.texture.dispose()},q.toThreeJsTextureFilter=
function(l){if(l===c.TextureFilter.Linear)return THREE.LinearFilter;if(l===c.TextureFilter.MipMap||l===c.TextureFilter.MipMapLinearLinear)return THREE.LinearMipMapLinearFilter;if(l===c.TextureFilter.MipMapLinearNearest)return THREE.LinearMipMapNearestFilter;if(l===c.TextureFilter.MipMapNearestLinear)return THREE.NearestMipMapLinearFilter;if(l===c.TextureFilter.MipMapNearestNearest)return THREE.NearestMipMapNearestFilter;if(l===c.TextureFilter.Nearest)return THREE.NearestFilter;throw Error("Unknown texture filter: "+
l);},q.toThreeJsTextureWrap=function(l){if(l===c.TextureWrap.ClampToEdge)return THREE.ClampToEdgeWrapping;if(l===c.TextureWrap.MirroredRepeat)return THREE.MirroredRepeatWrapping;if(l===c.TextureWrap.Repeat)return THREE.RepeatWrapping;throw Error("Unknown texture wrap: "+l);},q}(c.Texture);h.ThreeJsTexture=n}(c.threejs||(c.threejs={}))}(spine||(spine={}));
(function(c){function h(e){A.debug&&console.log("Graph created");this.list_of_graphcanvas=null;this.clear();e&&this.configure(e)}function n(e,m,v,D,B,I){this.id=e;this.type=m;this.origin_id=v;this.origin_slot=D;this.target_id=B;this.target_slot=I;this._data=null;this._pos=new Float32Array(2)}function f(e){this._ctor(e)}function q(e){this._ctor(e)}function l(e,m){this.offset=new Float32Array([0,0]);this.scale=1;this.max_scale=10;this.min_scale=.1;this.onredraw=null;this.enabled=!0;this.last_mouse=
[0,0];this.element=null;this.visible_area=new Float32Array(4);e&&(this.element=e,m||this.bindEvents(e))}function k(e,m,v){v=v||{};this.background_image=k.DEFAULT_BACKGROUND_IMAGE;e&&e.constructor===String&&(e=document.querySelector(e));this.ds=new l;this.zoom_modify_alpha=!0;this.title_text_font=""+A.NODE_TEXT_SIZE+"px Arial";this.inner_text_font="normal "+A.NODE_SUBTEXT_SIZE+"px Arial";this.node_title_color=A.NODE_TITLE_COLOR;this.default_link_color=A.LINK_COLOR;this.default_connection_color={input_off:"#778",
input_on:"#7F7",output_off:"#778",output_on:"#7F7"};this.highquality_render=!0;this.use_gradients=!1;this.editor_alpha=1;this.pause_rendering=!1;this.clear_background=!0;this.read_only=!1;this.render_only_selected=!0;this.live_mode=!1;this.allow_searchbox=this.allow_interaction=this.allow_dragnodes=this.allow_dragcanvas=this.show_info=!0;this.drag_mode=this.allow_reconnect_links=!1;this.filter=this.dragging_rectangle=null;this.set_canvas_dirty_on_mouse_event=!0;this.always_render_background=!1;this.render_canvas_border=
this.render_shadows=!0;this.render_connections_shadows=!1;this.render_connections_border=!0;this.render_connection_arrows=this.render_curved_connections=!1;this.render_collapsed_slots=!0;this.render_execution_order=!1;this.render_link_tooltip=this.render_title_colored=!0;this.links_render_mode=A.SPLINE_LINK;this.mouse=[0,0];this.canvas_mouse=this.graph_mouse=[0,0];this.onAfterChange=this.onBeforeChange=this.onConnectingChange=this.onSelectionChange=this.onNodeMoved=this.onDrawLinkTooltip=this.onDrawOverlay=
this.onDrawForeground=this.onDrawBackground=this.onMouse=this.onSearchBoxSelection=this.onSearchBox=null;this.connections_width=3;this.round_radius=8;this.over_link_center=this.node_widget=this.current_node=null;this.last_mouse_position=[0,0];this.visible_area=this.ds.visible_area;this.visible_links=[];m&&m.attachCanvas(this);this.setCanvas(e);this.clear();v.skip_render||this.startRendering();this.autoresize=v.autoresize}function u(e,m){return Math.sqrt((m[0]-e[0])*(m[0]-e[0])+(m[1]-e[1])*(m[1]-e[1]))}
function r(e,m,v,D,B,I){return v<e&&v+B>e&&D<m&&D+I>m?!0:!1}function z(e,m){var v=e[0]+e[2],D=e[1]+e[3],B=m[1]+m[3];return e[0]>m[0]+m[2]||e[1]>B||v<m[0]||D<m[1]?!1:!0}function C(e,m){function v(R){var W=parseInt(I.style.top);I.style.top=(W+R.deltaY*m.scroll_speed).toFixed()+"px";R.preventDefault();return!0}this.options=m=m||{};var D=this;m.parentMenu&&(m.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),m.parentMenu=null):(this.parentMenu=
m.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this));var B=null;m.event&&(B=m.event.constructor.name);"MouseEvent"!==B&&"CustomEvent"!==B&&"PointerEvent"!==B&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it."),m.event=null);var I=document.createElement("div");I.className="litegraph litecontextmenu litemenubar-panel";m.className&&(I.className+=" "+m.className);I.style.minWidth=100;I.style.minHeight=100;I.style.pointerEvents="none";
setTimeout(function(){I.style.pointerEvents="auto"},100);I.addEventListener("mouseup",function(R){R.preventDefault();return!0},!0);I.addEventListener("contextmenu",function(R){if(2!=R.button)return!1;R.preventDefault();return!1},!0);I.addEventListener("mousedown",function(R){if(2==R.button)return D.close(),R.preventDefault(),!0},!0);m.scroll_speed||(m.scroll_speed=.1);I.addEventListener("wheel",v,!0);I.addEventListener("mousewheel",v,!0);this.root=I;m.title&&(B=document.createElement("div"),B.className=
"litemenu-title",B.innerHTML=m.title,I.appendChild(B));for(var L=B=0;L<e.length;L++){var S=e.constructor==Array?e[L]:L;null!=S&&S.constructor!==String&&(S=void 0===S.content?String(S):S.content);this.addItem(S,e[L],m);B++}I.addEventListener("mouseleave",function(R){D.lock||(I.closing_timer&&clearTimeout(I.closing_timer),I.closing_timer=setTimeout(D.close.bind(D,R),500))});I.addEventListener("mouseenter",function(R){I.closing_timer&&clearTimeout(I.closing_timer)});e=document;m.event&&(e=m.event.target.ownerDocument);
e||(e=document);e.fullscreenElement?e.fullscreenElement.appendChild(I):e.body.appendChild(I);B=m.left||0;e=m.top||0;m.event&&(B=m.event.clientX-10,e=m.event.clientY-10,m.title&&(e-=20),m.parentMenu&&(B=m.parentMenu.root.getBoundingClientRect(),B=B.left+B.width),L=document.body.getBoundingClientRect(),S=I.getBoundingClientRect(),0==L.height&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),L.width&&B>L.width-S.width-10&&(B=L.width-S.width-10),L.height&&
e>L.height-S.height-10&&(e=L.height-S.height-10));I.style.left=B+"px";I.style.top=e+"px";m.scale&&(I.style.transform="scale("+m.scale+")")}function E(e){this.points=e;this.nearest=this.selected=-1;this.size=null;this.must_update=!0;this.margin=5}var A=c.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_TEXT_SIZE:14,
NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1E3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,
ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},Globals:{},searchbox_extras:{},registerNodeType:function(e,m){if(!m.prototype)throw"Cannot register a simple object, it must be a class with a prototype";
m.type=e;A.debug&&console.log("Node registered: "+e);e.split("/");var v=m.name,D=e.lastIndexOf("/");m.category=e.substr(0,D);m.title||(m.title=v);if(m.prototype)for(var B in f.prototype)m.prototype[B]||(m.prototype[B]=f.prototype[B]);D=this.registered_node_types[e];if(!D&&(Object.hasOwnProperty(m.prototype,"shape")||Object.defineProperty(m.prototype,"shape",{set:function(L){switch(L){case "default":delete this._shape;break;case "box":this._shape=A.BOX_SHAPE;break;case "round":this._shape=A.ROUND_SHAPE;
break;case "circle":this._shape=A.CIRCLE_SHAPE;break;case "card":this._shape=A.CARD_SHAPE;break;default:this._shape=L}},get:function(L){return this._shape},enumerable:!0,configurable:!0}),m.prototype.onPropertyChange&&console.warn("LiteGraph node class "+e+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),m.supported_extensions))for(B in m.supported_extensions){var I=m.supported_extensions[B];I&&I.constructor===String&&(this.node_types_by_file_extension[I.toLowerCase()]=
m)}this.registered_node_types[e]=m;m.constructor.name&&(this.Nodes[v]=m);if(A.onNodeTypeRegistered)A.onNodeTypeRegistered(e,m);if(D&&A.onNodeTypeReplaced)A.onNodeTypeReplaced(e,m,D);m.prototype.onPropertyChange&&console.warn("LiteGraph node class "+e+" has onPropertyChange method, it must be called onPropertyChanged with d at the end");if(m.supported_extensions)for(B=0;B<m.supported_extensions.length;B++)(I=m.supported_extensions[B])&&I.constructor===String&&(this.node_types_by_file_extension[I.toLowerCase()]=
m)},unregisterNodeType:function(e){var m=e.constructor===String?this.registered_node_types[e]:e;if(!m)throw"node type not found: "+e;delete this.registered_node_types[m.type];m.constructor.name&&delete this.Nodes[m.constructor.name]},wrapFunctionAsNode:function(e,m,v,D,B){for(var I=Array(m.length),L="",S=A.getParameterNames(m),R=0;R<S.length;++R)L+="this.addInput('"+S[R]+"',"+(v&&v[R]?"'"+v[R]+"'":"0")+");\n";L+="this.addOutput('out',"+(D?"'"+D+"'":0)+");\n";B&&(L+="this.properties = "+JSON.stringify(B)+
";\n");v=Function(L);v.title=e.split("/").pop();v.desc="Generated from "+m.name;v.prototype.onExecute=function(){for(var W=0;W<I.length;++W)I[W]=this.getInputData(W);W=m.apply(this,I);this.setOutputData(0,W)};this.registerNodeType(e,v)},clearRegisteredTypes:function(){this.registered_node_types={};this.node_types_by_file_extension={};this.Nodes={};this.searchbox_extras={}},addNodeMethod:function(e,m){f.prototype[e]=m;for(var v in this.registered_node_types){var D=this.registered_node_types[v];D.prototype[e]&&
(D.prototype["_"+e]=D.prototype[e]);D.prototype[e]=m}},createNode:function(e,m,v){var D=this.registered_node_types[e];if(!D)return A.debug&&console.log('GraphNode type "'+e+'" not registered.'),null;m=m||D.title||e;var B=null;if(A.catch_exceptions)try{B=new D(m)}catch(L){return console.error(L),null}else B=new D(m);B.type=e;!B.title&&m&&(B.title=m);B.properties||(B.properties={});B.properties_info||(B.properties_info=[]);B.flags||(B.flags={});B.size||(B.size=B.computeSize());B.pos||(B.pos=A.DEFAULT_POSITION.concat());
B.mode||(B.mode=A.ALWAYS);if(v)for(var I in v)B[I]=v[I];return B},getNodeType:function(e){return this.registered_node_types[e]},getNodeTypesInCategory:function(e,m){var v=[],D;for(D in this.registered_node_types){var B=this.registered_node_types[D];B.filter==m&&(""==e?null==B.category&&v.push(B):B.category==e&&v.push(B))}return v},getNodeTypesCategories:function(e){var m={"":1},v;for(v in this.registered_node_types){var D=this.registered_node_types[v];D.category&&!D.skip_list&&D.filter==e&&(m[D.category]=
1)}e=[];for(v in m)e.push(v);return e},reloadNodes:function(e){for(var m=document.getElementsByTagName("script"),v=[],D=0;D<m.length;D++)v.push(m[D]);m=document.getElementsByTagName("head")[0];e=document.location.href+e;for(D=0;D<v.length;D++){var B=v[D].src;if(B&&B.substr(0,e.length)==e)try{A.debug&&console.log("Reloading: "+B);var I=document.createElement("script");I.type="text/javascript";I.src=B;m.appendChild(I);m.removeChild(v[D])}catch(L){if(A.throw_errors)throw L;A.debug&&console.log("Error while reloading "+
B)}}A.debug&&console.log("Nodes reloaded")},cloneObject:function(e,m){if(null==e)return null;e=JSON.parse(JSON.stringify(e));if(!m)return e;for(var v in e)m[v]=e[v];return m},isValidConnection:function(e,m){if(!e||!m||e==m||e==A.EVENT&&m==A.ACTION)return!0;e=String(e);m=String(m);e=e.toLowerCase();m=m.toLowerCase();if(-1==e.indexOf(",")&&-1==m.indexOf(","))return e==m;e=e.split(",");m=m.split(",");for(var v=0;v<e.length;++v)for(var D=0;D<m.length;++D)if(e[v]==m[D])return!0;return!1},registerSearchboxExtra:function(e,
m,v){this.searchbox_extras[m.toLowerCase()]={type:e,desc:m,data:v}},fetchFile:function(e,m,v,D){if(!e)return null;m=m||"text";if(e.constructor===String)return"http"==e.substr(0,4)&&A.proxy&&(e=A.proxy+e.substr(e.indexOf(":")+3)),fetch(e).then(function(I){if(!I.ok)throw Error("File not found");if("arraybuffer"==m)return I.arrayBuffer();if("text"==m||"string"==m)return I.text();if("json"==m)return I.json();if("blob"==m)return I.blob()}).then(function(I){v&&v(I)}).catch(function(I){console.error("error fetching file:",
e);D&&D(I)});if(e.constructor===File||e.constructor===Blob){var B=new FileReader;B.onload=function(I){I=I.target.result;"json"==m&&(I=JSON.parse(I));v&&v(I)};if("arraybuffer"==m)return B.readAsArrayBuffer(e);if("text"==m||"json"==m)return B.readAsText(e);if("blob"==m)return B.readAsBinaryString(e)}return null}};A.getTime="undefined"!=typeof performance?performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?Date.now.bind(Date):"undefined"!=typeof process?function(){var e=process.hrtime();
return.001*e[0]+1E-6*e[1]}:function(){return(new Date).getTime()};c.LGraph=A.LGraph=h;h.supported_types=["number","string","boolean"];h.prototype.getSupportedTypes=function(){return this.supported_types||h.supported_types};h.STATUS_STOPPED=1;h.STATUS_RUNNING=2;h.prototype.clear=function(){this.stop();this.status=h.STATUS_STOPPED;this.last_link_id=this.last_node_id=0;this._version=-1;if(this._nodes)for(var e=0;e<this._nodes.length;++e){var m=this._nodes[e];if(m.onRemoved)m.onRemoved()}this._nodes=
[];this._nodes_by_id={};this._nodes_in_order=[];this._nodes_executable=null;this._groups=[];this.links={};this.iteration=0;this.config={};this.vars={};this.extra={};this.fixedtime=this.runningtime=this.globaltime=0;this.elapsed_time=this.fixedtime_lapse=.01;this.starttime=this.last_update_time=0;this.catch_errors=!0;this.inputs={};this.outputs={};this.change();this.sendActionToCanvas("clear")};h.prototype.attachCanvas=function(e){if(e.constructor!=k)throw"attachCanvas expects a LGraphCanvas instance";
e.graph&&e.graph!=this&&e.graph.detachCanvas(e);e.graph=this;this.list_of_graphcanvas||(this.list_of_graphcanvas=[]);this.list_of_graphcanvas.push(e)};h.prototype.detachCanvas=function(e){if(this.list_of_graphcanvas){var m=this.list_of_graphcanvas.indexOf(e);-1!=m&&(e.graph=null,this.list_of_graphcanvas.splice(m,1))}};h.prototype.start=function(e){if(this.status!=h.STATUS_RUNNING){this.status=h.STATUS_RUNNING;if(this.onPlayEvent)this.onPlayEvent();this.sendEventToAllNodes("onStart");this.last_update_time=
this.starttime=A.getTime();e=e||0;var m=this;if(0==e&&"undefined"!=typeof window&&window.requestAnimationFrame){var v=function(){if(-1==m.execution_timer_id){window.requestAnimationFrame(v);if(m.onBeforeStep)m.onBeforeStep();m.runStep(1,!m.catch_errors);if(m.onAfterStep)m.onAfterStep()}};this.execution_timer_id=-1;v()}else this.execution_timer_id=setInterval(function(){if(m.onBeforeStep)m.onBeforeStep();m.runStep(1,!m.catch_errors);if(m.onAfterStep)m.onAfterStep()},e)}};h.prototype.stop=function(){if(this.status!=
h.STATUS_STOPPED){this.status=h.STATUS_STOPPED;if(this.onStopEvent)this.onStopEvent();null!=this.execution_timer_id&&(-1!=this.execution_timer_id&&clearInterval(this.execution_timer_id),this.execution_timer_id=null);this.sendEventToAllNodes("onStop")}};h.prototype.runStep=function(e,m,v){e=e||1;var D=A.getTime();this.globaltime=.001*(D-this.starttime);var B=this._nodes_executable?this._nodes_executable:this._nodes;if(B){v=v||B.length;if(m){for(var I=0;I<e;I++){for(var L=0;L<v;++L){var S=B[L];if(S.mode==
A.ALWAYS&&S.onExecute)S.onExecute()}this.fixedtime+=this.fixedtime_lapse;if(this.onExecuteStep)this.onExecuteStep()}if(this.onAfterExecute)this.onAfterExecute()}else try{for(I=0;I<e;I++){for(L=0;L<v;++L)if(S=B[L],S.mode==A.ALWAYS&&S.onExecute)S.onExecute();this.fixedtime+=this.fixedtime_lapse;if(this.onExecuteStep)this.onExecuteStep()}if(this.onAfterExecute)this.onAfterExecute();this.errors_in_execution=!1}catch(R){this.errors_in_execution=!0;if(A.throw_errors)throw R;A.debug&&console.log("Error during execution: "+
R);this.stop()}e=A.getTime();D=e-D;0==D&&(D=1);this.execution_time=.001*D;this.globaltime+=.001*D;this.iteration+=1;this.elapsed_time=.001*(e-this.last_update_time);this.last_update_time=e}};h.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1);this._nodes_executable=[];for(var e=0;e<this._nodes_in_order.length;++e)this._nodes_in_order[e].onExecute&&this._nodes_executable.push(this._nodes_in_order[e])};h.prototype.computeExecutionOrder=function(e,m){for(var v=
[],D=[],B={},I={},L={},S=0,R=this._nodes.length;S<R;++S){var W=this._nodes[S];if(!e||W.onExecute){B[W.id]=W;var X=0;if(W.inputs)for(var V=0,la=W.inputs.length;V<la;V++)W.inputs[V]&&null!=W.inputs[V].link&&(X+=1);0==X?(D.push(W),m&&(W._level=1)):(m&&(W._level=0),L[W.id]=X)}}for(;0!=D.length;)if(W=D.shift(),v.push(W),delete B[W.id],W.outputs)for(S=0;S<W.outputs.length;S++)if(e=W.outputs[S],null!=e&&null!=e.links&&0!=e.links.length)for(V=0;V<e.links.length;V++)(R=this.links[e.links[V]])&&!I[R.id]&&(X=
this.getNodeById(R.target_id),null==X?I[R.id]=!0:(m&&(!X._level||X._level<=W._level)&&(X._level=W._level+1),I[R.id]=!0,--L[X.id],0==L[X.id]&&D.push(X)));for(S in B)v.push(B[S]);v.length!=this._nodes.length&&A.debug&&console.warn("something went wrong, nodes missing");R=v.length;for(S=0;S<R;++S)v[S].order=S;v=v.sort(function(fa,ha){var ba=fa.constructor.priority||fa.priority||0,ea=ha.constructor.priority||ha.priority||0;return ba==ea?fa.order-ha.order:ba-ea});for(S=0;S<R;++S)v[S].order=S;return v};
h.prototype.getAncestors=function(e){for(var m=[],v=[e],D={};v.length;){var B=v.shift();if(B.inputs){D[B.id]||B==e||(D[B.id]=!0,m.push(B));for(var I=0;I<B.inputs.length;++I){var L=B.getInputNode(I);L&&-1==m.indexOf(L)&&v.push(L)}}}m.sort(function(S,R){return S.order-R.order});return m};h.prototype.arrange=function(e){e=e||100;for(var m=this.computeExecutionOrder(!1,!0),v=[],D=0;D<m.length;++D){var B=m[D],I=B._level||1;v[I]||(v[I]=[]);v[I].push(B)}m=e;for(D=0;D<v.length;++D)if(I=v[D]){for(var L=100,
S=e+A.NODE_TITLE_HEIGHT,R=0;R<I.length;++R)B=I[R],B.pos[0]=m,B.pos[1]=S,B.size[0]>L&&(L=B.size[0]),S+=B.size[1]+e+A.NODE_TITLE_HEIGHT;m+=L+e}this.setDirtyCanvas(!0,!0)};h.prototype.getTime=function(){return this.globaltime};h.prototype.getFixedTime=function(){return this.fixedtime};h.prototype.getElapsedTime=function(){return this.elapsed_time};h.prototype.sendEventToAllNodes=function(e,m,v){v=v||A.ALWAYS;var D=this._nodes_in_order?this._nodes_in_order:this._nodes;if(D)for(var B=0,I=D.length;B<I;++B){var L=
D[B];if(L.constructor===A.Subgraph&&"onExecute"!=e)L.mode==v&&L.sendEventToAllNodes(e,m,v);else if(L[e]&&L.mode==v)if(void 0===m)L[e]();else if(m&&m.constructor===Array)L[e].apply(L,m);else L[e](m)}};h.prototype.sendActionToCanvas=function(e,m){if(this.list_of_graphcanvas)for(var v=0;v<this.list_of_graphcanvas.length;++v){var D=this.list_of_graphcanvas[v];D[e]&&D[e].apply(D,m)}};h.prototype.add=function(e,m){if(e)if(e.constructor===q)this._groups.push(e),this.setDirtyCanvas(!0),this.change(),e.graph=
this,this._version++;else{-1!=e.id&&null!=this._nodes_by_id[e.id]&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),e.id=++this.last_node_id);if(this._nodes.length>=A.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";null==e.id||-1==e.id?e.id=++this.last_node_id:this.last_node_id<e.id&&(this.last_node_id=e.id);e.graph=this;this._version++;this._nodes.push(e);this._nodes_by_id[e.id]=e;if(e.onAdded)e.onAdded(this);this.config.align_to_grid&&e.alignToGrid();
m||this.updateExecutionOrder();if(this.onNodeAdded)this.onNodeAdded(e);this.setDirtyCanvas(!0);this.change();return e}};h.prototype.remove=function(e){if(e.constructor===A.LGraphGroup){var m=this._groups.indexOf(e);-1!=m&&this._groups.splice(m,1);e.graph=null;this._version++;this.setDirtyCanvas(!0,!0);this.change()}else if(null!=this._nodes_by_id[e.id]&&!e.ignore_remove){if(e.inputs)for(m=0;m<e.inputs.length;m++){var v=e.inputs[m];null!=v.link&&e.disconnectInput(m)}if(e.outputs)for(m=0;m<e.outputs.length;m++)v=
e.outputs[m],null!=v.links&&v.links.length&&e.disconnectOutput(m);if(e.onRemoved)e.onRemoved();e.graph=null;this._version++;if(this.list_of_graphcanvas)for(m=0;m<this.list_of_graphcanvas.length;++m)v=this.list_of_graphcanvas[m],v.selected_nodes[e.id]&&delete v.selected_nodes[e.id],v.node_dragged==e&&(v.node_dragged=null);m=this._nodes.indexOf(e);-1!=m&&this._nodes.splice(m,1);delete this._nodes_by_id[e.id];if(this.onNodeRemoved)this.onNodeRemoved(e);this.sendActionToCanvas("checkPanels");this.setDirtyCanvas(!0,
!0);this.change();this.updateExecutionOrder()}};h.prototype.getNodeById=function(e){return null==e?null:this._nodes_by_id[e]};h.prototype.findNodesByClass=function(e,m){m=m||[];for(var v=m.length=0,D=this._nodes.length;v<D;++v)this._nodes[v].constructor===e&&m.push(this._nodes[v]);return m};h.prototype.findNodesByType=function(e,m){e=e.toLowerCase();m=m||[];for(var v=m.length=0,D=this._nodes.length;v<D;++v)this._nodes[v].type.toLowerCase()==e&&m.push(this._nodes[v]);return m};h.prototype.findNodeByTitle=
function(e){for(var m=0,v=this._nodes.length;m<v;++m)if(this._nodes[m].title==e)return this._nodes[m];return null};h.prototype.findNodesByTitle=function(e){for(var m=[],v=0,D=this._nodes.length;v<D;++v)this._nodes[v].title==e&&m.push(this._nodes[v]);return m};h.prototype.getNodeOnPos=function(e,m,v,D){v=v||this._nodes;for(var B=v.length-1;0<=B;B--){var I=v[B];if(I.isPointInside(e,m,D))return I}return null};h.prototype.getGroupOnPos=function(e,m){for(var v=this._groups.length-1;0<=v;v--){var D=this._groups[v];
if(D.isPointInside(e,m,2,!0))return D}return null};h.prototype.checkNodeTypes=function(){for(var e=0;e<this._nodes.length;e++){var m=this._nodes[e];if(m.constructor!=A.registered_node_types[m.type]){console.log("node being replaced by newer version: "+m.type);var v=A.createNode(m.type);this._nodes[e]=v;v.configure(m.serialize());v.graph=this;this._nodes_by_id[v.id]=v;m.inputs&&(v.inputs=m.inputs.concat());m.outputs&&(v.outputs=m.outputs.concat())}}this.updateExecutionOrder()};h.prototype.onAction=
function(e,m){this._input_nodes=this.findNodesByClass(A.GraphInput,this._input_nodes);for(var v=0;v<this._input_nodes.length;++v){var D=this._input_nodes[v];if(D.properties.name==e){D.onAction(e,m);break}}};h.prototype.trigger=function(e,m){if(this.onTrigger)this.onTrigger(e,m)};h.prototype.addInput=function(e,m,v){if(!this.inputs[e]){this.beforeChange();this.inputs[e]={name:e,type:m,value:v};this._version++;this.afterChange();if(this.onInputAdded)this.onInputAdded(e,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()}};
h.prototype.setInputData=function(e,m){if(e=this.inputs[e])e.value=m};h.prototype.getInputData=function(e){return(e=this.inputs[e])?e.value:null};h.prototype.renameInput=function(e,m){if(m!=e){if(!this.inputs[e])return!1;if(this.inputs[m])return console.error("there is already one input with that name"),!1;this.inputs[m]=this.inputs[e];delete this.inputs[e];this._version++;if(this.onInputRenamed)this.onInputRenamed(e,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()}};h.prototype.changeInputType=
function(e,m){if(!this.inputs[e])return!1;if(!this.inputs[e].type||String(this.inputs[e].type).toLowerCase()!=String(m).toLowerCase())if(this.inputs[e].type=m,this._version++,this.onInputTypeChanged)this.onInputTypeChanged(e,m)};h.prototype.removeInput=function(e){if(!this.inputs[e])return!1;delete this.inputs[e];this._version++;if(this.onInputRemoved)this.onInputRemoved(e);if(this.onInputsOutputsChange)this.onInputsOutputsChange();return!0};h.prototype.addOutput=function(e,m,v){this.outputs[e]={name:e,
type:m,value:v};this._version++;if(this.onOutputAdded)this.onOutputAdded(e,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()};h.prototype.setOutputData=function(e,m){if(e=this.outputs[e])e.value=m};h.prototype.getOutputData=function(e){return(e=this.outputs[e])?e.value:null};h.prototype.renameOutput=function(e,m){if(!this.outputs[e])return!1;if(this.outputs[m])return console.error("there is already one output with that name"),!1;this.outputs[m]=this.outputs[e];delete this.outputs[e];this._version++;
if(this.onOutputRenamed)this.onOutputRenamed(e,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()};h.prototype.changeOutputType=function(e,m){if(!this.outputs[e])return!1;if(!this.outputs[e].type||String(this.outputs[e].type).toLowerCase()!=String(m).toLowerCase())if(this.outputs[e].type=m,this._version++,this.onOutputTypeChanged)this.onOutputTypeChanged(e,m)};h.prototype.removeOutput=function(e){if(!this.outputs[e])return!1;delete this.outputs[e];this._version++;if(this.onOutputRemoved)this.onOutputRemoved(e);
if(this.onInputsOutputsChange)this.onInputsOutputsChange();return!0};h.prototype.triggerInput=function(e,m){e=this.findNodesByTitle(e);for(var v=0;v<e.length;++v)e[v].onTrigger(m)};h.prototype.setCallback=function(e,m){e=this.findNodesByTitle(e);for(var v=0;v<e.length;++v)e[v].setTrigger(m)};h.prototype.beforeChange=function(e){if(this.onBeforeChange)this.onBeforeChange(this,e);this.sendActionToCanvas("onBeforeChange",this)};h.prototype.afterChange=function(e){if(this.onAfterChange)this.onAfterChange(this,
e);this.sendActionToCanvas("onAfterChange",this)};h.prototype.connectionChange=function(e,m){this.updateExecutionOrder();if(this.onConnectionChange)this.onConnectionChange(e);this._version++;this.sendActionToCanvas("onConnectionChange")};h.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var e=0;e<this.list_of_graphcanvas.length;++e)if(this.list_of_graphcanvas[e].live_mode)return!0;return!1};h.prototype.clearTriggeredSlots=function(){for(var e in this.links){var m=this.links[e];
m&&m._last_time&&(m._last_time=0)}};h.prototype.change=function(){A.debug&&console.log("Graph changed");this.sendActionToCanvas("setDirty",[!0,!0]);if(this.on_change)this.on_change(this)};h.prototype.setDirtyCanvas=function(e,m){this.sendActionToCanvas("setDirty",[e,m])};h.prototype.removeLink=function(e){if(e=this.links[e]){var m=this.getNodeById(e.target_id);m&&m.disconnectInput(e.target_slot)}};h.prototype.serialize=function(){for(var e=[],m=0,v=this._nodes.length;m<v;++m)e.push(this._nodes[m].serialize());
v=[];for(m in this.links){var D=this.links[m];if(!D.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var B=new n;for(I in D)B[I]=D[I];D=this.links[m]=B}v.push(D.serialize())}var I=[];for(m=0;m<this._groups.length;++m)I.push(this._groups[m].serialize());e={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:e,links:v,groups:I,config:this.config,extra:this.extra,version:A.VERSION};if(this.onSerialize)this.onSerialize(e);return e};h.prototype.configure=
function(e,m){if(e){m||this.clear();m=e.nodes;if(e.links&&e.links.constructor===Array){for(var v=[],D=0;D<e.links.length;++D){var B=e.links[D];if(B){var I=new n;I.configure(B);v[I.id]=I}else console.warn("serialized graph link data contains errors, skipping.")}e.links=v}for(D in e)"nodes"!=D&&"groups"!=D&&(this[D]=e[D]);v=!1;this._nodes=[];if(m){D=0;for(B=m.length;D<B;++D){I=m[D];var L=A.createNode(I.type,I.title);L||(A.debug&&console.log("Node not found or has errors: "+I.type),L=new f,L.last_serialization=
I,v=L.has_errors=!0);L.id=I.id;this.add(L,!0)}D=0;for(B=m.length;D<B;++D)I=m[D],(L=this.getNodeById(I.id))&&L.configure(I)}this._groups.length=0;if(e.groups)for(D=0;D<e.groups.length;++D)m=new A.LGraphGroup,m.configure(e.groups[D]),this.add(m);this.updateExecutionOrder();this.extra=e.extra||{};if(this.onConfigure)this.onConfigure(e);this._version++;this.setDirtyCanvas(!0,!0);return v}};h.prototype.load=function(e){var m=this,v=new XMLHttpRequest;v.open("GET",e,!0);v.send(null);v.onload=function(D){200!==
v.status?console.error("Error loading graph:",v.status,v.response):(D=JSON.parse(v.response),m.configure(D))};v.onerror=function(D){console.error("Error loading graph:",D)}};h.prototype.onNodeTrace=function(e,m,v){};n.prototype.configure=function(e){e.constructor===Array?(this.id=e[0],this.origin_id=e[1],this.origin_slot=e[2],this.target_id=e[3],this.target_slot=e[4],this.type=e[5]):(this.id=e.id,this.type=e.type,this.origin_id=e.origin_id,this.origin_slot=e.origin_slot,this.target_id=e.target_id,
this.target_slot=e.target_slot)};n.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]};A.LLink=n;c.LGraphNode=A.LGraphNode=f;f.prototype._ctor=function(e){this.title=e||"Unnamed";this.size=[A.NODE_WIDTH,60];this.graph=null;this._pos=new Float32Array(10,10);Object.defineProperty(this,"pos",{set:function(m){!m||2>m.length||(this._pos[0]=m[0],this._pos[1]=m[1])},get:function(){return this._pos},enumerable:!0});this.id=-1;this.type=
null;this.inputs=[];this.outputs=[];this.connections=[];this.properties={};this.properties_info=[];this.flags={}};f.prototype.configure=function(e){this.graph&&this.graph._version++;for(var m in e)if("properties"==m)for(var v in e.properties){if(this.properties[v]=e.properties[v],this.onPropertyChanged)this.onPropertyChanged(v,e.properties[v])}else null!=e[m]&&("object"==typeof e[m]?this[m]&&this[m].configure?this[m].configure(e[m]):this[m]=A.cloneObject(e[m],this[m]):this[m]=e[m]);e.title||(this.title=
this.constructor.title);if(this.onConnectionsChange){if(this.inputs)for(v=0;v<this.inputs.length;++v){m=this.inputs[v];var D=this.graph?this.graph.links[m.link]:null;this.onConnectionsChange(A.INPUT,v,!0,D,m)}if(this.outputs)for(v=0;v<this.outputs.length;++v){var B=this.outputs[v];if(B.links)for(m=0;m<B.links.length;++m)D=this.graph?this.graph.links[B.links[m]]:null,this.onConnectionsChange(A.OUTPUT,v,!0,D,B)}}if(this.widgets){for(v=0;v<this.widgets.length;++v)(m=this.widgets[v])&&m.options&&m.options.property&&
this.properties[m.options.property]&&(m.value=JSON.parse(JSON.stringify(this.properties[m.options.property])));if(e.widgets_values)for(v=0;v<e.widgets_values.length;++v)this.widgets[v]&&(this.widgets[v].value=e.widgets_values[v])}if(this.onConfigure)this.onConfigure(e)};f.prototype.serialize=function(){var e={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:A.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===f&&this.last_serialization)return this.last_serialization;
this.inputs&&(e.inputs=this.inputs);if(this.outputs){for(var m=0;m<this.outputs.length;m++)delete this.outputs[m]._data;e.outputs=this.outputs}this.title&&this.title!=this.constructor.title&&(e.title=this.title);this.properties&&(e.properties=A.cloneObject(this.properties));if(this.widgets&&this.serialize_widgets)for(e.widgets_values=[],m=0;m<this.widgets.length;++m)e.widgets_values[m]=this.widgets[m]?this.widgets[m].value:null;e.type||(e.type=this.constructor.type);this.color&&(e.color=this.color);
this.bgcolor&&(e.bgcolor=this.bgcolor);this.boxcolor&&(e.boxcolor=this.boxcolor);this.shape&&(e.shape=this.shape);this.onSerialize&&this.onSerialize(e)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter");return e};f.prototype.clone=function(){var e=A.createNode(this.type);if(!e)return null;var m=A.cloneObject(this.serialize());if(m.inputs)for(var v=0;v<m.inputs.length;++v)m.inputs[v].link=null;if(m.outputs)for(v=0;v<m.outputs.length;++v)m.outputs[v].links&&
(m.outputs[v].links.length=0);delete m.id;e.configure(m);return e};f.prototype.toString=function(){return JSON.stringify(this.serialize())};f.prototype.getTitle=function(){return this.title||this.constructor.title};f.prototype.setProperty=function(e,m){this.properties||(this.properties={});if(m!==this.properties[e]){var v=this.properties[e];this.properties[e]=m;this.onPropertyChanged&&!1===this.onPropertyChanged(e,m,v)&&(this.properties[e]=v);if(this.widgets)for(v=0;v<this.widgets.length;++v){var D=
this.widgets[v];if(D&&D.options.property==e){D.value=m;break}}}};f.prototype.setOutputData=function(e,m){if(this.outputs&&!(-1==e||e>=this.outputs.length)){var v=this.outputs[e];if(v&&(v._data=m,this.outputs[e].links))for(v=0;v<this.outputs[e].links.length;v++){var D=this.graph.links[this.outputs[e].links[v]];D&&(D.data=m)}}};f.prototype.setOutputDataType=function(e,m){if(this.outputs&&!(-1==e||e>=this.outputs.length)){var v=this.outputs[e];if(v&&(v.type=m,this.outputs[e].links))for(v=0;v<this.outputs[e].links.length;v++)this.graph.links[this.outputs[e].links[v]].type=
m}};f.prototype.getInputData=function(e,m){if(this.inputs&&!(e>=this.inputs.length||null==this.inputs[e].link)){e=this.graph.links[this.inputs[e].link];if(!e)return null;if(!m)return e.data;m=this.graph.getNodeById(e.origin_id);if(!m)return e.data;if(m.updateOutputData)m.updateOutputData(e.origin_slot);else if(m.onExecute)m.onExecute();return e.data}};f.prototype.getInputDataType=function(e){if(!this.inputs||e>=this.inputs.length||null==this.inputs[e].link)return null;e=this.graph.links[this.inputs[e].link];
if(!e)return null;var m=this.graph.getNodeById(e.origin_id);return m?(e=m.outputs[e.origin_slot])?e.type:null:e.type};f.prototype.getInputDataByName=function(e,m){e=this.findInputSlot(e);return-1==e?null:this.getInputData(e,m)};f.prototype.isInputConnected=function(e){return this.inputs?e<this.inputs.length&&null!=this.inputs[e].link:!1};f.prototype.getInputInfo=function(e){return this.inputs?e<this.inputs.length?this.inputs[e]:null:null};f.prototype.getInputLink=function(e){return this.inputs?e<
this.inputs.length?this.graph.links[this.inputs[e].link]:null:null};f.prototype.getInputNode=function(e){if(!this.inputs||e>=this.inputs.length)return null;e=this.inputs[e];return e&&null!==e.link?(e=this.graph.links[e.link])?this.graph.getNodeById(e.origin_id):null:null};f.prototype.getInputOrProperty=function(e){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[e]:null;for(var m=0,v=this.inputs.length;m<v;++m){var D=this.inputs[m];if(e==D.name&&null!=D.link&&(D=this.graph.links[D.link]))return D.data}return this.properties[e]};
f.prototype.getOutputData=function(e){return!this.outputs||e>=this.outputs.length?null:this.outputs[e]._data};f.prototype.getOutputInfo=function(e){return this.outputs?e<this.outputs.length?this.outputs[e]:null:null};f.prototype.isOutputConnected=function(e){return this.outputs?e<this.outputs.length&&this.outputs[e].links&&this.outputs[e].links.length:!1};f.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var e=0;e<this.outputs.length;++e)if(this.outputs[e].links&&this.outputs[e].links.length)return!0;
return!1};f.prototype.getOutputNodes=function(e){if(!this.outputs||0==this.outputs.length||e>=this.outputs.length)return null;e=this.outputs[e];if(!e.links||0==e.links.length)return null;for(var m=[],v=0;v<e.links.length;v++){var D=this.graph.links[e.links[v]];D&&(D=this.graph.getNodeById(D.target_id))&&m.push(D)}return m};f.prototype.trigger=function(e,m){if(this.outputs&&this.outputs.length){this.graph&&(this.graph._last_trigger_time=A.getTime());for(var v=0;v<this.outputs.length;++v){var D=this.outputs[v];
!D||D.type!==A.EVENT||e&&D.name!=e||this.triggerSlot(v,m)}}};f.prototype.triggerSlot=function(e,m,v){if(this.outputs&&(e=this.outputs[e])&&(e=e.links)&&e.length){this.graph&&(this.graph._last_trigger_time=A.getTime());for(var D=0;D<e.length;++D){var B=e[D];if(null==v||v==B){var I=this.graph.links[e[D]];if(I&&(I._last_time=A.getTime(),B=this.graph.getNodeById(I.target_id)))if(I=B.inputs[I.target_slot],B.onAction)B.onAction(I.name,m);else if(B.mode===A.ON_TRIGGER&&B.onExecute)B.onExecute(m)}}}};f.prototype.clearTriggeredSlot=
function(e,m){if(this.outputs&&(e=this.outputs[e])&&(e=e.links)&&e.length)for(var v=0;v<e.length;++v){var D=e[v];if(null==m||m==D)if(D=this.graph.links[e[v]])D._last_time=0}};f.prototype.setSize=function(e){this.size=e;if(this.onResize)this.onResize(this.size)};f.prototype.addProperty=function(e,m,v,D){v={name:e,type:v,default_value:m};if(D)for(var B in D)v[B]=D[B];this.properties_info||(this.properties_info=[]);this.properties_info.push(v);this.properties||(this.properties={});this.properties[e]=
m;return v};f.prototype.addOutput=function(e,m,v){e={name:e,type:m,links:null};if(v)for(var D in v)e[D]=v[D];this.outputs||(this.outputs=[]);this.outputs.push(e);if(this.onOutputAdded)this.onOutputAdded(e);this.setSize(this.computeSize());this.setDirtyCanvas(!0,!0);return e};f.prototype.addOutputs=function(e){for(var m=0;m<e.length;++m){var v=e[m],D={name:v[0],type:v[1],link:null};if(e[2])for(var B in v[2])D[B]=v[2][B];this.outputs||(this.outputs=[]);this.outputs.push(D);if(this.onOutputAdded)this.onOutputAdded(D)}this.setSize(this.computeSize());
this.setDirtyCanvas(!0,!0)};f.prototype.removeOutput=function(e){this.disconnectOutput(e);this.outputs.splice(e,1);for(var m=e;m<this.outputs.length;++m)if(this.outputs[m]&&this.outputs[m].links)for(var v=this.outputs[m].links,D=0;D<v.length;++D){var B=this.graph.links[v[D]];B&&--B.origin_slot}this.setSize(this.computeSize());if(this.onOutputRemoved)this.onOutputRemoved(e);this.setDirtyCanvas(!0,!0)};f.prototype.addInput=function(e,m,v){e={name:e,type:m||0,link:null};if(v)for(var D in v)e[D]=v[D];
this.inputs||(this.inputs=[]);this.inputs.push(e);this.setSize(this.computeSize());if(this.onInputAdded)this.onInputAdded(e);this.setDirtyCanvas(!0,!0);return e};f.prototype.addInputs=function(e){for(var m=0;m<e.length;++m){var v=e[m],D={name:v[0],type:v[1],link:null};if(e[2])for(var B in v[2])D[B]=v[2][B];this.inputs||(this.inputs=[]);this.inputs.push(D);if(this.onInputAdded)this.onInputAdded(D)}this.setSize(this.computeSize());this.setDirtyCanvas(!0,!0)};f.prototype.removeInput=function(e){this.disconnectInput(e);
for(var m=this.inputs.splice(e,1),v=e;v<this.inputs.length;++v)if(this.inputs[v]){var D=this.graph.links[this.inputs[v].link];D&&--D.target_slot}this.setSize(this.computeSize());if(this.onInputRemoved)this.onInputRemoved(e,m[0]);this.setDirtyCanvas(!0,!0)};f.prototype.addConnection=function(e,m,v,D){e={name:e,type:m,pos:v,direction:D,links:null};this.connections.push(e);return e};f.prototype.computeSize=function(e){function m(X){return X?D*X.length*.6:0}if(this.constructor.size)return this.constructor.size.concat();
var v=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1);e=e||new Float32Array([0,0]);v=Math.max(v,1);var D=A.NODE_TEXT_SIZE,B=m(this.title),I=0,L=0;if(this.inputs)for(var S=0,R=this.inputs.length;S<R;++S){var W=this.inputs[S];W=W.label||W.name||"";W=m(W);I<W&&(I=W)}if(this.outputs)for(S=0,R=this.outputs.length;S<R;++S)W=this.outputs[S],W=W.label||W.name||"",W=m(W),L<W&&(L=W);e[0]=Math.max(I+L+10,B);e[0]=Math.max(e[0],A.NODE_WIDTH);this.widgets&&this.widgets.length&&(e[0]=
Math.max(e[0],1.5*A.NODE_WIDTH));e[1]=(this.constructor.slot_start_y||0)+v*A.NODE_SLOT_HEIGHT;v=0;if(this.widgets&&this.widgets.length){S=0;for(R=this.widgets.length;S<R;++S)v=this.widgets[S].computeSize?v+(this.widgets[S].computeSize(e[0])[1]+4):v+(A.NODE_WIDGET_HEIGHT+4);v+=8}e[1]=this.widgets_up?Math.max(e[1],v):null!=this.widgets_start_y?Math.max(e[1],v+this.widgets_start_y):e[1]+v;this.constructor.min_height&&e[1]<this.constructor.min_height&&(e[1]=this.constructor.min_height);e[1]+=6;return e};
f.prototype.getPropertyInfo=function(e){var m=null;if(this.properties_info)for(var v=0;v<this.properties_info.length;++v)if(this.properties_info[v].name==e){m=this.properties_info[v];break}this.constructor["@"+e]&&(m=this.constructor["@"+e]);this.constructor.widgets_info&&this.constructor.widgets_info[e]&&(m=this.constructor.widgets_info[e]);!m&&this.onGetPropertyInfo&&(m=this.onGetPropertyInfo(e));m||(m={});m.type||(m.type=typeof this.properties[e]);"combo"==m.widget&&(m.type="enum");return m};f.prototype.addWidget=
function(e,m,v,D,B){this.widgets||(this.widgets=[]);!B&&D&&D.constructor===Object&&(B=D,D=null);B&&B.constructor===String&&(B={property:B});D&&D.constructor===String&&(B||(B={}),B.property=D,D=null);D&&D.constructor!==Function&&(console.warn("addWidget: callback must be a function"),D=null);m={type:e.toLowerCase(),name:m,value:v,callback:D,options:B||{}};void 0!==m.options.y&&(m.y=m.options.y);D||m.options.callback||m.options.property||console.warn("LiteGraph addWidget(...) without a callback or property assigned");
if("combo"==e&&!m.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";this.widgets.push(m);this.setSize(this.computeSize());return m};f.prototype.addCustomWidget=function(e){this.widgets||(this.widgets=[]);this.widgets.push(e);return e};f.prototype.getBounding=function(e){e=e||new Float32Array(4);e[0]=this.pos[0]-4;e[1]=this.pos[1]-A.NODE_TITLE_HEIGHT;e[2]=this.size[0]+4;e[3]=this.size[1]+A.NODE_TITLE_HEIGHT;if(this.onBounding)this.onBounding(e);
return e};f.prototype.isPointInside=function(e,m,v,D){v=v||0;var B=this.graph&&this.graph.isLive()?0:A.NODE_TITLE_HEIGHT;D&&(B=0);if(this.flags&&this.flags.collapsed){if(r(e,m,this.pos[0]-v,this.pos[1]-A.NODE_TITLE_HEIGHT-v,(this._collapsed_width||A.NODE_COLLAPSED_WIDTH)+2*v,A.NODE_TITLE_HEIGHT+2*v))return!0}else if(this.pos[0]-4-v<e&&this.pos[0]+this.size[0]+4+v>e&&this.pos[1]-B-v<m&&this.pos[1]+this.size[1]+v>m)return!0;return!1};f.prototype.getSlotInPosition=function(e,m){var v=new Float32Array(2);
if(this.inputs)for(var D=0,B=this.inputs.length;D<B;++D){var I=this.inputs[D];this.getConnectionPos(!0,D,v);if(r(e,m,v[0]-10,v[1]-5,20,10))return{input:I,slot:D,link_pos:v}}if(this.outputs)for(D=0,B=this.outputs.length;D<B;++D)if(I=this.outputs[D],this.getConnectionPos(!1,D,v),r(e,m,v[0]-10,v[1]-5,20,10))return{output:I,slot:D,link_pos:v};return null};f.prototype.findInputSlot=function(e){if(!this.inputs)return-1;for(var m=0,v=this.inputs.length;m<v;++m)if(e==this.inputs[m].name)return m;return-1};
f.prototype.findOutputSlot=function(e){if(!this.outputs)return-1;for(var m=0,v=this.outputs.length;m<v;++m)if(e==this.outputs[m].name)return m;return-1};f.prototype.connect=function(e,m,v){v=v||0;if(!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(e.constructor===String){if(e=this.findOutputSlot(e),-1==e)return A.debug&&console.log("Connect: Error, no slot of name "+e),null}else if(!this.outputs||
e>=this.outputs.length)return A.debug&&console.log("Connect: Error, slot number not found"),null;m&&m.constructor===Number&&(m=this.graph.getNodeById(m));if(!m)throw"target node is null";if(m==this)return null;if(v.constructor===String){if(v=m.findInputSlot(v),-1==v)return A.debug&&console.log("Connect: Error, no slot of name "+v),null}else{if(v===A.EVENT)return null;if(!m.inputs||v>=m.inputs.length)return A.debug&&console.log("Connect: Error, slot number not found"),null}var D=!1;null!=m.inputs[v].link&&
(this.graph.beforeChange(),m.disconnectInput(v),D=!0);var B=this.outputs[e];if(m.onConnectInput&&!1===m.onConnectInput(v,B.type,B,this,e))return null;var I=m.inputs[v],L=null;if(!A.isValidConnection(B.type,I.type))return this.setDirtyCanvas(!1,!0),D&&this.graph.connectionChange(this,L),null;D||this.graph.beforeChange();L=new n(++this.graph.last_link_id,I.type,this.id,e,m.id,v);this.graph.links[L.id]=L;null==B.links&&(B.links=[]);B.links.push(L.id);m.inputs[v].link=L.id;this.graph&&this.graph._version++;
if(this.onConnectionsChange)this.onConnectionsChange(A.OUTPUT,e,!0,L,B);if(m.onConnectionsChange)m.onConnectionsChange(A.INPUT,v,!0,L,I);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(A.INPUT,m,v,this,e),this.graph.onNodeConnectionChange(A.OUTPUT,this,e,m,v));this.setDirtyCanvas(!1,!0);this.graph.afterChange();this.graph.connectionChange(this,L);return L};f.prototype.disconnectOutput=function(e,m){if(e.constructor===String){if(e=this.findOutputSlot(e),-1==e)return A.debug&&
console.log("Connect: Error, no slot of name "+e),!1}else if(!this.outputs||e>=this.outputs.length)return A.debug&&console.log("Connect: Error, slot number not found"),!1;var v=this.outputs[e];if(!v||!v.links||0==v.links.length)return!1;if(m){m.constructor===Number&&(m=this.graph.getNodeById(m));if(!m)throw"Target Node not found";for(var D=0,B=v.links.length;D<B;D++){var I=v.links[D],L=this.graph.links[I];if(L.target_id==m.id){v.links.splice(D,1);var S=m.inputs[L.target_slot];S.link=null;delete this.graph.links[I];
this.graph&&this.graph._version++;if(m.onConnectionsChange)m.onConnectionsChange(A.INPUT,L.target_slot,!1,L,S);if(this.onConnectionsChange)this.onConnectionsChange(A.OUTPUT,e,!1,L,v);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange(A.OUTPUT,this,e);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(A.OUTPUT,this,e),this.graph.onNodeConnectionChange(A.INPUT,m,L.target_slot));break}}}else{D=0;for(B=v.links.length;D<B;D++)if(I=v.links[D],
L=this.graph.links[I]){m=this.graph.getNodeById(L.target_id);this.graph&&this.graph._version++;if(m){S=m.inputs[L.target_slot];S.link=null;if(m.onConnectionsChange)m.onConnectionsChange(A.INPUT,L.target_slot,!1,L,S);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange(A.INPUT,m,L.target_slot)}delete this.graph.links[I];if(this.onConnectionsChange)this.onConnectionsChange(A.OUTPUT,e,!1,L,v);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(A.OUTPUT,
this,e),this.graph.onNodeConnectionChange(A.INPUT,m,L.target_slot))}v.links=null}this.setDirtyCanvas(!1,!0);this.graph.connectionChange(this);return!0};f.prototype.disconnectInput=function(e){if(e.constructor===String){if(e=this.findInputSlot(e),-1==e)return A.debug&&console.log("Connect: Error, no slot of name "+e),!1}else if(!this.inputs||e>=this.inputs.length)return A.debug&&console.log("Connect: Error, slot number not found"),!1;var m=this.inputs[e];if(!m)return!1;var v=this.inputs[e].link;this.inputs[e].link=
null;var D=this.graph.links[v];if(D){var B=this.graph.getNodeById(D.origin_id);if(!B)return!1;var I=B.outputs[D.origin_slot];if(!I||!I.links||0==I.links.length)return!1;for(var L=0,S=I.links.length;L<S;L++)if(I.links[L]==v){I.links.splice(L,1);break}delete this.graph.links[v];this.graph&&this.graph._version++;if(this.onConnectionsChange)this.onConnectionsChange(A.INPUT,e,!1,D,m);if(B.onConnectionsChange)B.onConnectionsChange(A.OUTPUT,L,!1,D,I);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(A.OUTPUT,
B,L),this.graph.onNodeConnectionChange(A.INPUT,this,e))}this.setDirtyCanvas(!1,!0);this.graph.connectionChange(this);return!0};f.prototype.getConnectionPos=function(e,m,v){v=v||new Float32Array(2);var D=0;e&&this.inputs&&(D=this.inputs.length);!e&&this.outputs&&(D=this.outputs.length);var B=.5*A.NODE_SLOT_HEIGHT;if(this.flags.collapsed)return m=this._collapsed_width||A.NODE_COLLAPSED_WIDTH,this.horizontal?(v[0]=this.pos[0]+.5*m,v[1]=e?this.pos[1]-A.NODE_TITLE_HEIGHT:this.pos[1]):(v[0]=e?this.pos[0]:
this.pos[0]+m,v[1]=this.pos[1]-.5*A.NODE_TITLE_HEIGHT),v;if(e&&-1==m)return v[0]=this.pos[0]+.5*A.NODE_TITLE_HEIGHT,v[1]=this.pos[1]+.5*A.NODE_TITLE_HEIGHT,v;if(e&&D>m&&this.inputs[m].pos)return v[0]=this.pos[0]+this.inputs[m].pos[0],v[1]=this.pos[1]+this.inputs[m].pos[1],v;if(!e&&D>m&&this.outputs[m].pos)return v[0]=this.pos[0]+this.outputs[m].pos[0],v[1]=this.pos[1]+this.outputs[m].pos[1],v;if(this.horizontal)return v[0]=this.pos[0]+this.size[0]/D*(m+.5),v[1]=e?this.pos[1]-A.NODE_TITLE_HEIGHT:this.pos[1]+
this.size[1],v;v[0]=e?this.pos[0]+B:this.pos[0]+this.size[0]+1-B;v[1]=this.pos[1]+(m+.7)*A.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0);return v};f.prototype.alignToGrid=function(){this.pos[0]=A.CANVAS_GRID_SIZE*Math.round(this.pos[0]/A.CANVAS_GRID_SIZE);this.pos[1]=A.CANVAS_GRID_SIZE*Math.round(this.pos[1]/A.CANVAS_GRID_SIZE)};f.prototype.trace=function(e){this.console||(this.console=[]);this.console.push(e);this.console.length>f.MAX_CONSOLE&&this.console.shift();if(this.graph.onNodeTrace)this.graph.onNodeTrace(this,
e)};f.prototype.setDirtyCanvas=function(e,m){this.graph&&this.graph.sendActionToCanvas("setDirty",[e,m])};f.prototype.loadImage=function(e){var m=new Image;m.src=A.node_images_path+e;m.ready=!1;var v=this;m.onload=function(){this.ready=!0;v.setDirtyCanvas(!0)};return m};f.prototype.captureInput=function(e){if(this.graph&&this.graph.list_of_graphcanvas)for(var m=this.graph.list_of_graphcanvas,v=0;v<m.length;++v){var D=m[v];if(e||D.node_capturing_input==this)D.node_capturing_input=e?this:null}};f.prototype.collapse=
function(e){this.graph._version++;if(!1!==this.constructor.collapsable||e)this.flags.collapsed=this.flags.collapsed?!1:!0,this.setDirtyCanvas(!0,!0)};f.prototype.pin=function(e){this.graph._version++;this.flags.pinned=void 0===e?!this.flags.pinned:e};f.prototype.localToScreen=function(e,m,v){return[(e+this.pos[0])*v.scale+v.offset[0],(m+this.pos[1])*v.scale+v.offset[1]]};c.LGraphGroup=A.LGraphGroup=q;q.prototype._ctor=function(e){this.title=e||"Group";this.font_size=24;this.color=k.node_colors.pale_blue?
k.node_colors.pale_blue.groupcolor:"#AAA";this._bounding=new Float32Array([10,10,140,80]);this._pos=this._bounding.subarray(0,2);this._size=this._bounding.subarray(2,4);this._nodes=[];this.graph=null;Object.defineProperty(this,"pos",{set:function(m){!m||2>m.length||(this._pos[0]=m[0],this._pos[1]=m[1])},get:function(){return this._pos},enumerable:!0});Object.defineProperty(this,"size",{set:function(m){!m||2>m.length||(this._size[0]=Math.max(140,m[0]),this._size[1]=Math.max(80,m[1]))},get:function(){return this._size},
enumerable:!0})};q.prototype.configure=function(e){this.title=e.title;this._bounding.set(e.bounding);this.color=e.color;this.font=e.font};q.prototype.serialize=function(){var e=this._bounding;return{title:this.title,bounding:[Math.round(e[0]),Math.round(e[1]),Math.round(e[2]),Math.round(e[3])],color:this.color,font:this.font}};q.prototype.move=function(e,m,v){this._pos[0]+=e;this._pos[1]+=m;if(!v)for(v=0;v<this._nodes.length;++v){var D=this._nodes[v];D.pos[0]+=e;D.pos[1]+=m}};q.prototype.recomputeInsideNodes=
function(){this._nodes.length=0;for(var e=this.graph._nodes,m=new Float32Array(4),v=0;v<e.length;++v){var D=e[v];D.getBounding(m);z(this._bounding,m)&&this._nodes.push(D)}};q.prototype.isPointInside=f.prototype.isPointInside;q.prototype.setDirtyCanvas=f.prototype.setDirtyCanvas;A.DragAndScale=l;l.prototype.bindEvents=function(e){this.last_mouse=new Float32Array(2);this._binded_mouse_callback=this.onMouse.bind(this);e.addEventListener("mousedown",this._binded_mouse_callback);e.addEventListener("mousemove",
this._binded_mouse_callback);e.addEventListener("mousewheel",this._binded_mouse_callback,!1);e.addEventListener("wheel",this._binded_mouse_callback,!1)};l.prototype.computeVisibleArea=function(){if(this.element){var e=-this.offset[0],m=-this.offset[1],v=e+this.element.width/this.scale,D=m+this.element.height/this.scale;this.visible_area[0]=e;this.visible_area[1]=m;this.visible_area[2]=v-e;this.visible_area[3]=D-m}else this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=
0};l.prototype.onMouse=function(e){if(this.enabled){var m=this.element,v=m.getBoundingClientRect(),D=e.clientX-v.left;v=e.clientY-v.top;e.canvasx=D;e.canvasy=v;e.dragging=this.dragging;var B=!1;this.onmouse&&(B=this.onmouse(e));if("mousedown"==e.type)this.dragging=!0,m.removeEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mouseup",this._binded_mouse_callback);else if("mousemove"==e.type)B||
(m=D-this.last_mouse[0],B=v-this.last_mouse[1],this.dragging&&this.mouseDrag(m,B));else if("mouseup"==e.type)this.dragging=!1,document.body.removeEventListener("mousemove",this._binded_mouse_callback),document.body.removeEventListener("mouseup",this._binded_mouse_callback),m.addEventListener("mousemove",this._binded_mouse_callback);else if("mousewheel"==e.type||"wheel"==e.type||"DOMMouseScroll"==e.type)e.eventType="mousewheel",e.wheel="wheel"==e.type?-e.deltaY:null!=e.wheelDeltaY?e.wheelDeltaY:-60*
e.detail,e.delta=e.wheelDelta?e.wheelDelta/40:e.deltaY?-e.deltaY/3:0,this.changeDeltaScale(1+.05*e.delta);this.last_mouse[0]=D;this.last_mouse[1]=v;e.preventDefault();e.stopPropagation();return!1}};l.prototype.toCanvasContext=function(e){e.scale(this.scale,this.scale);e.translate(this.offset[0],this.offset[1])};l.prototype.convertOffsetToCanvas=function(e){return[(e[0]+this.offset[0])*this.scale,(e[1]+this.offset[1])*this.scale]};l.prototype.convertCanvasToOffset=function(e,m){m=m||[0,0];m[0]=e[0]/
this.scale-this.offset[0];m[1]=e[1]/this.scale-this.offset[1];return m};l.prototype.mouseDrag=function(e,m){this.offset[0]+=e/this.scale;this.offset[1]+=m/this.scale;if(this.onredraw)this.onredraw(this)};l.prototype.changeScale=function(e,m){e<this.min_scale?e=this.min_scale:e>this.max_scale&&(e=this.max_scale);if(e!=this.scale&&this.element){var v=this.element.getBoundingClientRect();if(v&&(m=m||[.5*v.width,.5*v.height],v=this.convertCanvasToOffset(m),this.scale=e,.01>Math.abs(this.scale-1)&&(this.scale=
1),e=this.convertCanvasToOffset(m),e=[e[0]-v[0],e[1]-v[1]],this.offset[0]+=e[0],this.offset[1]+=e[1],this.onredraw))this.onredraw(this)}};l.prototype.changeDeltaScale=function(e,m){this.changeScale(this.scale*e,m)};l.prototype.reset=function(){this.scale=1;this.offset[0]=0;this.offset[1]=0};c.LGraphCanvas=A.LGraphCanvas=k;k.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=";
k.link_type_colors={"-1":A.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"};k.gradients={};k.prototype.clear=function(){this.fps=this.render_time=this.last_draw_time=this.frame=0;this.dragging_rectangle=null;this.selected_nodes={};this.selected_group=null;this.visible_nodes=[];this.connecting_node=this.node_capturing_input=this.node_over=this.node_dragged=null;this.highlighted_links={};this.dragging_canvas=!1;this.dirty_bgcanvas=this.dirty_canvas=!0;this.node_widget=this.node_in_panel=this.dirty_area=
null;this.last_mouse=[0,0];this.last_mouseclick=0;this.visible_area.set([0,0,0,0]);if(this.onClear)this.onClear()};k.prototype.setGraph=function(e,m){this.graph!=e&&(m||this.clear(),!e&&this.graph?this.graph.detachCanvas(this):(e.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)))};k.prototype.getTopGraph=function(){return this._graph_stack.length?this._graph_stack[0]:this.graph};k.prototype.openSubgraph=function(e){if(!e)throw"graph cannot be null";if(this.graph==
e)throw"graph cannot be the same";this.clear();this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph));e.attachCanvas(this);this.checkPanels();this.setDirty(!0,!0)};k.prototype.closeSubgraph=function(){if(this._graph_stack&&0!=this._graph_stack.length){var e=this.graph._subgraph_node,m=this._graph_stack.pop();this.selected_nodes={};this.highlighted_links={};m.attachCanvas(this);this.setDirty(!0,!0);e&&(this.centerOnNode(e),this.selectNodes([e]))}};k.prototype.getCurrentGraph=
function(){return this.graph};k.prototype.setCanvas=function(e,m){if(e&&e.constructor===String&&(e=document.getElementById(e),!e))throw"Error creating LiteGraph canvas: Canvas not found";if(e!==this.canvas&&(!e&&this.canvas&&(m||this.unbindEvents()),this.canvas=e,this.ds.element=e)){e.className+=" lgraphcanvas";e.data=this;e.tabindex="1";this.bgcanvas=null;this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height);
if(null==e.getContext){if("canvas"!=e.localName)throw"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+e.localName;throw"This browser doesn't support Canvas";}null==(this.ctx=e.getContext("2d"))&&(e.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL());this._mousemove_callback=this.processMouseMove.bind(this);this._mouseup_callback=this.processMouseUp.bind(this);m||this.bindEvents()}};k.prototype._doNothing=function(e){e.preventDefault();
return!1};k.prototype._doReturnTrue=function(e){e.preventDefault();return!0};k.prototype.bindEvents=function(){if(this._events_binded)console.warn("LGraphCanvas: events already binded");else{var e=this.canvas,m=this.getCanvasWindow().document;this._mousedown_callback=this.processMouseDown.bind(this);this._mousewheel_callback=this.processMouseWheel.bind(this);e.addEventListener("mousedown",this._mousedown_callback,!0);e.addEventListener("mousemove",this._mousemove_callback);e.addEventListener("mousewheel",
this._mousewheel_callback,!1);e.addEventListener("contextmenu",this._doNothing);e.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1);e.addEventListener("touchstart",this.touchHandler,!0);e.addEventListener("touchmove",this.touchHandler,!0);e.addEventListener("touchend",this.touchHandler,!0);e.addEventListener("touchcancel",this.touchHandler,!0);this._key_callback=this.processKey.bind(this);e.addEventListener("keydown",this._key_callback,!0);m.addEventListener("keyup",this._key_callback,
!0);this._ondrop_callback=this.processDrop.bind(this);e.addEventListener("dragover",this._doNothing,!1);e.addEventListener("dragend",this._doNothing,!1);e.addEventListener("drop",this._ondrop_callback,!1);e.addEventListener("dragenter",this._doReturnTrue,!1);this._events_binded=!0}};k.prototype.unbindEvents=function(){if(this._events_binded){var e=this.getCanvasWindow().document;this.canvas.removeEventListener("mousedown",this._mousedown_callback);this.canvas.removeEventListener("mousewheel",this._mousewheel_callback);
this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback);this.canvas.removeEventListener("keydown",this._key_callback);e.removeEventListener("keyup",this._key_callback);this.canvas.removeEventListener("contextmenu",this._doNothing);this.canvas.removeEventListener("drop",this._ondrop_callback);this.canvas.removeEventListener("dragenter",this._doReturnTrue);this.canvas.removeEventListener("touchstart",this.touchHandler);this.canvas.removeEventListener("touchmove",this.touchHandler);
this.canvas.removeEventListener("touchend",this.touchHandler);this.canvas.removeEventListener("touchcancel",this.touchHandler);this._ondrop_callback=this._key_callback=this._mousewheel_callback=this._mousedown_callback=null;this._events_binded=!1}else console.warn("LGraphCanvas: no events binded")};k.getFileExtension=function(e){var m=e.indexOf("?");-1!=m&&(e=e.substr(0,m));m=e.lastIndexOf(".");return-1==m?"":e.substr(m+1).toLowerCase()};k.prototype.enableWebGL=function(){this.gl=this.ctx=enableWebGLCanvas(this.canvas);
this.ctx.webgl=!0;this.bgcanvas=this.canvas;this.bgctx=this.gl;this.canvas.webgl_enabled=!0};k.prototype.setDirty=function(e,m){e&&(this.dirty_canvas=!0);m&&(this.dirty_bgcanvas=!0)};k.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var e=this.canvas.ownerDocument;return e.defaultView||e.parentWindow};k.prototype.startRendering=function(){function e(){this.pause_rendering||this.draw();var m=this.getCanvasWindow();this.is_rendering&&m.requestAnimationFrame(e.bind(this))}this.is_rendering||
(this.is_rendering=!0,e.call(this))};k.prototype.stopRendering=function(){this.is_rendering=!1};k.prototype.blockClick=function(){this.block_click=!0;this.last_mouseclick=0};k.prototype.processMouseDown=function(e){this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0);if(this.graph){this.adjustMouseEvent(e);var m=this.getCanvasWindow();k.active_canvas=this;var v=this;this.canvas.removeEventListener("mousemove",this._mousemove_callback);m.document.addEventListener("mousemove",this._mousemove_callback,
!0);m.document.addEventListener("mouseup",this._mouseup_callback,!0);var D=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes,5),B=!1,I=300>A.getTime()-this.last_mouseclick;this.mouse[0]=e.localX;this.mouse[1]=e.localY;this.graph_mouse[0]=e.canvasX;this.graph_mouse[1]=e.canvasY;this.last_click_position=[this.mouse[0],this.mouse[1]];this.canvas.focus();A.closeAllContextMenus(m);if(!this.onMouse||1!=this.onMouse(e)){if(1==e.which){e.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),
this.dragging_rectangle[0]=e.canvasX,this.dragging_rectangle[1]=e.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,B=!0);var L=!1;if(D&&this.allow_interaction&&!B&&!this.read_only){this.live_mode||D.flags.pinned||this.bringToFront(D);if(!this.connecting_node&&!D.flags.collapsed&&!this.live_mode)if(!B&&!1!==D.resizable&&r(e.canvasX,e.canvasY,D.pos[0]+D.size[0]-5,D.pos[1]+D.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=D,this.canvas.style.cursor="se-resize",B=!0;else{if(D.outputs)for(var S=
0,R=D.outputs.length;S<R;++S){var W=D.outputs[S],X=D.getConnectionPos(!1,S);if(r(e.canvasX,e.canvasY,X[0]-15,X[1]-10,30,20)){this.connecting_node=D;this.connecting_output=W;this.connecting_pos=D.getConnectionPos(!1,S);this.connecting_slot=S;e.shiftKey&&D.disconnectOutput(S);if(I){if(D.onOutputDblClick)D.onOutputDblClick(S,e)}else if(D.onOutputClick)D.onOutputClick(S,e);B=!0;break}}if(D.inputs)for(S=0,R=D.inputs.length;S<R;++S)if(W=D.inputs[S],X=D.getConnectionPos(!0,S),r(e.canvasX,e.canvasY,X[0]-
15,X[1]-10,30,20)){if(I){if(D.onInputDblClick)D.onInputDblClick(S,e)}else if(D.onInputClick)D.onInputClick(S,e);if(null!==W.link){B=this.graph.links[W.link];D.disconnectInput(S);if(this.allow_reconnect_links||e.shiftKey)this.connecting_node=this.graph._nodes_by_id[B.origin_id],this.connecting_slot=B.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot);B=this.dirty_bgcanvas=!0}}}if(!B){S=
!1;R=[e.canvasX-D.pos[0],e.canvasY-D.pos[1]];if(X=this.processNodeWidgets(D,this.graph_mouse,e))S=!0,this.node_widget=[D,X];if(I&&this.selected_nodes[D.id]){if(D.onDblClick)D.onDblClick(e,R,this);this.processNodeDblClicked(D);S=!0}D.onMouseDown&&D.onMouseDown(e,R,this)?S=!0:(D.subgraph&&!D.skip_subgraph_button&&!D.flags.collapsed&&R[0]>D.size[0]-A.NODE_TITLE_HEIGHT&&0>R[1]&&(v=this,setTimeout(function(){v.openSubgraph(D.subgraph)},10)),this.live_mode&&(S=L=!0));S||(this.allow_dragnodes&&(this.graph.beforeChange(),
this.node_dragged=D),this.selected_nodes[D.id]||this.processNodeSelected(D,e));this.dirty_canvas=!0}}else{if(!this.read_only)for(S=0;S<this.visible_links.length;++S)if(L=this.visible_links[S],R=L._pos,!(!R||e.canvasX<R[0]-4||e.canvasX>R[0]+4||e.canvasY<R[1]-4||e.canvasY>R[1]+4)){this.showLinkMenu(L,e);this.over_link_center=null;break}this.selected_group=this.graph.getGroupOnPos(e.canvasX,e.canvasY);this.selected_group_resizing=!1;this.selected_group&&!this.read_only&&(e.ctrlKey&&(this.dragging_rectangle=
null),10>u([e.canvasX,e.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]])*this.ds.scale?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes());I&&!this.read_only&&this.allow_searchbox&&this.showSearchBox(e);L=!0}!B&&L&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else 2!=e.which&&3==e.which&&(this.read_only||this.processContextMenu(D,e));this.last_mouse[0]=e.localX;this.last_mouse[1]=e.localY;this.last_mouseclick=
A.getTime();this.last_mouse_dragging=!0;this.graph.change();(!m.document.activeElement||"input"!=m.document.activeElement.nodeName.toLowerCase()&&"textarea"!=m.document.activeElement.nodeName.toLowerCase())&&e.preventDefault();e.stopPropagation();if(this.onMouseDown)this.onMouseDown(e);return!1}}};k.prototype.processMouseMove=function(e){this.autoresize&&this.resize();this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0);if(this.graph){k.active_canvas=this;this.adjustMouseEvent(e);var m=[e.localX,
e.localY];this.mouse[0]=m[0];this.mouse[1]=m[1];var v=[m[0]-this.last_mouse[0],m[1]-this.last_mouse[1]];this.last_mouse=m;this.graph_mouse[0]=e.canvasX;this.graph_mouse[1]=e.canvasY;if(this.block_click)return e.preventDefault(),!1;e.dragging=this.last_mouse_dragging;this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,e,this.node_widget[1]),this.dirty_canvas=!0);if(this.dragging_rectangle)this.dragging_rectangle[2]=e.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=
e.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only)this.selected_group_resizing?this.selected_group.size=[e.canvasX-this.selected_group.pos[0],e.canvasY-this.selected_group.pos[1]]:(this.selected_group.move(v[0]/this.ds.scale,v[1]/this.ds.scale,e.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)),this.dirty_bgcanvas=!0;else if(this.dragging_canvas)this.ds.offset[0]+=v[0]/this.ds.scale,this.ds.offset[1]+=v[1]/this.ds.scale,this.dirty_bgcanvas=
this.dirty_canvas=!0;else if(this.allow_interaction&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);var D=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes);m=0;for(var B=this.graph._nodes.length;m<B;++m)if(this.graph._nodes[m].mouseOver&&D!=this.graph._nodes[m]){this.graph._nodes[m].mouseOver=!1;if(this.node_over&&this.node_over.onMouseLeave)this.node_over.onMouseLeave(e);this.node_over=null;this.dirty_canvas=!0}if(D){D.redraw_on_mouse&&(this.dirty_canvas=!0);if(!D.mouseOver&&
(D.mouseOver=!0,this.node_over=D,this.dirty_canvas=!0,D.onMouseEnter))D.onMouseEnter(e);if(D.onMouseMove)D.onMouseMove(e,[e.canvasX-D.pos[0],e.canvasY-D.pos[1]],this);if(this.connecting_node&&(B=this._highlight_input||[0,0],!this.isOverNodeBox(D,e.canvasX,e.canvasY))){var I=this.isOverNodeInput(D,e.canvasX,e.canvasY,B);-1!=I&&D.inputs[I]?A.isValidConnection(this.connecting_output.type,D.inputs[I].type)&&(this._highlight_input=B):this._highlight_input=null}this.canvas&&(r(e.canvasX,e.canvasY,D.pos[0]+
D.size[0]-5,D.pos[1]+D.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{B=null;for(m=0;m<this.visible_links.length;++m){I=this.visible_links[m];var L=I._pos;if(!(!L||e.canvasX<L[0]-4||e.canvasX>L[0]+4||e.canvasY<L[1]-4||e.canvasY>L[1]+4)){B=I;break}}B!=this.over_link_center&&(this.over_link_center=B,this.dirty_canvas=!0);this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=D&&this.node_capturing_input.onMouseMove)this.node_capturing_input.onMouseMove(e,
[e.canvasX-this.node_capturing_input.pos[0],e.canvasY-this.node_capturing_input.pos[1]],this);if(this.node_dragged&&!this.live_mode){for(m in this.selected_nodes)D=this.selected_nodes[m],D.pos[0]+=v[0]/this.ds.scale,D.pos[1]+=v[1]/this.ds.scale;this.dirty_bgcanvas=this.dirty_canvas=!0}this.resizing_node&&!this.live_mode&&(v=[e.canvasX-this.resizing_node.pos[0],e.canvasY-this.resizing_node.pos[1]],m=this.resizing_node.computeSize(),v[0]=Math.max(m[0],v[0]),v[1]=Math.max(m[1],v[1]),this.resizing_node.setSize(v),
this.canvas.style.cursor="se-resize",this.dirty_bgcanvas=this.dirty_canvas=!0)}e.preventDefault();return!1}};k.prototype.processMouseUp=function(e){this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0);if(this.graph){var m=this.getCanvasWindow().document;k.active_canvas=this;m.removeEventListener("mousemove",this._mousemove_callback,!0);this.canvas.addEventListener("mousemove",this._mousemove_callback,!0);m.removeEventListener("mouseup",this._mouseup_callback,!0);this.adjustMouseEvent(e);m=
A.getTime();e.click_time=m-this.last_mouseclick;this.last_mouse_dragging=!1;this.last_click_position=null;this.block_click&&(console.log("foo"),this.block_click=!1);if(1==e.which)if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,e),this.node_widget=null,this.selected_group&&(this.selected_group.move(this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]),e.ctrlKey),this.selected_group.pos[0]=
Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null),this.selected_group_resizing=!1,this.dragging_rectangle){if(this.graph){m=this.graph._nodes;var v=new Float32Array(4);this.deselectAllNodes();var D=Math.abs(this.dragging_rectangle[2]),B=Math.abs(this.dragging_rectangle[3]),I=0>this.dragging_rectangle[3]?this.dragging_rectangle[1]-B:this.dragging_rectangle[1];this.dragging_rectangle[0]=
0>this.dragging_rectangle[2]?this.dragging_rectangle[0]-D:this.dragging_rectangle[0];this.dragging_rectangle[1]=I;this.dragging_rectangle[2]=D;this.dragging_rectangle[3]=B;B=[];for(I=0;I<m.length;++I)D=m[I],D.getBounding(v),z(this.dragging_rectangle,v)&&B.push(D);B.length&&this.selectNodes(B)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_bgcanvas=this.dirty_canvas=!0;if(D=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes))this.connecting_output.type==A.EVENT&&
this.isOverNodeBox(D,e.canvasX,e.canvasY)?this.connecting_node.connect(this.connecting_slot,D,A.EVENT):(m=this.isOverNodeInput(D,e.canvasX,e.canvasY),-1!=m?this.connecting_node.connect(this.connecting_slot,D,m):(m=D.getInputInfo(0),this.connecting_output.type==A.EVENT?this.connecting_node.connect(this.connecting_slot,D,A.EVENT):m&&!m.link&&A.isValidConnection(m.type&&this.connecting_output.type)&&this.connecting_node.connect(this.connecting_slot,D,0)));this.connecting_node=this.connecting_pos=this.connecting_output=
null;this.connecting_slot=-1}else if(this.resizing_node)this.dirty_bgcanvas=this.dirty_canvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null;else if(this.node_dragged){(D=this.node_dragged)&&300>e.click_time&&r(e.canvasX,e.canvasY,D.pos[0],D.pos[1]-A.NODE_TITLE_HEIGHT,A.NODE_TITLE_HEIGHT,A.NODE_TITLE_HEIGHT)&&D.collapse();this.dirty_bgcanvas=this.dirty_canvas=!0;this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]);this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]);
this.graph.config.align_to_grid&&this.node_dragged.alignToGrid();if(this.onNodeMoved)this.onNodeMoved(this.node_dragged);this.graph.afterChange(this.node_dragged);this.node_dragged=null}else{D=this.graph.getNodeOnPos(e.canvasX,e.canvasY,this.visible_nodes);!D&&300>e.click_time&&this.deselectAllNodes();this.dirty_canvas=!0;this.dragging_canvas=!1;if(this.node_over&&this.node_over.onMouseUp)this.node_over.onMouseUp(e,[e.canvasX-this.node_over.pos[0],e.canvasY-this.node_over.pos[1]],this);if(this.node_capturing_input&&
this.node_capturing_input.onMouseUp)this.node_capturing_input.onMouseUp(e,[e.canvasX-this.node_capturing_input.pos[0],e.canvasY-this.node_capturing_input.pos[1]])}else 2==e.which?(this.dirty_canvas=!0,this.dragging_canvas=!1):3==e.which&&(this.dirty_canvas=!0,this.dragging_canvas=!1);this.graph.change();e.stopPropagation();e.preventDefault();return!1}};k.prototype.processMouseWheel=function(e){if(this.graph&&this.allow_dragcanvas){var m=null!=e.wheelDeltaY?e.wheelDeltaY:-60*e.detail;this.adjustMouseEvent(e);
var v=this.ds.scale;0<m?v*=1.1:0>m&&(v*=1/1.1);this.ds.changeScale(v,[e.localX,e.localY]);this.graph.change();e.preventDefault();return!1}};k.prototype.isOverNodeBox=function(e,m,v){var D=A.NODE_TITLE_HEIGHT;return r(m,v,e.pos[0]+2,e.pos[1]+2-D,D-4,D-4)?!0:!1};k.prototype.isOverNodeInput=function(e,m,v,D){if(e.inputs)for(var B=0,I=e.inputs.length;B<I;++B){var L=e.getConnectionPos(!0,B);if(e.horizontal?r(m,v,L[0]-5,L[1]-10,10,20):r(m,v,L[0]-10,L[1]-5,40,10))return D&&(D[0]=L[0],D[1]=L[1]),B}return-1};
k.prototype.processKey=function(e){if(this.graph){var m=!1;if("input"!=e.target.localName){if("keydown"==e.type){if(32==e.keyCode&&(m=this.dragging_canvas=!0),65==e.keyCode&&e.ctrlKey&&(this.selectNodes(),m=!0),"KeyC"==e.code&&(e.metaKey||e.ctrlKey)&&!e.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),m=!0),"KeyV"!=e.code||!e.metaKey&&!e.ctrlKey||e.shiftKey||this.pasteFromClipboard(),46!=e.keyCode&&8!=e.keyCode||"input"==e.target.localName||"textarea"==e.target.localName||(this.deleteSelectedNodes(),
m=!0),this.selected_nodes)for(var v in this.selected_nodes)if(this.selected_nodes[v].onKeyDown)this.selected_nodes[v].onKeyDown(e)}else if("keyup"==e.type&&(32==e.keyCode&&(this.dragging_canvas=!1),this.selected_nodes))for(v in this.selected_nodes)if(this.selected_nodes[v].onKeyUp)this.selected_nodes[v].onKeyUp(e);this.graph.change();if(m)return e.preventDefault(),e.stopImmediatePropagation(),!1}}};k.prototype.copyToClipboard=function(){var e={nodes:[],links:[]},m=0,v=[],D;for(D in this.selected_nodes){var B=
this.selected_nodes[D];B._relative_id=m;v.push(B);m+=1}for(D=0;D<v.length;++D)if(B=v[D],m=B.clone()){if(e.nodes.push(m.serialize()),B.inputs&&B.inputs.length)for(m=0;m<B.inputs.length;++m){var I=B.inputs[m];if(I&&null!=I.link&&(I=this.graph.links[I.link])){var L=this.graph.getNodeById(I.origin_id);L&&this.selected_nodes[L.id]&&e.links.push([L._relative_id,I.origin_slot,B._relative_id,I.target_slot])}}}else console.warn("node type not found: "+B.type);localStorage.setItem("litegrapheditor_clipboard",
JSON.stringify(e))};k.prototype.pasteFromClipboard=function(){var e=localStorage.getItem("litegrapheditor_clipboard");if(e){this.graph.beforeChange();e=JSON.parse(e);for(var m=[],v=0;v<e.nodes.length;++v){var D=e.nodes[v],B=A.createNode(D.type);B&&(B.configure(D),B.pos[0]+=5,B.pos[1]+=5,this.graph.add(B),m.push(B))}for(v=0;v<e.links.length;++v){D=e.links[v];B=m[D[0]];var I=m[D[2]];B&&I?B.connect(D[1],I,D[3]):console.warn("Warning, nodes missing on pasting")}this.selectNodes(m);this.graph.afterChange()}};
k.prototype.processDrop=function(e){e.preventDefault();this.adjustMouseEvent(e);var m=[e.canvasX,e.canvasY],v=this.graph?this.graph.getNodeOnPos(m[0],m[1]):null;if(v){if((v.onDropFile||v.onDropData)&&(m=e.dataTransfer.files)&&m.length)for(var D=0;D<m.length;D++){var B=e.dataTransfer.files[0],I=B.name;k.getFileExtension(I);if(v.onDropFile)v.onDropFile(B);if(v.onDropData){var L=new FileReader;L.onload=function(R){v.onDropData(R.target.result,I,B)};var S=B.type.split("/")[0];"text"==S||""==S?L.readAsText(B):
"image"==S?L.readAsDataURL(B):L.readAsArrayBuffer(B)}}return v.onDropItem&&v.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}m=null;this.onDropItem&&(m=this.onDropItem(event));m||this.checkDropItem(e)};k.prototype.checkDropItem=function(e){if(e.dataTransfer.files.length){var m=e.dataTransfer.files[0],v=k.getFileExtension(m.name).toLowerCase();if(v=A.node_types_by_file_extension[v]){this.graph.beforeChange();v=A.createNode(v.type);v.pos=[e.canvasX,e.canvasY];this.graph.add(v);if(v.onDropFile)v.onDropFile(m);
this.graph.afterChange()}}};k.prototype.processNodeDblClicked=function(e){if(this.onShowNodePanel)this.onShowNodePanel(e);else this.showShowNodePanel(e);if(this.onNodeDblClicked)this.onNodeDblClicked(e);this.setDirty(!0)};k.prototype.processNodeSelected=function(e,m){this.selectNode(e,m&&m.shiftKey);if(this.onNodeSelected)this.onNodeSelected(e)};k.prototype.selectNode=function(e,m){null==e?this.deselectAllNodes():this.selectNodes([e],m)};k.prototype.selectNodes=function(e,m){m||this.deselectAllNodes();
e=e||this.graph._nodes;for(m=0;m<e.length;++m){var v=e[m];if(!v.is_selected){if(!v.is_selected&&v.onSelected)v.onSelected();v.is_selected=!0;this.selected_nodes[v.id]=v;if(v.inputs)for(var D=0;D<v.inputs.length;++D)this.highlighted_links[v.inputs[D].link]=!0;if(v.outputs)for(D=0;D<v.outputs.length;++D){var B=v.outputs[D];if(B.links)for(var I=0;I<B.links.length;++I)this.highlighted_links[B.links[I]]=!0}}}if(this.onSelectionChange)this.onSelectionChange(this.selected_nodes);this.setDirty(!0)};k.prototype.deselectNode=
function(e){if(e.is_selected){if(e.onDeselected)e.onDeselected();e.is_selected=!1;if(this.onNodeDeselected)this.onNodeDeselected(e);if(e.inputs)for(var m=0;m<e.inputs.length;++m)delete this.highlighted_links[e.inputs[m].link];if(e.outputs)for(m=0;m<e.outputs.length;++m){var v=e.outputs[m];if(v.links)for(var D=0;D<v.links.length;++D)delete this.highlighted_links[v.links[D]]}}};k.prototype.deselectAllNodes=function(){if(this.graph){for(var e=this.graph._nodes,m=0,v=e.length;m<v;++m){var D=e[m];if(D.is_selected){if(D.onDeselected)D.onDeselected();
D.is_selected=!1;if(this.onNodeDeselected)this.onNodeDeselected(D)}}this.selected_nodes={};this.current_node=null;this.highlighted_links={};if(this.onSelectionChange)this.onSelectionChange(this.selected_nodes);this.setDirty(!0)}};k.prototype.deleteSelectedNodes=function(){this.graph.beforeChange();for(var e in this.selected_nodes){var m=this.selected_nodes[e];if(!m.block_delete){if(m.inputs&&m.inputs.length&&m.outputs&&m.outputs.length&&A.isValidConnection(m.inputs[0].type,m.outputs[0].type)&&m.inputs[0].link&&
m.outputs[0].links&&m.outputs[0].links.length){var v=m.graph.links[m.inputs[0].link],D=m.graph.links[m.outputs[0].links[0]],B=m.getInputNode(0),I=m.getOutputNodes(0)[0];B&&I&&B.connect(v.origin_slot,I,D.target_slot)}this.graph.remove(m);if(this.onNodeDeselected)this.onNodeDeselected(m)}}this.selected_nodes={};this.current_node=null;this.highlighted_links={};this.setDirty(!0);this.graph.afterChange()};k.prototype.centerOnNode=function(e){this.ds.offset[0]=-e.pos[0]-.5*e.size[0]+.5*this.canvas.width/
this.ds.scale;this.ds.offset[1]=-e.pos[1]-.5*e.size[1]+.5*this.canvas.height/this.ds.scale;this.setDirty(!0,!0)};k.prototype.adjustMouseEvent=function(e){if(this.canvas){var m=this.canvas.getBoundingClientRect();e.localX=e.clientX-m.left;e.localY=e.clientY-m.top}else e.localX=e.clientX,e.localY=e.clientY;e.deltaX=e.localX-this.last_mouse_position[0];e.deltaY=e.localY-this.last_mouse_position[1];this.last_mouse_position[0]=e.localX;this.last_mouse_position[1]=e.localY;e.canvasX=e.localX/this.ds.scale-
this.ds.offset[0];e.canvasY=e.localY/this.ds.scale-this.ds.offset[1]};k.prototype.setZoom=function(e,m){this.ds.changeScale(e,m);this.dirty_bgcanvas=this.dirty_canvas=!0};k.prototype.convertOffsetToCanvas=function(e,m){return this.ds.convertOffsetToCanvas(e,m)};k.prototype.convertCanvasToOffset=function(e,m){return this.ds.convertCanvasToOffset(e,m)};k.prototype.convertEventToCanvasOffset=function(e){var m=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([e.clientX-m.left,e.clientY-
m.top])};k.prototype.bringToFront=function(e){var m=this.graph._nodes.indexOf(e);-1!=m&&(this.graph._nodes.splice(m,1),this.graph._nodes.push(e))};k.prototype.sendToBack=function(e){var m=this.graph._nodes.indexOf(e);-1!=m&&(this.graph._nodes.splice(m,1),this.graph._nodes.unshift(e))};var H=new Float32Array(4);k.prototype.computeVisibleNodes=function(e,m){m=m||[];m.length=0;e=e||this.graph._nodes;for(var v=0,D=e.length;v<D;++v){var B=e[v];(!this.live_mode||B.onDrawBackground||B.onDrawForeground)&&
z(this.visible_area,B.getBounding(H))&&m.push(B)}return m};k.prototype.draw=function(e,m){if(this.canvas&&0!=this.canvas.width&&0!=this.canvas.height){var v=A.getTime();this.render_time=.001*(v-this.last_draw_time);this.last_draw_time=v;this.graph&&this.ds.computeVisibleArea();(this.dirty_bgcanvas||m||this.always_render_background||this.graph&&this.graph._last_trigger_time&&1E3>v-this.graph._last_trigger_time)&&this.drawBackCanvas();(this.dirty_canvas||e)&&this.drawFrontCanvas();this.fps=this.render_time?
1/this.render_time:0;this.frame+=1}};k.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1;this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var e=this.ctx;if(e){e.start2D&&e.start2D();var m=this.canvas;e.restore();e.setTransform(1,0,0,1,0,0);this.dirty_area&&(e.save(),e.beginPath(),e.rect(this.dirty_area[0],this.dirty_area[1],this.dirty_area[2],this.dirty_area[3]),e.clip());this.clear_background&&e.clearRect(0,0,m.width,m.height);this.bgcanvas==this.canvas?this.drawBackCanvas():e.drawImage(this.bgcanvas,
0,0);if(this.onRender)this.onRender(m,e);this.show_info&&this.renderInfo(e);if(this.graph){e.save();this.ds.toCanvasContext(e);m=this.computeVisibleNodes(null,this.visible_nodes);for(var v=0;v<m.length;++v){var D=m[v];e.save();e.translate(D.pos[0],D.pos[1]);this.drawNode(D,e);e.restore()}this.render_execution_order&&this.drawExecutionOrder(e);this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(e));if(null!=this.connecting_pos){e.lineWidth=this.connections_width;switch(this.connecting_output.type){case A.EVENT:m=
A.EVENT_LINK_COLOR;break;default:m=A.CONNECTING_LINK_COLOR}this.renderLink(e,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,m,this.connecting_output.dir||(this.connecting_node.horizontal?A.DOWN:A.RIGHT),A.CENTER);e.beginPath();this.connecting_output.type===A.EVENT||this.connecting_output.shape===A.BOX_SHAPE?e.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10):e.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,2*Math.PI);e.fill();e.fillStyle="#ffcc00";
this._highlight_input&&(e.beginPath(),e.arc(this._highlight_input[0],this._highlight_input[1],6,0,2*Math.PI),e.fill())}this.dragging_rectangle&&(e.strokeStyle="#FFF",e.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3]));if(this.over_link_center&&this.render_link_tooltip)this.drawLinkTooltip(e,this.over_link_center);else if(this.onDrawLinkTooltip)this.onDrawLinkTooltip(e,null);if(this.onDrawForeground)this.onDrawForeground(e,this.visible_rect);
e.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(e);if(this.onDrawOverlay)this.onDrawOverlay(e);this.dirty_area&&e.restore();e.finish2D&&e.finish2D()}};k.prototype.drawSubgraphPanel=function(e){var m=this.graph,v=m._subgraph_node;if(v){var D=v.inputs?v.inputs.length:0,B=Math.floor(1.6*A.NODE_SLOT_HEIGHT);e.fillStyle="#111";e.globalAlpha=.8;e.beginPath();e.roundRect(10,10,300,(D+1)*B+50,8);e.fill();e.globalAlpha=1;e.fillStyle="#888";e.font="14px Arial";e.textAlign="left";
e.fillText("Graph Inputs",20,34);if(this.drawButton(280,20,20,20,"X","#151515"))this.closeSubgraph();else{D=50;e.font="20px Arial";if(v.inputs)for(var I=0;I<v.inputs.length;++I){var L=v.inputs[I];if(!L.not_subgraph_input){if(this.drawButton(20,D+2,280,B-2)){var S=v.constructor.input_node_type||"graph/input";this.graph.beforeChange();var R=A.createNode(S);R?(m.add(R),this.block_click=!1,this.last_click_position=null,this.selectNodes([R]),this.node_dragged=R,this.dragging_canvas=!1,R.setProperty("name",
L.name),R.setProperty("type",L.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",S)}e.fillStyle="#9C9";e.beginPath();e.arc(284,D+.5*B,5,0,2*Math.PI);e.fill();e.fillStyle="#AAA";e.fillText(L.name,50,D+.75*B);S=e.measureText(L.name);e.fillStyle="#777";e.fillText(L.type,50+S.width+10,D+.75*B);D+=B}}this.drawButton(20,D+2,280,B-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(v)}}else console.warn("subgraph without subnode")};
k.prototype.drawButton=function(e,m,v,D,B,I,L,S){var R=this.ctx;I=I||A.NODE_DEFAULT_COLOR;L=L||"#555";S=S||A.NODE_TEXT_COLOR;var W=this.mouse,X=A.isInsideRectangle(W[0],W[1],e,m,v,D);W=(W=this.last_click_position)&&A.isInsideRectangle(W[0],W[1],e,m,v,D);R.fillStyle=X?L:I;W&&(R.fillStyle="#AAA");R.beginPath();R.roundRect(e,m,v,D,4);R.fill();null!=B&&B.constructor==String&&(R.fillStyle=S,R.textAlign="center",R.font=(.65*D|0)+"px Arial",R.fillText(B,e+.5*v,m+.75*D),R.textAlign="left");e=W&&!this.block_click;
W&&this.blockClick();return e};k.prototype.isAreaClicked=function(e,m,v,D,B){var I=this.mouse;A.isInsideRectangle(I[0],I[1],e,m,v,D);m=(e=(I=this.last_click_position)&&A.isInsideRectangle(I[0],I[1],e,m,v,D))&&!this.block_click;e&&B&&this.blockClick();return m};k.prototype.renderInfo=function(e,m,v){m=m||10;v=v||this.canvas.height-80;e.save();e.translate(m,v);e.font="10px Arial";e.fillStyle="#888";this.graph?(e.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),e.fillText("I: "+this.graph.iteration,
5,26),e.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),e.fillText("V: "+this.graph._version,5,52),e.fillText("FPS:"+this.fps.toFixed(2),5,65)):e.fillText("No graph selected",5,13);e.restore()};k.prototype.drawBackCanvas=function(){var e=this.bgcanvas;if(e.width!=this.canvas.width||e.height!=this.canvas.height)e.width=this.canvas.width,e.height=this.canvas.height;this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var m=this.bgctx;m.start&&m.start();this.clear_background&&
m.clearRect(0,0,e.width,e.height);if(this._graph_stack&&this._graph_stack.length){m.save();var v=this.graph._subgraph_node;m.strokeStyle=v.bgcolor;m.lineWidth=10;m.strokeRect(1,1,e.width-2,e.height-2);m.lineWidth=1;m.font="40px Arial";m.textAlign="center";m.fillStyle=v.bgcolor||"#AAA";for(var D="",B=1;B<this._graph_stack.length;++B)D+=this._graph_stack[B]._subgraph_node.getTitle()+" >> ";m.fillText(D+v.getTitle(),.5*e.width,40);m.restore()}v=!1;this.onRenderBackground&&(v=this.onRenderBackground(e,
m));m.restore();m.setTransform(1,0,0,1,0,0);this.visible_links.length=0;if(this.graph){m.save();this.ds.toCanvasContext(m);if(this.background_image&&.5<this.ds.scale&&!v){m.globalAlpha=this.zoom_modify_alpha?(1-.5/this.ds.scale)*this.editor_alpha:this.editor_alpha;m.imageSmoothingEnabled=m.mozImageSmoothingEnabled=m.imageSmoothingEnabled=!1;if(!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image;this._bg_img.name=this.background_image;this._bg_img.src=this.background_image;
var I=this;this._bg_img.onload=function(){I.draw(!0,!0)}}v=null;null==this._pattern&&0<this._bg_img.width?(v=m.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=v):v=this._pattern;v&&(m.fillStyle=v,m.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),m.fillStyle="transparent");m.globalAlpha=1;m.imageSmoothingEnabled=m.mozImageSmoothingEnabled=m.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(e,
m);if(this.onDrawBackground)this.onDrawBackground(m,this.visible_area);this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null);this.render_canvas_border&&(m.strokeStyle="#235",m.strokeRect(0,0,e.width,e.height));this.render_connections_shadows?(m.shadowColor="#000",m.shadowOffsetX=0,m.shadowOffsetY=0,m.shadowBlur=6):m.shadowColor="rgba(0,0,0,0)";this.live_mode||this.drawConnections(m);m.shadowColor="rgba(0,0,0,0)";
m.restore()}m.finish&&m.finish();this.dirty_bgcanvas=!1;this.dirty_canvas=!0};var J=new Float32Array(2);k.prototype.drawNode=function(e,m){this.current_node=e;var v=e.color||e.constructor.color||A.NODE_DEFAULT_COLOR,D=e.bgcolor||e.constructor.bgcolor||A.NODE_DEFAULT_BGCOLOR,B=.6>this.ds.scale;if(this.live_mode){if(!e.flags.collapsed&&(m.shadowColor="transparent",e.onDrawForeground))e.onDrawForeground(m,this,this.canvas)}else{var I=this.editor_alpha;m.globalAlpha=I;this.render_shadows&&!B?(m.shadowColor=
A.DEFAULT_SHADOW_COLOR,m.shadowOffsetX=2*this.ds.scale,m.shadowOffsetY=2*this.ds.scale,m.shadowBlur=3*this.ds.scale):m.shadowColor="transparent";if(!e.flags.collapsed||!e.onDrawCollapsed||1!=e.onDrawCollapsed(m,this)){var L=e._shape||A.BOX_SHAPE;J.set(e.size);var S=e.horizontal;if(e.flags.collapsed){m.font=this.inner_text_font;var R=e.getTitle?e.getTitle():e.title;null!=R&&(e._collapsed_width=Math.min(e.size[0],m.measureText(R).width+2*A.NODE_TITLE_HEIGHT),J[0]=e._collapsed_width,J[1]=0)}e.clip_area&&
(m.save(),m.beginPath(),L==A.BOX_SHAPE?m.rect(0,0,J[0],J[1]):L==A.ROUND_SHAPE?m.roundRect(0,0,J[0],J[1],10):L==A.CIRCLE_SHAPE&&m.arc(.5*J[0],.5*J[1],.5*J[0],0,2*Math.PI),m.clip());e.has_errors&&(D="red");this.drawNodeShape(e,m,J,v,D,e.is_selected,e.mouseOver);m.shadowColor="transparent";if(e.onDrawForeground)e.onDrawForeground(m,this,this.canvas);m.textAlign=S?"center":"left";m.font=this.inner_text_font;D=!B;L=this.connecting_output;m.lineWidth=1;R=0;var W=new Float32Array(2);if(!e.flags.collapsed){if(e.inputs)for(v=
0;v<e.inputs.length;v++){var X=e.inputs[v];m.globalAlpha=I;this.connecting_node&&!A.isValidConnection(X.type,L.type)&&(m.globalAlpha=.4*I);m.fillStyle=null!=X.link?X.color_on||this.default_connection_color.input_on:X.color_off||this.default_connection_color.input_off;var V=e.getConnectionPos(!0,v,W);V[0]-=e.pos[0];V[1]-=e.pos[1];R<V[1]+.5*A.NODE_SLOT_HEIGHT&&(R=V[1]+.5*A.NODE_SLOT_HEIGHT);m.beginPath();X.type===A.EVENT||X.shape===A.BOX_SHAPE?S?m.rect(V[0]-5+.5,V[1]-8+.5,10,14):m.rect(V[0]-6+.5,V[1]-
5+.5,14,10):X.shape===A.ARROW_SHAPE?(m.moveTo(V[0]+8,V[1]+.5),m.lineTo(V[0]-4,V[1]+6+.5),m.lineTo(V[0]-4,V[1]-6+.5),m.closePath()):B?m.rect(V[0]-4,V[1]-4,8,8):m.arc(V[0],V[1],4,0,2*Math.PI);m.fill();if(D){var la=null!=X.label?X.label:X.name;la&&(m.fillStyle=A.NODE_TEXT_COLOR,S||X.dir==A.UP?m.fillText(la,V[0],V[1]-10):m.fillText(la,V[0]+10,V[1]+5))}}this.connecting_node&&(m.globalAlpha=.4*I);m.textAlign=S?"center":"right";m.strokeStyle="black";if(e.outputs)for(v=0;v<e.outputs.length;v++)if(X=e.outputs[v],
V=e.getConnectionPos(!1,v,W),V[0]-=e.pos[0],V[1]-=e.pos[1],R<V[1]+.5*A.NODE_SLOT_HEIGHT&&(R=V[1]+.5*A.NODE_SLOT_HEIGHT),m.fillStyle=X.links&&X.links.length?X.color_on||this.default_connection_color.output_on:X.color_off||this.default_connection_color.output_off,m.beginPath(),X.type===A.EVENT||X.shape===A.BOX_SHAPE?S?m.rect(V[0]-5+.5,V[1]-8+.5,10,14):m.rect(V[0]-6+.5,V[1]-5+.5,14,10):X.shape===A.ARROW_SHAPE?(m.moveTo(V[0]+8,V[1]+.5),m.lineTo(V[0]-4,V[1]+6+.5),m.lineTo(V[0]-4,V[1]-6+.5),m.closePath()):
B?m.rect(V[0]-4,V[1]-4,8,8):m.arc(V[0],V[1],4,0,2*Math.PI),m.fill(),B||m.stroke(),D&&(la=null!=X.label?X.label:X.name))m.fillStyle=A.NODE_TEXT_COLOR,S||X.dir==A.DOWN?m.fillText(la,V[0],V[1]-8):m.fillText(la,V[0]-10,V[1]+5);m.textAlign="left";m.globalAlpha=1;if(e.widgets){X=R;if(S||e.widgets_up)X=2;null!=e.widgets_start_y&&(X=e.widgets_start_y);this.drawNodeWidgets(e,X,m,this.node_widget&&this.node_widget[0]==e?this.node_widget[1]:null)}}else if(this.render_collapsed_slots){B=I=null;if(e.inputs)for(v=
0;v<e.inputs.length;v++)if(X=e.inputs[v],null!=X.link){I=X;break}if(e.outputs)for(v=0;v<e.outputs.length;v++)X=e.outputs[v],X.links&&X.links.length&&(B=X);I&&(I=0,v=-.5*A.NODE_TITLE_HEIGHT,S&&(I=.5*e._collapsed_width,v=-A.NODE_TITLE_HEIGHT),m.fillStyle="#686",m.beginPath(),X.type===A.EVENT||X.shape===A.BOX_SHAPE?m.rect(I-7+.5,v-4,14,8):X.shape===A.ARROW_SHAPE?(m.moveTo(I+8,v),m.lineTo(I+-4,v-4),m.lineTo(I+-4,v+4),m.closePath()):m.arc(I,v,4,0,2*Math.PI),m.fill());B&&(I=e._collapsed_width,v=-.5*A.NODE_TITLE_HEIGHT,
S&&(I=.5*e._collapsed_width,v=0),m.fillStyle="#686",m.strokeStyle="black",m.beginPath(),X.type===A.EVENT||X.shape===A.BOX_SHAPE?m.rect(I-7+.5,v-4,14,8):X.shape===A.ARROW_SHAPE?(m.moveTo(I+6,v),m.lineTo(I-6,v-4),m.lineTo(I-6,v+4),m.closePath()):m.arc(I,v,4,0,2*Math.PI),m.fill())}e.clip_area&&m.restore();m.globalAlpha=1}}};k.prototype.drawLinkTooltip=function(e,m){var v=m._pos;e.fillStyle="black";e.beginPath();e.arc(v[0],v[1],3,0,2*Math.PI);e.fill();if(null!=m.data&&(!this.onDrawLinkTooltip||1!=this.onDrawLinkTooltip(e,
m,this))&&(m=m.data,m=m.constructor===Number?m.toFixed(2):m.constructor===String?'"'+m+'"':m.constructor===Boolean?String(m):m.toToolTip?m.toToolTip():"["+m.constructor.name+"]",null!=m)){m=m.substr(0,30);e.font="14px Courier New";var D=e.measureText(m).width+20;e.shadowColor="black";e.shadowOffsetX=2;e.shadowOffsetY=2;e.shadowBlur=3;e.fillStyle="#454";e.beginPath();e.roundRect(v[0]-.5*D,v[1]-15-24,D,24,3,3);e.moveTo(v[0]-10,v[1]-15);e.lineTo(v[0]+10,v[1]-15);e.lineTo(v[0],v[1]-5);e.fill();e.shadowColor=
"transparent";e.textAlign="center";e.fillStyle="#CEC";e.fillText(m,v[0],v[1]-15-24*.3)}};var N=new Float32Array(4);k.prototype.drawNodeShape=function(e,m,v,D,B,I,L){m.strokeStyle=D;m.fillStyle=B;B=A.NODE_TITLE_HEIGHT;var S=.5>this.ds.scale,R=e._shape||e.constructor.shape||A.ROUND_SHAPE,W=e.constructor.title_mode,X=!0;W==A.TRANSPARENT_TITLE?X=!1:W==A.AUTOHIDE_TITLE&&L&&(X=!0);N[0]=0;N[1]=X?-B:0;N[2]=v[0]+1;N[3]=X?v[1]+B:v[1];L=m.globalAlpha;m.beginPath();R==A.BOX_SHAPE||S?m.fillRect(N[0],N[1],N[2],
N[3]):R==A.ROUND_SHAPE||R==A.CARD_SHAPE?m.roundRect(N[0],N[1],N[2],N[3],this.round_radius,R==A.CARD_SHAPE?0:this.round_radius):R==A.CIRCLE_SHAPE&&m.arc(.5*v[0],.5*v[1],.5*v[0],0,2*Math.PI);m.fill();e.flags.collapsed||(m.shadowColor="transparent",m.fillStyle="rgba(0,0,0,0.2)",m.fillRect(0,-1,N[2],2));m.shadowColor="transparent";if(e.onDrawBackground)e.onDrawBackground(m,this,this.canvas,this.graph_mouse);if(X||W==A.TRANSPARENT_TITLE){if(e.onDrawTitleBar)e.onDrawTitleBar(m,B,v,this.ds.scale,D);else if(W!=
A.TRANSPARENT_TITLE&&(e.constructor.title_color||this.render_title_colored)){X=e.constructor.title_color||D;e.flags.collapsed&&(m.shadowColor=A.DEFAULT_SHADOW_COLOR);if(this.use_gradients){var V=k.gradients[X];V||(V=k.gradients[X]=m.createLinearGradient(0,0,400,0),V.addColorStop(0,X),V.addColorStop(.25,D));m.fillStyle=V}else m.fillStyle=X;m.beginPath();R==A.BOX_SHAPE||S?m.rect(0,-B,v[0]+1,B):(R==A.ROUND_SHAPE||R==A.CARD_SHAPE)&&m.roundRect(0,-B,v[0]+1,B,this.round_radius,e.flags.collapsed?this.round_radius:
0);m.fill();m.shadowColor="transparent"}if(e.onDrawTitleBox)e.onDrawTitleBox(m,B,v,this.ds.scale);else R==A.ROUND_SHAPE||R==A.CIRCLE_SHAPE||R==A.CARD_SHAPE?(S&&(m.fillStyle="black",m.beginPath(),m.arc(.5*B,-.5*B,6,0,2*Math.PI),m.fill()),m.fillStyle=e.boxcolor||A.NODE_DEFAULT_BOXCOLOR,S?m.fillRect(.5*B-5,-.5*B-5,10,10):(m.beginPath(),m.arc(.5*B,-.5*B,5,0,2*Math.PI),m.fill())):(S&&(m.fillStyle="black",m.fillRect(.5*(B-10)-1,-.5*(B+10)-1,12,12)),m.fillStyle=e.boxcolor||A.NODE_DEFAULT_BOXCOLOR,m.fillRect(.5*
(B-10),-.5*(B+10),10,10));m.globalAlpha=L;if(e.onDrawTitleText)e.onDrawTitleText(m,B,v,this.ds.scale,this.title_text_font,I);!S&&(m.font=this.title_text_font,L=String(e.getTitle()))&&(m.fillStyle=I?"white":e.constructor.title_text_color||this.node_title_color,e.flags.collapsed?(m.textAlign="left",m.measureText(L),m.fillText(L.substr(0,20),B,A.NODE_TITLE_TEXT_Y-B),m.textAlign="left"):(m.textAlign="left",m.fillText(L,B,A.NODE_TITLE_TEXT_Y-B)));e.flags.collapsed||!e.subgraph||e.skip_subgraph_button||
(L=A.NODE_TITLE_HEIGHT,X=e.size[0]-L,V=A.isInsideRectangle(this.graph_mouse[0]-e.pos[0],this.graph_mouse[1]-e.pos[1],X+2,-L+2,L-4,L-4),m.fillStyle=V?"#888":"#555",R==A.BOX_SHAPE||S?m.fillRect(X+2,-L+2,L-4,L-4):(m.beginPath(),m.roundRect(X+2,-L+2,L-4,L-4,4),m.fill()),m.fillStyle="#333",m.beginPath(),m.moveTo(X+.2*L,.6*-L),m.lineTo(X+.8*L,.6*-L),m.lineTo(X+.5*L,.3*-L),m.fill());if(e.onDrawTitle)e.onDrawTitle(m)}if(I){if(e.onBounding)e.onBounding(N);W==A.TRANSPARENT_TITLE&&(N[1]-=B,N[3]+=B);m.lineWidth=
1;m.globalAlpha=.8;m.beginPath();R==A.BOX_SHAPE?m.rect(-6+N[0],-6+N[1],12+N[2],12+N[3]):R==A.ROUND_SHAPE||R==A.CARD_SHAPE&&e.flags.collapsed?m.roundRect(-6+N[0],-6+N[1],12+N[2],12+N[3],2*this.round_radius):R==A.CARD_SHAPE?m.roundRect(-6+N[0],-6+N[1],12+N[2],12+N[3],2*this.round_radius,2):R==A.CIRCLE_SHAPE&&m.arc(.5*v[0],.5*v[1],.5*v[0]+6,0,2*Math.PI);m.strokeStyle="#FFF";m.stroke();m.strokeStyle=D;m.globalAlpha=1}};var U=new Float32Array(4),p=new Float32Array(4),x=new Float32Array(2),G=new Float32Array(2);
k.prototype.drawConnections=function(e){var m=A.getTime(),v=this.visible_area;U[0]=v[0]-20;U[1]=v[1]-20;U[2]=v[2]+40;U[3]=v[3]+40;e.lineWidth=this.connections_width;e.fillStyle="#AAA";e.strokeStyle="#AAA";e.globalAlpha=this.editor_alpha;v=this.graph._nodes;for(var D=0,B=v.length;D<B;++D){var I=v[D];if(I.inputs&&I.inputs.length)for(var L=0;L<I.inputs.length;++L){var S=I.inputs[L];if(S&&null!=S.link&&(S=this.graph.links[S.link])){var R=this.graph.getNodeById(S.origin_id);if(null!=R){var W=S.origin_slot;
var X=-1==W?[R.pos[0]+10,R.pos[1]+10]:R.getConnectionPos(!1,W,x);var V=I.getConnectionPos(!0,L,G);p[0]=X[0];p[1]=X[1];p[2]=V[0]-X[0];p[3]=V[1]-X[1];0>p[2]&&(p[0]+=p[2],p[2]=Math.abs(p[2]));0>p[3]&&(p[1]+=p[3],p[3]=Math.abs(p[3]));if(z(p,U)){var la=R.outputs[W];W=I.inputs[L];if(la&&W&&(R=la.dir||(R.horizontal?A.DOWN:A.RIGHT),W=W.dir||(I.horizontal?A.UP:A.LEFT),this.renderLink(e,X,V,S,!1,0,null,R,W),S&&S._last_time&&1E3>m-S._last_time)){la=2-.002*(m-S._last_time);var fa=e.globalAlpha;e.globalAlpha=
fa*la;this.renderLink(e,X,V,S,!0,la,"white",R,W);e.globalAlpha=fa}}}}}}e.globalAlpha=1};k.prototype.renderLink=function(e,m,v,D,B,I,L,S,R,W){D&&this.visible_links.push(D);!L&&D&&(L=D.color||k.link_type_colors[D.type]);L||(L=this.default_link_color);null!=D&&this.highlighted_links[D.id]&&(L="#FFF");S=S||A.RIGHT;R=R||A.LEFT;var X=u(m,v);this.render_connections_border&&.6<this.ds.scale&&(e.lineWidth=this.connections_width+4);e.lineJoin="round";W=W||1;1<W&&(e.lineWidth=.5);e.beginPath();for(var V=0;V<
W;V+=1){var la=5*(V-.5*(W-1));if(this.links_render_mode==A.SPLINE_LINK){e.moveTo(m[0],m[1]+la);var fa=0,ha=0,ba=0,ea=0;switch(S){case A.LEFT:fa=-.25*X;break;case A.RIGHT:fa=.25*X;break;case A.UP:ha=-.25*X;break;case A.DOWN:ha=.25*X}switch(R){case A.LEFT:ba=-.25*X;break;case A.RIGHT:ba=.25*X;break;case A.UP:ea=-.25*X;break;case A.DOWN:ea=.25*X}e.bezierCurveTo(m[0]+fa,m[1]+ha+la,v[0]+ba,v[1]+ea+la,v[0],v[1]+la)}else if(this.links_render_mode==A.LINEAR_LINK){e.moveTo(m[0],m[1]+la);ea=ba=ha=fa=0;switch(S){case A.LEFT:fa=
-1;break;case A.RIGHT:fa=1;break;case A.UP:ha=-1;break;case A.DOWN:ha=1}switch(R){case A.LEFT:ba=-1;break;case A.RIGHT:ba=1;break;case A.UP:ea=-1;break;case A.DOWN:ea=1}e.lineTo(m[0]+15*fa,m[1]+15*ha+la);e.lineTo(v[0]+15*ba,v[1]+15*ea+la);e.lineTo(v[0],v[1]+la)}else if(this.links_render_mode==A.STRAIGHT_LINK)e.moveTo(m[0],m[1]),la=m[0],fa=m[1],ha=v[0],ba=v[1],S==A.RIGHT?la+=10:fa+=10,R==A.LEFT?ha-=10:ba-=10,e.lineTo(la,fa),e.lineTo(.5*(la+ha),fa),e.lineTo(.5*(la+ha),ba),e.lineTo(ha,ba),e.lineTo(v[0],
v[1]);else return}this.render_connections_border&&.6<this.ds.scale&&!B&&(e.strokeStyle="rgba(0,0,0,0.5)",e.stroke());e.lineWidth=this.connections_width;e.fillStyle=e.strokeStyle=L;e.stroke();B=this.computeConnectionPoint(m,v,.5,S,R);D&&D._pos&&(D._pos[0]=B[0],D._pos[1]=B[1]);.6<=this.ds.scale&&this.highquality_render&&R!=A.CENTER&&(this.render_connection_arrows&&(V=this.computeConnectionPoint(m,v,.25,S,R),X=this.computeConnectionPoint(m,v,.26,S,R),D=this.computeConnectionPoint(m,v,.75,S,R),W=this.computeConnectionPoint(m,
v,.76,S,R),this.render_curved_connections?(X=-Math.atan2(X[0]-V[0],X[1]-V[1]),W=-Math.atan2(W[0]-D[0],W[1]-D[1])):W=X=v[1]>m[1]?0:Math.PI,e.save(),e.translate(V[0],V[1]),e.rotate(X),e.beginPath(),e.moveTo(-5,-3),e.lineTo(0,7),e.lineTo(5,-3),e.fill(),e.restore(),e.save(),e.translate(D[0],D[1]),e.rotate(W),e.beginPath(),e.moveTo(-5,-3),e.lineTo(0,7),e.lineTo(5,-3),e.fill(),e.restore()),e.beginPath(),e.arc(B[0],B[1],5,0,2*Math.PI),e.fill());if(I)for(e.fillStyle=L,V=0;5>V;++V)I=(.001*A.getTime()+.2*V)%
1,B=this.computeConnectionPoint(m,v,I,S,R),e.beginPath(),e.arc(B[0],B[1],5,0,2*Math.PI),e.fill()};k.prototype.computeConnectionPoint=function(e,m,v,D,B){D=D||A.RIGHT;B=B||A.LEFT;var I=u(e,m),L=[e[0],e[1]],S=[m[0],m[1]];switch(D){case A.LEFT:L[0]+=-.25*I;break;case A.RIGHT:L[0]+=.25*I;break;case A.UP:L[1]+=-.25*I;break;case A.DOWN:L[1]+=.25*I}switch(B){case A.LEFT:S[0]+=-.25*I;break;case A.RIGHT:S[0]+=.25*I;break;case A.UP:S[1]+=-.25*I;break;case A.DOWN:S[1]+=.25*I}D=(1-v)*(1-v)*(1-v);B=3*(1-v)*(1-
v)*v;I=3*(1-v)*v*v;v*=v*v;return[D*e[0]+B*L[0]+I*S[0]+v*m[0],D*e[1]+B*L[1]+I*S[1]+v*m[1]]};k.prototype.drawExecutionOrder=function(e){e.shadowColor="transparent";e.globalAlpha=.25;e.textAlign="center";e.strokeStyle="white";e.globalAlpha=.75;for(var m=this.visible_nodes,v=0;v<m.length;++v){var D=m[v];e.fillStyle="black";e.fillRect(D.pos[0]-A.NODE_TITLE_HEIGHT,D.pos[1]-A.NODE_TITLE_HEIGHT,A.NODE_TITLE_HEIGHT,A.NODE_TITLE_HEIGHT);0==D.order&&e.strokeRect(D.pos[0]-A.NODE_TITLE_HEIGHT+.5,D.pos[1]-A.NODE_TITLE_HEIGHT+
.5,A.NODE_TITLE_HEIGHT,A.NODE_TITLE_HEIGHT);e.fillStyle="#FFF";e.fillText(D.order,D.pos[0]+-.5*A.NODE_TITLE_HEIGHT,D.pos[1]-6)}e.globalAlpha=1};k.prototype.drawNodeWidgets=function(e,m,v,D){if(!e.widgets||!e.widgets.length)return 0;var B=e.size[0],I=e.widgets;m+=2;var L=A.NODE_WIDGET_HEIGHT,S=.5<this.ds.scale;v.save();v.globalAlpha=this.editor_alpha;for(var R=A.WIDGET_OUTLINE_COLOR,W=A.WIDGET_BGCOLOR,X=A.WIDGET_TEXT_COLOR,V=A.WIDGET_SECONDARY_TEXT_COLOR,la=0;la<I.length;++la){var fa=I[la],ha=m;fa.y&&
(ha=fa.y);fa.last_y=ha;v.strokeStyle=R;v.fillStyle="#222";v.textAlign="left";fa.disabled&&(v.globalAlpha*=.5);var ba=fa.width||B;switch(fa.type){case "button":fa.clicked&&(v.fillStyle="#AAA",fa.clicked=!1,this.dirty_canvas=!0);v.fillRect(15,ha,ba-30,L);S&&!fa.disabled&&v.strokeRect(15,ha,ba-30,L);S&&(v.textAlign="center",v.fillStyle=X,v.fillText(fa.name,.5*ba,ha+.7*L));break;case "toggle":v.textAlign="left";v.strokeStyle=R;v.fillStyle=W;v.beginPath();S?v.roundRect(15,m,ba-30,L,.5*L):v.rect(15,m,ba-
30,L);v.fill();S&&!fa.disabled&&v.stroke();v.fillStyle=fa.value?"#89A":"#333";v.beginPath();v.arc(ba-30,ha+.5*L,.36*L,0,2*Math.PI);v.fill();S&&(v.fillStyle=V,null!=fa.name&&v.fillText(fa.name,30,ha+.7*L),v.fillStyle=fa.value?X:V,v.textAlign="right",v.fillText(fa.value?fa.options.on||"true":fa.options.off||"false",ba-40,ha+.7*L));break;case "slider":v.fillStyle=W;v.fillRect(15,ha,ba-30,L);var ea=fa.options.max-fa.options.min,ka=(fa.value-fa.options.min)/ea;v.fillStyle=D==fa?"#89A":"#678";v.fillRect(15,
ha,ka*(ba-30),L);S&&!fa.disabled&&v.strokeRect(15,ha,ba-30,L);fa.marker&&(ea=(fa.marker-fa.options.min)/ea,v.fillStyle="#AA9",v.fillRect(15+ea*(ba-30),ha,2,L));S&&(v.textAlign="center",v.fillStyle=X,v.fillText(fa.name+"  "+Number(fa.value).toFixed(3),.5*ba,ha+.7*L));break;case "number":case "combo":v.textAlign="left";v.strokeStyle=R;v.fillStyle=W;v.beginPath();S?v.roundRect(15,m,ba-30,L,.5*L):v.rect(15,m,ba-30,L);v.fill();S&&(fa.disabled||v.stroke(),v.fillStyle=X,fa.disabled||(v.beginPath(),v.moveTo(31,
m+5),v.lineTo(21,m+.5*L),v.lineTo(31,m+L-5),v.fill(),v.beginPath(),v.moveTo(ba-15-16,m+5),v.lineTo(ba-15-6,m+.5*L),v.lineTo(ba-15-16,m+L-5),v.fill()),v.fillStyle=V,v.fillText(fa.name,35,ha+.7*L),v.fillStyle=X,v.textAlign="right","number"==fa.type?v.fillText(Number(fa.value).toFixed(void 0!==fa.options.precision?fa.options.precision:3),ba-30-20,ha+.7*L):(ea=fa.value,fa.options.values&&(ka=fa.options.values,ka.constructor===Function&&(ka=ka()),ka&&ka.constructor!==Array&&(ea=ka[fa.value])),v.fillText(ea,
ba-30-20,ha+.7*L)));break;case "string":case "text":v.textAlign="left";v.strokeStyle=R;v.fillStyle=W;v.beginPath();S?v.roundRect(15,m,ba-30,L,.5*L):v.rect(15,m,ba-30,L);v.fill();S&&(v.save(),v.beginPath(),v.rect(15,m,ba-30,L),v.clip(),v.stroke(),v.fillStyle=V,null!=fa.name&&v.fillText(fa.name,30,ha+.7*L),v.fillStyle=X,v.textAlign="right",v.fillText(String(fa.value).substr(0,30),ba-30,ha+.7*L),v.restore());break;default:fa.draw&&fa.draw(v,e,ba,ha,L)}m+=(fa.computeSize?fa.computeSize(ba)[1]:L)+4;v.globalAlpha=
this.editor_alpha}v.restore();v.textAlign="left"};k.prototype.processNodeWidgets=function(e,m,v,D){function B(ka,O){ka.value=O;ka.options&&ka.options.property&&void 0!==e.properties[ka.options.property]&&e.setProperty(ka.options.property,O);ka.callback&&ka.callback(ka.value,R,e,m,v)}if(!e.widgets||!e.widgets.length)return null;for(var I=m[0]-e.pos[0],L=m[1]-e.pos[1],S=e.size[0],R=this,W=this.getCanvasWindow(),X=0;X<e.widgets.length;++X){var V=e.widgets[X];if(V&&!V.disabled){var la=V.computeSize?V.computeSize(S)[1]:
A.NODE_WIDGET_HEIGHT,fa=V.width||S;if(V==D||!(6>I||I>fa-12||L<V.last_y||L>V.last_y+la)){D=V.value;switch(V.type){case "button":if("mousemove"===v.type)break;V.callback&&setTimeout(function(){V.callback(V,R,e,m,v)},20);this.dirty_canvas=V.clicked=!0;break;case "slider":W=Math.clamp((I-10)/(fa-20),0,1);V.value=V.options.min+(V.options.max-V.options.min)*W;V.callback&&setTimeout(function(){B(V,V.value)},20);this.dirty_canvas=!0;break;case "number":case "combo":D=V.value;if("mousemove"==v.type&&"number"==
V.type)V.value+=.1*v.deltaX*(V.options.step||1),null!=V.options.min&&V.value<V.options.min&&(V.value=V.options.min),null!=V.options.max&&V.value>V.options.max&&(V.value=V.options.max);else if("mousedown"==v.type){var ha=V.options.values;ha&&ha.constructor===Function&&(ha=V.options.values(V,e));var ba=null;"number"!=V.type&&(ba=ha.constructor===Array?ha:Object.keys(ha));I=40>I?-1:I>fa-40?1:0;if("number"==V.type)V.value+=.1*I*(V.options.step||1),null!=V.options.min&&V.value<V.options.min&&(V.value=
V.options.min),null!=V.options.max&&V.value>V.options.max&&(V.value=V.options.max);else if(I)W=-1,this.last_mouseclick=0,W=ha.constructor===Object?ba.indexOf(String(V.value))+I:ba.indexOf(V.value)+I,W>=ba.length&&(W=ba.length-1),0>W&&(W=0),V.value=ha.constructor===Array?ha[W]:W;else{var ea=ha!=ba?Object.values(ha):ha;new A.ContextMenu(ea,{scale:Math.max(1,this.ds.scale),event:v,className:"dark",callback:function(ka,O,Y){ha!=ba&&(ka=ea.indexOf(ka));this.value=ka;B(this,ka);R.dirty_canvas=!0;return!1}.bind(V)},
W)}}else"mouseup"==v.type&&"number"==V.type&&(I=40>I?-1:I>fa-40?1:0,200>v.click_time&&0==I&&this.prompt("Value",V.value,function(ka){this.value=Number(ka);B(this,this.value)}.bind(V),v));D!=V.value&&setTimeout(function(){B(this,this.value)}.bind(V),20);this.dirty_canvas=!0;break;case "toggle":"mousedown"==v.type&&(V.value=!V.value,setTimeout(function(){B(V,V.value)},20));break;case "string":case "text":"mousedown"==v.type&&this.prompt("Value",V.value,function(ka){this.value=ka;B(this,ka)}.bind(V),
v);break;default:V.mouse&&(this.dirty_canvas=V.mouse(v,[I,L],e))}if(D!=V.value){if(e.onWidgetChanged)e.onWidgetChanged(V.name,V.value,D,V);e.graph._version++}return V}}}return null};k.prototype.drawGroups=function(e,m){if(this.graph){e=this.graph._groups;m.save();m.globalAlpha=.5*this.editor_alpha;for(var v=0;v<e.length;++v){var D=e[v];if(z(this.visible_area,D._bounding)){m.fillStyle=D.color||"#335";m.strokeStyle=D.color||"#335";var B=D._pos,I=D._size;m.globalAlpha=.25*this.editor_alpha;m.beginPath();
m.rect(B[0]+.5,B[1]+.5,I[0],I[1]);m.fill();m.globalAlpha=this.editor_alpha;m.stroke();m.beginPath();m.moveTo(B[0]+I[0],B[1]+I[1]);m.lineTo(B[0]+I[0]-10,B[1]+I[1]);m.lineTo(B[0]+I[0],B[1]+I[1]-10);m.fill();I=D.font_size||A.DEFAULT_GROUP_FONT_SIZE;m.font=I+"px Arial";m.fillText(D.title,B[0]+4,B[1]+I)}}m.restore()}};k.prototype.adjustNodesSize=function(){for(var e=this.graph._nodes,m=0;m<e.length;++m)e[m].size=e[m].computeSize();this.setDirty(!0,!0)};k.prototype.resize=function(e,m){e||m||(m=this.canvas.parentNode,
e=m.offsetWidth,m=m.offsetHeight);if(this.canvas.width!=e||this.canvas.height!=m)this.canvas.width=e,this.canvas.height=m,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0)};k.prototype.switchLiveMode=function(e){if(e){var m=this,v=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var D=setInterval(function(){m.editor_alpha*=v;m.dirty_canvas=!0;m.dirty_bgcanvas=!0;1>v&&.01>m.editor_alpha&&(clearInterval(D),1>v&&(m.live_mode=
!0));1<v&&.99<m.editor_alpha&&(clearInterval(D),m.editor_alpha=1)},1)}else this.live_mode=!this.live_mode,this.dirty_bgcanvas=this.dirty_canvas=!0};k.prototype.onNodeSelectionChange=function(e){};k.prototype.touchHandler=function(e){var m=e.changedTouches[0];switch(e.type){case "touchstart":var v="mousedown";break;case "touchmove":v="mousemove";break;case "touchend":v="mouseup";break;default:return}var D=this.getCanvasWindow(),B=D.document.createEvent("MouseEvent");B.initMouseEvent(v,!0,!0,D,1,m.screenX,
m.screenY,m.clientX,m.clientY,!1,!1,!1,!1,0,null);m.target.dispatchEvent(B);e.preventDefault()};k.onGroupAdd=function(e,m,v){e=k.active_canvas;e.getCanvasWindow();m=new A.LGraphGroup;m.pos=e.convertEventToCanvasOffset(v);e.graph.add(m)};k.onMenuAdd=function(e,m,v,D,B){function I(la,fa){fa=D.getFirstEvent();L.graph.beforeChange();if(la=A.createNode(la.value))la.pos=L.convertEventToCanvasOffset(fa),L.graph.add(la);B&&B(la);L.graph.afterChange()}var L=k.active_canvas,S=L.getCanvasWindow(),R=L.graph;
if(R){e=A.getNodeTypesCategories(L.filter||R.filter);m=[];for(var W=0;W<e.length;W++)if(e[W]){var X=e[W];-1!=X.indexOf("::")&&(X=X.split("::")[1]);m.push({value:e[W],content:X,has_submenu:!0})}var V=new A.ContextMenu(m,{event:v,callback:function(la,fa,ha){la=A.getNodeTypesInCategory(la.value,L.filter||R.filter);fa=[];for(var ba=0;ba<la.length;ba++)la[ba].skip_list||fa.push({content:la[ba].title,value:la[ba].type});new A.ContextMenu(fa,{event:ha,callback:I,parentMenu:V},S);return!1},parentMenu:D},
S);return!1}};k.onMenuCollapseAll=function(){};k.onMenuNodeEdit=function(){};k.showMenuNodeOptionalInputs=function(e,m,v,D,B){if(B){var I=this;e=k.active_canvas.getCanvasWindow();m=B.optional_inputs;B.onGetInputs&&(m=B.onGetInputs());var L=[];if(m)for(var S=0;S<m.length;S++){var R=m[S];if(R){var W=R[0];R[2]&&R[2].label&&(W=R[2].label);W={content:W,value:R};R[1]==A.ACTION&&(W.className="event");L.push(W)}else L.push(null)}this.onMenuNodeInputs&&(L=this.onMenuNodeInputs(L));if(L.length)return new A.ContextMenu(L,
{event:v,callback:function(X,V,la){B&&(X.callback&&X.callback.call(I,B,X,V,la),X.value&&(B.graph.beforeChange(),B.addInput(X.value[0],X.value[1],X.value[2]),B.setDirtyCanvas(!0,!0),B.graph.afterChange()))},parentMenu:D,node:B},e),!1;console.log("no input entries")}};k.showMenuNodeOptionalOutputs=function(e,m,v,D,B){function I(V,la,fa){if(B&&(V.callback&&V.callback.call(L,B,V,la,fa),V.value))if(fa=V.value[1],!fa||fa.constructor!==Object&&fa.constructor!==Array)B.graph.beforeChange(),B.addOutput(V.value[0],
V.value[1],V.value[2]),B.setDirtyCanvas(!0,!0),B.graph.afterChange();else{V=[];for(var ha in fa)V.push({content:ha,value:fa[ha]});new A.ContextMenu(V,{event:la,callback:I,parentMenu:D,node:B});return!1}}if(B){var L=this;e=k.active_canvas.getCanvasWindow();m=B.optional_outputs;B.onGetOutputs&&(m=B.onGetOutputs());var S=[];if(m)for(var R=0;R<m.length;R++){var W=m[R];if(!W)S.push(null);else if(!B.flags||!B.flags.skip_repeated_outputs||-1==B.findOutputSlot(W[0])){var X=W[0];W[2]&&W[2].label&&(X=W[2].label);
X={content:X,value:W};W[1]==A.EVENT&&(X.className="event");S.push(X)}}this.onMenuNodeOutputs&&(S=this.onMenuNodeOutputs(S));if(S.length)return new A.ContextMenu(S,{event:v,callback:I,parentMenu:D,node:B},e),!1}};k.onShowMenuNodeProperties=function(e,m,v,D,B){if(B&&B.properties){var I=k.active_canvas;m=I.getCanvasWindow();var L=[],S;for(S in B.properties){e=void 0!==B.properties[S]?B.properties[S]:" ";"object"==typeof e&&(e=JSON.stringify(e));var R=B.getPropertyInfo(S);if("enum"==R.type||"combo"==
R.type)e=k.getPropertyPrintableValue(e,R.values);e=k.decodeHTML(e);L.push({content:"<span class='property_name'>"+S+"</span><span class='property_value'>"+e+"</span>",value:S})}if(L.length)return new A.ContextMenu(L,{event:v,callback:function(W,X,V,la){B&&(X=this.getBoundingClientRect(),I.showEditPropertyValue(B,W.value,{position:[X.left,X.top]}))},parentMenu:D,allow_html:!0,node:B},m),!1}};k.decodeHTML=function(e){var m=document.createElement("div");m.innerText=e;return m.innerHTML};k.onResizeNode=
function(e,m,v,D,B){if(B){B.size=B.computeSize();if(B.onResize)B.onResize(B.size);B.setDirtyCanvas(!0,!0)}};k.prototype.showLinkMenu=function(e,m){var v=this;console.log(e);var D=new A.ContextMenu(["Add Node",null,"Delete"],{event:m,title:null!=e.data?e.data.constructor.name:null,callback:function(B,I,L){switch(B){case "Add Node":k.onMenuAdd(null,null,L,D,function(S){console.log("node autoconnect");var R=v.graph.getNodeById(e.origin_id),W=v.graph.getNodeById(e.target_id);S.inputs&&S.inputs.length&&
S.outputs&&S.outputs.length&&R.outputs[e.origin_slot].type==S.inputs[0].type&&S.outputs[0].type==W.inputs[0].type&&(R.connect(e.origin_slot,S,0),S.connect(0,W,e.target_slot),S.pos[0]-=.5*S.size[0])});break;case "Delete":v.graph.removeLink(e.id)}}});return!1};k.onShowPropertyEditor=function(e,m,v,D,B){function I(){var X=R.value;"Number"==e.type?X=Number(X):"Boolean"==e.type&&(X=!!X);B[L]=X;S.parentNode&&S.parentNode.removeChild(S);B.setDirtyCanvas(!0,!0)}var L=e.property||"title";m=B[L];var S=document.createElement("div");
S.className="graphdialog";S.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>";S.querySelector(".name").innerText=L;var R=S.querySelector("input");R&&(R.value=m,R.addEventListener("blur",function(X){this.focus()}),R.addEventListener("keydown",function(X){13==X.keyCode&&(I(),X.preventDefault(),X.stopPropagation())}));m=k.active_canvas.canvas;v=m.getBoundingClientRect();var W=D=-20;v&&(D-=v.left,W-=v.top);event?(S.style.left=event.clientX+D+"px",S.style.top=
event.clientY+W+"px"):(S.style.left=.5*m.width+D+"px",S.style.top=.5*m.height+W+"px");S.querySelector("button").addEventListener("click",I);m.parentNode.appendChild(S)};k.prototype.prompt=function(e,m,v,D){var B=this;e=e||"";var I=!1,L=document.createElement("div");L.className="graphdialog rounded";L.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>";L.close=function(){B.prompt_box=null;L.parentNode&&L.parentNode.removeChild(L)};
1<this.ds.scale&&(L.style.transform="scale("+this.ds.scale+")");L.addEventListener("mouseleave",function(X){I||L.close()});B.prompt_box&&B.prompt_box.close();B.prompt_box=L;L.querySelector(".name").innerText=e;L.querySelector(".value").value=m;var S=L.querySelector("input");S.addEventListener("keydown",function(X){I=!0;if(27==X.keyCode)L.close();else if(13==X.keyCode)v&&v(this.value),L.close();else return;X.preventDefault();X.stopPropagation()});L.querySelector("button").addEventListener("click",
function(X){v&&v(S.value);B.setDirty(!0);L.close()});e=k.active_canvas.canvas;m=e.getBoundingClientRect();var R=-20,W=-20;m&&(R-=m.left,W-=m.top);D?(L.style.left=D.clientX+R+"px",L.style.top=D.clientY+W+"px"):(L.style.left=.5*e.width+R+"px",L.style.top=.5*e.height+W+"px");e.parentNode.appendChild(L);setTimeout(function(){S.focus()},10);return L};k.search_limit=-1;k.prototype.showSearchBox=function(e){function m(ea){if(ea)if(B.onSearchBoxSelection)B.onSearchBoxSelection(ea,e,I);else{var ka=A.searchbox_extras[ea.toLowerCase()];
ka&&(ea=ka.type);I.graph.beforeChange();if(ea=A.createNode(ea))ea.pos=I.convertEventToCanvasOffset(e),I.graph.add(ea);if(ka&&ka.data){if(ka.data.properties)for(var O in ka.data.properties)ea.addProperty(O,ka.data.properties[O]);if(ka.data.inputs)for(O in ea.inputs=[],ka.data.inputs)ea.addOutput(ka.data.inputs[O][0],ka.data.inputs[O][1]);if(ka.data.outputs)for(O in ea.outputs=[],ka.data.outputs)ea.addOutput(ka.data.outputs[O][0],ka.data.outputs[O][1]);ka.data.title&&(ea.title=ka.data.title);ka.data.json&&
ea.configure(ka.data.json);I.graph.afterChange()}}R.close()}function v(ea){var ka=fa;fa&&fa.classList.remove("selected");fa?(fa=ea?fa.nextSibling:fa.previousSibling)||(fa=ka):fa=ea?X.childNodes[0]:X.childNodes[X.childNodes.length];fa&&(fa.classList.add("selected"),fa.scrollIntoView({block:"end",behavior:"smooth"}))}function D(){function ea(Ca,ya){var za=document.createElement("div");V||(V=Ca);za.innerText=Ca;za.dataset.type=escape(Ca);za.className="litegraph lite-search-item";ya&&(za.className+=" "+
ya);za.addEventListener("click",function(ob){m(unescape(this.dataset.type))});X.appendChild(za)}la=null;var ka=ha.value;V=null;X.innerHTML="";if(ka)if(B.onSearchBox){var O=B.onSearchBox(X,ka,I);if(O)for(var Y=0;Y<O.length;++Y)ea(O[Y])}else{O=function(Ca){var ya=A.registered_node_types[Ca];return pa&&ya.filter!=pa?!1:-1!==Ca.toLowerCase().indexOf(ka)};var da=0;ka=ka.toLowerCase();var pa=I.filter||I.graph.filter;for(Y in A.searchbox_extras){var ma=A.searchbox_extras[Y];if(-1!==ma.desc.toLowerCase().indexOf(ka)){var wa=
A.registered_node_types[ma.type];if(!wa||!wa.filter||wa.filter==pa)if(ea(ma.desc,"searchbox_extra"),-1!==k.search_limit&&da++>k.search_limit)break}}ma=null;if(Array.prototype.filter)ma=Object.keys(A.registered_node_types).filter(O);else for(Y in ma=[],A.registered_node_types)O(Y)&&ma.push(Y);for(Y=0;Y<ma.length&&!(ea(ma[Y]),-1!==k.search_limit&&da++>k.search_limit);Y++);}}var B=this,I=k.active_canvas,L=I.canvas,S=L.ownerDocument||document,R=document.createElement("div");R.className="litegraph litesearchbox graphdialog rounded";
R.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/><div class='helper'></div>";R.close=function(){B.search_box=null;S.body.focus();S.body.style.overflow="";setTimeout(function(){B.canvas.focus()},20);R.parentNode&&R.parentNode.removeChild(R)};var W=null;1<this.ds.scale&&(R.style.transform="scale("+this.ds.scale+")");R.addEventListener("mouseenter",function(ea){W&&(clearTimeout(W),W=null)});R.addEventListener("mouseleave",function(ea){W=setTimeout(function(){R.close()},
500)});B.search_box&&B.search_box.close();B.search_box=R;var X=R.querySelector(".helper"),V=null,la=null,fa=null,ha=R.querySelector("input");ha&&(ha.addEventListener("blur",function(ea){this.focus()}),ha.addEventListener("keydown",function(ea){if(38==ea.keyCode)v(!1);else if(40==ea.keyCode)v(!0);else if(27==ea.keyCode)R.close();else if(13==ea.keyCode)fa?m(fa.innerHTML):V?m(V):R.close();else{la&&clearInterval(la);la=setTimeout(D,10);return}ea.preventDefault();ea.stopPropagation();ea.stopImmediatePropagation();
return!0}));S.fullscreenElement?S.fullscreenElement.appendChild(R):(S.body.appendChild(R),S.body.style.overflow="hidden");L=L.getBoundingClientRect();var ba=(e?e.clientY:L.top+.5*L.height)-20;R.style.left=(e?e.clientX:L.left+.5*L.width)-80+"px";R.style.top=ba+"px";e.layerY>L.height-200&&(X.style.maxHeight=L.height-e.layerY-20+"px");ha.focus();return R};k.prototype.showEditPropertyValue=function(e,m,v){function D(){B(V.value)}function B(la){I&&I.values&&I.values.constructor===Object&&void 0!=I.values[la]&&
(la=I.values[la]);"number"==typeof e.properties[m]&&(la=Number(la));if("array"==L||"object"==L)la=JSON.parse(la);e.properties[m]=la;e.graph&&e.graph._version++;if(e.onPropertyChanged)e.onPropertyChanged(m,la);if(v.onclose)v.onclose();X.close();e.setDirtyCanvas(!0,!0)}if(e&&void 0!==e.properties[m]){v=v||{};var I=e.getPropertyInfo(m),L=I.type,S="";if("string"==L||"number"==L||"array"==L||"object"==L)S="<input autofocus type='text' class='value'/>";else if("enum"!=L&&"combo"!=L||!I.values)if("boolean"==
L)S="<input autofocus type='checkbox' class='value' "+(e.properties[m]?"checked":"")+"/>";else{console.warn("unknown type: "+L);return}else{S="<select autofocus type='text' class='value'>";for(var R in I.values){var W=R;I.values.constructor===Array&&(W=I.values[R]);S+="<option value='"+W+"' "+(W==e.properties[m]?"selected":"")+">"+I.values[R]+"</option>"}S+="</select>"}var X=this.createDialog("<span class='name'>"+m+"</span>"+S+"<button>OK</button>",v);if("enum"!=L&&"combo"!=L||!I.values)if("boolean"==
L)(V=X.querySelector("input"))&&V.addEventListener("click",function(la){B(!!V.checked)});else{if(V=X.querySelector("input"))V.addEventListener("blur",function(la){this.focus()}),W=void 0!==e.properties[m]?e.properties[m]:"",W=JSON.stringify(W),V.value=W,V.addEventListener("keydown",function(la){13==la.keyCode&&(D(),la.preventDefault(),la.stopPropagation())})}else{var V=X.querySelector("select");V.addEventListener("change",function(la){B(la.target.value)})}X.querySelector("button").addEventListener("click",
D);return X}};k.prototype.createDialog=function(e,m){m=m||{};var v=document.createElement("div");v.className="graphdialog";v.innerHTML=e;e=this.canvas.getBoundingClientRect();var D=-20,B=-20;e&&(D-=e.left,B-=e.top);m.position?(D+=m.position[0],B+=m.position[1]):m.event?(D+=m.event.clientX,B+=m.event.clientY):(D+=.5*this.canvas.width,B+=.5*this.canvas.height);v.style.left=D+"px";v.style.top=B+"px";this.canvas.parentNode.appendChild(v);v.close=function(){this.parentNode&&this.parentNode.removeChild(this)};
return v};k.prototype.createPanel=function(e,m){m=m||{};var v=m.window||window,D=document.createElement("div");D.className="litegraph dialog";D.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div class='dialog-footer'></div>";D.header=D.querySelector(".dialog-header");m.width&&(D.style.width=m.width+(m.width.constructor===Number?"px":""));m.height&&(D.style.height=m.height+(m.height.constructor===Number?"px":""));m.closable&&(m=document.createElement("span"),
m.innerHTML="&#10005;",m.classList.add("close"),m.addEventListener("click",function(){D.close()}),D.header.appendChild(m));D.title_element=D.querySelector(".dialog-title");D.title_element.innerText=e;D.content=D.querySelector(".dialog-content");D.footer=D.querySelector(".dialog-footer");D.close=function(){this.parentNode.removeChild(this)};D.clear=function(){this.content.innerHTML=""};D.addHTML=function(B,I,L){var S=document.createElement("div");I&&(S.className=I);S.innerHTML=B;L?D.footer.appendChild(S):
D.content.appendChild(S);return S};D.addButton=function(B,I,L){var S=document.createElement("button");S.innerText=B;S.options=L;S.classList.add("btn");S.addEventListener("click",I);D.footer.appendChild(S);return S};D.addSeparator=function(){var B=document.createElement("div");B.className="separator";D.content.appendChild(B)};D.addWidget=function(B,I,L,S,R){function W(fa,ha){console.log("change",fa,ha);S.callback&&S.callback(fa,ha);R&&R(fa,ha)}S=S||{};var X=String(L);B=B.toLowerCase();"number"==B&&
(X=L.toFixed(3));var V=document.createElement("div");V.className="property";V.innerHTML="<span class='property_name'></span><span class='property_value'></span>";V.querySelector(".property_name").innerText=I;var la=V.querySelector(".property_value");la.innerText=X;V.dataset.property=I;V.dataset.type=S.type||B;V.options=S;V.value=L;if("boolean"==B)V.classList.add("boolean"),L&&V.classList.add("bool-on"),V.addEventListener("click",function(){var fa=this.dataset.property;this.value=!this.value;this.classList.toggle("bool-on");
this.querySelector(".property_value").innerText=this.value?"true":"false";W(fa,this.value)});else if("string"==B||"number"==B)la.setAttribute("contenteditable",!0),la.addEventListener("keydown",function(fa){"Enter"==fa.code&&(fa.preventDefault(),this.blur())}),la.addEventListener("blur",function(){var fa=this.innerText,ha=this.parentNode.dataset.property;"number"==this.parentNode.dataset.type&&(fa=Number(fa));W(ha,fa)});else if("enum"==B||"combo"==B)X=k.getPropertyPrintableValue(L,S.values);la.innerText=
X;la.addEventListener("click",function(fa){var ha=this.parentNode.dataset.property,ba=this;new A.ContextMenu(S.values||[],{event:fa,className:"dark",callback:function(ea,ka,O){ba.innerText=ea;W(ha,ea);return!1}},v)});D.content.appendChild(V);return V};return D};k.getPropertyPrintableValue=function(e,m){if(!m||m.constructor===Array)return String(e);if(m.constructor===Object){var v="",D;for(D in m)if(m[D]==e){v=D;break}return String(e)+" ("+v+")"}};k.prototype.showShowNodePanel=function(e){};k.prototype.showSubgraphPropertiesDialog=
function(e){function m(){D.clear();if(e.inputs)for(var B=0;B<e.inputs.length;++B){var I=e.inputs[B];if(!I.not_subgraph_input){var L=D.addHTML("<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>","subgraph_property");L.dataset.name=I.name;L.dataset.slot=B;L.querySelector(".name").innerText=I.name;L.querySelector(".type").innerText=I.type;L.querySelector("button").addEventListener("click",function(S){e.removeInput(Number(this.parentNode.dataset.slot));
m()})}}}console.log("showing subgraph properties dialog");var v=this.canvas.parentNode.querySelector(".subgraph_dialog");v&&v.close();var D=this.createPanel("Subgraph Inputs",{closable:!0,width:500});D.node=e;D.classList.add("subgraph_dialog");D.addHTML(" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>","subgraph_property extra",!0).querySelector("button").addEventListener("click",function(B){B=this.parentNode;var I=
B.querySelector(".name").value,L=B.querySelector(".type").value;I&&-1==e.findInputSlot(I)&&(e.addInput(I,L),B.querySelector(".name").value="",B.querySelector(".type").value="",m())});m();this.canvas.parentNode.appendChild(D);return D};k.prototype.checkPanels=function(){if(this.canvas)for(var e=this.canvas.parentNode.querySelectorAll(".litegraph.dialog"),m=0;m<e.length;++m){var v=e[m];v.node&&(v.node.graph&&v.graph==this.graph||v.close())}};k.onMenuNodeCollapse=function(e,m,v,D,B){B.graph.beforeChange(B);
B.collapse();B.graph.afterChange(B)};k.onMenuNodePin=function(e,m,v,D,B){B.pin()};k.onMenuNodeMode=function(e,m,v,D,B){new A.ContextMenu(["Always","On Event","On Trigger","Never"],{event:v,callback:function(I){if(B)switch(I){case "On Event":B.mode=A.ON_EVENT;break;case "On Trigger":B.mode=A.ON_TRIGGER;break;case "Never":B.mode=A.NEVER;break;default:B.mode=A.ALWAYS}},parentMenu:D,node:B});return!1};k.onMenuNodeColors=function(e,m,v,D,B){if(!B)throw"no node for color";m=[];m.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});
for(var I in k.node_colors)e=k.node_colors[I],e={value:I,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+e.color+"; background-color:"+e.bgcolor+"'>"+I+"</span>"},m.push(e);new A.ContextMenu(m,{event:v,callback:function(L){B&&((L=L.value?k.node_colors[L.value]:null)?B.constructor===A.LGraphGroup?B.color=L.groupcolor:(B.color=L.color,B.bgcolor=L.bgcolor):(delete B.color,delete B.bgcolor),B.setDirtyCanvas(!0,!0))},parentMenu:D,node:B});return!1};k.onMenuNodeShapes=
function(e,m,v,D,B){if(!B)throw"no node passed";new A.ContextMenu(A.VALID_SHAPES,{event:v,callback:function(I){B&&(B.graph.beforeChange(B),B.shape=I,B.graph.afterChange(B),B.setDirtyCanvas(!0))},parentMenu:D,node:B});return!1};k.onMenuNodeRemove=function(e,m,v,D,B){if(!B)throw"no node passed";!1!==B.removable&&(e=B.graph,e.beforeChange(),e.remove(B),e.afterChange(),B.setDirtyCanvas(!0,!0))};k.onMenuNodeToSubgraph=function(e,m,v,D,B){e=B.graph;if(m=k.active_canvas)v=Object.values(m.selected_nodes||
{}),v.length||(v=[B]),D=A.createNode("graph/subgraph"),D.pos=B.pos.concat(),e.add(D),D.buildFromNodes(v),m.deselectAllNodes(),B.setDirtyCanvas(!0,!0)};k.onMenuNodeClone=function(e,m,v,D,B){0!=B.clonable&&(e=B.clone())&&(e.pos=[B.pos[0]+5,B.pos[1]+5],B.graph.beforeChange(),B.graph.add(e),B.graph.afterChange(),B.setDirtyCanvas(!0,!0))};k.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",
groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}};k.prototype.getCanvasMenuOptions=function(){if(this.getMenuOptions)var e=this.getMenuOptions();else e=[{content:"Add Node",has_submenu:!0,
callback:k.onMenuAdd},{content:"Add Group",callback:k.onGroupAdd}],this._graph_stack&&0<this._graph_stack.length&&e.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)});if(this.getExtraMenuOptions){var m=this.getExtraMenuOptions(this,e);m&&(e=e.concat(m))}return e};k.prototype.getNodeMenuOptions=function(e){var m=e.getMenuOptions?e.getMenuOptions(this):[{content:"Inputs",has_submenu:!0,disabled:!0,callback:k.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,
callback:k.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:k.onShowMenuNodeProperties},null,{content:"Title",callback:k.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:k.onMenuNodeMode},{content:"Resize",callback:k.onResizeNode},{content:"Collapse",callback:k.onMenuNodeCollapse},{content:"Pin",callback:k.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:k.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:k.onMenuNodeShapes},null];if(e.onGetInputs){var v=
e.onGetInputs();v&&v.length&&(m[0].disabled=!1)}e.onGetOutputs&&(v=e.onGetOutputs())&&v.length&&(m[1].disabled=!1);e.getExtraMenuOptions&&(v=e.getExtraMenuOptions(this,m))&&(v.push(null),m=v.concat(m));!1!==e.clonable&&m.push({content:"Clone",callback:k.onMenuNodeClone});m.push(null,{content:"Remove",disabled:!(!1!==e.removable&&!e.block_delete),callback:k.onMenuNodeRemove});if(e.graph&&e.graph.onGetNodeMenuOptions)e.graph.onGetNodeMenuOptions(m,e);return m};k.prototype.getGroupMenuOptions=function(e){return[{content:"Title",
callback:k.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:k.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:k.onShowPropertyEditor},null,{content:"Remove",callback:k.onMenuNodeRemove}]};k.prototype.processContextMenu=function(e,m){var v=this,D=k.active_canvas.getCanvasWindow(),B=null,I={event:m,callback:function(S,R,W){if(S)if("Remove Slot"==S.content)S=S.slot,S.input?e.removeInput(S.slot):S.output&&e.removeOutput(S.slot);else if("Disconnect Links"==
S.content)S=S.slot,S.output?e.disconnectOutput(S.slot):S.input&&e.disconnectInput(S.slot);else if("Rename Slot"==S.content){S=S.slot;var X=S.input?e.getInputInfo(S.slot):e.getOutputInfo(S.slot),V=v.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",R),la=V.querySelector("input");la&&X&&(la.value=X.label||"");V.querySelector("button").addEventListener("click",function(fa){la.value&&(X&&(X.label=la.value),v.setDirty(!0));V.close()})}},extra:e};e&&(I.title=
e.type);var L=null;e&&(L=e.getSlotInPosition(m.canvasX,m.canvasY),k.active_node=e);L?(B=[],e.getSlotMenuOptions?B=e.getSlotMenuOptions(L,e,m):(L&&L.output&&L.output.links&&L.output.links.length&&B.push({content:"Disconnect Links",slot:L}),m=L.input||L.output,B.push(m.locked?"Cannot remove":{content:"Remove Slot",slot:L}),B.push(m.nameLocked?"Cannot rename":{content:"Rename Slot",slot:L})),I.title=(L.input?L.input.type:L.output.type)||"*",L.input&&L.input.type==A.ACTION&&(I.title="Action"),L.output&&
L.output.type==A.EVENT&&(I.title="Event")):e?B=this.getNodeMenuOptions(e):(B=this.getCanvasMenuOptions(),(L=this.graph.getGroupOnPos(m.canvasX,m.canvasY))&&B.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:L,options:this.getGroupMenuOptions(L)}}));B&&new A.ContextMenu(B,I,D)};"undefined"!=typeof window&&window.CanvasRenderingContext2D&&(window.CanvasRenderingContext2D.prototype.roundRect=function(e,m,v,D,B,I){void 0===B&&(B=5);void 0===I&&(I=B);this.moveTo(e+B,m);this.lineTo(e+
v-B,m);this.quadraticCurveTo(e+v,m,e+v,m+B);this.lineTo(e+v,m+D-I);this.quadraticCurveTo(e+v,m+D,e+v-I,m+D);this.lineTo(e+I,m+D);this.quadraticCurveTo(e,m+D,e,m+D-I);this.lineTo(e,m+B);this.quadraticCurveTo(e,m,e+B,m)});A.compareObjects=function(e,m){for(var v in e)if(e[v]!=m[v])return!1;return!0};A.distance=u;A.colorToString=function(e){return"rgba("+Math.round(255*e[0]).toFixed()+","+Math.round(255*e[1]).toFixed()+","+Math.round(255*e[2]).toFixed()+","+(4==e.length?e[3].toFixed(2):"1.0")+")"};A.isInsideRectangle=
r;A.growBounding=function(e,m,v){m<e[0]?e[0]=m:m>e[2]&&(e[2]=m);v<e[1]?e[1]=v:v>e[3]&&(e[3]=v)};A.isInsideBounding=function(e,m){return e[0]<m[0][0]||e[1]<m[0][1]||e[0]>m[1][0]||e[1]>m[1][1]?!1:!0};A.overlapBounding=z;A.hex2num=function(e){"#"==e.charAt(0)&&(e=e.slice(1));e=e.toUpperCase();for(var m=Array(3),v=0,D,B,I=0;6>I;I+=2)D="0123456789ABCDEF".indexOf(e.charAt(I)),B="0123456789ABCDEF".indexOf(e.charAt(I+1)),m[v]=16*D+B,v++;return m};A.num2hex=function(e){for(var m="#",v,D,B=0;3>B;B++)v=e[B]/
16,D=e[B]%16,m+="0123456789ABCDEF".charAt(v)+"0123456789ABCDEF".charAt(D);return m};C.prototype.addItem=function(e,m,v){function D(R){var W=this.value;W&&W.has_submenu&&B.call(this,R)}function B(R){var W=this.value,X=!0;I.current_submenu&&I.current_submenu.close(R);if(v.callback){var V=v.callback.call(this,W,v,R,I,v.node);!0===V&&(X=!1)}if(W&&(W.callback&&!v.ignore_item_callbacks&&!0!==W.disabled&&(V=W.callback.call(this,W,v,R,I,v.extra),!0===V&&(X=!1)),W.submenu)){if(!W.submenu.options)throw"ContextMenu submenu needs options";
new I.constructor(W.submenu.options,{callback:W.submenu.callback,event:R,parentMenu:I,ignore_item_callbacks:W.submenu.ignore_item_callbacks,title:W.submenu.title,extra:W.submenu.extra,autoopen:v.autoopen});X=!1}X&&!I.lock&&I.close()}var I=this;v=v||{};var L=document.createElement("div");L.className="litemenu-entry submenu";var S=!1;if(null===m)L.classList.add("separator");else{L.innerHTML=m&&m.title?m.title:e;if(L.value=m)m.disabled&&(S=!0,L.classList.add("disabled")),(m.submenu||m.has_submenu)&&
L.classList.add("has_submenu");"function"==typeof m?(L.dataset.value=e,L.onclick_callback=m):L.dataset.value=m;m.className&&(L.className+=" "+m.className)}this.root.appendChild(L);S||L.addEventListener("click",B);v.autoopen&&L.addEventListener("mouseenter",D);return L};C.prototype.close=function(e,m){this.root.parentNode&&this.root.parentNode.removeChild(this.root);this.parentMenu&&!m&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,void 0===e?this.parentMenu.close():e&&!C.isCursorOverElement(e,
this.parentMenu.root)&&C.trigger(this.parentMenu.root,"mouseleave",e));this.current_submenu&&this.current_submenu.close(e,!0);this.root.closing_timer&&clearTimeout(this.root.closing_timer)};C.trigger=function(e,m,v,D){var B=document.createEvent("CustomEvent");B.initCustomEvent(m,!0,!0,v);B.srcElement=D;e.dispatchEvent?e.dispatchEvent(B):e.__events&&e.__events.dispatchEvent(B);return B};C.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this};C.prototype.getFirstEvent=
function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event};C.isCursorOverElement=function(e,m){var v=e.clientX;e=e.clientY;return(m=m.getBoundingClientRect())?e>m.top&&e<m.top+m.height&&v>m.left&&v<m.left+m.width?!0:!1:!1};A.ContextMenu=C;A.closeAllContextMenus=function(e){e=e||window;e=e.document.querySelectorAll(".litecontextmenu");if(e.length){for(var m=[],v=0;v<e.length;v++)m.push(e[v]);for(v=0;v<m.length;v++)m[v].close?m[v].close():m[v].parentNode&&
m[v].parentNode.removeChild(m[v])}};A.extendClass=function(e,m){for(var v in m)e.hasOwnProperty(v)||(e[v]=m[v]);if(m.prototype)for(v in m.prototype)m.prototype.hasOwnProperty(v)&&!e.prototype.hasOwnProperty(v)&&(m.prototype.__lookupGetter__(v)?e.prototype.__defineGetter__(v,m.prototype.__lookupGetter__(v)):e.prototype[v]=m.prototype[v],m.prototype.__lookupSetter__(v)&&e.prototype.__defineSetter__(v,m.prototype.__lookupSetter__(v)))};E.sampleCurve=function(e,m){if(m){for(var v=0;v<m.length-1;++v){var D=
m[v],B=m[v+1];if(!(B[0]<e)){m=B[0]-D[0];if(1E-5>Math.abs(m))return D[1];e=(e-D[0])/m;return D[1]*(1-e)+B[1]*e}}return 0}};E.prototype.draw=function(e,m,v,D,B,I){if(v=this.points){this.size=m;var L=m[0]-2*this.margin;m=m[1]-2*this.margin;B=B||"#666";e.save();e.translate(this.margin,this.margin);D&&(e.fillStyle="#111",e.fillRect(0,0,L,m),e.fillStyle="#222",e.fillRect(.5*L,0,1,m),e.strokeStyle="#333",e.strokeRect(0,0,L,m));e.strokeStyle=B;I&&(e.globalAlpha=.5);e.beginPath();for(D=0;D<v.length;++D)B=
v[D],e.lineTo(B[0]*L,(1-B[1])*m);e.stroke();e.globalAlpha=1;if(!I)for(D=0;D<v.length;++D)B=v[D],e.fillStyle=this.selected==D?"#FFF":this.nearest==D?"#DDD":"#AAA",e.beginPath(),e.arc(B[0]*L,(1-B[1])*m,2,0,2*Math.PI),e.fill();e.restore()}};E.prototype.onMouseDown=function(e,m){var v=this.points;if(v&&!(0>e[1])){var D=this.size[0]-2*this.margin,B=this.size[1]-2*this.margin,I=e[0]-this.margin;e=e[1]-this.margin;this.selected=this.getCloserPoint([I,e],30/m.ds.scale);-1==this.selected&&(m=[I/D,1-e/B],v.push(m),
v.sort(function(L,S){return L[0]-S[0]}),this.selected=v.indexOf(m),this.must_update=!0);if(-1!=this.selected)return!0}};E.prototype.onMouseMove=function(e,m){var v=this.points;if(v){var D=this.selected;if(!(0>D)){var B=(e[0]-this.margin)/(this.size[0]-2*this.margin),I=(e[1]-this.margin)/(this.size[1]-2*this.margin);this._nearest=this.getCloserPoint([e[0]-this.margin,e[1]-this.margin],30/m.ds.scale);if(m=v[D]){var L=0==D||D==v.length-1;!L&&(-10>e[0]||e[0]>this.size[0]+10||-10>e[1]||e[1]>this.size[1]+
10)?(v.splice(D,1),this.selected=-1):(m[0]=L?0==D?0:1:Math.clamp(B,0,1),m[1]=1-Math.clamp(I,0,1),v.sort(function(S,R){return S[0]-R[0]}),this.selected=v.indexOf(m),this.must_update=!0)}}}};E.prototype.onMouseUp=function(e,m){this.selected=-1;return!1};E.prototype.getCloserPoint=function(e,m){var v=this.points;if(!v)return-1;m=m||30;for(var D=this.size[0]-2*this.margin,B=this.size[1]-2*this.margin,I=v.length,L=[0,0],S=1E6,R=-1,W=0;W<I;++W){var X=v[W];L[0]=X[0]*D;L[1]=(1-X[1])*B;X=vec2.distance(e,L);
X>S||X>m||(R=W,S=X)}return R};A.CurveEditor=E;A.getParameterNames=function(e){return(e+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)};Math.clamp=function(e,m,v){return m>e?m:v<e?v:e};"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1E3/
60)})})(this);"undefined"!=typeof exports&&(exports.LiteGraph=this.LiteGraph);
var BufferAttribute=THREE.BufferAttribute,BufferGeometry=THREE.BufferGeometry,Clock=THREE.Clock,Face3=THREE.Face3,Geometry=THREE.Geometry,Object3D=THREE.Object3D,Raycaster=THREE.Raycaster,Material=THREE.Material,LineBasicMaterial=THREE.LineBasicMaterial,LineDashedMaterial=THREE.LineDashedMaterial,MeshPhysicalMaterial=THREE.MeshPhysicalMaterial,MultiMaterial=THREE.MultiMaterial,PointsMaterial=THREE.PointsMaterial,RawShaderMaterial=THREE.RawShaderMaterial,SpriteMaterial=THREE.SpriteMaterial,Box2=THREE.Box2,
Box3=THREE.Box3,Color=THREE.Color,Euler=THREE.Euler,Frustum=THREE.Frustum,Matrix3=THREE.Matrix3,Matrix4=THREE.Matrix4,Plane=THREE.Plane,Quarternion=THREE.Quarternion,Ray=THREE.Ray,Sphere=THREE.Sphere,Spline=THREE.Spline,Triangle=THREE.Triangle,Vector2=THREE.Vector2,Vector3=THREE.Vector3,Vector4=THREE.Vector4,LOD=THREE.LOD,LensFlare=THREE.LensFlare;THREE.Object3D.prototype.folded=!1;THREE.Object3D.prototype.hidden=!1;THREE.Object3D.prototype.initialize=function(){for(var c=0;c<this.children.length;c++)this.children[c].initialize()};
THREE.Object3D.prototype.update=function(){for(var c=0;c<this.children.length;c++)this.children[c].update()};THREE.Object3D.prototype.dispose=function(){for(var c=0;c<this.children.length;c++)this.children[c].dispose()};THREE.Object3D.prototype.removeAll=function(){for(var c=this.children.length-1;-1<c;c--)this.remove(this.children[c])};THREE.Object3D.prototype.destroy=function(){for(;0<this.children.length;)this.children[0].destroy();null!==this.parent&&(this.dispose&&this.dispose(),this.parent.remove(this))};
THREE.Object3D.prototype.toJSON=function(c,h,n){function f(u){var r=[],z;for(z in u){var C=u[z];delete C.metadata;r.push(C)}return r}var q=void 0===c,l={};q&&(c={fonts:{},videos:{},images:{},audio:{},geometries:{},materials:{},textures:{},asset_objects:{}},l.metadata={version:Editor.VERSION,type:"PhantanizerProgram"});var k={};k.uuid=this.uuid;k.type=this.type;k.name=this.name;k.folded=this.folded;k.hidden=this.hidden;k.castShadow=this.castShadow;k.receiveShadow=this.receiveShadow;k.visible=this.visible;
k.matrixAutoUpdate=this.matrixAutoUpdate;k.matrix=this.matrix.toArray();void 0!==this.components&&(k.components=this.components);"{}"!==JSON.stringify(this.userData)&&(k.userData=this.userData);void 0!==this.geometry&&(void 0===c.geometries[this.geometry.uuid]&&(c.geometries[this.geometry.uuid]=this.geometry.toJSON(c)),k.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===c.materials[this.material.uuid]&&(c.materials[this.material.uuid]=this.material.toJSON(c)),k.material=this.material.uuid);
void 0!==h&&h(c,k);if(!1!==n&&0<this.children.length)for(k.children=[],h=0;h<this.children.length;h++)(this.children[h]instanceof BlockScript||!this.children[h].hidden)&&k.children.push(this.children[h].toJSON(c).object);q&&(l.geometries=f(c.geometries),l.materials=f(c.materials),l.textures=f(c.textures),l.images=f(c.images),l.videos=f(c.videos),l.audio=f(c.audio),l.fonts=f(c.fonts),l.asset_objects=f(c.asset_objects));l.object=k;return l};
THREE.Vector3.fromJSON=function(c){return new THREE.Vector3(c.x,c.y,c.z)};THREE.Vector3.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z}};THREE.Vector2.fromJSON=function(c){return new THREE.Vector2(c.x,c.y)};THREE.Vector2.prototype.toJSON=function(){return{x:this.x,y:this.y}};THREE.Color.fromJSON=function(c){return new THREE.Color(c.r,c.g,c.b)};
THREE.Texture.prototype.toJSON=function(c){if(void 0!==c.textures[this.uuid])return c.textures[this.uuid];var h={metadata:{version:Editor.VERSION,type:"Texture"},uuid:this.uuid,name:this.name,category:this.category,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};return c.textures[this.uuid]=h};
THREE.LightShadow.prototype.toJSON=function(){var c={};c.bias=this.bias;c.radius=this.radius;c.mapSize={};c.mapSize.x=this.mapSize.x;c.mapSize.y=this.mapSize.y;c.camera={};c.camera.top=this.camera.top;c.camera.bottom=this.camera.bottom;c.camera.far=this.camera.far;c.camera.near=this.camera.near;c.camera.left=this.camera.left;c.camera.right=this.camera.right;return c};
THREE.LightShadow.prototype.fromJSON=function(c){void 0!==c.bias&&(this.bias=c.bias);void 0!==c.radius&&(this.radius=c.radius);if(void 0!==c.mapSize){var h=c.mapSize;this.mapSize.set(h.x,h.y)}void 0!==c.camera&&(c=c.camera,this.camera.top=c.top,this.camera.bottom=c.bottom,this.camera.left=c.left,this.camera.right=c.right,this.camera.near=c.near,this.camera.far=c.far)};THREE.Fog.NONE=0;THREE.Fog.LINEAR=1;THREE.Fog.EXPONENTIAL=2;THREE.Material.prototype.nodes={};
THREE.Material.prototype.updateNodes=function(c){void 0!==this.nodes&&(this.nodes=c)};function Key(){this.justReleased=this.justPressed=this.isPressed=!1}Key.KEY_DOWN=-1;Key.KEY_UP=1;Key.KEY_RESET=0;Key.KEY_DOUBLE=2;Key.prototype.update=function(c){this.justReleased=this.justPressed=!1;c===Key.KEY_DOWN?(!1===this.isPressed&&(this.justPressed=!0),this.isPressed=!0):c===Key.KEY_UP?(this.isPressed&&(this.justReleased=!0),this.isPressed=!1):c===Key.KEY_RESET&&(this.justPressed=this.justReleased=!1)};
Key.prototype.set=function(c,h,n){this.justPressed=c;this.isPressed=h;this.justReleased=n};Key.prototype.reset=function(){this.justReleased=this.isPressed=this.justPressed=!1};Key.prototype.toString=function(){return"Pressed:"+this.isPressed+" JustPressed:"+this.justPressed+" JustReleased:"+this.justReleased};function Keyboard(){}
Keyboard.initialize=function(){Keyboard.keys=[];Keyboard.actions=[];for(var c=0;256>c;c++)Keyboard.keys.push(new Key);document.onkeydown=h=>{Keyboard.actions.push(h.keyCode);Keyboard.actions.push(Key.KEY_DOWN)};document.onkeyup=h=>{Keyboard.actions.push(h.keyCode);Keyboard.actions.push(Key.KEY_UP)}};
Keyboard.update=function(){for(var c=0;Keyboard.actions.length>c;){var h=Keyboard.actions.shift(),n=Keyboard.actions.shift();Keyboard.keys[h].update(n);if(Keyboard.keys[h].justReleased||Keyboard.keys[h].justPressed)Keyboard.actions.push(h),Keyboard.actions.push(Key.KEY_RESET),c+=2}};Keyboard.reset=function(){Keyboard.actions=[];for(var c=0;c<Keyboard.keys.length;c++)Keyboard.keys[c].reset()};Keyboard.keyPressed=function(c){return 256>c&&Keyboard.keys[c].isPressed};
Keyboard.keyJustPressed=function(c){return 256>c&&Keyboard.keys[c].justPressed};Keyboard.keyJustReleased=function(c){return 256>c&&Keyboard.keys[c].justReleased};Keyboard.BACKSPACE=8;Keyboard.TAB=9;Keyboard.ENTER=13;Keyboard.SHIFT=16;Keyboard.CTRL=17;Keyboard.ALT=18;Keyboard.CAPS_LOCK=20;Keyboard.ESC=27;Keyboard.SPACEBAR=32;Keyboard.PAGE_UP=33;Keyboard.PAGE_DOWN=34;Keyboard.END=35;Keyboard.HOME=36;Keyboard.INSERT=45;Keyboard.DEL=46;Keyboard.LEFT=37;Keyboard.RIGHT=39;Keyboard.UP=38;Keyboard.DOWN=40;
Keyboard.NUM0=48;Keyboard.NUM1=49;Keyboard.NUM2=50;Keyboard.NUM3=51;Keyboard.NUM4=52;Keyboard.NUM5=53;Keyboard.NUM6=54;Keyboard.NUM7=55;Keyboard.NUM8=56;Keyboard.NUM9=57;Keyboard.A=65;Keyboard.B=66;Keyboard.C=67;Keyboard.D=68;Keyboard.E=69;Keyboard.F=70;Keyboard.G=71;Keyboard.H=72;Keyboard.I=73;Keyboard.J=74;Keyboard.K=75;Keyboard.L=76;Keyboard.M=77;Keyboard.N=78;Keyboard.O=79;Keyboard.P=80;Keyboard.Q=81;Keyboard.R=82;Keyboard.S=83;Keyboard.T=84;Keyboard.U=85;Keyboard.V=86;Keyboard.W=87;
Keyboard.X=88;Keyboard.Y=89;Keyboard.Z=90;Keyboard.F1=112;Keyboard.F2=113;Keyboard.F3=114;Keyboard.F4=115;Keyboard.F5=116;Keyboard.F6=117;Keyboard.F7=118;Keyboard.F8=119;Keyboard.F9=120;Keyboard.F10=121;Keyboard.F11=122;Keyboard.F12=123;function Mouse(){}
Mouse.initialize=function(){Mouse._keys=[];Mouse._position=new THREE.Vector2(0,0);Mouse._position_updated=!1;Mouse._delta=new THREE.Vector2(0,0);Mouse._wheel=0;Mouse._wheel_updated=!1;Mouse._double_clicked=!1;Mouse.keys=[];Mouse.position=new THREE.Vector2(0,0);Mouse.delta=new THREE.Vector2(0,0);Mouse.wheel=0;Mouse.double_clicked=!1;Mouse.canvas=null;for(var c=0;3>c;c++)Mouse._keys.push(new Key),Mouse.keys.push(new Key);void 0!==document.onmousewheel?document.addEventListener("mousewheel",n=>{Mouse._wheel=
n.deltaY;Mouse._wheel_updated=!0},!1):void 0!==document.addEventListener?document.addEventListener("DOMMouseScroll",n=>{Mouse._wheel=30*n.detail;Mouse._wheel_updated=!0},!1):void 0!==document.onwheel&&(document.onwheel=n=>{Mouse._wheel=n.deltaY;Mouse._wheel_updated=!0});if("ontouchstart"in window||0<navigator.msMaxTouchPoints){var h=new THREE.Vector2(0,0);document.addEventListener("touchstart",n=>{n=n.touches[0];h.set(n.clientX,n.clientY);Mouse.updateKey(Mouse.LEFT,Key.KEY_DOWN)},!1);document.addEventListener("touchend",
function(n){Mouse.updateKey(Mouse.LEFT,Key.KEY_UP)},!1);document.addEventListener("touchmove",n=>{n=n.touches[0];if(null!==Mouse.canvas){var f=Mouse.canvas.getBoundingClientRect();Mouse.updatePosition(n.clientX-f.left,n.clientY-f.top,n.clientX-h.x,n.clientY-h.y)}else Mouse.updatePosition(n.clientX,n.clientY,n.clientX-h.x,n.clientY-h.y);h.set(n.clientX,n.clientY)},!1)}else document.addEventListener("mousemove",n=>{if(null!==Mouse.canvas){var f=Mouse.canvas.getBoundingClientRect();Mouse.updatePosition(n.clientX-
f.left,n.clientY-f.top,n.movementX,n.movementY)}else Mouse.updatePosition(n.clientX,n.clientY,n.movementX,n.movementY)},!1),document.addEventListener("mousedown",n=>{Mouse.updateKey(n.which-1,Key.KEY_DOWN)},!1),document.addEventListener("mouseup",function(n){Mouse.updateKey(n.which-1,Key.KEY_UP)},!1);document.addEventListener("dblclick",function(n){Mouse._double_clicked=!0},!1)};Mouse.LEFT=0;Mouse.MIDDLE=1;Mouse.RIGHT=2;
Mouse.setCanvas=function(c){Mouse.canvas=c;c.mouseInside=!1;c.addEventListener("mouseenter",function(){this.mouseInside=!0},!1);c.addEventListener("mouseleave",function(){this.mouseInside=!1},!1)};Mouse.insideCanvas=function(){return null===Mouse.canvas?!1:Mouse.canvas.mouseInside};
Mouse.setLock=function(c){null!==Mouse.canvas&&(c?Mouse.canvas.requestPointerLock?Mouse.canvas.requestPointerLock():Mouse.canvas.mozRequestPointerLock?Mouse.canvas.mozRequestPointerLock():Mouse.canvas.webkitRequestPointerLock&&Mouse.canvas.webkitRequestPointerLock():document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock())};Mouse.buttonPressed=function(c){return Mouse.keys[c].isPressed};
Mouse.buttonDoubleClicked=function(){return Mouse.double_clicked};Mouse.buttonJustPressed=function(c){return Mouse.keys[c].justPressed};Mouse.buttonJustReleased=function(c){return Mouse.keys[c].justReleased};Mouse.updatePosition=function(c,h,n,f){Mouse._position.set(c,h);Mouse._delta.x+=n;Mouse._delta.y+=f;Mouse._position_updated=!0};Mouse.updateKey=function(c,h){-1<c&&Mouse._keys[c].update(h)};
Mouse.update=function(){for(var c=0;c<Mouse._keys.length;c++)Mouse._keys[c].justPressed&&Mouse.keys[c].justPressed&&(Mouse._keys[c].justPressed=!1),Mouse._keys[c].justReleased&&Mouse.keys[c].justReleased&&(Mouse._keys[c].justReleased=!1),Mouse.keys[c].set(Mouse._keys[c].justPressed,Mouse._keys[c].isPressed,Mouse._keys[c].justReleased);Mouse._wheel_updated?(Mouse.wheel=Mouse._wheel,Mouse._wheel_updated=!1):Mouse.wheel=0;Mouse._double_clicked?(Mouse.double_clicked=!0,Mouse._double_clicked=!1):Mouse.double_clicked=
!1;Mouse._position_updated?(Mouse.delta.x=Mouse._delta.x,Mouse.delta.y=Mouse._delta.y,Mouse._delta.set(0,0),Mouse.position.x=Mouse._position.x,Mouse.position.y=Mouse._position.y,Mouse._position_updated=!1):(Mouse.delta.x=0,Mouse.delta.y=0)};Mouse.toString=function(){return"Pos:"+Mouse.position.x+","+Mouse.position.y+" Delta:"+Mouse.delta.toString()+"\n   Left: "+Mouse.keys[0].toString()+"\n   Middle: "+Mouse.keys[1].toString()+"\n   Right: "+Mouse.keys[2].toString()};
function VRControls(c,h){function n(q){for(var l=0;l<q.length;l++)if("VRDisplay"in window&&q[l]instanceof VRDisplay||"PositionSensorVRDevice"in window&&q[l]instanceof PositionSensorVRDevice){f.vr_input=q[l];break}f.vr_input||h&&h("VR input not available")}this.vr_input=null;this.scale=1;this.standing=!1;this.userHeight=1.6;this.object=null;void 0!==c&&(this.object=c);this.position=new THREE.Vector3;this.quaternion=new THREE.Quaternion;var f=this;void 0!==navigator.getVRDisplays&&navigator.getVRDisplays().then(n)}
VRControls.prototype.update=function(){if(null!==this.vr_input){var c=this.vr_input.getPose();null!==c.orientation&&this.quaternion.fromArray(c.orientation);null!==c.position?this.position.fromArray(c.position):this.position.set(0,0,0);this.standing&&(this.position.y+=this.userHeight);this.position.multiplyScalar(this.scale);null!==this.object&&(this.object.position.copy(this.position),this.object.quaternion.copy(this.quaternion))}};VRControls.prototype.dispose=function(){this.vr_input=null};
VRControls.prototype.resetPose=function(){null!==this.vr_input&&this.vr_input.resetPose()};VRControls.prototype.attachObject=function(c){this.object=c};var PHANTANIZER={};
function Font(c){this.name="font";this.uuid=THREE.Math.generateUUID();this.type="Font";this.encoding=this.format="";this.data=null;if(void 0!==c)if("object"===typeof c)this.data=c,this.name=c.original_font_information.fullName,this.encoding=this.format="json";else if(this.encoding=c.split(".").pop().toLowerCase(),"json"===this.encoding)this.data=JSON.parse(FileSystem.readFile(c)),this.name=this.data.original_font_information.fullName,this.format="json";else if("ttf"===this.encoding||"otf"===this.encoding||
"ttc"===this.encoding||"otc"===this.encoding)this.data=(new TTFLoader).parse(FileSystem.readFileArrayBuffer(c)),this.name=this.data.original_font_information.fullName,this.encoding=this.format="json"}Font.prototype.isFont=!0;Font.prototype.toJSON=function(c){if(void 0!==c.fonts[this.uuid])return c.fonts[this.uuid];var h={};h.name=this.name;h.uuid=this.uuid;h.encoding=this.encoding;h.type=this.type;h.format=this.format;h.data=this.data;return c.fonts[this.uuid]=h};
Font.prototype.generateShapes=function(c,h,n){void 0===h&&(h=100);void 0===n&&(n=4);var f=this.data;c=String(c).split("");var q=h/f.resolution,l=0;h=[];for(var k=0;k<c.length;k++){var u;var r=q;var z=l,C=f.glyphs[c[k]]||f.glyphs["?"];if(C){var E=new THREE.ShapePath,A=[],H=THREE.ShapeUtils.b2,J=THREE.ShapeUtils.b3;if(C.o)for(var N=C._cachedOutline||(C._cachedOutline=C.o.split(" ")),U=0,p=N.length;U<p;){var x=N[U++];if("m"===x){var G=N[U++]*r+z;var e=N[U++]*r;E.moveTo(G,e)}if("l"===x)G=N[U++]*r+z,e=
N[U++]*r,E.lineTo(G,e);else if("q"===x){var m=N[U++]*r+z;var v=N[U++]*r;var D=N[U++]*r+z;x=N[U++]*r;E.quadraticCurveTo(D,x,m,v);if(u=A[A.length-1]){var B=u.x;u=u.y;for(var I=1;I<=n;I++){var L=I/n;H(L,B,D,m);H(L,u,x,v)}}}else if("b"===x&&(m=N[U++]*r+z,v=N[U++]*r,D=N[U++]*r+z,x=N[U++]*r,G=N[U++]*r+z,e=N[U++]*r,E.bezierCurveTo(D,x,G,e,m,v),u=A[A.length-1]))for(B=u.x,u=u.y,I=1;I<=n;I++)L=I/n,J(L,B,D,G,m),J(L,u,x,e,v)}r={offset:C.ha*r,path:E}}else r=void 0;l+=r.offset;h.push(r.path)}n=[];f=0;for(c=h.length;f<
c;f++)Array.prototype.push.apply(n,h[f].toShapes());return n};function Video(c){this.name="video";this.uuid=THREE.Math.generateUUID();this.type="Video";this.data=this.encoding=this.format="";void 0!==c&&(this.encoding=c.split(".").pop().toLowerCase(),this.data="data:video/"+this.encoding+";base64,"+FileSystem.readFileBase64(c),this.format="base64")}
Video.prototype.toJSON=function(c){if(void 0!==c.videos[this.uuid])return c.videos[this.uuid];var h={};h.name=this.name;h.uuid=this.uuid;h.type=this.type;h.encoding=this.encoding;h.format=this.format;h.data=this.data;return c.videos[this.uuid]=h};
function Audio(c){this.name="audio";this.uuid=THREE.Math.generateUUID();this.type="Audio";this.encoding=this.format="";this.data=null;void 0!==c&&(this.data=FileSystem.readFileArrayBuffer(c),this.encoding=c.split(".").pop().toLowerCase(),this.format="arraybuffer")}
Audio.prototype.toJSON=function(c){if(void 0!==c.audio[this.uuid])return c.audio[this.uuid];var h={};h.name=this.name;h.uuid=this.uuid;h.type=this.type;h.encoding=this.encoding;h.data=Base64Utils.fromArrayBuffer(this.data);h.format="base64";return c.audio[this.uuid]=h};
PHANTANIZER.Image=function(c){this.name="image";this.uuid=THREE.Math.generateUUID();this.type="Image";this.encoding=this.format="";this.data=null;void 0!==c&&(this.encoding=c.split(".").pop().toLowerCase(),"gif"===this.encoding?(this.data="data:image/"+this.encoding+";base64,"+FileSystem.readFileBase64(c),this.format="base64"):"tga"===this.encoding?(c=(new THREE.TGALoader).parse(FileSystem.readFileBase64(c)),this.encoding="jpeg",this.format="base64",this.data=c.toDataURL("image/jpeg",.8)):(this.format=
"url",this.data=c))};
PHANTANIZER.Image.prototype.encodeData=function(){var c=document.createElement("img");c.src=this.data;var h=document.createElement("canvas");h.width=c.width;h.height=c.height;var n=h.getContext("2d");n.drawImage(c,0,0,c.width,c.height);var f=!1;c=n.getImageData(0,0,c.width,c.height).data;for(n=3;n<c.length;n+=4)if(255!==c[n]){f=!0;break}f?(this.format="base64",this.encoding="png",this.data=h.toDataURL("image/png")):(this.format="base64",this.encoding="jpeg",this.data=h.toDataURL("image/jpeg",.8))};
PHANTANIZER.Image.prototype.toJSON=function(c){if(void 0!==c.images[this.uuid])return c.images[this.uuid];"url"===this.format&&this.encodeData();var h={};h.name=this.name;h.uuid=this.uuid;h.type=this.type;h.encoding=this.encoding;h.format=this.format;h.data=this.data;return c.images[this.uuid]=h};
function TextTexture(c,h,n,f,q,l,k,u,r,z,C){THREE.Texture.call(this,document.createElement("canvas"),n,f,q,l,k,u,r,z,C);this.image.width=2048;this.image.height=2048;this.context=this.image.getContext("2d");this.context.font="Normal 500px Arial";this.context.textAlign="center";this.context.fillStyle="#FFFFFF";this.context.fillText("text",this.image.width/2,this.image.height/2);this.name="text";this.category="Text";this.text="text";this.font=h;this.needsUpdate=!0}TextTexture.prototype=Object.create(THREE.Texture.prototype);
function VideoTexture(c,h,n,f,q,l){function k(){c.readyState>=c.HAVE_CURRENT_DATA&&(u.needsUpdate=!0);u.disposed||requestAnimationFrame(k)}"string"===typeof c?this.video=new Video(c):c instanceof Video&&(this.video=c);THREE.Texture.call(this,document.createElement("video"),h,n,f,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,q,l);this.disposed=this.generateMipmaps=!1;this.name="video";this.category="Video";this.loop=this.autoplay=!0;this.image.autoplay=this.autoplay;this.image.loop=this.loop;
this.image.src=this.video.data;var u=this;c=this.image;k()}VideoTexture.prototype=Object.create(THREE.Texture.prototype);VideoTexture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0;this.image.paused||this.image.pause()};VideoTexture.prototype.toJSON=function(c){var h=THREE.Texture.prototype.toJSON.call(this,c);c=this.video.toJSON(c);h.video=c.uuid;h.loop=this.loop;h.autoplay=this.autoplay;return h};
function WebcamTexture(c,h,n,f,q,l,k){function u(){r.readyState>=r.HAVE_CURRENT_DATA&&(z.needsUpdate=!0);z.disposed||requestAnimationFrame(u)}var r=document.createElement("video");r.autoplay=!0;r.loop=!0;navigator.webkitGetUserMedia?navigator.webkitGetUserMedia({video:!0},function(C){r.src=URL.createObjectURL(C)},function(C){console.warn("WebcamTexture: No webcam available")}):navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(C){r.src=URL.createObjectURL(C)}).catch(function(C){console.warn("No webcam available")});
THREE.Texture.call(this,r,c,h,n,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,l,k);this.disposed=this.generateMipmaps=!1;this.name="webcam";this.category="Webcam";var z=this;u()}WebcamTexture.prototype=Object.create(THREE.VideoTexture.prototype);WebcamTexture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0;this.image.paused||this.image.pause()};
function Texture(c,h,n,f,q,l,k,u,r,z){this.img="string"===typeof c?new PHANTANIZER.Image(c):c;THREE.Texture.call(this,document.createElement("img"),h,n,f,q,l,k,u,r,z);var C=this;this.disposed=!1;this.name="texture";this.category="Image";this.image.src=this.img.data;this.image.onload=function(){C.needsUpdate=!0};if("gif"===this.img.encoding){var E=function(){C.disposed||(C.needsUpdate=!0,requestAnimationFrame(E))};E()}}Texture.prototype=Object.create(THREE.Texture.prototype);
Texture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0};Texture.prototype.toJSON=function(c){var h=THREE.Texture.prototype.toJSON.call(this,c);c=this.img.toJSON(c);h.image=c.uuid;return h};function FontLoader(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager}FontLoader.prototype.load=function(c,h,n,f){(new THREE.XHRLoader(this.manager)).load(c,function(q){h(new Font(JSON.parse(q)))},n,f)};
FontLoader.prototype.parse=function(c){if(void 0!==c.data){var h=new Font;h.name=c.name;h.uuid=c.uuid;h.format=c.format;h.encoding=c.encoding;h.data=c.data;return h}return new Font(c)};function ImageLoader(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager}ImageLoader.prototype.load=function(c,h,n,f){var q=this;(new THREE.XHRLoader(this.manager)).load(c,function(l){q.parse(JSON.parse(l),h)},n,f)};
ImageLoader.prototype.parse=function(c,h){h=new PHANTANIZER.Image;h.name=c.name;h.uuid=c.uuid;h.format=c.format;h.encoding=c.encoding;h.data=c.data;return h};function VideoLoader(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager}VideoLoader.prototype.load=function(c,h,n,f){var q=this;(new THREE.XHRLoader(this.manager)).load(c,l=>{q.parse(JSON.parse(l),h)},n,f)};VideoLoader.prototype.parse=function(c,h){h=new Video;h.name=c.name;h.uuid=c.uuid;h.format=c.uuid;h.encoding=c.encoding;h.data=c.data;return h};
function AudioLoader(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager}AudioLoader.prototype.load=function(c,h,n,f){var q=this;(new THREE.XHRLoader(this.manager)).load(c,l=>{q.parse(JSON.parse(l),h)},n,f)};AudioLoader.prototype.parse=function(c){var h=new Audio;h.name=c.name;h.uuid=c.uuid;h.format=c.format;h.encoding=c.encoding;h.data=ArraybufferUtils.fromBase64(c.data);return h};
function TextureLoader(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager;this.images=[];this.videos=[];this.fonts=[]}TextureLoader.prototype.load=function(c,h,n,f){var q=this;(new THREE.XHRLoader(this.manager)).load(c,l=>{q.parse(JSON.parse(l),h)},n,f)};
TextureLoader.prototype.parse=function(c,h){var n=c.category;"Video"===n?(void 0===c.video&&console.warn("TextureLoader: No video specified for",c.uuid),void 0===this.videos[c.video]&&console.warn("TextureLoader: Undefined video",c.video),n=new VideoTexture(this.videos[c.video])):"Webcam"===n?n=new WebcamTexture:(void 0===c.image&&console.warn("TextureLoader: No image specified for",c.uuid),void 0===this.images[c.image]&&console.warn("TextureLoader: Undefined image",c.image),n=new Texture(this.images[c.image]));
n.uuid=c.uuid;n.name=c.name;n.mapping=c.mapping;n.offset=new THREE.Vector2(c.offset[0],c.offset[1]);n.repeat=new THREE.Vector2(c.repeat[0],c.repeat[1]);n.wrapS=c.wrap[0];n.wrapT=c.wrap[1];n.minFilter=c.minFilter;n.magFilter=c.magFilter;n.anisotropy=c.anisotropy;n.flipY=c.flipY;void 0!==h&&h(n);return n};TextureLoader.prototype.setImages=function(c){this.images=c;return this};TextureLoader.prototype.setVideos=function(c){this.videos=c;return this};
TextureLoader.prototype.setFonts=function(c){this.fonts=c;return this};function ObjectLoader(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager;this.texturePath=""}ObjectLoader.prototype.load=function(c,h,n,f){""===this.texturePath&&(this.texturePath=c.substring(0,c.lastIndexOf("/")+1));var q=this;(new THREE.XHRLoader(this.manager)).load(c,function(l){q.parse(JSON.parse(l),h)},n,f)};
ObjectLoader.prototype.parse=function(c,h){var n=this.parseGeometries(c.geometries),f=this.parseImages(c.images),q=this.parseVideos(c.videos),l=this.parseAudio(c.audio),k=this.parseFonts(c.fonts);f=this.parseTextures(c.textures,f,q);q=this.parseMaterials(c.materials,f);var u=this.parseAssetObjects(c.asset_objects);n=this.parseObject(c.object,n,q,f,l,k,u);c.animations&&(n.animations=this.parseAnimations(c.animations));void 0!==c.images&&0!==c.images.length||void 0===h||h(n);return n};
ObjectLoader.prototype.setTexturePath=function(c){this.texturePath=c};ObjectLoader.prototype.setCrossOrigin=function(c){this.crossOrigin=c};
ObjectLoader.prototype.parseGeometries=function(c){var h=[];if(void 0!==c)for(var n=new THREE.JSONLoader,f=new THREE.BufferGeometryLoader,q=0;q<c.length;q++){var l=c[q];switch(l.type){case "PlaneGeometry":case "PlaneBufferGeometry":var k=new THREE[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":k=new THREE[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":k=
new THREE[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":k=new THREE[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case "ConeGeometry":case "ConeBufferGeometry":k=new THREE[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":k=new THREE[l.type](l.radius,
l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":k=new THREE[l.type](l.radius,l.detail);break;case "RingGeometry":case "RingBufferGeometry":k=new THREE[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":k=new THREE[l.type](l.radius,l.tube,l.radialSegments,
l.tubularSegments,l.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":k=new THREE[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case "LatheGeometry":case "LatheBufferGeometry":k=new THREE[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case "BufferGeometry":k=f.parse(l);break;case "Geometry":k=n.parse(l.data,this.texturePath).geometry;break;default:console.warn('ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}k.uuid=l.uuid;k.name=
void 0!==l.name?l.name:"geometry";h[l.uuid]=k}return h};ObjectLoader.prototype.parseMaterials=function(c,h){var n=[],f=new MaterialLoader;f.setTextures(h);if(void 0!==c)for(h=0;h<c.length;h++){var q=f.parse(c[h]);n[q.uuid]=q}return n};ObjectLoader.prototype.parseAnimations=function(c){for(var h=[],n=0;n<c.length;n++){var f=THREE.AnimationClip.parse(c[n]);h.push(f)}return h};
ObjectLoader.prototype.parseImages=function(c){var h=new ImageLoader,n=[];if(void 0!==c)for(var f=0;f<c.length;f++)n[c[f].uuid]=h.parse(c[f]);return n};ObjectLoader.prototype.parseVideos=function(c){var h=new VideoLoader,n=[];if(void 0!==c)for(var f=0;f<c.length;f++)n[c[f].uuid]=h.parse(c[f]);return n};ObjectLoader.prototype.parseAudio=function(c){var h=new AudioLoader,n=[];if(void 0!==c)for(var f=0;f<c.length;f++)n[c[f].uuid]=h.parse(c[f]);return n};
ObjectLoader.prototype.parseFonts=function(c){var h=new FontLoader,n=[];if(void 0!==c)for(var f=0;f<c.length;f++)n[c[f].uuid]=h.parse(c[f]);return n};ObjectLoader.prototype.parseTextures=function(c,h,n){var f=new TextureLoader;f.setImages(h);f.setVideos(n);h=[];if(void 0!==c)for(n=0;n<c.length;n++){var q=f.parse(c[n]);h[q.uuid]=q}return h};ObjectLoader.prototype.parseAssetObjects=function(c){var h=new ObjectLoader,n=[];if(void 0!==c)for(var f=0;f<c.length;f++){var q=h.parse(c[f]);n[q.uuid]=q}return n};
ObjectLoader.prototype.parseObject=function(c,h,n,f,q,l,k){function u(p){void 0===f[p]&&console.warn("ObjectLoader: Undefined texture",p);return f[p]}function r(p){void 0===h[p]&&console.warn("ObjectLoader: Undefined geometry",p);return h[p]}function z(p){void 0===n[p]&&console.warn("ObjectLoader: Undefined material",p);return n[p]}function C(p){void 0===l[p]&&console.warn("ObjectLoader: Undefined font",p);return l[p]}var E=new THREE.Matrix4;switch(c.type){case "SpineAnimation":for(var A=0;A<c.textures.length;A++)c.textures[A].texture=
u(c.textures[A].texture);var H=new SpineAnimation(c.json,c.atlas,"",c.textures);break;case "Audio":void 0===q[c.audio]&&console.warn();H=new AudioEmitter(void 0);H.autoplay=c.autoplay;H.startTime=c.startTime;H.playbackRate=c.playbackRate;H.source.loop=c.source.loop;break;case "Physics":H=new PhysicsObject;H.body.type=c.body.type;H.body.mass=c.body.mass;H.body.linearDamping=c.body.linearDamping;H.body.angularDamping=c.body.angularDamping;H.body.allowSleep=c.body.allowSleep;H.body.sleepSpeedLimit=c.body.sleepSpeedLimit;
H.body.sleepTimeLimit=c.body.sleepTimeLimit;H.body.collisionFilterGroup=c.body.collisionFilterGroup;H.body.collisionFilterMask=c.body.collisionFilterMask;H.body.fixedRotation=c.body.fixedRotation;var J=c.body.shapes;for(A=0;A<J.length;A++){var N=J[A];N.type===CANNON.Shape.types.SPHERE?H.body.addShape(new CANNON.Sphere(N.radius)):N.type===CANNON.Shape.types.BOX?H.body.addShape(new CANNON.Box(new CANNON.Vec3(N.halfExtents.x,N.halfExtents.y,N.halfExtents.z))):N.type===CANNON.Shape.types.PARTICLE?H.body.addShape(new CANNON.Particle):
N.type===CANNON.Shape.types.PLANE?H.body.addShape(new CANNON.Plane):N.type===CANNON.Shape.types.CONVEXPOLYHEDRON&&H.body.addShape(new CANNON.ConvexPolyhedron(N.vertices,N.faces))}break;case "ParticleEmiter":void 0!==c.group&&(H=c.group,H.texture.value=u(H.texture.value),H.textureFrames=THREE.Vector2(H.textureFrames));if(void 0!==c.emitter)for(H=c.emitter,H.position.value=THREE.Vector3.fromJSON(H.position.value),H.position.spread=THREE.Vector3.fromJSON(H.position.spread),H.velocity.value=THREE.Vector3.fromJSON(H.velocity.value),
H.velocity.spread=THREE.Vector3.fromJSON(H.velocity.spread),H.acceleration.value=THREE.Vector3.fromJSON(H.acceleration.value),H.acceleration.spread=THREE.Vector3.fromJSON(H.acceleration.spread),A=0;A<H.color.value.length;A++)H.color.value[A]=THREE.Color.fromJSON(H.color.value[A]),H.color.spread[A]=THREE.Vector3.fromJSON(H.color.spread[A]);H=new ParticleEmitter(c.group,c.emitter);break;case "Text3D":H=new Text3D(c.text,z(c.material),C(c.font),c.height,c.bevel,c.bevel_thickness,c.bevel_size);break;
case "Program":H=new Program(c.name);H.description=c.description;H.author=c.author;H.version=c.version;H.vr=c.vr;H.vr_scale=c.vr_scale;void 0!==c.lock_pointer&&(H.lock_pointer=c.lock_pointer);void 0!==c.default_scene&&(H.default_scene=c.default_scene);break;case "LeapDevice":H=new LeapMotion;H.mode=c.mode;H.use_arm=c.use_arm;void 0!==c.debug_model&&(H.debug_model=c.debug_model);void 0!==c.gestures_enabled&&(H.gestures_enabled=c.gestures_enabled);void 0!==c.poses_enabled&&(H.poses_enabled=c.poses_enabled);
break;case "Kinect":H=new KinectDevice;void 0!==c.debug_model&&(H.debug_model=c.debug_model);break;case "Sky":H=new Sky(c.auto_update,c.day_time,c.sun_distance,c.time);void 0!==c.sun&&H.sun.shadow.fromJSON(c.sun.shadow);break;case "Scene":H=new Scene;void 0!==c.background&&Number.isInteger(c.background)&&(H.background=new THREE.Color(c.background));void 0!==c.fog&&("Fog"===c.fog.type?H.fog=new THREE.Fog(c.fog.color,c.fog.near,c.fog.far):"FogExp2"===c.fog.type&&(H.fog=new THREE.FogExp2(c.fog.color,
c.fog.density)));void 0!==c.cameras&&(H.cameras=c.cameras);void 0!==c.world&&H.world.gravity.set(c.world.gravity.x,c.world.gravity.y,c.world.gravity.z);break;case "PerspectiveCamera":H=new PerspectiveCamera(c.fov,c.aspect,c.near,c.far);void 0!==c.focus&&(H.focus=c.focus);void 0!==c.zoom&&(H.zoom=c.zoom);void 0!==c.filmGauge&&(H.filmGauge=c.filmGauge);void 0!==c.filmOffset&&(H.filmOffset=c.filmOffset);void 0!==c.view&&(H.view=Object.assign({},c.view));void 0!==c.viewport&&H.viewport.fromArray(c.viewport);
void 0!==c.offset&&H.offset.fromArray(c.offset);void 0!==c.clear_color&&(H.clear_color=c.clear_color);void 0!==c.clear_depth&&(H.clear_depth=c.clear_depth);break;case "OrthographicCamera":H=new OrthographicCamera(c.size,c.aspect,c.mode,c.near,c.far);void 0!==c.viewport&&H.viewport.fromArray(c.viewport);void 0!==c.offset&&H.offset.fromArray(c.offset);void 0!==c.clear_color&&(H.clear_color=c.clear_color);void 0!==c.clear_depth&&(H.clear_depth=c.clear_color);break;case "AmbientLight":H=new AmbientLight(c.color,
c.intensity);break;case "DirectionalLight":H=new DirectionalLight(c.color,c.intensity);break;case "PointLight":H=new PointLight(c.color,c.intensity,c.distance,c.decay);break;case "SpotLight":H=new SpotLight(c.color,c.intensity,c.distance,c.angle,c.penumbra,c.decay);break;case "HemisphereLight":H=new HemisphereLight(c.color,c.groundColor,c.intensity);break;case "Mesh":H=new Mesh(r(c.geometry),z(c.material));break;case "SkinnedMesh":H=new SkinnedMesh(r(c.geometry),z(c.material));break;case "LOD":H=
new THREE.LOD;break;case "Line":H=new THREE.Line(r(c.geometry),z(c.material),c.mode);break;case "PointCloud":case "Points":H=new THREE.Points(r(c.geometry),z(c.material));break;case "Sprite":H=new Sprite(z(c.material));break;case "Group":H=new Empty;break;case "ObjectCaller":H=new ObjectCaller(c.obj_uuid,c.obj_type);break;case "Script":H=new Script(c.code);break;case "BlockScript":H=new BlockScript(c.nodes);break;case "Bone":H=new Bone;break;default:H=new Empty}H.uuid=c.uuid;void 0!==c.name&&(H.name=
c.name);void 0!==c.hidden&&(H.hidden=c.hidden);void 0!==c.folded&&(H.folded=c.folded);void 0!==c.matrix?(E.fromArray(c.matrix),E.decompose(H.position,H.quaternion,H.scale)):(void 0!==c.position&&H.position.fromArray(c.position),void 0!==c.rotation&&H.rotation.fromArray(c.rotation),void 0!==c.scale&&H.scale.fromArray(c.scale));void 0!==c.castShadow&&(H.castShadow=c.castShadow);void 0!==c.receiveShadow&&(H.receiveShadow=c.receiveShadow);void 0!==c.shadow&&H.shadow.fromJSON(c.shadow);void 0!==c.visible&&
(H.visible=c.visible);void 0!==c.userData&&(H.userData=c.userData);if(void 0!==c.children)for(var U in c.children)H.add(this.parseObject(c.children[U],h,n,f,q,l));void 0!==c.nodes&&(H.nodes=c.nodes);void 0!==c.blocks_type&&(H.blocks_type=c.blocks_type);if(void 0!==c.components)for(A in c.components)eval(`
				object.components.push(new ${c.components[A].className}())
				object.components[object.components.length - 1].values = compo.values
			`);void 0!==c.matrixAutoUpdate&&(H.matrixAutoUpdate=c.matrixAutoUpdate,H.matrixAutoUpdate||(H.updateMatrix(),H.updateMatrixWorld(!0)));if("Program"===c.type)H.materials=n,H.asset_objects=k;else if("Scene"===c.type)for(A=0;A<H.cameras.length;A++)U=H.getCamera(H.cameras[A]),null!==U?H.cameras[A]=U:H.cameras.splice(A,1);else if("LOD"===c.type)for(A=c.levels,c=0;c<A.length;c++)q=A[c],U=H.getObjectByProperty("uuid",q.object),void 0!==U&&H.addLevel(U,q.distance);return H};
var MaterialLoader=function(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager;this.textures={}};
MaterialLoader.prototype={constructor:MaterialLoader,load:function(c,h,n,f){var q=this;(new THREE.XHRLoader(q.manager)).load(c,function(l){h(q.parse(JSON.parse(l)))},n,f)},setTextures:function(c){this.textures=c},getTexture:function(c){var h=this.textures;void 0===h[c]&&console.warn("THREE.MaterialLoader: Undefined texture",c);return h[c]},parse:function(c){var h=c.type;"MeshPhongMaterial"===h?h=new MeshPhongMaterial:"MeshStandardMaterial"===h?h=new MeshStandardMaterial:"MeshLambertMaterial"===h?
h=new MeshLambertMaterial:"ShaderMaterial"===h?h=new MeshShaderMaterial:"MeshNormalMaterial"===h?h=new MeshNormalMaterial:"MeshDepthMaterial"===h?h=new MeshDepthMaterial:(console.log('Unregistered material in "MaterialLoader": '+c.type),h=new THREE[c.type]);void 0!==c.uuid&&(h.uuid=c.uuid);void 0!==c.name&&(h.name=c.name);void 0!==c.color&&h.color.setHex(c.color);void 0!==c.roughness&&(h.roughness=c.roughness);void 0!==c.metalness&&(h.metalness=c.metalness);void 0!==c.emissive&&h.emissive.setHex(c.emissive);
void 0!==c.nodes&&(h.nodes=c.nodes);void 0!==c.specular&&h.specular.setHex(c.specular);void 0!==c.shininess&&(h.shininess=c.shininess);void 0!==c.uniforms&&(h.uniforms=c.uniforms);void 0!==c.vertexShader&&(h.vertexShader=c.vertexShader);void 0!==c.fragmentShader&&(h.fragmentShader=c.fragmentShader);void 0!==c.vertexColors&&(h.vertexColors=c.vertexColors);void 0!==c.shading&&(h.shading=c.shading);void 0!==c.blending&&(h.blending=c.blending);void 0!==c.side&&(h.side=c.side);void 0!==c.opacity&&(h.opacity=
c.opacity);void 0!==c.transparent&&(h.transparent=c.transparent);void 0!==c.alphaTest&&(h.alphaTest=c.alphaTest);void 0!==c.depthTest&&(h.depthTest=c.depthTest);void 0!==c.depthWrite&&(h.depthWrite=c.depthWrite);void 0!==c.colorWrite&&(h.colorWrite=c.colorWrite);void 0!==c.wireframe&&(h.wireframe=c.wireframe);void 0!==c.wireframeLinewidth&&(h.wireframeLinewidth=c.wireframeLinewidth);void 0!==c.size&&(h.size=c.size);void 0!==c.sizeAttenuation&&(h.sizeAttenuation=c.sizeAttenuation);void 0!==c.map&&
(h.map=this.getTexture(c.map));void 0!==c.alphaMap&&(h.alphaMap=this.getTexture(c.alphaMap),h.transparent=!0);void 0!==c.bumpMap&&(h.bumpMap=this.getTexture(c.bumpMap));void 0!==c.bumpScale&&(h.bumpScale=c.bumpScale);void 0!==c.normalMap&&(h.normalMap=this.getTexture(c.normalMap));if(void 0!==c.normalScale){var n=c.normalScale;!1===Array.isArray(n)&&(n=[n,n]);h.normalScale=(new THREE.Vector2).fromArray(n)}void 0!==c.displacementMap&&(h.displacementMap=this.getTexture(c.displacementMap));void 0!==
c.displacementScale&&(h.displacementScale=c.displacementScale);void 0!==c.displacementBias&&(h.displacementBias=c.displacementBias);void 0!==c.roughnessMap&&(h.roughnessMap=this.getTexture(c.roughnessMap));void 0!==c.metalnessMap&&(h.metalnessMap=this.getTexture(c.metalnessMap));void 0!==c.emissiveMap&&(h.emissiveMap=this.getTexture(c.emissiveMap));void 0!==c.emissiveIntensity&&(h.emissiveIntensity=c.emissiveIntensity);void 0!==c.specularMap&&(h.specularMap=this.getTexture(c.specularMap));void 0!==
c.envMap&&(h.envMap=this.getTexture(c.envMap),h.combine=THREE.MultiplyOperation);c.reflectivity&&(h.reflectivity=c.reflectivity);void 0!==c.lightMap&&(h.lightMap=this.getTexture(c.lightMap));void 0!==c.lightMapIntensity&&(h.lightMapIntensity=c.lightMapIntensity);void 0!==c.aoMap&&(h.aoMap=this.getTexture(c.aoMap));void 0!==c.aoMapIntensity&&(h.aoMapIntensity=c.aoMapIntensity);if(void 0!==c.materials){n=0;for(var f=c.materials.length;n<f;n++)h.materials.push(this.parse(c.materials[n]))}return h}};
function TTFLoader(c){this.manager=void 0!==c?c:THREE.DefaultLoadingManager;this.reversed=!1}TTFLoader.prototype.load=function(c,h,n,f){var q=new THREE.XHRLoader(this.manager);q.setResponseType("arraybuffer");q.load(c,function(l){l=scope.parse(l);void 0!==h&&h(l)},n,f)};TTFLoader.prototype.parse=function(c){c=opentype.parse(c);return TTFLoader.convert(c,this.reversed)};
TTFLoader.convert=function(c,h){for(var n=1E5/(72*(c.unitsPerEm||2048)),f={glyphs:{}},q=0;q<c.glyphs.length;q++){var l=c.glyphs.glyphs[q];if(void 0!==l.unicode){var k={};k.ha=Math.round(l.advanceWidth*n);k.x_min=Math.round(l.xMin*n);k.x_max=Math.round(l.xMax*n);k.o="";h&&(l.path.commands=TTFLoader.reverseCommands(l.path.commands));l.path.commands.forEach(function(u,r){"c"===u.type.toLowerCase()&&(u.type="b");k.o+=u.type.toLowerCase();k.o+=" ";void 0!==u.x&&void 0!==u.y&&(k.o+=Math.round(u.x*n),k.o+=
" ",k.o+=Math.round(u.y*n),k.o+=" ");void 0!==u.x1&&void 0!==u.y1&&(k.o+=Math.round(u.x1*n),k.o+=" ",k.o+=Math.round(u.y1*n),k.o+=" ");void 0!==u.x2&&void 0!==u.y2&&(k.o+=Math.round(u.x2*n),k.o+=" ",k.o+=Math.round(u.y2*n),k.o+=" ")});f.glyphs[String.fromCharCode(l.unicode)]=k}}f.familyName=c.familyName;f.ascender=Math.round(c.ascender*n);f.descender=Math.round(c.descender*n);f.underlinePosition=c.tables.post.underlinePosition;f.underlineThickness=c.tables.post.underlineThickness;f.boundingBox={yMin:c.tables.head.yMin,
xMin:c.tables.head.xMin,yMax:c.tables.head.yMax,xMax:c.tables.head.xMax};f.resolution=1E3;f.original_font_information=c.tables.name;return f};
TTFLoader.reverseCommands=function(c){var h=[],n;c.forEach(function(q){"m"===q.type.toLowerCase()?(n=[q],h.push(n)):"z"!==q.type.toLowerCase()&&n.push(q)});var f=[];h.forEach(function(q){var l={type:"m",x:q[q.length-1].x,y:q[q.length-1].y};f.push(l);for(var k=q.length-1;0<k;k--){var u=q[k];l={type:u.type};void 0!==u.x2&&void 0!==u.y2?(l.x1=u.x2,l.y1=u.y2,l.x2=u.x1,l.y2=u.y1):void 0!==u.x1&&void 0!==u.y1&&(l.x1=u.x1,l.y1=u.y1);l.x=q[k-1].x;l.y=q[k-1].y;f.push(l)}});return f};
function LeapMotion(){THREE.Object3D.call(this);this.type="LeapDevice";this.name="leap";this.poses_enabled=this.gestures_enabled=this.debug_model=!0;this.mode=LeapMotion.DESK;this.use_arm=!1;this.bone_meshes=[];this.arm_meshes=[];this.material=new THREE.MeshPhongMaterial;this.geometry=new THREE.BoxBufferGeometry(1,1,1);this.physics_world=null;this.physics_bodys=[];this.gesture=[];for(var c=0;10>c;c++)this.gesture[c]=!1;this.pose=[];for(c=0;3>c;c++)this.pose[c]=!1;this.data=null;this.components=[];
this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LeapComponent)}LeapMotion.prototype=Object.create(THREE.Object3D.prototype);LeapMotion.DESK=0;LeapMotion.HDM=1;LeapMotion.SWIPE=0;LeapMotion.SWIPE_LEFT=1;LeapMotion.SWIPE_RIGHT=2;LeapMotion.SWIPE_FRONT=3;LeapMotion.SWIPE_BACK=4;LeapMotion.SWIPE_UP=5;LeapMotion.SWIPE_DOWN=6;LeapMotion.CIRCLE=7;LeapMotion.SCREEN_TAP=8;LeapMotion.KEY_TAP=9;
LeapMotion.CLOSED=0;LeapMotion.OPEN=1;LeapMotion.POINTING=2;LeapMotion.prototype.initialize=function(){var c=this;Leap.loop({background:!0},function(n){c.data=n}).connect();for(var h=0;h<this.children.length;h++)this.children[h].initialize()};LeapMotion.prototype.update=function(){null!==this.data&&(this.gestures_enabled&&this.updateGestures(),this.poses_enabled&&this.updatePoses(),this.debug_model&&this.updateDebugModel());for(var c=0;c<this.children.length;c++)this.children[c].update()};
LeapMotion.prototype.checkGesture=function(c){return void 0!==this.gesture[c]?this.gesture[c]:!1};LeapMotion.prototype.checkPose=function(c){return void 0!==this.pose[c]?this.pose[c]:!1};LeapMotion.prototype.setMode=function(c){this.mode=c};
LeapMotion.prototype.updatePoses=function(){for(var c=0;c<this.pose.length;c++)this.pose[c]=!0;for(var h=0;h<this.data.hands.length;h++){var n=this.data.hands[h],f=n.sphereCenter;f=new THREE.Vector3(f[0],f[1],f[2]);var q=[],l=0;for(c=0;c<this.pose.length;c++)this.pose[c]=!0;var k=[];for(c=0;c<n.fingers.length;c++){var u=n.fingers[c];k.push(u.direction);u=u.distal.nextJoint;u=new THREE.Vector3(u[0],u[1],u[2]);q.push(f.distanceTo(u)/n._scaleFactor);0!==c&&(.3>k[c][2]&&(this.pose[LeapMotion.CLOSED]=
!1),-.5<k[c][2]&&(this.pose[LeapMotion.OPEN]=!1),1===c?l=q[1]:l<2*q[c]-15&&(this.pose[LeapMotion.POINTING]=!1))}l<2*q[0]-15&&(this.pose[LeapMotion.POINTING]=!1)}};
LeapMotion.prototype.updateGestures=function(){for(var c=0;c<this.gesture.length;c++)this.gesture[c]=!1;var h=this;this.data.valid&&0<this.data.gestures.length&&this.data.gestures.forEach(function(n){"swipe"===n.type?(h.gesture[LeapMotion.SWIPE]=!0,0<n.direction[0]?h.gesture[LeapMotion.SWIPE_RIGHT]=!0:h.gesture[LeapMotion.SWIPE_LEFT]=!0,0<n.direction[1]?h.gesture[LeapMotion.SWIPE_UP]=!0:h.gesture[LeapMotion.SWIPE_DOWN]=!0,0<n.direction[2]?h.gesture[LeapMotion.SWIPE_FRONT]=!0:h.gesture[LeapMotion.SWIPE_BACK]=
!0):"circle"===n.type?h.gesture[LeapMotion.CIRCLE]=!0:"keyTap"===n.type?h.gesture[LeapMotion.KEY_TAP]=!0:"screenTap"===n.type&&(h.gesture[LeapMotion.SCREEN_TAP]=!0)})};
LeapMotion.prototype.updateDebugModel=function(){var c=this;this.arm_meshes.forEach(function(r){c.remove(r)});this.bone_meshes.forEach(function(r){c.remove(r)});var h=0,n=0,f;for(f of this.data.hands){for(var q of f.fingers)for(var l of q.bones){if(0!==h){var k=this.bone_meshes[h]||this.addMesh(this.bone_meshes);this.updateMesh(l,k)}h++}if(this.show_arm){k=f.arm;var u=this.arm_meshes[n++]||this.addMesh(this.arm_meshes);this.updateMesh(k,u);u.scale.set(k.width/1200,k.width/300,k.length/150)}}null!==
this.physics_world&&this.updatePhysics()};
LeapMotion.prototype.updatePhysics=function(){for(var c=0;c<this.physics_bodys.length;c++)this.physics_world.removeBody(this.physics_bodys[c].pop());this.children.forEach(function(h,n){h=new THREE.BoundingBoxHelper(h);h.update();n=new THREE.Vector3(h.box.max.x-h.box.min.x,h.box.max.y-h.box.min.y,h.box.max.z-h.box.min.z);n.x*=this.scale.x;n.y*=this.scale.y;n.z*=this.scale.z;n.divideScalar(2);h=h.box.center();h.x*=this.scale.x;h.y*=this.scale.y;h.z*=this.scale.z;h.add(this.position);n=new CANNON.Box(new CANNON.Vec3(n.x,
n.y,n.z));var f=new CANNON.Body({mass:0});f.addShape(n);f.position.set(h.x-this.position.x,h.y-this.position.y,h.z-this.position.z);f.updateMassProperties();this.physics_bodys.push(f);this.physics_world.addBody(f)})};LeapMotion.prototype.addMesh=function(c){var h=new Mesh(this.geometry,this.material);h.castShadow=this.castShadow;h.receiveShadow=this.receiveShadow;c.push(h);return h};
LeapMotion.prototype.updateMesh=function(c,h){h.position.fromArray(c.center());h.position.divideScalar(150);h.setRotationFromMatrix((new THREE.Matrix4).fromArray(c.matrix()));h.scale.set(c.width/150,c.width/150,c.length/150);this.add(h)};LeapMotion.prototype.getMovement=function(){var c=this.data.gestures[0].position,h=this.data.gestures[0].startPosition;c=new THREE.Vector3(c[0]-h[0],c[1]-h[1],c[2]-h[2]);c.divideScalar(this.data.currentFrameRate);return c};
LeapMotion.prototype.toJSON=function(c){c=THREE.Object3D.prototype.toJSON.call(this,c);c.object.type=this.type;c.object.debug_model=this.debug_model;c.object.gestures_enabled=this.gestures_enabled;c.object.poses_enabled=this.poses_enabled;c.object.mode=this.mode;c.object.use_arm=this.use_arm;return c};
function KinectDevice(){THREE.Object3D.call(this);this.type="Kinect";this.name="kinect";this.socket=new WebSocket("ws://127.0.0.1:8181");this.connected=!1;this.debug_model=!0;this.data_timeout=0;this.data=this.camera=null;this.data_received=!1;var c=this;this.socket.onopen=function(){c.connected=!0};this.socket.onclose=function(){c.connected=!1};this.socket.onmessage=function(h){"string"===typeof h.data?(c.data=JSON.parse(h.data),c.data_received=!0,c.data_timeout=KinectDevice.DATA_TIMEOUT):h.data instanceof
Blob&&(c.camera=h.data)};this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new KinectComponent)}KinectDevice.DATA_TIMEOUT=20;KinectDevice.DEPTH=0;KinectDevice.COLOR=1;
KinectDevice.JOINTS_NAME=[["head","shouldercenter"],["shouldercenter","shoulderright"],["shouldercenter","shoulderleft"],["shoulderright","elbowright"],["shoulderleft","elbowleft"],["elbowright","wristright"],["elbowleft","wristleft"],["wristright","handright"],["wristleft","handleft"],["shouldercenter","spine"],["spine","hipcenter"],["hipcenter","hipright"],["hipcenter","hipleft"],["hipright","kneeright"],["hipleft","kneeleft"],["kneeright","ankleright"],["kneeleft","ankleleft"],["ankleright","footright"],
["ankleleft","footleft"]];KinectDevice.prototype=Object.create(THREE.Object3D.prototype);
KinectDevice.prototype.update=function(){if(null!==this.data)if(this.data_received){for(this.data_received=!1;0<this.children.length;)this.children.pop();if(this.debug_model)for(var c=new THREE.SphereGeometry(.04,6,6),h=new THREE.MeshPhongMaterial(16711680),n=0;n<this.data.skeletons.length;n++)for(var f=this.data.skeletons[n].joints,q=0;q<f.length;q++){var l=new Mesh(c,h);l.position.set(f[q].x,f[q].y,f[q].z);l.castShadow=!0;this.add(l)}}else if(0<this.data_timeout&&(this.data_timeout--,0===this.data_timeout))for(;0<
this.children.length;)this.children.pop();for(q=0;q<this.children.length;q++)this.children[q].update()};KinectDevice.prototype.isConnected=function(){return this.connected};KinectDevice.prototype.setCameraMode=function(c){c===KinectDevice.COLOR?socket.send("Color"):c===KinectDevice.DEPTH&&socket.send("Depth")};KinectDevice.prototype.toJSON=function(c){c=THREE.Object3D.prototype.toJSON.call(this,c);c.object.debug_model=this.debug_model;return c};
function Mesh(c,h){THREE.Mesh.call(this,c,h);this.name="model";this.castShadow=this.receiveShadow=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Mesh.prototype=Object.create(THREE.Mesh.prototype);Mesh.prototype.dispose=function(){void 0!==this.material.dispose&&this.material.dispose();this.geometry.dispose();for(var c=0;c<this.children.length;c++)this.children[c].dispose()};
function SkinnedMesh(c,h,n){THREE.SkinnedMesh.call(this,c,h,n);this.name="model";this.castShadow=this.receiveShadow=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}SkinnedMesh.prototype=Object.create(THREE.SkinnedMesh.prototype);SkinnedMesh.prototype.dispose=function(){void 0!==this.material.dispose&&this.material.dispose();this.geometry.dispose();for(var c=0;c<this.children.length;c++)this.children[c].dispose()};
function Text3D(c,h,n,f,q,l,k){THREE.Mesh.call(this,void 0,h);this.name="text";this.type="Text3D";this.scale.set(.02,.02,.02);this.font=n;this.text=void 0!==c?c:"text";this.height=void 0!==f?f:50;this.bevel=void 0!=q?q:!1;this.bevel_thickness=void 0!==l?l:10;this.bevel_size=void 0!==k?k:8;this.setText(this.text);this.castShadow=this.receiveShadow=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new Text3DComponent)}
Text3D.prototype=Object.create(THREE.Mesh.prototype);Text3D.prototype.setText=function(c){void 0!==c&&(this.text=c);void 0!==this.geometry&&this.geometry.dispose();this.geometry=new THREE.TextGeometry(this.text,{font:this.font,height:this.height,bevelEnabled:this.bevel,bevelSize:this.bevel_size,bevelThickness:this.bevel_thickness})};Text3D.prototype.dispose=function(){void 0!==this.material.dispose&&this.material.dispose();void 0!==this.geometry&&this.geometry.dispose();for(var c=0;c<this.children.length;c++)this.children[c].dispose()};
Text3D.prototype.toJSON=function(c){var h=this.geometry;this.geometry=void 0;var n=this.font;c=THREE.Object3D.prototype.toJSON.call(this,c,(f,q)=>{n=n.toJSON(f)});c.object.text=this.text;c.object.font=n.uuid;c.object.height=this.height;c.object.bevel=this.bevel;c.object.bevel_thickness=this.bevel_thickness;c.object.bevel_size=this.bevel_size;this.geometry=h;return c};
function Sprite(c){THREE.Sprite.call(this,c);this.name="sprite";this.type="Sprite";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Sprite.prototype=Object.create(THREE.Sprite.prototype);Sprite.prototype.dispose=function(){void 0!==this.material.dispose&&this.material.dispose();for(var c=0;c<this.children.length;c++)this.children[c].dispose()};
function TextSprite(c,h){THREE.Sprite.call(this,new THREE.SpriteMaterial({color:16777215}));this.name="sprite";this.type="TextSprite";this.font=h;this.text=c}TextSprite.prototype=Object.create(THREE.Sprite.prototype);TextSprite.prototype.setText=function(c){this.text=c};TextSprite.prototype.dispose=function(){void 0!==this.material.dispose&&this.material.dispose();for(var c=0;c<this.children.length;c++)this.children[c].dispose()};
TextSprite.prototype.toJSON=function(c){var h=this.material;this.material=void 0;var n=this.font;c=THREE.Sprite.prototype.toJSON.call(this,c,(f,q)=>{n=n.toJSON(f)});c.object.text=this.text;c.object.font=this.uuid;this.material=h;return c};
function PointLight(c,h,n,f){THREE.PointLight.call(this,c,h,n,f);this.name="point_light";this.castShadow=!0;this.shadow.camera.near=.05;this.shadow.camera.far=5E3;this.shadow.bias=.01;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}PointLight.prototype=Object.create(THREE.PointLight.prototype);
PointLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};
function SpotLight(c,h,n,f,q,l){THREE.SpotLight.call(this,c,h,n,f,q,l);this.name="spot_light";this.castShadow=!0;this.shadow.camera.near=.5;this.shadow.camera.far=5E3;this.shadow.mapSize.width=512;this.shadow.mapSize.height=512;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}SpotLight.prototype=Object.create(THREE.SpotLight.prototype);
SpotLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};function AmbientLight(c){THREE.AmbientLight.call(this,c);this.name="ambient_light";this.matrixAutoUpdate=!1;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}AmbientLight.prototype=Object.create(THREE.AmbientLight.prototype);
function DirectionalLight(c,h){THREE.DirectionalLight.call(this,c,h);this.name="directional_light";this.castShadow=!0;this.shadow.camera.near=.5;this.shadow.camera.far=1E4;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}DirectionalLight.prototype=Object.create(THREE.DirectionalLight.prototype);
DirectionalLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};function HemisphereLight(c,h,n){THREE.HemisphereLight.call(this,c,h,n);this.name="hemisphere_light";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}HemisphereLight.prototype=Object.create(THREE.HemisphereLight.prototype);
function Sky(c,h,n,f){THREE.Object3D.call(this);this.name="sky";this.type="Sky";this.clock=new THREE.Clock;this.hemisphere=new HemisphereLight(16777215,16777215,.5);this.hemisphere.color.setHSL(.6,1,.6);this.hemisphere.groundColor.setHSL(.1,1,.75);this.hemisphere.position.set(0,500,0);this.hemisphere.hidden=!0;this.hemisphere.rotationAutoUpdate=!1;this.hemisphere.matrixAutoUpdate=!1;this.add(this.hemisphere);this.sun=new DirectionalLight(Sky.sun_color,.3);this.sun.castShadow=!0;this.sun.hidden=!0;
this.add(this.sun);var q={top_color:{type:"c",value:new THREE.Color(0,.46,1)},bottom_color:{type:"c",value:new THREE.Color(1,1,1)},offset:{type:"f",value:20},exponent:{type:"f",value:.4}};q.top_color.value.copy(this.hemisphere.color);var l=new THREE.SphereBufferGeometry(1E3,16,16);q=new THREE.ShaderMaterial({vertexShader:"varying vec3 vWorldPosition; \tvoid main() \t{ \t\tvec4 worldPosition = modelMatrix * vec4(position, 1.0); \t\tvWorldPosition = worldPosition.xyz; \t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); \t}",
fragmentShader:"uniform vec3 top_color; \tuniform vec3 bottom_color; \tuniform float offset; \tuniform float exponent; \tvarying vec3 vWorldPosition; \tvoid main() \t{ \t\tfloat h = normalize(vWorldPosition + offset).y; \t\tgl_FragColor = vec4(mix(bottom_color, top_color, max(pow(max(h , 0.0), exponent), 0.0)), 1.0); \t}",uniforms:q,side:THREE.BackSide});this.sky=new THREE.Mesh(l,q);this.sky.hidden=!0;this.sky.rotationAutoUpdate=!1;this.sky.matrixAutoUpdate=!1;this.add(this.sky);this.sky.raycast=
function(){return null};this.auto_update=void 0!==c?c:!0;this.sun_distance=void 0!==n?n:500;this.day_time=void 0!==h?h:240;this.time=void 0!==f?f:150;this.updateSky();this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new SkyComponent)}Sky.prototype=Object.create(THREE.Object3D.prototype);Sky.color_top=[new THREE.Color(7844859),new THREE.Color(30463),new THREE.Color(220086),new THREE.Color(9273)];
Sky.color_bottom=[new THREE.Color(15461606),new THREE.Color(16777215),new THREE.Color(16705495),new THREE.Color(26023)];Sky.sun_color=16777130;Sky.moon_color=8947967;Sky.prototype.initialize=function(){this.updateSky();for(var c=0;c<this.children.length;c++)this.children[c].initialize()};Sky.prototype.update=function(){this.auto_update&&(this.time+=this.clock.getDelta(),this.time>this.day_time&&(this.time-=this.day_time),this.updateSky());for(var c=0;c<this.children.length;c++)this.children[c].update()};
Sky.prototype.updateSky=function(){var c=this.time/this.day_time;if(.25>c)this.sky.material.uniforms.top_color.value.setRGB(Sky.color_top[3].r,Sky.color_top[3].g,Sky.color_top[3].b),this.sky.material.uniforms.bottom_color.value.setRGB(Sky.color_bottom[3].r,Sky.color_bottom[3].g,Sky.color_bottom[3].b);else if(.292>c){var h=23.81*(c-.25),n=1-h;this.sky.material.uniforms.top_color.value.setRGB(n*Sky.color_top[3].r+h*Sky.color_top[0].r,n*Sky.color_top[3].g+h*Sky.color_top[0].g,n*Sky.color_top[3].b+h*
Sky.color_top[0].b);this.sky.material.uniforms.bottom_color.value.setRGB(n*Sky.color_bottom[3].r+h*Sky.color_bottom[0].r,n*Sky.color_bottom[3].g+h*Sky.color_bottom[0].g,n*Sky.color_bottom[3].b+h*Sky.color_bottom[0].b)}else.4167>c?(this.sky.material.uniforms.top_color.value.setRGB(Sky.color_top[0].r,Sky.color_top[0].g,Sky.color_top[0].b),this.sky.material.uniforms.bottom_color.value.setRGB(Sky.color_bottom[0].r,Sky.color_bottom[0].g,Sky.color_bottom[0].b)):.5>c?(h=12*(c-.4167),n=1-h,this.sky.material.uniforms.top_color.value.setRGB(n*
Sky.color_top[0].r+h*Sky.color_top[1].r,n*Sky.color_top[0].g+h*Sky.color_top[1].g,n*Sky.color_top[0].b+h*Sky.color_top[1].b),this.sky.material.uniforms.bottom_color.value.setRGB(n*Sky.color_bottom[0].r+h*Sky.color_bottom[1].r,n*Sky.color_bottom[0].g+h*Sky.color_bottom[1].g,n*Sky.color_bottom[0].b+h*Sky.color_bottom[1].b)):.708>c?(this.sky.material.uniforms.top_color.value.setRGB(Sky.color_top[1].r,Sky.color_top[1].g,Sky.color_top[1].b),this.sky.material.uniforms.bottom_color.value.setRGB(Sky.color_bottom[1].r,
Sky.color_bottom[1].g,Sky.color_bottom[1].b)):.75>c?(h=23.81*(c-.708),n=1-h,this.sky.material.uniforms.top_color.value.setRGB(n*Sky.color_top[1].r+h*Sky.color_top[2].r,n*Sky.color_top[1].g+h*Sky.color_top[2].g,n*Sky.color_top[1].b+h*Sky.color_top[2].b),this.sky.material.uniforms.bottom_color.value.setRGB(n*Sky.color_bottom[1].r+h*Sky.color_bottom[2].r,n*Sky.color_bottom[1].g+h*Sky.color_bottom[2].g,n*Sky.color_bottom[1].b+h*Sky.color_bottom[2].b)):.8333>c?(h=12.048*(c-.75),n=1-h,this.sky.material.uniforms.top_color.value.setRGB(n*
Sky.color_top[2].r+h*Sky.color_top[3].r,n*Sky.color_top[2].g+h*Sky.color_top[3].g,n*Sky.color_top[2].b+h*Sky.color_top[3].b),this.sky.material.uniforms.bottom_color.value.setRGB(n*Sky.color_bottom[2].r+h*Sky.color_bottom[3].r,n*Sky.color_bottom[2].g+h*Sky.color_bottom[3].g,n*Sky.color_bottom[2].b+h*Sky.color_bottom[3].b)):(this.sky.material.uniforms.top_color.value.setRGB(Sky.color_top[3].r,Sky.color_top[3].g,Sky.color_top[3].b),this.sky.material.uniforms.bottom_color.value.setRGB(Sky.color_bottom[3].r,
Sky.color_bottom[3].g,Sky.color_bottom[3].b));.2>c?this.sun.color.setHex(Sky.moon_color):.3>c?(h=10*(c-.2),.5>h?(this.sun.intensity=.3*(2-2*h),this.sun.color.setHex(Sky.moon_color)):(this.sun.intensity=.6*h,this.sun.color.setHex(Sky.sun_color))):.7>c?this.sun.color.setHex(Sky.sun_color):.8>c?(h=10*(c-.7),.5>h?(this.sun.intensity=.3*(2-2*h),this.sun.color.setHex(Sky.sun_color)):(this.sun.intensity=.6*h,this.sun.color.setHex(Sky.moon_color))):this.sun.color.setHex(Sky.moon_color);h=MathUtils.pi2*c-
MathUtils.pid2;.25<c&&.75>c?(this.sun.position.x=this.sun_distance*Math.cos(h),this.sun.position.y=this.sun_distance*Math.sin(h)):(this.sun.position.x=this.sun_distance*Math.cos(h+Math.PI),this.sun.position.y=this.sun_distance*Math.sin(h+Math.PI))};
Sky.prototype.toJSON=function(c){c=THREE.Object3D.prototype.toJSON.call(this,c);c.object.auto_update=this.auto_update;c.object.sun_distance=this.sun_distance;c.object.day_time=this.day_time;c.object.time=this.time;c.object.sun={};c.object.sun.shadow=this.sun.shadow.toJSON();return c};
function PerspectiveCamera(c,h,n,f){void 0===n&&(n=.1);void 0===f&&(f=1E5);THREE.PerspectiveCamera.call(this,c,h,n,f);this.name="camera";this.offset=new THREE.Vector2(0,0);this.viewport=new THREE.Vector2(1,1);this.clear_depth=this.clear_color=!1;this.listener=new THREE.AudioListener;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new CameraComponent)}
PerspectiveCamera.prototype=Object.create(THREE.PerspectiveCamera.prototype);PerspectiveCamera.prototype.initialize=function(){for(var c=0;c<this.children.length;c++)this.children[c].initialize()};PerspectiveCamera.prototype.destroy=function(){var c=ObjectUtils.getScene(this);null!==c&&c.removeCamera(this);THREE.Object3D.prototype.destroy.call(this)};
PerspectiveCamera.prototype.updateMatrixWorld=function(c){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===c)null!==this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld=this.matrix,this.matrixWorldNeedsUpdate=!1,c=!0;for(var h=this.children,n=0;n<this.children.length;n++)h[n].updateMatrixWorld(c)};
PerspectiveCamera.prototype.updateProjectionMatrix=function(){var c=this.near*Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom,h=2*c,n=this.aspect*h*(void 0!==this.viewport?this.viewport.x/this.viewport.y:1),f=-.5*n;0!==this.filmOffset&&(f+=this.near*this.filmOffset/this.getFilmWidth());this.projectionMatrix.makeFrustum(f,f+n,c-h,c,this.near,this.far)};
PerspectiveCamera.prototype.toJSON=function(c){c=THREE.PerspectiveCamera.prototype.toJSON.call(this,c);c.object.clear_color=this.clear_color;c.object.clear_depth=this.clear_depth;c.object.viewport=this.viewport.toArray();c.object.offset=this.offset.toArray();return c};
function OrthographicCamera(c,h,n,f,q){void 0===f&&(f=0);void 0===q&&(q=1E5);THREE.OrthographicCamera.call(this,-1,1,1,-1,f,q);this.name="camera";this.size=void 0!==c?c:1;this.aspect=void 0!==h?h:1;this.mode=void 0!==n?n:OrthographicCamera.FIXED_VERTICAL;this.offset=new THREE.Vector2(0,0);this.viewport=new THREE.Vector2(1,1);this.clear_depth=this.clear_color=!1;this.updateProjectionMatrix();this.listener=new THREE.AudioListener;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);
this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new CameraComponent)}OrthographicCamera.prototype=Object.create(THREE.OrthographicCamera.prototype);OrthographicCamera.FIXED_VERTICAL=0;OrthographicCamera.FIXED_HORIZONTAL=1;OrthographicCamera.prototype.initialize=function(){for(var c=0;c<this.children.length;c++)this.children[c].initialize()};OrthographicCamera.prototype.destroy=function(){var c=ObjectUtils.getScene(this);null!==c&&c.removeCamera(this);THREE.Object3D.prototype.destroy.call(this)};
OrthographicCamera.prototype.updateProjectionMatrix=function(){this.mode===OrthographicCamera.FIXED_VERTICAL?(this.top=this.size/2,this.bottom=-this.top,this.right=this.viewport.x/this.viewport.y*this.aspect*this.top,this.left=-this.right):this.mode===OrthographicCamera.FIXED_HORIZONTAL&&(this.right=this.size/2,this.left=-this.right,this.top=this.right/this.aspect*(this.viewport.x/this.viewport.y),this.bottom=-this.top);THREE.OrthographicCamera.prototype.updateProjectionMatrix.call(this)};
OrthographicCamera.prototype.toJSON=function(c){c=THREE.OrthographicCamera.prototype.toJSON.call(this,c);c.object.size=this.size;c.object.aspect=this.aspect;c.object.mode=this.mode;c.object.clear_color=this.clear_color;c.object.clear_depth=this.clear_depth;c.object.viewport=this.viewport.toArray();c.object.offset=this.offset.toArray();return c};
function AudioEmitter(c){THREE.Audio.call(this,AudioEmitter.listener);this.name="audio";this.type="Audio";this.audio=void 0!==c?c:Editor.default_audio;this.autoplay=!0;this.playbackRate=1;this.startTime=0;this.source.loop=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new AudioComponent)}AudioEmitter.listener=new THREE.AudioListener;AudioEmitter.prototype=Object.create(THREE.Audio.prototype);
AudioEmitter.prototype.initialize=function(){var c=this;null!==this.audio&&THREE.AudioContext.decodeAudioData(this.audio.data,n=>{c.setBuffer(n)});for(var h=0;h<this.children.length;h++)this.children[h].initialize()};AudioEmitter.prototype.dispose=function(){this.isPlaying&&(this.stop(),this.disconnect());for(var c=0;c<this.children.length;c++)this.children[c].dispose()};
AudioEmitter.prototype.toJSON=function(c){var h=this.audio;c=THREE.Object3D.prototype.toJSON.call(this,c,(n,f)=>{h=h.toJSON(n)});c.object.audio=h.uuid;c.object.autoplay=this.autoplay;c.object.startTime=this.startTime;c.object.playbackRate=this.playbackRate;c.object.source={};c.object.source.loop=this.source.loop;return c};
function Script(c){THREE.Object3D.call(this);this.type="Script";this.name="script";this.func=this.scene=this.program=null;this.setCode(void 0!==c?c:"// This block of code is executed one\nthis.initialize = function() {\n\n}\n\n// This block of code is executed once per frame\nthis.update = function() {\n\n}\n\nthis.onMouseOver = function(object) {\n\n}");this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ScriptComponent)}
Script.prototype=Object.create(THREE.Object3D.prototype);Script.prototype.initialize=function(){for(var c=this;null!==c.parent;)c=c.parent,c instanceof Scene?this.scene=c:c instanceof Program&&(this.program=c);void 0!==this.script.initialize&&this.script.initialize.call(this);for(c=0;c<this.children.length;c++)this.children[c].initialize()};
Script.prototype.update=function(){if(void 0!==this.script.onMouseOver){var c=this.scene.raycaster.intersectObjects(this.children,!0);0<c.length&&this.script.onMouseOver.call(this,c)}void 0!==this.script.update&&this.script.update.call(this);for(c=0;c<this.children.length;c++)this.children[c].update()};Script.prototype.setCode=function(c){try{this.code=c,this.script=new (new Function(this.code))}catch(h){this.script=new function(){}}};
Script.prototype.toJSON=function(c){c=THREE.Object3D.prototype.toJSON.call(this,c);c.object.code=this.code;return c};
function BlockScript(c,h,n){THREE.Object3D.call(this);this.type="BlockScript";this.name="blocks";this.obj_uuid=void 0!==h?h:this.uuid;this.blocks_type=void 0!==n?n:"scene";this.nodes={config:{blocks:"Blocks",type:this.blocks_type,uuid:this.obj_uuid},extra:{},groups:{},last_link_id:0,last_node_id:0,links:[],nodes:[{flags:{},id:1,mode:0,order:0,outputs:[Object.assign({},{name:"",type:-1,links:null},NodesHelper.slots.output.passer),Object.assign({},{name:"",type:-1,links:null},NodesHelper.slots.output.event)],
pos:[100,352],properties:{},size:[120,26],type:"Events/BeginPlay"},{flags:{},id:2,inputs:[],mode:0,order:1,outputs:[Object.assign({},{name:"",type:-1,links:null},NodesHelper.slots.output.passer)],pos:[100,429],properties:{},size:[120,26],type:"Events/EventTick"}],version:.4};void 0!==c&&(this.nodes=c);this.graph=null;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent)}BlockScript.prototype=Object.create(THREE.Object3D.prototype);
BlockScript.prototype.initialize=function(){var c=this;this.graph=new LGraph(this.nodes);this.graph.config.scene=ObjectUtils.getScene(this);if("scene"===this.graph.config.type)this.graph.config.self=this;else if("class"===this.graph.config.type){var h=void 0!==Editor.program_running&&null!==Editor.program_running?Editor.program_running.scene:Main.program.scene;this.graph.config.scene=h;h.traverse(n=>{void 0!==n.obj_uuid&&n.obj_uuid===c.uuid&&(c.graph.config.self=n)})}setTimeout(()=>{c.graph.start()},
100);for(h=0;h<this.children.length;h++)this.children[h].initialize()};BlockScript.prototype.update=function(){for(var c=0;c<this.children.length;c++)this.children[c].update()};BlockScript.prototype.dispose=function(){null!==this.graph&&(this.graph.sendEventToAllNodes("onDispose"),this.graph.stop(),this.nodes.extra={});for(var c=0;c<this.children.length;c++)this.children[c].dispose()};BlockScript.prototype.updateNodes=function(c){this.nodes=c};
BlockScript.prototype.toJSON=function(c){c=THREE.Object3D.prototype.toJSON.call(this,c);delete this.nodes.config.self;delete this.nodes.config.scene;c.object.nodes=this.nodes;return c};
function PhysicsObject(){THREE.Object3D.call(this);this.name="physics";this.type="Physics";this.body=new CANNON.Body;this.body.type=CANNON.Body.DYNAMIC;this.body.mass=1;this.world=null;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new PhysicsComponent)}PhysicsObject.prototype=Object.create(THREE.Object3D.prototype);
PhysicsObject.prototype.initialize=function(){this.body.position.copy(this.position);this.body.quaternion.copy(this.quaternion);for(var c=this;null!==c.parent;)c=c.parent,c instanceof Scene&&(this.world=c.world,this.world.addBody(this.body));for(c=0;c<this.children.length;c++)this.children[c].initialize()};PhysicsObject.prototype.update=function(){this.position.copy(this.body.position);this.body.fixedRotation||this.quaternion.copy(this.body.quaternion);for(var c=0;c<this.children.length;c++)this.children[c].update()};
PhysicsObject.prototype.addShape=function(c){c instanceof CANNON.Shape&&this.body.addShape(c)};
PhysicsObject.prototype.toJSON=function(c){c=THREE.Object3D.prototype.toJSON.call(this,c);c.object.body={};c.object.body.type=this.body.type;c.object.body.mass=this.body.mass;c.object.body.linearDamping=this.body.linearDamping;c.object.body.angularDamping=this.body.angularDamping;c.object.body.allowSleep=this.body.allowSleep;c.object.body.sleepSpeedLimit=this.body.sleepSpeedLimit;c.object.body.sleepTimeLimit=this.body.sleepTimeLimit;c.object.body.collisionFilterGroup=this.body.collisionFilterGroup;
c.object.body.collisionFilterMask=this.body.collisionFilterMask;c.object.body.fixedRotation=this.body.fixedRotation;c.object.body.shapes=[];for(var h=this.body.shapes,n=0;n<h.length;n++){var f=h[n],q={};q.type=f.type;f.type===CANNON.Shape.types.SPHERE?q.radius=f.radius:f.type===CANNON.Shape.types.BOX?(q.halfExtents={},q.halfExtents.x=f.halfExtents.x,q.halfExtents.y=f.halfExtents.y,q.halfExtents.z=f.halfExtents.z):f.type===CANNON.Shape.types.CONVEXPOLYHEDRON&&(q.vertices=f.vertices,q.faces=f.faces);
c.object.body.shapes[n]=q}return c};
function SpineAnimation(c,h,n,f){if(void 0!==f)var q=new spine.TextureAtlas(h,l=>{for(var k=0;k<f.length;k++)if(f[k].name===l)return l=new SpineTexture(f[k].texture),k=l.texture.image,k.width=1024,k.height=1024,l});else f=[],q=new spine.TextureAtlas(h,l=>{var k=new SpineTexture(new Texture(new PHANTANIZER.Image(n+"/"+l))),u=new k.texture.image;u.width=1024;u.height=1024;f.push({name:l,texture:k.texture});return k});q=new spine.TextureAtlasAttachmentLoader(q);q=(new spine.SkeletonJson(q)).readSkeletonData(c);THREE.Mesh.call(this);
this.zOffset=.1;this.skeleton=new spine.Skeleton(q);q=new spine.AnimationStateData(q);this.state=new spine.AnimationState(q);this.batcher=new spine.threejs.MeshBatcher(this);q=new THREE.MeshBasicMaterial;q.side=THREE.DoubleSide;q.transparent=!0;q.name="spine";q.alphaTest=.5;this.material=q;this.json=c;this.atlas=h;this.textures=f;this.name="spine";this.type="SpineAnimation";this.scale.set(.005,.005,.005);this.frustumCulled=!1;this.castShadow=this.receiveShadow=!0;this.clock=new THREE.Clock;this.components=
[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}SpineAnimation.prototype=Object.create(THREE.Mesh.prototype);SpineAnimation.QUAD_TRIANGLES=[0,1,2,2,3,0];SpineAnimation.prototype.update=function(){var c=this.state,h=this.skeleton;c.update(this.clock.getDelta());c.apply(h);h.updateWorldTransform();this.updateGeometry();for(c=0;c<this.children.length;c++)this.children[c].update()};SpineAnimation.prototype.getAnimations=function(){return this.state.data.skeletonData.animations};
SpineAnimation.prototype.setAnimation=function(c,h){try{this.state.setAnimation(c,h,!0)}catch(n){}};SpineAnimation.prototype.getSkins=function(){return this.state.data.skeletonData.skins};
SpineAnimation.prototype.updateGeometry=function(){var c=this.skeleton.drawOrder,h=0,n=this.zOffset,f=this.batcher;f.begin();for(var q=0,l=c.length;q<l;q++){var k=c[q];var u=k.getAttachment();if(u instanceof spine.RegionAttachment){var r=u;k=r.updateWorldVertices(k,!1);u=SpineAnimation.QUAD_TRIANGLES;r=r.region.renderObject.texture}else if(u instanceof spine.MeshAttachment)r=u,k=r.updateWorldVertices(k,!1),u=r.triangles,r=r.region.renderObject.texture;else continue;if(null!==r){if(!this.material.map){var z=
this.material;z.map=r.texture;z.needsUpdate=!0}f.batch(k,u,h);h+=n}}f.end()};SpineAnimation.prototype.toJSON=function(c){var h=this.geometry,n=this.material;this.material=this.geometry=void 0;var f=[],q=this;c=THREE.Object3D.prototype.toJSON.call(this,c,(l,k)=>{for(k=0;k<q.textures.length;k++){var u=q.textures[k].texture.toJSON(l);f.push({name:q.textures[k].name,texture:u.uuid})}});c.object.json=this.json;c.object.atlas=this.atlas;c.object.textures=f;this.geometry=h;this.material=n;return c};
function SpineTexture(c){spine.Texture.call(this,c.image);this.texture=c;this.texture.flipY=!1}SpineTexture.prototype=Object.create(spine.Texture.prototype);SpineTexture.prototype.setFilters=function(c,h){this.texture.minFilter=SpineTexture.getTextureFilter(c);this.texture.magFilter=SpineTexture.getTextureFilter(h)};SpineTexture.prototype.setWraps=function(c,h){this.texture.wrapS=SpineTexture.getTextureWrap(c);this.texture.wrapT=SpineTexture.getTextureWrap(h)};SpineTexture.prototype.dispose=function(){this.texture.dispose()};
SpineTexture.getTextureFilter=function(c){return c===spine.TextureFilter.Linear?THREE.LinearFilter:c===spine.TextureFilter.MipMap||c===spine.TextureFilter.MipMapLinearLinear?THREE.LinearMipMapLinearFilter:c===spine.TextureFilter.MipMapLinearNearest?THREE.LinearMipMapNearestFilter:c===spine.TextureFilter.MipMapNearestNearest?THREE.NearestMipMapNearestFilter:c===spine.TextureFilter.Nearest?THREE.NearestFilter:null};
SpineTexture.getTextureWrap=function(c){if(c===spine.TextureWrap.ClampToEdge)return THREE.ClampToEdgeWrapping;if(c===spine.TextureWrap.MirroredRepeat)return THREE.MirroredRepeatWrapping;if(c===spine.TextureWrap.Repeat)return THREE.RepeatWrapping};function Bone(){THREE.Bone.call(this);this.name="bone";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Bone.prototype=Object.create(THREE.Bone.prototype);
function Empty(){THREE.Object3D.call(this);this.name="empty";this.type="Group";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Empty.prototype=Object.create(THREE.Object3D.prototype);
function ParticleEmitter(c,h){THREE.Object3D.call(this);this.type="ParticleEmiter";this.name="particle";this.nodes={config:{},groups:[],last_link_id:0,last_node_id:1,links:[],nodes:[{flags:{},id:1,mode:0,order:0,outputs:[],pos:[130,130],properties:{},extra:{},size:[210,234],type:"Particles/Particles"}],version:.4};this.clock=new THREE.Clock;this.group=void 0!==c?new SPE.Group(c):new SPE.Group({texture:{value:new Texture(new PHANTANIZER.Image("Engine/Data/particle.png"))},maxParticleCount:2E3,blending:THREE.AdditiveBlending,
hasPerspective:!0});this.group.mesh.frustumCulled=!1;this.emitter=void 0!==h?new SPE.Emitter(h):new SPE.Emitter({particleCount:2E3,type:SPE.distributions.BOX,maxAge:{value:2,spread:0},velocity:{value:new THREE.Vector3(0,25,0),spread:new THREE.Vector3(10,7.5,10)},acceleration:{value:new THREE.Vector3(0,-10,0),spread:new THREE.Vector3(10,0,10)},color:{value:[new THREE.Color(1,1,1)],spread:[new THREE.Vector3(0,0,0)]}});this.group.addEmitter(this.emitter);this.components=[];this.defaultComponents=[];
this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}ParticleEmitter.prototype=Object.create(THREE.Object3D.prototype);ParticleEmitter.prototype.initialize=function(){for(var c=0;c<this.children.length;c++)this.children[c].initialize();this.clock.getDelta();this.add(this.group.mesh)};ParticleEmitter.prototype.update=function(){this.group.tick(this.clock.getDelta());for(var c=0;c<this.children.length;c++)this.children[c].update()};
ParticleEmitter.prototype.updateNodes=function(c){this.nodes=c};ParticleEmitter.prototype.dispose=function(){for(var c=0;c<this.children.length;c++)this.children[c].dispose()};
ParticleEmitter.prototype.toJSON=function(c){var h=this.group.texture;c=THREE.Object3D.prototype.toJSON.call(this,c,function(n,f){h=h.toJSON(n)});c.object.group={};c.object.group.texture={};c.object.group.texture.value=h.uuid;c.object.group.textureFrames=this.group.textureFrames;c.object.group.textureFrameCount=this.group.textureFrameCount;c.object.group.textureLoop=this.group.textureLoop;c.object.group.hasPerspective=this.group.hasPerspective;c.object.group.colorize=this.group.colorize;c.object.group.maxParticleCount=
this.group.maxParticleCount;c.object.group.blending=this.group.blending;c.object.group.scale=this.group.scale;c.object.group.depthWrite=this.group.depthWrite;c.object.group.depthTest=this.group.depthTest;c.object.group.fog=this.group.fog;c.object.emitter={};c.object.emitter.uuid=this.emitter.uuid;c.object.emitter.direction=this.emitter.direction;c.object.emitter.particleCount=this.emitter.particleCount;c.object.emitter.duration=this.emitter.duration;c.object.emitter.type=this.emitter.type;c.object.emitter.maxAge=
{};c.object.emitter.maxAge.value=this.emitter.maxAge.value;c.object.emitter.maxAge.spread=this.emitter.maxAge.spread;c.object.emitter.position={};c.object.emitter.position.value=this.emitter.position.value;c.object.emitter.position.spread=this.emitter.position.spread;c.object.emitter.velocity={};c.object.emitter.velocity.value=this.emitter.velocity.value;c.object.emitter.velocity.spread=this.emitter.velocity.spread;c.object.emitter.acceleration={};c.object.emitter.acceleration.value=this.emitter.acceleration.value;
c.object.emitter.acceleration.spread=this.emitter.acceleration.spread;c.object.emitter.wiggle={};c.object.emitter.wiggle.value=this.emitter.wiggle.value;c.object.emitter.wiggle.spread=this.emitter.wiggle.spread;c.object.emitter.opacity={};c.object.emitter.opacity.value=this.emitter.opacity.value;c.object.emitter.opacity.spread=this.emitter.opacity.spread;c.object.emitter.size={};c.object.emitter.size.value=this.emitter.size.value;c.object.emitter.size.spread=this.emitter.size.spread;c.object.emitter.angle=
{};c.object.emitter.angle.value=this.emitter.angle.value;c.object.emitter.angle.spread=this.emitter.angle.spread;c.object.emitter.color={};c.object.emitter.color.value=this.emitter.color.value;c.object.emitter.color.spread=this.emitter.color.spread;c.object.nodes=this.nodes;return c};
function Program(c){THREE.Object3D.call(this);this.type="Program";this.matrixAutoUpdate=!1;this.name=void 0!==c?c:"program";this.author=this.description="";this.version="0";this.vr=this.lock_pointer=!1;this.vr_scale=1;this.antialiasing=!1;this.shadows=!0;this.shadows_type=THREE.PCFSoftShadowMap;this.images=[];this.videos=[];this.audio=[];this.fonts=[];this.materials=[];this.textures=[];this.geometries=[];this.asset_objects=[];this.renderer=this.scene=this.default_camera=this.default_scene=null;this.components=
[];this.defaultComponents=[];this.defaultComponents.push(new ProgramComponent)}Program.prototype=Object.create(THREE.Object3D.prototype);Program.prototype.initialize=function(){if(null!==this.default_scene)for(var c=0;c<this.children.length;c++){if(this.children[c].uuid===this.default_scene){this.setScene(this.children[c]);break}}else 0<this.children.length&&this.setScene(this.children[0]);Mouse.setLock(this.lock_pointer)};Program.prototype.update=function(){this.scene.update()};
Program.prototype.render=function(c){var h=c.domElement.width,n=c.domElement.height;c.setScissorTest(!0);for(var f=0;f<this.scene.cameras.length;f++){var q=this.scene.cameras[f];q.clear_color&&c.clearColor();q.clear_depth&&c.clearDepth();c.setViewport(h*q.offset.x,n*q.offset.y,h*q.viewport.x,n*q.viewport.y);c.setScissor(h*q.offset.x,n*q.offset.y,h*q.viewport.x,n*q.viewport.y);c.render(this.scene,q)}c.setScissorTest(!1)};
Program.prototype.resize=function(c,h){for(var n=0;n<this.scene.cameras.length;n++)this.scene.cameras[n].aspect=c/h,this.scene.cameras[n].updateProjectionMatrix()};Program.prototype.getMaterialByName=function(c){for(var h in this.materials.length)if(this.materials[h].name===c)return this.materials[h];return null};Program.prototype.addMaterial=function(c){c instanceof THREE.Material&&(this.materials[c.uuid]=c)};
Program.prototype.removeMaterial=function(c,h,n){c instanceof THREE.Material&&(delete this.materials[c.uuid],this.traverse(function(f){void 0!==f.material&&f.material.uuid===c.uuid&&(f.material=f instanceof THREE.Sprite?n:h)}))};Program.prototype.addTexture=function(c){this.textures[c.uuid]=c};Program.prototype.getTextureByName=function(c){for(var h in this.textures.length)if(this.textures[h].name===c)return this.textures[h];return null};
Program.prototype.addObject=function(c){this.asset_objects[c.uuid]=c};Program.prototype.getAssetObjectByname=function(c){for(var h in this.asset_objects.length)if(this.asset_objects[h].name===c)return this.asset_objects[h];return null};Program.prototype.removeObject=function(c){c instanceof THREE.Object3D&&delete this.asset_objects[c.uuid]};
Program.prototype.setScene=function(c){c instanceof Scene?this.scene=c:"string"===typeof c&&(this.scene=this.getObjectByName(c));null!==this.scene&&(this.scene.initialize(),0===this.scene.cameras.length&&this.scene.cameras.push(this.default_camera))};Program.prototype.remove=function(c){var h=this.children.indexOf(c);-1<h&&(this.children.splice(h,1),c.parent=null);0===this.children.length&&(this.scene=null)};
Program.prototype.add=function(c){c instanceof Scene&&(this.children.push(c),c.parent=this,1===this.children.length&&(this.scene=this.children[0]))};Program.prototype.clone=function(){return(new ObjectLoader).parse(this.toJSON())};Program.prototype.setInitialScene=function(c){this.default_scene=c.uuid};
Program.prototype.addDefaultScene=function(c){void 0===c&&(c=new MeshStandardMaterial({roughness:.6,metalness:.2}),c.name="default");var h=new Scene,n=new Sky;n.auto_update=!1;h.add(n);n=new THREE.BoxBufferGeometry(1,1,1);var f=new Mesh(n,c);f.scale.set(4,4,4);f.position.set(0,1.5,0);f.receiveShadow=!0;f.castShadow=!0;f.name="box";h.add(f);f=new Mesh(n,c);f.scale.set(40,2,40);f.position.set(0,-1.5,0);f.receiveShadow=!0;f.castShadow=!0;f.name="ground";h.add(f);this.add(h)};
Program.prototype.dispose=function(){for(var c=0;c<this.materials.length;c++)this.materials[c].dispose();for(c=0;c<this.textures.length;c++)this.textures[c].dispose();for(c=0;c<this.children.length;c++)this.children[c].dispose()};
Program.prototype.toJSON=function(c){var h=this;c=THREE.Object3D.prototype.toJSON.call(this,c,function(n,f){f=h.materials;for(var q in f){var l=f[q];void 0===n.materials[l.uuid]&&(n.materials[l.uuid]=l.toJSON(n))}l=h.asset_objects;for(q in l)f=l[q],void 0===n.asset_objects[f.uuid]&&(n.asset_objects[f.uuid]=f.toJSON(n))});c.object.author=this.author;c.object.description=this.description;c.object.version=this.version;c.object.lock_pointer=this.lock_pointer;c.object.vr=this.vr;c.object.vr_scale=this.vr_scale;
null!==this.default_scene&&(c.object.default_scene=this.default_scene);return c};
function Scene(){THREE.Scene.call(this);this.name="scene";this.matrixAutoUpdate=!1;this.world=new CANNON.World;this.world.defaultContactMaterial.contactEquationStiffness=1E9;this.world.defaultContactMaterial.contactEquationRelaxation=4;this.world.quatNormalizeSkip=0;this.world.quatNormalizeFast=!1;this.world.gravity.set(0,-9.8,0);this.world.broadphase=new CANNON.NaiveBroadphase;this.world.solver=new CANNON.SplitSolver(new CANNON.GSSolver);this.world.solver.tolerance=.1;this.world.solver.iterations=
7;this.clock=new THREE.Clock;this.raycaster=new THREE.Raycaster;this.cameras=[];this.components=[];this.defaultComponents=[];this.defaultComponents.push(new SceneComponent)}Scene.prototype=Object.create(THREE.Scene.prototype);Scene.prototype.initialize=function(){for(var c=0;c<this.children.length;c++)this.children[c].initialize();this.canvas=this.parent.renderer.domElement};
Scene.prototype.update=function(){var c=new Vector2(Mouse.position.x/this.canvas.width*2-1,-2*Mouse.position.y/this.canvas.height+1);0<this.cameras.length&&this.raycaster.setFromCamera(c,this.cameras[0]);this.world.step(this.clock.getDelta());for(c=0;c<this.children.length;c++)this.children[c].update()};Scene.prototype.getCamera=function(c,h){void 0===h&&(h=this);if(c===h.uuid)return h;h=h.children;for(var n=0;n<h.length;n++){var f=this.getCamera(c,h[n]);if(null!==f)return f}return null};
Scene.prototype.addCamera=function(c){this.cameras.push(c)};Scene.prototype.removeCamera=function(c){c=this.cameras.indexOf(c);-1<c&&this.cameras.splice(c,1)};Scene.prototype.setFogMode=function(c){var h=null!==this.fog?this.fog.color.getHex():"#FFFFFF";c===THREE.Fog.LINEAR?this.fog=new THREE.Fog(h,5,20):c===THREE.Fog.EXPONENTIAL?this.fog=new THREE.FogExp2(h,.01):c===THREE.Fog.NONE&&(this.fog=null)};
Scene.prototype.toJSON=function(c){c=THREE.Scene.prototype.toJSON.call(this,c);null!==this.background&&(c.object.background=this.background);c.object.cameras=[];for(var h=0;h<this.cameras.length;h++)c.object.cameras.push(this.cameras[h].uuid);c.object.world={};c.object.world.gravity=this.world.gravity;c.object.world.quatNormalizeSkip=this.world.quatNormalizeSkip;c.object.world.quatNormalizeFast=this.world.quatNormalizeFast;c.object.world.solver={};c.object.world.solver.tolerance=this.world.solver.tolerance;
c.object.world.solver.iterations=this.world.solver.iterations;return c};function ObjectCaller(c,h){THREE.Object3D.call(this);this.name="caller";this.type="ObjectCaller";this.obj=null;this.obj_uuid=void 0===c?null:c;this.obj_type=void 0===h?null:h;this.program=null;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}ObjectCaller.prototype=Object.create(THREE.Object3D.prototype);
ObjectCaller.prototype.initialize=function(){this.program=void 0!==Editor.program_running&&null!==Editor.program_running?Editor.program_running:Main.program;null!==this.obj_uuid&&void 0!==this.program.asset_objects[this.obj_uuid]&&(this.obj=this.program.asset_objects[this.obj_uuid],this.obj.initialize());for(var c=0;c<this.children.length;c++)this.children[c].initialize()};ObjectCaller.prototype.update=function(){if(null!==this.obj){this.obj.update();for(var c=0;c<this.children.length;c++)this.children[c].update()}};
ObjectCaller.prototype.dispose=function(){if(null!==this.obj){this.obj.dispose();for(var c=0;c<this.children.length;c++)this.children[c].dispose()}};ObjectCaller.prototype.setObject=function(c){this.obj_uuid=c.uuid;this.name=c.name;this.obj_type=c.type};ObjectCaller.prototype.toJSON=function(c){c=THREE.Object3D.prototype.toJSON.call(this,c);c.object.obj_uuid=this.obj_uuid;c.object.obj_type=this.obj_type;return c};function Base64Utils(){}
Base64Utils.fromArrayBuffer=function(c){var h="";c=new Uint8Array(c);for(var n=c.byteLength%3,f=c.byteLength-n,q,l,k,u,r=0;r<f;r+=3)u=c[r]<<16|c[r+1]<<8|c[r+2],q=(u&16515072)>>18,l=(u&258048)>>12,k=(u&4032)>>6,u&=63,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[q]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[u];1===
n?(u=c[f],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(u&252)>>2]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(u&3)<<4]+"=="):2===n&&(u=c[f]<<8|c[f+1],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(u&64512)>>10]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(u&1008)>>4]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(u&15)<<2]+"=");return h};
Base64Utils.fromBinaryString=function(c){var h="",n=c.length%3,f=c.length-n,q;for(q=0;q<f;q+=3){var l=c.charCodeAt(q)&255;var k=c.charCodeAt(q+1);var u=c.charCodeAt(q+2);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>2);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((l&3)<<4|(k&240)>>4);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((k&15)<<2|(u&192)>>6);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(u&
63)}1===n?(l=c.charCodeAt(q)&255,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>2),h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((l&3)<<4),h+="=="):2===n&&(l=c.charCodeAt(q)&255,k=c.charCodeAt(q+1),h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>2),h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((l&3)<<4)|(k&&240)>>4,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((k&
15)<<2),h+="==");return h};function ArraybufferUtils(){}ArraybufferUtils.fromBinaryString=function(c){for(var h=c.length,n=new ArrayBuffer(h),f=new Uint8Array(n),q=0;q<h;q++)f[q]=c.charCodeAt();return n};
ArraybufferUtils.fromBase64=function(c){for(var h=c.length/4*3,n=new ArrayBuffer(h),f=new Uint8Array(n),q,l,k,u,r=0,z=0;r<h;r+=3)q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(c.charAt(z++)),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(c.charAt(z++)),k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(c.charAt(z++)),u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(c.charAt(z++)),f[r]=
q<<2|l>>4,64!==k&&(f[r+1]=(l&15)<<4|k>>2),64!==u&&(f[r+2]=(k&3)<<6|u);return n};function MathUtils(){}MathUtils.pi2=2*Math.PI;MathUtils.pid2=Math.PI/2;function ObjectUtils(){}
ObjectUtils.getMaterials=function(c,h){function n(u){void 0===h[u.uuid]&&(h[u.uuid]=u)}void 0===h&&(h=[]);for(var f=0;f<c.children.length;f++){var q=c.children[f];if(!(q.hidden||void 0===q.material||q instanceof Sky||q instanceof SpineAnimation))if(q.material instanceof THREE.Material)n(q.material);else if(q.material instanceof THREE.MultiMaterial)for(var l=q.material.materials,k=0;k<l.length;k++)n(l[k]);ObjectUtils.getMaterials(q,h)}return h};
ObjectUtils.getTextures=function(c,h){function n(k){null!==k&&void 0!==k&&void 0===h[k.uuid]&&(h[k.uuid]=k)}void 0===h&&(h=[]);for(var f=0;f<c.children.length;f++){var q=c.children[f];if(void 0!==q.material){var l=q.material;n(l.map);n(l.bumpMap);n(l.normalMap);n(l.displacementMap);n(l.specularMap);n(l.emissiveMap);n(l.alphaMap);n(l.roughnessMap);n(l.metalnessMap)}else q instanceof ParticleEmitter&&n(q.group.texture);ObjectUtils.getTextures(q,h)}return h};
ObjectUtils.getScene=function(c){for(;null!==c.parent;)if(c=c.parent,c instanceof Scene)return c;return null};ObjectUtils.getRoot=function(c){for(;null!==c.parent;)c=c.parent;return c};ObjectUtils.setMatrixAutoUpdate=function(c,h){c.traverse(n=>{n.matrixAutoUpdate=h})};ObjectUtils.setShadowReceiving=function(c,h){c.traverse(n=>{n.receiveShadow=h})};ObjectUtils.setShadowCasting=function(c,h){c.traverse(n=>{n.castShadow=h})};
ObjectUtils.isChildOf=function(c,h){for(var n=0;n<c.children.length;n++)if(c.children[n]===h||ObjectUtils.isChildOf(c.children[n],h))return!0;return!1};var PI2=Math.PI/2;function Mesh2shape(){}Mesh2shape.Type={BOX:"Box",CYLINDER:"Cylinder",SPHERE:"Sphere",HULL:"ConvexPolyhedron"};
Mesh2shape.createShape=function(c,h){if(void 0!==h){if(h===Mesh2shape.Type.BOX)return Mesh2shape.createBoundingBoxShape(c);if(h===Mesh2shape.Type.CYLINDER)return Mesh2shape.createBoundingCylinderShape(c,options);if(h===Mesh2shape.Type.SPHERE)return Mesh2shape.createBoundingSphereShape(c,options);if(h===Mesh2shape.Type.HULL)return Mesh2shape.createConvexPolyhedron(c);console.warn("[CANNON.mesh2shape] Invalid type",h)}var n=Mesh2shape.getGeometry(c);if(!n)return null;h=n.metadata?n.metadata.type:n.type;
switch(h){case "BoxGeometry":case "BoxBufferGeometry":return Mesh2shape.createBoxShape(n);case "CylinderGeometry":case "CylinderBufferGeometry":return Mesh2shape.createCylinderShape(n);case "PlaneGeometry":case "PlaneBufferGeometry":return Mesh2shape.createPlaneShape(n);case "SphereGeometry":case "SphereBufferGeometry":return Mesh2shape.createSphereShape(n);case "TubeGeometry":return Mesh2shape.createTubeShape(n);case "Geometry":case "BufferGeometry":return Mesh2shape.createConvexPolyhedron(c);default:return console.warn("Unrecognized geometry: Using bounding box as shape.",
n.type),Mesh2shape.createBoxShape(n)}};Mesh2shape.createBoxShape=function(c){if(!Mesh2shape.getVertices(c).length)return null;c.computeBoundingBox();c=c.boundingBox;return new CANNON.Box(new CANNON.Vec3((c.max.x-c.min.x)/2,(c.max.y-c.min.y)/2,(c.max.z-c.min.z)/2))};
Mesh2shape.createBoundingBoxShape=function(c){var h=new THREE.BoundingBoxHelper(c);h.update();var n=h.box;if(!isFinite(n.min.lengthSq()))return null;n=new CANNON.Box(new CANNON.Vec3((n.max.x-n.min.x)/2,(n.max.y-n.min.y)/2,(n.max.z-n.min.z)/2));c.updateMatrixWorld();var f=new THREE.Vector3;f.setFromMatrixPosition(c.matrixWorld);c=h.position.sub(f);c.lengthSq()&&(n.offset=c);return n};
Mesh2shape.createConvexPolyhedron=function(c){var h=Mesh2shape.getGeometry(c);h instanceof THREE.BufferGeometry&&(h=(new THREE.Geometry).fromBufferGeometry(h));if(!h||!h.vertices.length)return null;for(c=0;c<h.vertices.length;c++)h.vertices[c].x+=1E-4*(Math.random()-.5),h.vertices[c].y+=1E-4*(Math.random()-.5),h.vertices[c].z+=1E-4*(Math.random()-.5);var n=(new quickhull)(h);console.log(n);h=Array(n.vertices.length);for(c=0;c<n.vertices.length;c++)h[c]=new CANNON.Vec3(n.vertices[c].x,n.vertices[c].y,
n.vertices[c].z);var f=Array(n.faces.length);for(c=0;c<n.faces.length;c++)f[c]=[n.faces[c].a,n.faces[c].b,n.faces[c].c];return new CANNON.ConvexPolyhedron(h,f)};Mesh2shape.createCylinderShape=function(c){c=c.metadata?c.metadata.parameters:c.parameters;c=new CANNON.Cylinder(c.radiusTop,c.radiusBottom,c.height,c.radialSegments);c.orientation=new CANNON.Quaternion;c.orientation.setFromEuler(THREE.Math.degToRad(-90),0,0,"XYZ").normalize();return c};
Mesh2shape.createBoundingCylinderShape=function(c,h){var n=["x","y","z"];h=h.cylinderAxis||"y";n=n.splice(n.indexOf(h),1)&&n;c=Mesh2shape.getGeometry(c);c.computeBoundingBox();c.computeBoundingSphere();n=.5*Math.max(c.boundingBox.max[n[0]]-c.boundingBox.min[n[0]],c.boundingBox.max[n[1]]-c.boundingBox.min[n[1]]);c=new CANNON.Cylinder(n,n,c.boundingBox.max[h]-c.boundingBox.min[h],12);c.orientation=new CANNON.Quaternion;c.orientation.setFromEuler("y"===h?PI2:0,"z"===h?PI2:0,0,"XYZ").normalize();return c};
Mesh2shape.createPlaneShape=function(c){c.computeBoundingBox();c=c.boundingBox;return new CANNON.Box(new CANNON.Vec3((c.max.x-c.min.x)/2||.1,(c.max.y-c.min.y)/2||.1,(c.max.z-c.min.z)/2||.1))};Mesh2shape.createSphereShape=function(c){return new CANNON.Sphere((c.metadata?c.metadata.parameters:c.parameters).radius)};Mesh2shape.createBoundingSphereShape=function(c,h){c=Mesh2shape.getGeometry(c);c.computeBoundingSphere();return new CANNON.Sphere(h.sphereRadius||c.boundingSphere.radius)};
Mesh2shape.createTubeShape=function(c){var h=new THREE.BufferGeometry;h.fromGeometry(c);return createTrimeshShape(h)};Mesh2shape.createTrimeshShape=function(c){var h=Mesh2shape.getVertices(c);if(!h.length)return null;c=Object.keys(h).map(Number);return new CANNON.Trimesh(h,c)};
Mesh2shape.getGeometry=function(c){var h=Mesh2shape.getMeshes(c);if(0===h.length)return null;var n=new THREE.Geometry;if(1===h.length){c=new THREE.Vector3;var f=new THREE.Quaternion,q=new THREE.Vector3;n=h[0].geometry.clone();n.metadata=h[0].geometry.metadata;h[0].updateMatrixWorld();h[0].matrixWorld.decompose(c,f,q);return n.scale(q.x,q.y,q.z)}for(f=new THREE.Geometry;q=h.pop();)q.updateMatrixWorld(),q.geometry instanceof THREE.BufferGeometry?(n.fromBufferGeometry(q.geometry),f.merge(n,q.matrixWorld)):
f.merge(q.geometry,q.matrixWorld);h=new THREE.Matrix4;h.scale(c.scale);f.applyMatrix(h);return f};Mesh2shape.getVertices=function(c){c.attributes||(c=(new THREE.BufferGeometry).fromGeometry(c));return c.attributes.position.array};Mesh2shape.getMeshes=function(c){var h=[];c.traverse(function(n){"Mesh"===n.type&&h.push(n)});return h};function MeshBasicMaterial(c){THREE.MeshBasicMaterial.call(this,c)}MeshBasicMaterial.prototype=Object.create(THREE.MeshBasicMaterial.prototype);
MeshBasicMaterial.prototype.toJSON=function(c){c=THREE.Material.prototype.toJSON.call(this,c);c.nodes=this.nodes;return c};function MeshLambertMaterial(c){THREE.MeshLambertMaterial.call(this,c)}MeshLambertMaterial.prototype=Object.create(THREE.MeshLambertMaterial.prototype);MeshLambertMaterial.prototype.toJSON=function(c){c=THREE.Material.prototype.toJSON.call(this,c);c.nodes=this.nodes;return c};function MeshNormalMaterial(c){THREE.MeshNormalMaterial.call(this,c)}MeshNormalMaterial.prototype=Object.create(THREE.MeshNormalMaterial.prototype);
MeshNormalMaterial.prototype.toJSON=function(c){c=THREE.Material.prototype.toJSON.call(this,c);c.nodes=this.nodes;return c};function MeshPhongMaterial(c){THREE.MeshPhongMaterial.call(this,c)}MeshPhongMaterial.prototype=Object.create(THREE.MeshPhongMaterial.prototype);MeshPhongMaterial.prototype.toJSON=function(c){c=THREE.Material.prototype.toJSON.call(this,c);c.nodes=this.nodes;return c};function MeshShaderMaterial(c){THREE.ShaderMaterial.call(this,c)}MeshShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);
MeshShaderMaterial.prototype.toJSON=function(c){c=THREE.ShaderMaterial.prototype.toJSON.call(this,c);c.nodes=this.nodes;return c};function MeshStandardMaterial(c){THREE.MeshStandardMaterial.call(this,c)}MeshStandardMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype);MeshStandardMaterial.prototype.toJSON=function(c){c=THREE.Material.prototype.toJSON.call(this,c);c.nodes=this.nodes;return c};
function Panel(c){this.parent=void 0===c?document.body:c;Panel.id++;this.element=document.createElement("div");this.element.style.position="absolute";this.element.style.overflow="auto";this.element.style.cursor="default";this.element.style.backgroundColor=Editor.theme.panel_color;this.element.ondrop=function(h){h.preventDefault()};this.element.ondragover=function(h){h.preventDefault()};this.components=[];this.children_pos=new THREE.Vector2(5,10);this.fit_parent=!0;this.size=new THREE.Vector2(0,0);
this.position=new THREE.Vector2(0,0);this.visible=!0;this.obj=null;this.parent.appendChild(this.element)}Panel.id=0;Panel.prototype.updatePanel=function(){if(null!==this.obj)for(var c=0;c<this.components.length;c++)this.components[c].updateData&&this.components[c].updateData(this.obj)};
Panel.prototype.attachObject=function(c){if(c instanceof THREE.Object3D){this.obj=c;this.updateComponents();var h=this;this.add=new Button(this.element);this.add.setText("Add Component");this.add.setCallback(n=>{var f=new ContextMenu;f.size.set(130,20);var q=App.componentManager.length;f.position.set(n.clientX-5,event.clientY-10*q);for(n=0;n<q;n++){var l=App.componentManager[n];f.addOption(l.component_name,()=>{var k=!1;h.obj.components.includes(l)&&(k=!0);k||(h.obj.components.push(l),h.obj.components[h.obj.components.length-
1].onCreate(h.obj),h.updateComponents())})}});this.add.updateInterface();this.updateInterface();this.updatePanel()}};
Panel.prototype.updateComponents=function(){if(void 0!==this.obj.components&&void 0!==this.obj.defaultComponents){this.components=this.obj.defaultComponents.concat(this.obj.components);this.children_pos.equals(new THREE.Vector2(5,10))||this.children_pos.set(5,10);for(var c=0;c<this.components.length;c++)this.element.appendChild(this.components[c].initUI(this.children_pos,this.obj)),this.children_pos.y+=10;this.updatePanel();this.updateInterface()}};Panel.prototype.destroy=function(){try{this.parent.removeChild(this.element)}catch(c){}};
Panel.prototype.update=function(){};
Panel.prototype.updateInterface=function(){this.fit_parent&&(this.size.x=this.parent.offsetWidth,this.size.y=this.parent.offsetHeight);for(var c=0;c<this.components.length;c++)this.components[c].updateInterface();this.element.style.visiblility=this.visible?"visible":"hidden";void 0!==this.add&&(this.add.size.set(this.size.x-30,20),this.add.position.copy(this.children_pos),this.add.updateInterface());this.element.style.top=this.position.y+"px";this.element.style.left=this.position.x+"px";this.element.style.width=
this.size.x+"px";this.element.style.height=this.size.y+"px"};function Component(){this.values={};this.obj=null;this.element=document.createElement("div");this.className=this.component_name="";this.widgetsPos=new THREE.Vector2}Component.prototype.clearElement=function(){if(0<this.element.children.length){var c=new Range;c.selectNodeContents(this.element);c.deleteContents()}};
Component.prototype.addDeleteButton=function(){var c=this;this.delete=new Button(this.element);this.delete.setText("Delete Component");this.delete.size.set(120,20);this.delete.position.copy(this.widgetsPos);this.delete.updateInterface();this.delete.setCallback(()=>{c.onDelete()});this.widgetsPos.y+=this.delete.size.y};
Component.prototype.addResetButton=function(){var c=this;this.reset=new Button(this.element);this.reset.setText("Reset Defaults");this.reset.size.set(100,20);this.reset.position.copy(this.widgetsPos);this.reset.updateInterface();this.reset.setCallback(()=>{c.onReset()});this.widgetsPos.y+=this.reset.size.y};Component.prototype.onDelete=function(){};Component.prototype.onReset=function(){};Component.prototype.onCreate=function(){};Component.prototype.initialize=function(){};
Component.prototype.update=function(){};Component.prototype.updateInterface=function(){this.element.style.width=this.form.size.x+"px";this.form.updateInterface()};Component.prototype.toJSON=function(){var c={};c.name=this.component_name;c.className=this.className;c.values=this.values;return c};function AudioComponent(){Component.call(this);this.component_name="Audio";this.className="AudioComponent";this.values={autoplay:!0,loop:!0,playbackRate:1}}AudioComponent.prototype=Object.create(Component.prototype);
AudioComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.autoplay=new CheckBox(this.form.element);this.autoplay.setText("Autoplay");this.autoplay.size.set(150,15);this.autoplay.setOnChange(()=>{null!==n.obj&&(n.obj.autoplay=n.autoplay.getValue())});this.form.add(this.autoplay);this.form.nextRow();this.loop=new CheckBox(this.form.element);
this.loop.setText("Loop");this.loop.size.set(150,15);this.loop.setOnChange(()=>{null!==n.obj&&(n.obj.source.loop=n.loop.getValue())});this.form.add(this.loop);this.form.nextRow();this.form.addText("Playback Speed");this.playbackRate=new NumberBox(this.form.element);this.playbackRate.size.set(60,18);this.playbackRate.setStep(.01);this.playbackRate.setRange(0,Number.MAX_SAFE_INTEGER);this.playbackRate.setOnChange(()=>{null!==n.obj&&(n.obj.playbackRate=n.playbackRate.getValue())});this.form.add(this.playbackRate);
this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton(this.onReset);return this.element};AudioComponent.prototype.updateData=function(){this.autoplay.setValue(this.obj.autoplay);this.loop.setValue(this.obj.source.loop);this.playbackRate.setValue(this.obj.playbackRate)};
AudioComponent.prototype.onReset=function(){this.obj.autoplay=this.values.autoplay;this.obj.source.loop=this.values.loop;this.obj.playbackRate=this.values.playbackRate;Editor.updateObjectViews();this.updateData()};function ElementComponent(){Component.call(this);this.component_name="Element";this.className="ElementComponent";this.values={name:"object",position:new THREE.Vector3(0,0,0),rotation:new THREE.Vector3(0,0,0),scale:new THREE.Vector3(1,1,1)}}ElementComponent.prototype=Object.create(Component.prototype);
ElementComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Name");this.name=new TextBox(this.form.element);this.name.size.set(200,18);this.name.setOnChange(()=>{null!==n.obj&&(n.obj.name=n.name.getText(),Editor.updateObjectViews())});this.form.add(this.name);this.form.nextRow();this.form.addText("UUID");this.uuid=
new TextBox(this.form.element);this.uuid.size.set(248,18);this.uuid.setDisabled(!0);this.form.add(this.uuid);this.form.nextRow();this.form.addText("Type");this.type=this.form.addText("null");this.form.nextRow();this.form.addText("Position");this.position=new CoordinatesBox(this.form.element);this.position.setOnChange(()=>{if(null!==n.obj){var f=n.position.getValue();n.obj.position.set(f.x,f.y,f.z)}});this.form.add(this.position);this.form.nextRow();this.form.addText("Rotation");this.rotation=new CoordinatesBox(this.form.element);
this.rotation.setOnChange(()=>{if(null!==n.obj){var f=n.rotation.getValue();n.obj.rotation.set(f.x,f.y,f.z)}});this.form.add(this.rotation);this.form.nextRow();this.form.addText("Scale");this.scale=new CoordinatesBox(this.form.element);this.scale.setOnChange(()=>{if(null!==n.obj){var f=n.scale.getValue();n.obj.scale.set(f.x,f.y,f.z);if(n.obj instanceof PhysicsObject)for(var q=n.obj.body.shapes,l=0;l<q.length;l++){var k=q[l];k.type===CANNON.Shape.types.BOX?(k.halfExtents.x=f.x/2,k.halfExtents.y=f.y/
2,k.halfExtents.z=f.z/2):k.type===CANNON.Shape.types.SPHERE&&(k.radius=f.x)}}});this.form.add(this.scale);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
ElementComponent.prototype.updateData=function(){this.name.setText(this.obj.name);this.uuid.setText(this.obj.uuid);this.position.setValue(this.obj.position.x,this.obj.position.y,this.obj.position.z);this.rotation.setValue(this.obj.rotation.x,this.obj.rotation.y,this.obj.rotation.z);this.scale.setValue(this.obj.scale.x,this.obj.scale.y,this.obj.scale.z);this.type.setText(this.obj.type)};
ElementComponent.prototype.onReset=function(){this.obj.position.set(this.values.position.x,this.values.position.y,this.values.position.z);this.obj.rotation.set(this.values.rotation.x,this.values.rotation.y,this.values.rotation.z);this.obj.scale.set(this.values.scale.x,this.values.scale.y,this.values.scale.z);Editor.updateObjectViews();this.updateData()};
function ObjectComponent(){Component.call(this);this.component_name="Object 3D";this.className="ObjectComponent";this.values={visible:!0,static:!1,castShadow:!0,receiveShadow:!0}}ObjectComponent.prototype=Object.create(Component.prototype);
ObjectComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.visible=new CheckBox(this.form.element);this.visible.setText("Visible");this.visible.size.set(200,15);this.visible.setOnChange(()=>{null!==n.obj&&(n.obj.visible=n.visible.getValue())});this.form.add(this.visible);this.form.nextRow();this.static=new CheckBox(this.form.element);
this.static.setText("Static Object");this.static.size.set(200,15);this.static.setOnChange(()=>{null!==n.obj&&(n.obj.matrixAutoUpdate=!n.static.getValue())});this.form.add(this.static);this.form.nextRow();this.cast_shadow=new CheckBox(this.form.element);this.cast_shadow.setText("Cast Shadow");this.cast_shadow.size.set(200,15);this.cast_shadow.setOnChange(()=>{null!==n.obj&&(n.obj.castShadow=n.cast_shadow.getValue())});this.form.add(this.cast_shadow);this.form.nextRow();this.receive_shadow=new CheckBox(this.form.element);
this.receive_shadow.setText("Receive Shadow");this.receive_shadow.size.set(200,15);this.receive_shadow.setOnChange(()=>{null!==n.obj&&(n.obj.receiveShadow=n.receive_shadow.getValue())});this.form.add(this.receive_shadow);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
ObjectComponent.prototype.updateData=function(){this.visible.setValue(this.obj.visible);this.static.setValue(!this.obj.matrixAutoUpdate);this.cast_shadow.setValue(this.obj.castShadow);this.receive_shadow.setValue(this.obj.receiveShadow)};ObjectComponent.prototype.onReset=function(){this.obj.visible=this.values.visible;this.obj.matrixAutoUpdate=!this.values.static;this.obj.castShadow=this.values.castShadow;this.obj.receiveShadow=this.values.receiveShadow;this.updateData()};
function PhysicsComponent(){Component.call(this);this.component_name="Physics";this.className="PhysicsComponent";this.values={type:1,mass:1,linearDamping:.01,angularDamping:.01,allowSleep:!0,sleepSpeedLimit:.1,sleepTimeLimit:1,fixedRotation:!1,collisionFilterGroup:1}}PhysicsComponent.prototype=Object.create(Component.prototype);
PhysicsComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Type");this.type=new DropdownList(this.form.element);this.type.size.set(100,20);this.type.addValue("Static",CANNON.Body.STATIC);this.type.addValue("Dynamic",CANNON.Body.DYNAMIC);this.type.addValue("Kinematic",CANNON.Body.KINEMATIC);this.type.setOnChange(()=>
{null!==n.obj&&(n.obj.body.type=n.type.getValue())});this.form.add(this.type);this.form.nextRow();this.form.addText("Mass");this.mass=new NumberBox(this.form.element);this.mass.size.set(80,18);this.mass.setStep(.1);this.mass.setOnChange(()=>{null!==n.obj&&(n.obj.body.mass=n.mass.getValue())});this.form.add(this.mass);this.form.nextRow();this.form.addText("Linear Damping");this.linearDamping=new NumberBox(this.form.element);this.linearDamping.size.set(80,18);this.linearDamping.setStep(.01);this.linearDamping.setRange(0,
1);this.linearDamping.setOnChange(()=>{null!==n.obj&&(n.obj.body.linearDamping=n.linearDamping.getValue())});this.form.add(this.linearDamping);this.form.nextRow();this.form.addText("Angular Damping");this.angularDamping=new NumberBox(this.form.element);this.angularDamping.size.set(80,18);this.angularDamping.setStep(.01);this.angularDamping.setRange(0,1);this.angularDamping.setOnChange(()=>{null!==n.obj&&(n.obj.body.angularDamping=n.angularDamping.getValue())});this.form.add(this.angularDamping);this.form.nextRow();
this.allowSleep=new CheckBox(this.form.element);this.allowSleep.setText("Allow Sleep");this.allowSleep.size.set(150,15);this.allowSleep.setOnChange(()=>{null!==n.obj&&(n.obj.body.allowSleep=n.allowSleep.getValue())});this.form.add(this.allowSleep);this.form.nextRow();this.form.addText("Sleep Speed Limit");this.sleepSpeedLimit=new NumberBox(this.form.element);this.sleepSpeedLimit.size.set(80,18);this.sleepSpeedLimit.setStep(.01);this.sleepSpeedLimit.setOnChange(()=>{null!==n.obj&&(n.obj.body.sleepSpeedLimit=
n.sleepSpeedLimit.getValue())});this.form.add(this.sleepSpeedLimit);this.form.nextRow();this.form.addText("Sleep Time Limit");this.sleepTimeLimit=new NumberBox(this.form.element);this.sleepTimeLimit.size.set(80,18);this.sleepTimeLimit.setStep(.01);this.sleepTimeLimit.setOnChange(()=>{null!==n.obj&&(n.obj.body.sleepTimeLimit=n.sleepTimeLimit.getValue())});this.form.add(this.sleepTimeLimit);this.form.nextRow();this.fixedRotation=new CheckBox(this.form.element);this.fixedRotation.setText("Fixed Rotation");
this.fixedRotation.size.set(150,15);this.fixedRotation.setOnChange(()=>{null!==n.obj&&(n.obj.body.fixedRotation=n.fixedRotation.getValue())});this.form.add(this.fixedRotation);this.form.nextRow();this.form.addText("Collision Group");this.collisionFilterGroup=new NumberBox(this.form.element);this.collisionFilterGroup.size.set(80,18);this.collisionFilterGroup.setStep(1);this.collisionFilterGroup.setOnChange(()=>{null!==n.obj&&(n.obj.body.collisionFilterGroup=n.collisionFilterGroup.getValue())});this.form.add(this.collisionFilterGroup);
this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
PhysicsComponent.prototype.updateData=function(){this.type.setValue(this.obj.body.type);this.mass.setValue(this.obj.body.mass);this.linearDamping.setValue(this.obj.body.linearDamping);this.angularDamping.setValue(this.obj.body.angularDamping);this.allowSleep.setValue(this.obj.body.allowSleep);this.sleepTimeLimit.setValue(this.obj.body.sleepTimeLimit);this.sleepSpeedLimit.setValue(this.obj.body.sleepSpeedLimit);this.fixedRotation.setValue(this.obj.body.fixedRotation);this.collisionFilterGroup.setValue(this.obj.body.collisionFilterGroup)};
PhysicsComponent.prototype.onReset=function(){this.obj.body.type=this.values.type;this.obj.body.mass=this.values.mass;this.obj.body.linearDamping=this.values.linearDamping;this.obj.body.angularDamping=this.values.angularDamping;this.obj.body.allowSleep=this.values.allowSleep;this.obj.body.sleepTimeLimit=this.values.sleepTimeLimit;this.obj.body.sleepSpeedLimit=this.values.sleepSpeedLimit;this.obj.body.fixedRotation=this.values.fixedRotation;this.obj.body.collisionFilterGroup=this.values.collisionFilterGroup;
Editor.updateObjectViews();this.updateData()};function ProgramComponent(){Component.call(this);this.component_name="Program";this.className="ProgramComponent";this.values={name:"program",author:"",version:"0",lock_pointer:!1,vr:!1,vr_scale:1}}ProgramComponent.prototype=Object.create(Component.prototype);
ProgramComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Name");this.name=new TextBox(this.form.element);this.name.size.set(200,18);this.name.setOnChange(()=>{null!==n.obj&&(n.obj.name=n.name.getText(),Editor.updateObjectViews())});this.form.add(this.name);
this.form.nextRow();this.form.addText("Author");this.author=new TextBox(this.form.element);this.author.position.set(50,35);this.author.size.set(200,18);this.author.updateInterface();this.author.setOnChange(()=>{null!==n.obj&&(n.obj.author=n.author.getText())});this.form.add(this.author);this.form.nextRow();this.form.addText("Version");this.version=new TextBox(this.form.element);this.version.size.set(100,18);this.version.setOnChange(()=>{null!==n.obj&&(n.obj.version=n.version.getText())});this.form.add(this.version);
this.form.nextRow();this.lock_pointer=new CheckBox(this.form.element);this.lock_pointer.setText("Lock Pointer");this.lock_pointer.size.set(50,15);this.lock_pointer.setOnChange(()=>{null!==n.obj&&(n.obj.lock_pointer=n.lock_pointer.getValue())});this.form.add(this.lock_pointer);this.form.nextRow();this.form.addText("Virtual Reality");this.form.nextRow();this.vr=new CheckBox(this.form.element);this.vr.setText("VR Enabled");this.vr.size.set(50,15);this.vr.setOnChange(()=>{null!==n.obj&&(n.obj.vr=n.vr.getValue())});
this.form.add(this.vr);this.form.nextRow();this.form.addText("VR Movement Scale");this.vr_scale=new NumberBox(this.form.element);this.vr_scale.size.set(50,18);this.vr_scale.setRange(0,1E3);this.vr_scale.setStep(.05);this.vr_scale.setOnChange(()=>{null!==n.obj&&(n.obj.vr_scale=n.vr_scale.getValue())});this.form.add(this.vr_scale);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
ProgramComponent.prototype.updateData=function(){this.name.setText(this.obj.name);this.author.setText(this.obj.author);this.version.setText(this.obj.version);this.lock_pointer.setValue(this.obj.lock_pointer);this.vr.setValue(this.obj.vr);this.vr_scale.setValue(this.obj.vr_scale)};
ProgramComponent.prototype.onReset=function(){this.obj.name=this.values.name;this.obj.author=this.values.author;this.obj.version=this.values.version;this.obj.lock_pointer=this.values.lock_pointer;this.obj.vr=this.values.vr;this.obj.vr_scale=this.values.vr_scale;Editor.updateObjectViews();this.updateData()};function SceneComponent(){Component.call(this);this.component_name="Scene";this.className="SceneComponent";this.values={name:"scene",default:!1,background:[0,0,0],fog:THREE.Fog.NONE}}
SceneComponent.prototype=Object.create(Component.prototype);
SceneComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Name");this.name=new TextBox(this.form.element);this.name.size.set(200,18);this.name.setOnChange(()=>{null!==n.obj&&(n.obj.name=n.name.getText(),Editor.updateObjectViews())});this.form.add(this.name);this.form.nextRow();this.default=new CheckBox(this.form.element);
this.default.setText("Default Scene");this.default.size.set(200,15);this.default.setOnChange(()=>{if(null!==n.obj){var f=n.obj.parent;n.default.getValue()?f.default_scene=n.obj.uuid:f.default_scene=null}});this.form.add(this.default);this.form.nextRow();this.form.addText("Background");this.background=new ColorChooser(this.form.element);this.background.size.set(80,18);this.background.setValue(0,0,0);this.background.setOnChange(()=>{null!==n.obj&&(null===n.obj.background&&(n.obj.background=new THREE.Color),
n.obj.background.setHex(n.background.getValueHex()))});this.form.add(this.background);this.form.nextRow();this.form.addText("Fog");this.fog=new DropdownList(this.form.element);this.fog.size.set(100,20);this.fog.addValue("None",THREE.Fog.NONE);this.fog.addValue("Linear",THREE.Fog.LINEAR);this.fog.addValue("Exponential",THREE.Fog.EXPONENTIAL);this.fog.setOnChange(()=>{null!==n.obj&&(n.obj.setFogMode(n.fog.getSelectedIndex()),n.updateData())});this.form.add(this.fog);this.form.nextRow();this.form.addText("Fog Settings");
this.form.nextRow();this.fog_linear_form=new Form(this.form.element);this.fog_linear_form.spacing.set(5,5);this.fog_linear_form.addText("Linear Fog");this.fog_linear_form.nextRow();this.fog_linear_form.addText("Colour");this.fog_linear_colour=new ColorChooser(this.fog_linear_form.element);this.fog_linear_colour.size.set(80,18);this.fog_linear_colour.setOnChange(()=>{if(null!==n.obj){var f=n.fog_linear_colour.getValueHex();n.obj.fog.color.setHex(f)}});this.fog_linear_form.add(this.fog_linear_colour);
this.fog_linear_form.nextRow();this.fog_linear_form.addText("Near");this.fog_near=new NumberBox(this.fog_linear_form.element);this.fog_near.size.set(60,18);this.fog_near.setOnChange(()=>{null!==n.obj&&(n.obj.fog.near=n.fog_near.getValue())});this.fog_linear_form.add(this.fog_near);this.fog_linear_form.nextRow();this.fog_linear_form.addText("Far");this.fog_far=new NumberBox(this.fog_linear_form.element);this.fog_far.size.set(60,18);this.fog_far.setOnChange(()=>{null!==n.obj&&(n.obj.fog.far=n.fog_far.getValue())});
this.fog_linear_form.add(this.fog_far);this.fog_linear_form.nextRow();this.fog_linear_form.updateInterface();this.form.add(this.fog_linear_form);this.form.nextRow();this.fog_exponential_form=new Form(this.form.element);this.fog_exponential_form.spacing.set(5,5);this.fog_exponential_form.addText("Exponential Fog");this.fog_exponential_form.nextRow();this.fog_exponential_form.addText("Density");this.fog_density=new NumberBox(this.fog_exponential_form.element);this.fog_density.size.set(100,18);this.fog_density.setStep(1E-4);
this.fog_density.setOnChange(()=>{null!==n.obj&&(n.obj.fog.density=n.fog_density.getValue())});this.fog_exponential_form.add(this.fog_density);this.fog_exponential_form.nextRow();this.fog_exponential_form.updateInterface();this.form.add(this.fog_exponential_form);this.form.nextRow();this.form.addText("Physics World");this.form.nextRow();this.form.addText("Gravity");this.gravity=new CoordinatesBox(this.form.element);this.gravity.setOnChange(()=>{if(null!==n.obj){var f=n.gravity.getValue();n.obj.world.gravity.set(f.x,
f.y,f.z)}});this.form.add(this.gravity);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};SceneComponent.prototype.updateForms=function(){};
SceneComponent.prototype.updateData=function(){this.name.setText(this.obj.name);this.default.setValue(this.obj.uuid===this.obj.parent.default_scene);this.obj.fog instanceof THREE.Fog?this.fog.setValue(THREE.Fog.LINEAR):this.obj.fog instanceof THREE.FogExp2?this.fog.setValue(THREE.Fog.EXPONENTIAL):this.fog.setValue(THREE.Fog.NONE);null!==this.obj.fog?(this.fog_linear_colour.setValueHex(this.obj.fog.color.getHex()),this.fog_near.setValue(void 0!==this.obj.fog.near?this.obj.fog.near:0),this.fog_far.setValue(void 0!==
this.obj.fog.far?this.obj.fog.far:0),this.fog_density.setValue(void 0!==this.obj.fog.density?this.obj.fog.density:0)):(this.fog_linear_colour.setValueHex(0),this.fog_near.setValue(0),this.fog_far.setValue(0),this.fog_density.setValue(0));null!==this.obj.background&&this.background.setValue(this.obj.background.r,this.obj.background.g,this.obj.background.b);this.gravity.setValue(this.obj.world.gravity.x,this.obj.world.gravity.y,this.obj.world.gravity.z);this.updateForms()};
SceneComponent.prototype.onReset=function(){this.obj.name=this.values.name;this.obj.default=this.values.default;this.obj.parent.default_scene=null;this.obj.setFogMode(this.values.fog);this.updateData();Editor.updateObjectViews()};function Text3DComponent(){Component.call(this);this.component_name="Text";this.className="Text3DComponent";this.values={text:"text",thickness:50,bevel:!1,bevelThickness:10,bevelSize:8}}Text3DComponent.prototype=Object.create(Component.prototype);
Text3DComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Text");this.text=new TextBox(this.form.element);this.text.size.set(200,18);this.text.setOnChange(()=>{null!==n.obj&&n.obj.setText(n.text.getText())});this.form.add(this.text);this.form.nextRow();this.form.addText("Thickness");this.height=new NumberBox(this.form.element);
this.height.size.set(60,18);this.height.setRange(0,Number.MAX_SAFE_INTEGER);this.height.setStep(.1);this.height.setOnChange(()=>{null!==n.obj&&(n.obj.height=n.height.getValue(),n.obj.setText())});this.form.add(this.height);this.form.nextRow();this.bevel=new CheckBox(this.form.element);this.bevel.setText("Bevel");this.bevel.size.set(200,15);this.bevel.setOnChange(()=>{null!==n.obj&&(n.obj.bevel=n.bevel.getValue(),n.obj.setText())});this.form.add(this.bevel);this.form.nextRow();this.form.addText("Bevel Thickness");
this.bevel_thickness=new NumberBox(this.form.element);this.bevel_thickness.size.set(60,18);this.bevel_thickness.setRange(0,Number.MAX_SAFE_INTEGER);this.bevel_thickness.setStep(.1);this.bevel_thickness.setOnChange(()=>{null!==n.obj&&(n.obj.bevel_thickness=n.bevel_thickness.getValue(),n.obj.setText())});this.form.add(this.bevel_thickness);this.form.nextRow();this.form.addText("Bevel Size");this.bevel_size=new NumberBox(this.form.element);this.bevel_size.size.set(60,18);this.bevel_size.setRange(0,Number.MAX_SAFE_INTEGER);
this.bevel_size.setStep(.1);this.bevel_size.setOnChange(()=>{null!==n.obj&&(n.obj.bevel_size=n.bevel_size.getValue(),n.obj.setText())});this.form.add(this.bevel_size);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
Text3DComponent.prototype.updateData=function(){this.text.setText(this.obj.text);this.height.setValue(this.obj.height);this.bevel.setValue(this.obj.bevel);this.bevel_thickness.setValue(this.obj.bevel_thickness);this.bevel_size.setValue(this.obj.bevel_size)};
Text3DComponent.prototype.onReset=function(){this.obj.height=this.values.thickness;this.obj.bevel=this.values.bevel;this.obj.bevel_thickness=this.values.bevelThickness;this.obj.bevel_size=this.values.bevelSize;this.obj.setText(this.values.text);this.updateData();Editor.updateObjectViews()};function ScriptComponent(){Component.call(this);this.component_name="Script";this.className="ScriptComponent";this.values={mode:Script.INIT}}ScriptComponent.prototype=Object.create(Component.prototype);
ScriptComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};ScriptComponent.prototype.onReset=function(){this.updateData();Editor.updateObjectViews()};
function KinectComponent(){Component.call(this);this.component_name="Kinect";this.className="KinectComponent";this.values={debugModel:!0}}KinectComponent.prototype=Object.create(Component.prototype);
KinectComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.debug_model=new CheckBox(this.form.element);this.debug_model.setText("Debug model");this.debug_model.size.set(200,15);this.debug_model.setOnChange(()=>{null!==n.obj&&(n.obj.debug_model=n.debug_model.getValue())});this.form.add(this.debug_model);this.form.position.copy(this.widgetsPos);
this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};KinectComponent.prototype.updateData=function(){this.debug_model.setValue(this.obj.debug_model)};KinectComponent.prototype.onReset=function(){this.obj.debug_model=this.values.debugModel;Editor.updateObjectViews();this.updateData()};
function LeapComponent(){Component.call(this);this.component_name="Leap";this.className="LeapComponent";this.values={mode:0,debug_model:!0,gestures_enabled:!0,poses_enabled:!0}}LeapComponent.prototype=Object.create(Component.prototype);
LeapComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Mode");this.mode=new DropdownList(this.form.element);this.mode.size.set(80,18);this.mode.addValue("Desk",Script.INIT);this.mode.addValue("HMD",Script.LOOP);this.mode.setOnChange(()=>{null!==n.obj&&(n.obj.mode=n.mode.getSelectedIndex())});this.form.add(this.mode);
this.form.nextRow();this.debug_model=new CheckBox(this.form.element);this.debug_model.setText("Debug Model");this.debug_model.size.set(200,15);this.debug_model.setOnChange(()=>{null!==n.obj&&(n.obj.debug_model=n.debug_model.getValue())});this.form.add(this.debug_model);this.form.nextRow();this.gestures_enabled=new CheckBox(this.form.element);this.gestures_enabled.setText("Gestures Enabled");this.gestures_enabled.size.set(200,15);this.gestures_enabled.setOnChange(()=>{null!==n.obj&&(n.obj.gestures_enabled=
n.gestures_enabled.getValue())});this.form.add(this.gestures_enabled);this.form.nextRow();this.poses_enabled=new CheckBox(this.form.element);this.poses_enabled.setText("Poses Enabled");this.poses_enabled.size.set(200,15);this.poses_enabled.setOnChange(()=>{null!==n.obj&&(n.obj.poses_enabled=n.poses_enabled.getValue())});this.form.add(this.poses_enabled);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();
return this.element};LeapComponent.prototype.updateData=function(){this.mode.setSelectedIndex(this.obj.mode);this.debug_model.setValue(this.obj.debug_model);this.gestures_enabled.setValue(this.obj.gestures_enabled);this.poses_enabled.setValue(this.obj.poses_enabled)};
LeapComponent.prototype.onReset=function(){this.obj.mode=this.values.mode;this.obj.debug_model=this.values.debug_model;this.obj.gestures_enabled=this.values.gestures_enabled;this.obj.poses_enabled=this.values.poses_enabled;Editor.updateObjectViews();this.updateData()};function CameraComponent(){Component.call(this);this.component_name="Camera";this.className="CameraComponent";this.values={fov:60,default:!1,near:.1,far:1E5,size:3,mode:0,start:[0,0],camSize:[1,1],clearColor:!1,clearDepth:!1}}
CameraComponent.prototype=Object.create(Component.prototype);
CameraComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.obj instanceof PerspectiveCamera?(this.form.addText("FOV"),this.fov=new Slider(this.form.element),this.fov.size.set(160,18),this.fov.setRange(30,160),this.fov.setOnChange(()=>{null!==n.obj&&(n.obj.fov=n.fov.getValue(),n.obj.updateProjectionMatrix())}),this.form.add(this.fov),
this.form.nextRow()):this.obj instanceof OrthographicCamera&&(this.form.addText("Size"),this.size=new NumberBox(this.form.element),this.size.size.set(80,18),this.size.setOnChange(()=>{null!==n.obj&&(n.obj.size=n.size.getValue(),n.obj.updateProjectionMatrix())}),this.form.add(this.size),this.form.nextRow(),this.form.addText("Resize Mode"),this.mode=new DropdownList(this.form.element),this.mode.size.set(130,18),this.mode.addValue("Horizontal",OrthographicCamera.FIXED_VERTICAL),this.mode.addValue("Vertical",
OrthographicCamera.FIXED_HORIZONTAL),this.mode.setOnChange(()=>{null!==n.obj&&(n.obj.mode=n.mode.getSelectedIndex())}),this.form.add(this.mode),this.form.nextRow());this.form.addText("Clipping Planes");this.form.nextRow();this.form.addText("Near");this.near=new NumberBox(this.form.element);this.near.size.set(60,18);this.near.setStep(.1);this.near.setRange(0,Number.MAX_SAFE_INTEGER);this.near.setOnChange(()=>{null!==n.obj&&(n.obj.near=n.near.getValue())});this.form.add(this.near);this.form.nextRow();
this.form.addText("Far");this.far=new NumberBox(this.form.element);this.far.size.set(80,18);this.far.setRange(0,Number.MAX_SAFE_INTEGER);this.far.setOnChange(()=>{null!==n.obj&&(n.obj.far=n.far.getValue())});this.form.add(this.far);this.form.nextRow();this.form.addText("Viewport");this.form.nextRow();this.form.addText("Position");this.offset=new CoordinatesBox(this.form.element);this.offset.setMode(CoordinatesBox.VECTOR2);this.offset.setStep(.05);this.offset.size.set(160,20);this.offset.setOnChange(()=>
{null!==n.obj&&n.obj.offset.copy(n.offset.getValue())});this.form.add(this.offset);this.form.nextRow();this.form.addText("Size");this.viewport=new CoordinatesBox(this.form.element);this.viewport.setMode(CoordinatesBox.VECTOR2);this.viewport.setRange(.05);this.viewport.size.set(160,20);this.viewport.setOnChange(()=>{null!==n.obj&&n.obj.viewport.copy(n.viewport.getValue())});this.form.add(this.viewport);this.form.nextRow();this.clear_color=new CheckBox(this.form.element);this.clear_color.setText("Clear colour");
this.clear_color.size.set(200,15);this.clear_color.setOnChange(()=>{null!==n.obj&&(n.obj.clear_color=n.clear_color.getValue())});this.form.add(this.clear_color);this.form.nextRow();this.clear_depth=new CheckBox(this.form.element);this.clear_depth.setText("Clear depth");this.clear_depth.size.set(200,15);this.clear_depth.setOnChange(()=>{null!==n.obj&&(n.obj.clear_depth=n.clear_depth.getValue())});this.form.add(this.clear_depth);this.form.nextRow();this.default=new CheckBox(this.form.element);this.default.setText("Use camera");
this.default.size.set(200,15);this.default.setOnChange(()=>{if(null!==n.obj){var f=ObjectUtils.getScene(n.obj);null!==f&&(n.default.getValue()?f.addCamera(n.obj):f.removeCamera(n.obj))}});this.form.add(this.default);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
CameraComponent.prototype.updateData=function(){this.obj instanceof PerspectiveCamera?this.fov.setValue(this.obj.fov):this.obj instanceof OrthographicCamera&&(this.size.setValue(this.obj.size),this.mode.setSelectedIndex(this.obj.mode));this.near.setValue(this.obj.near);this.far.setValue(this.obj.far);this.offset.setValue(this.obj.offset);this.viewport.setValue(this.obj.viewport);this.clear_color.setValue(this.obj.clear_color);this.clear_depth.setValue(this.obj.clear_depth);this.default.setValue(-1!==
ObjectUtils.getScene(this.obj).cameras.indexOf(this.obj))};
CameraComponent.prototype.onReset=function(){this.obj instanceof PerspectiveCamera?this.obj.fov=this.values.fov:this.obj instanceof OrthographicCamera&&(this.obj.size=this.values.camSize,this.obj.mode=this.values.mode);this.obj.near=this.values.near;this.obj.far=this.values.far;this.obj.offset=new THREE.Vector2(this.values.offset[0],this.values.offset[1]);this.obj.viewport=new THREE.Vector2(this.values.viewport[0],this.values.viewport[1]);this.obj.clear_color=this.values.clearColor;this.obj.clear_depth=
this.values.clearDepth;var c=ObjectUtils.getScene(this.obj);if(null!==c){var h=c.cameras.indexOf(this.obj);-1<h&&c.cameras.splice(h,1)}Editor.updateObjectViews();this.updateData()};function LightComponent(){Component.call(this);this.component_name="Light";this.className="LightComponent";this.values={colour:[.265,.265,.265],castShadow:!0,groundCol:[1,1,1],distance:0,intensity:1,shadow_width:512,shadow_height:512,shadow_near:.01,shadow_far:1E6,angle:1,penumbra:0}}LightComponent.prototype=Object.create(Component.prototype);
LightComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Colour");this.colour=new ColorChooser(this.form.element);this.colour.size.set(80,18);this.colour.setOnChange(()=>{if(null!==n.obj){var f=n.colour.getValue();n.obj.color.setRGB(f.r,f.g,f.b)}});this.form.add(this.colour);this.form.nextRow();this.obj instanceof
HemisphereLight&&(this.form.addText("Ground Colour"),this.groundCol=new ColorChooser(this.form.element),this.groundCol.size.set(80,18),this.groundCol.setOnChange(()=>{if(null!==n.obj){var f=n.groundCol.getValue();n.obj.groundColor.setRGB(f.r,f.g,f.b)}}),this.form.add(this.groundCol),this.form.nextRow());this.obj instanceof PointLight&&(this.form.addText("Distance"),this.distance=new NumberBox(this.form.element),this.distance.size.set(60,18),this.distance.setStep(.1),this.distance.setOnChange(()=>
{null!==n.obj&&(n.obj.distance=n.distance.getValue())}),this.form.add(this.distance),this.form.nextRow(),this.form.addText("Intensity"),this.intensity=new Slider(this.form.element),this.intensity.size.set(160,18),this.intensity.setStep(.1),this.intensity.setRange(0,10),this.intensity.setOnChange(()=>{null!==n.obj&&(n.obj.intensity=n.intensity.getValue())}),this.form.add(this.intensity),this.form.nextRow());this.obj instanceof SpotLight&&(this.form.addText("Penumbra"),this.penumbra=new Slider(this.form.element),
this.penumbra.size.set(160,18),this.penumbra.position.set(65,110),this.penumbra.setRange(0,1),this.penumbra.setStep(.01),this.penumbra.updateInterface(),this.penumbra.setOnChange(()=>{null!==n.obj&&(n.obj.penumbra=n.penumbra.getValue())}),this.form.add(this.penumbra),this.form.nextRow(),this.form.addText("Angle"),this.angle=new Slider(this.form.element),this.angle.size.set(160,18),this.angle.setRange(0,1.57),this.angle.setStep(.01),this.angle.setOnChange(()=>{null!==n.obj&&(n.obj.angle=n.angle.getValue())}),
this.form.add(this.angle),this.form.nextRow());if(this.obj instanceof DirectionalLight||this.obj instanceof PointLight||this.obj instanceof SpotLight){this.form.addText("Shadows");this.form.nextRow();this.cast_shadow=new CheckBox(this.form.element);this.cast_shadow.setText("Cast Shadow");this.cast_shadow.size.set(200,15);this.cast_shadow.position.set(5,85);this.cast_shadow.updateInterface();this.cast_shadow.setOnChange(()=>{null!==n.obj&&(n.obj.castShadow=n.cast_shadow.getValue())});this.form.add(this.cast_shadow);
this.form.nextRow();this.form.addText("Map");this.form.nextRow();this.form.addText("Resolution");this.shadow_width=new DropdownList(this.form.element);this.shadow_width.size.set(60,18);this.shadow_width.setOnChange(()=>{null!==n.obj&&(n.obj.shadow.mapSize.width=n.shadow_width.getValue(),n.obj.updateShadowMap())});this.form.add(this.shadow_width);this.form.addText("x");this.shadow_height=new DropdownList(this.form.element);this.shadow_height.size.set(60,18);this.shadow_height.setOnChange(()=>{null!==
n.obj&&(n.obj.shadow.mapSize.height=n.shadow_height.getValue(),n.obj.updateShadowMap())});this.form.add(this.shadow_height);this.form.nextRow();for(c=0;13>c;c++)h=Math.pow(2,c),this.shadow_width.addValue(h.toString(),h),this.shadow_height.addValue(h.toString(),h);this.form.addText("Near");this.shadow_near=new NumberBox(this.form.element);this.shadow_near.size.set(60,18);this.shadow_near.setStep(.1);this.shadow_near.setOnChange(()=>{null!==n.obj&&(n.obj.shadow.camera.near=n.shadow_near.getValue(),
n.obj.updateShadowMap())});this.form.add(this.shadow_near);this.form.addText("Far");this.shadow_far=new NumberBox(this.form.element);this.shadow_far.size.set(60,18);this.shadow_far.setStep(.1);this.shadow_far.setOnChange(()=>{null!==n.obj&&(n.obj.shadow.camera.far=n.shadow_far.getValue(),n.obj.updateShadowMap())});this.form.add(this.shadow_far);this.form.nextRow();this.obj instanceof DirectionalLight&&(this.form.addText("Left"),this.shadow_left=new NumberBox(this.form.element),this.shadow_left.size.set(60,
18),this.shadow_left.setStep(.1),this.shadow_left.setOnChange(()=>{null!==n.obj&&(n.obj.shadow.camera.left=n.shadow_left.getValue(),n.obj.updateShadowMap())}),this.form.add(this.shadow_left),this.form.addText("Right"),this.shadow_right=new NumberBox(this.form.element),this.shadow_right.size.set(60,18),this.shadow_right.setStep(.1),this.shadow_right.setOnChange(()=>{null!==n.obj&&(n.obj.shadow.camera.right=n.shadow_right.getValue(),n.obj.updateShadowMap())}),this.form.add(this.shadow_right),this.form.nextRow(),
this.form.addText("Top"),this.shadow_top=new NumberBox(this.form.element),this.shadow_top.size.set(60,18),this.shadow_top.setStep(.1),this.shadow_top.setOnChange(()=>{null!==n.obj&&(n.obj.shadow.camera.top=n.shadow_top.getValue(),n.obj.updateShadowMap())}),this.form.add(this.shadow_top),this.form.addText("Bottom"),this.shadow_bottom=new NumberBox(this.form.element),this.shadow_bottom.size.set(60,18),this.shadow_bottom.setStep(.1),this.shadow_bottom.setOnChange(()=>{null!==n.obj&&(n.obj.shadow.camera.bottom=
n.shadow_bottom.getValue(),n.obj.updateShadowMap())}),this.form.add(this.shadow_bottom),this.form.nextRow())}this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
LightComponent.prototype.updateData=function(){this.colour.setValue(this.obj.color.r,this.obj.color.g,this.obj.color.b);this.obj instanceof HemisphereLight&&this.groundCol.setValue(this.obj.groundColor.r,this.obj.groundColor.g,this.obj.groundColor.b);this.obj instanceof PointLight&&(this.distance.setValue(this.obj.distance),this.intensity.setValue(this.obj.intensity));this.obj instanceof SpotLight&&(this.angle.setValue(this.obj.angle),this.penumbra.setValue(this.obj.penumbra));if(this.obj instanceof
DirectionalLight||this.obj instanceof PointLight||this.obj instanceof SpotLight)this.cast_shadow.setValue(this.obj.castShadow),this.shadow_width.setValue(this.obj.shadow.mapSize.width),this.shadow_height.setValue(this.obj.shadow.mapSize.height),this.shadow_near.setValue(this.obj.shadow.camera.near),this.shadow_far.setValue(this.obj.shadow.camera.far);this.obj instanceof DirectionalLight&&(this.shadow_left.setValue(this.obj.shadow.camera.left),this.shadow_right.setValue(this.obj.shadow.camera.right),
this.shadow_top.setValue(this.obj.shadow.camera.top),this.shadow_bottom.setValue(this.obj.shadow.camera.bottom))};
LightComponent.prototype.onReset=function(){this.obj.color.setRGB(this.values.colour[0],this.values.colour[1],this.values.colour[2]);if(this.obj instanceof DirectionalLight||this.obj instanceof PointLight)this.obj.castShadow=this.values.castShadow;this.obj instanceof HemisphereLight&&this.obj.groundColor.setRGB(this.values.groundCol[0],this.values.groundCol[1],this.values.groundCol[2]);this.obj instanceof PointLight&&(this.obj.distance=this.values.distance,this.obj.intensity=this.values.intensity,
this.obj.shadow.mapSize.width=this.values.shadow_width,this.obj.shadow.mapSize.height=this.values.shadow_height,this.obj.shadow.camera.near=this.values.shadow_near,this.obj.shadow.camera.far=this.values.shadow_far,this.obj.updateShadowMap());this.obj instanceof SpotLight&&(this.obj.penumbra=this.values.penumbra,this.obj.angle=this.values.angle);Editor.updateObjectViews();this.updateData()};
function SkyComponent(){Component.call(this);this.component_name="Sky";this.className="SkyComponent";this.values={auto_update:!1,duration:240,time:150,distance:500,shadows:!0,width:512,height:512,near:.5,far:1E4,left:-10,right:10,top:10,bottom:-10}}SkyComponent.prototype=Object.create(Component.prototype);
SkyComponent.prototype.initUI=function(c,h){this.clearElement();this.widgetsPos=c;var n=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.auto_update=new CheckBox(this.form.element);this.auto_update.setText("Auto Update");this.auto_update.size.set(200,15);this.auto_update.setOnChange(()=>{null!==n.obj&&(n.obj.auto_update=n.auto_update.getValue())});this.form.add(this.auto_update);this.form.nextRow();this.form.addText("Day duration");
this.day_time=new NumberBox(this.form.element);this.day_time.size.set(60,18);this.day_time.setStep(.1);this.day_time.setOnChange(()=>{if(null!==n.obj){var f=n.day_time.getValue();0>f&&(f=0,n.day_time.setValue(f));n.obj.day_time=f;n.obj.day_time>f&&(n.obj.time=f,n.time.setValue(f));n.time.setRange(0,f);n.obj.updateSky()}});this.form.add(this.day_time);this.form.addText("s");this.form.nextRow();this.form.addText("Time");this.time=new NumberBox(this.form.element);this.time.size.set(100,18);this.time.setStep(.1);
this.time.setOnChange(()=>{if(null!==n.obj){var f=n.time.getValue();0>f?(f=0,n.time.setValue(f)):f>n.obj.day_time&&(f=n.obj.day_time,n.time.setValue(f));n.obj.time=f;n.obj.updateSky()}});this.form.add(this.time);this.form.addText("s");this.form.nextRow();this.form.addText("Sun distance");this.sun_distance=new NumberBox(this.form.element);this.sun_distance.size.set(80,18);this.sun_distance.setStep(10);this.sun_distance.setOnChange(()=>{null!==n.obj&&(n.obj.sun_distance=n.sun_distance.getValue(),n.obj.updateSky())});
this.form.add(this.sun_distance);this.form.nextRow();this.form.addText("Shadows");this.form.nextRow();this.cast_shadow=new CheckBox(this.form.element);this.cast_shadow.setText("Cast shadows");this.cast_shadow.size.set(200,15);this.cast_shadow.position.set(5,85);this.cast_shadow.updateInterface();this.cast_shadow.setOnChange(()=>{null!==n.obj&&(n.obj.sun.castShadow=n.cast_shadow.getValue())});this.form.add(this.cast_shadow);this.form.nextRow();this.form.addText("Resolution");this.shadow_width=new DropdownList(this.form.element);
this.shadow_width.size.set(60,18);this.shadow_width.setOnChange(()=>{null!==n.obj&&(n.obj.sun.shadow.mapSize.width=n.shadow_width.getValue(),n.obj.sun.updateShadowMap())});this.form.add(this.shadow_width);this.form.addText("x");this.shadow_height=new DropdownList(this.form.element);this.shadow_height.size.set(60,18);this.shadow_height.setOnChange(()=>{null!==n.obj&&(n.obj.sun.shadow.mapSize.height=n.shadow_height.getValue(),n.obj.sun.updateShadowMap())});this.form.add(this.shadow_height);this.form.nextRow();
for(c=0;13>c;c++)h=Math.pow(2,c),this.shadow_width.addValue(h.toString(),h),this.shadow_height.addValue(h.toString(),h);this.form.addText("Near");this.shadow_near=new NumberBox(this.form.element);this.shadow_near.size.set(60,18);this.shadow_near.setStep(.1);this.shadow_near.setOnChange(()=>{null!==n.obj&&(n.obj.sun.shadow.camera.near=n.shadow_near.getValue(),n.obj.sun.updateShadowMap())});this.form.add(this.shadow_near);this.form.addText("Far");this.shadow_far=new NumberBox(this.form.element);this.shadow_far.size.set(60,
18);this.shadow_far.setStep(.1);this.shadow_far.setOnChange(()=>{null!==n.obj&&(n.obj.sun.shadow.camera.far=n.shadow_far.getValue(),n.obj.sun.updateShadowMap())});this.form.add(this.shadow_far);this.form.nextRow();this.form.addText("Left");this.shadow_left=new NumberBox(this.form.element);this.shadow_left.size.set(60,18);this.shadow_left.setStep(.1);this.shadow_left.setOnChange(()=>{null!==n.obj&&(n.obj.sun.shadow.camera.left=n.shadow_left.getValue(),n.obj.sun.updateShadowMap())});this.form.add(this.shadow_left);
this.form.addText("Right");this.shadow_right=new NumberBox(this.form.element);this.shadow_right.size.set(60,18);this.shadow_right.setStep(.1);this.shadow_right.setOnChange(()=>{null!==n.obj&&(n.obj.sun.shadow.camera.right=n.shadow_right.getValue(),n.obj.sun.updateShadowMap())});this.form.add(this.shadow_right);this.form.nextRow();this.form.addText("Top");this.shadow_top=new NumberBox(this.form.element);this.shadow_top.size.set(60,18);this.shadow_top.setStep(.1);this.shadow_top.setOnChange(()=>{null!==
n.obj&&(n.obj.sun.shadow.camera.top=n.shadow_top.getValue(),n.obj.sun.updateShadowMap())});this.form.add(this.shadow_top);this.form.addText("Bottom");this.shadow_bottom=new NumberBox(this.form.element);this.shadow_bottom.size.set(60,18);this.shadow_bottom.setStep(.1);this.shadow_bottom.setOnChange(()=>{null!==n.obj&&(n.obj.sun.shadow.camera.bottom=n.shadow_bottom.getValue(),n.obj.sun.updateShadowMap())});this.form.add(this.shadow_bottom);this.form.nextRow();this.form.position.copy(this.widgetsPos);
this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
SkyComponent.prototype.updateData=function(){this.auto_update.setValue(this.obj.auto_update);this.day_time.setValue(this.obj.day_time);this.time.setValue(this.obj.time);this.sun_distance.setValue(this.obj.sun_distance);this.cast_shadow.setValue(this.obj.sun.castShadow);this.shadow_width.setValue(this.obj.sun.shadow.mapSize.width);this.shadow_height.setValue(this.obj.sun.shadow.mapSize.height);this.shadow_near.setValue(this.obj.sun.shadow.camera.near);this.shadow_far.setValue(this.obj.sun.shadow.camera.far);
this.shadow_left.setValue(this.obj.sun.shadow.camera.left);this.shadow_right.setValue(this.obj.sun.shadow.camera.right);this.shadow_top.setValue(this.obj.sun.shadow.camera.top);this.shadow_bottom.setValue(this.obj.sun.shadow.camera.bottom)};
SkyComponent.prototype.onReset=function(){this.obj.auto_update=this.values.auto_update;this.obj.day_time=this.values.duration;this.obj.time=this.values.time;this.obj.sun_distance=this.values.distance;this.obj.sun.castShadow=this.values.shadows;this.obj.sun.shadow.mapSize.width=this.values.width;this.obj.sun.shadow.mapSize.height=this.values.height;this.obj.sun.shadow.camera.near=this.values.near;this.obj.sun.shadow.camera.far=this.values.far;this.obj.sun.shadow.camera.left=this.values.left;this.obj.sun.shadow.camera.right=
this.values.right;this.obj.sun.shadow.camera.top=this.values.top;this.obj.sun.shadow.camera.bottom=this.values.bottom;this.updateData();this.obj.updateSky();Editor.updateObjectViews()};function Register(){}Register.registerBlocksNodes=function(){registerBase();registerEvents();registerArray();registerWidgets();registerColour();registerVectorNode();registerObjects();registerHierarchy();registerKeyboardNodes()};
Register.registerMaterialNodes=function(){registerArray();registerWidgets();registerColour();registerMaterialNodes()};Register.registerParticlesNodes=function(){registerArray();registerWidgets();registerColour();registerParticlesNodes()};Register.unregisterAll=function(){LiteGraph.registered_node_types={};LiteGraph.Nodes={}};Register.registerAll=function(){Register.registerBlocksNodes();Register.registerMaterialNodes();Register.registerParticlesNodes()};function NodesHelper(){}NodesHelper.sizes={};
NodesHelper.sizes.small=[120,26];NodesHelper.sizes.medium=[180,46];NodesHelper.sizes.big=[220,66];NodesHelper.sizes.large=[280,86];NodesHelper.titles={};NodesHelper.titles.event="#FF0000";NodesHelper.titles.hierarchy="#556B2f";NodesHelper.titles.input="#0080FF";NodesHelper.titles.object="#DEB887";NodesHelper.titles.base="#5F9EA0";NodesHelper.titles.material="#032138";NodesHelper.titles.texture="#1d5e4a";NodesHelper.titles.particles="#bf7f3b";NodesHelper.titles.array=NodesHelper.titles.event;
NodesHelper.titles.widget="#7E0480";NodesHelper.titles.color="#380333";NodesHelper.titles.vector="#f4042c";NodesHelper.slots={};NodesHelper.slots.position={};NodesHelper.slots.position.x=20;NodesHelper.slots.position.y=12;NodesHelper.slots.position.y_second=30;NodesHelper.slots.position.y_third=48;NodesHelper.slots.position.y_fourth=66;NodesHelper.slots.position.y_fifth=84;NodesHelper.slots.position.y_sixth=104;NodesHelper.slots.position.y_seventh=122;NodesHelper.slots.position.y_eighth=140;
NodesHelper.slots.position.y_ninth=158;NodesHelper.slots.position.x1=105;NodesHelper.slots.position.y1=12;NodesHelper.slots.colours={};NodesHelper.slots.colours.event="#FFFFFF";NodesHelper.slots.colours.passer="#FFC0CB";NodesHelper.slots.colours.element="#00BFFF";NodesHelper.slots.colours.array="#9400D3";NodesHelper.slots.colours.string="#FF1493";NodesHelper.slots.colours.number="#7ef48f";NodesHelper.slots.colours.input="#87ceeb";NodesHelper.slots.colours.bool="#800000";
NodesHelper.slots.colours.vector="#D2691E";NodesHelper.slots.colours.variable="#A52A2A";NodesHelper.slots.colours.euler="#8bd613";NodesHelper.slots.colours.color="#380333";NodesHelper.slots.colours.texture="#1d5e4a";NodesHelper.slots.colours.json="#1d395e";NodesHelper.slots.event={color_on:NodesHelper.slots.colours.event,color_off:NodesHelper.slots.colours.event,shape:LiteGraph.ARROW_SHAPE};
NodesHelper.slots.passer={color_on:NodesHelper.slots.colours.passer,color_off:NodesHelper.slots.colours.passer,shape:LiteGraph.BOX_SHAPE};NodesHelper.slots.object={color_on:NodesHelper.slots.colours.element,color_off:NodesHelper.slots.colours.element};NodesHelper.slots.array={color_on:NodesHelper.slots.colours.array,color_off:NodesHelper.slots.colours.array};NodesHelper.slots.string={color_on:NodesHelper.slots.colours.string,color_off:NodesHelper.slots.colours.string};
NodesHelper.slots.number={color_on:NodesHelper.slots.colours.number,color_off:NodesHelper.slots.colours.number};NodesHelper.slots.keyinput={color_on:NodesHelper.slots.colours.input,color_off:NodesHelper.slots.colours.input};NodesHelper.slots.bool={color_on:NodesHelper.slots.colours.bool,color_off:NodesHelper.slots.colours.bool};NodesHelper.slots.vector={color_on:NodesHelper.slots.colours.vector,color_off:NodesHelper.slots.colours.vector};
NodesHelper.slots.variable={color_on:NodesHelper.slots.colours.variable,color_off:NodesHelper.slots.colours.variable};NodesHelper.slots.euler={color_on:NodesHelper.slots.colours.euler,color_off:NodesHelper.slots.colours.euler};NodesHelper.slots.color={color_on:NodesHelper.slots.colours.color,color_off:NodesHelper.slots.colours.color};NodesHelper.slots.texture={color_on:NodesHelper.slots.colours.texture,color_off:NodesHelper.slots.colours.texture};
NodesHelper.slots.json={color_on:NodesHelper.slots.colours.json,color_off:NodesHelper.slots.colours.json};NodesHelper.slots.input={};NodesHelper.slots.input.position={pos:[NodesHelper.slots.position.x,12]};NodesHelper.slots.input.event=Object.assign({},NodesHelper.slots.event,NodesHelper.slots.input.position);NodesHelper.slots.output={};NodesHelper.slots.output.position={pos:[NodesHelper.slots.position.x1,12]};NodesHelper.slots.output.title_pos={pos:[NodesHelper.slots.position.x1,-10]};
NodesHelper.slots.output.event=Object.assign({},NodesHelper.slots.event,NodesHelper.slots.output.position);NodesHelper.slots.output.passer=Object.assign({},NodesHelper.slots.passer,{shape:LiteGraph.BOX_SHAPE},NodesHelper.slots.output.title_pos);
NodesHelper.getSlotMenuOptions=function(c,h,n){void 0!==c.output&&new LiteGraph.ContextMenu([{title:"Convert to Variable",callback:()=>{var f=LGraphCanvas.active_canvas.graph,q=LiteGraph.createNode("Base/Variable");q.pos=[h.pos[0]+150,h.pos[1]];f.add(q);h.connect(0,q,0);h.connect(c.slot,q,1)}}],{title:c.output.name,event:n})};
function VariableNode(){this.properties={name:"myname",container:VariableNode.LITEGRAPH};this.addInput("",LiteGraph.EVENT,NodesHelper.slots.input.event);this.addInput("In","",Object.assign({},NodesHelper.slots.variable,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.name_widget=this.addWidget("string","",this.properties.name,"name");this.name_widget.width=100;this.addOutput("Value","",Object.assign({},NodesHelper.slots.variable,{pos:[NodesHelper.slots.position.x1+10,
NodesHelper.slots.position.y]}));this.size[0]=130}VariableNode.title="Variable";VariableNode.title_color=NodesHelper.titles.base;VariableNode.collapsable=!0;VariableNode.blocks="Blocks";VariableNode.prototype.resizable=!1;VariableNode.LITEGRAPH=0;VariableNode.GRAPH=1;VariableNode.GLOBALSCOPE=2;VariableNode["@container"]={type:"enum",values:{litegraph:VariableNode.LITEGRAPH,graph:VariableNode.GRAPH,global:VariableNode.GLOBALSCOPE}};
VariableNode.prototype.getContainer=function(){switch(this.properties.container){case VariableNode.GRAPH:return this.graph?this.graph.vars:{};case VariableNode.GLOBALSCOPE:return global;default:return LiteGraph.Globals}};VariableNode.prototype.onAction=function(c,h){c=this.getContainer();this.isInputConnected(1)?(this.value=this.getInputData(1),c[this.properties.name]=this.value,this.setOutputData(0,this.value)):this.setOutputData(0,c[this.properties.name])};VariableNode.prototype.getTitle=function(){return this.properties.name};
function registerBase(){LiteGraph.registerNodeType("Base/Variable",VariableNode)}function BeginPlayNode(){this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,NodesHelper.slots.output.position))}BeginPlayNode.title="Begin Play";BeginPlayNode.title_color=NodesHelper.titles.event;BeginPlayNode.skip_list=!0;BeginPlayNode.collapsable=!1;BeginPlayNode.blocks="Blocks";BeginPlayNode.prototype.resizable=!1;
BeginPlayNode.prototype.ignore_remove=!0;BeginPlayNode.prototype.clonable=!1;BeginPlayNode.prototype.getMenuOptions=()=>[];BeginPlayNode.prototype.onStart=function(){this.triggerSlot(0,"BeginPlay");this.triggerSlot(1)};function EventTickNode(){this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.passer);this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,NodesHelper.slots.output.position))}EventTickNode.title="Event Tick";EventTickNode.title_color=NodesHelper.titles.event;
EventTickNode.skip_list=!0;EventTickNode.collapsable=!1;EventTickNode.blocks="Blocks";EventTickNode.prototype.resizable=!1;EventTickNode.prototype.ignore_remove=!0;EventTickNode.prototype.clonable=!1;EventTickNode.prototype.getMenuOptions=()=>[];EventTickNode.prototype.onStart=function(){this.triggerSlot(1,"EventTickStarted")};EventTickNode.prototype.onExecute=function(){this.triggerSlot(0,"Tick")};
function OnGameStartNode(){this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,NodesHelper.slots.output.position));this.size=[NodesHelper.sizes.small[0],NodesHelper.sizes.small[1]]}OnGameStartNode.title="On Game Start";OnGameStartNode.title_color=NodesHelper.titles.event;OnGameStartNode.collapsable=!1;
OnGameStartNode.blocks="Blocks";OnGameStartNode.prototype.reiszable=!1;OnGameStartNode.prototype.onStart=function(){this.triggerSlot(0,"GameStart");this.triggerSlot(1)};
function EventDestroyedNode(){this.addInput("Target","object",Object.assign({},NodesHelper.slots.object));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,NodesHelper.slots.output.position));this.size=[NodesHelper.sizes.small[0],NodesHelper.sizes.small[1]]}EventDestroyedNode.title="On Destroyed";
EventDestroyedNode.title_color=NodesHelper.titles.event;EventDestroyedNode.collapsable=!1;EventDestroyedNode.blocks="Blocks";EventDestroyedNode.prototype.resizable=!1;EventDestroyedNode.prototype.onStart=function(){var c=this.getInputData(0);void 0===c&&(c=this.graph.config.self);var h=this;c.addEventListener("removed",n=>{h.triggerSlot(0,c.uuid);h.triggerSlot(1)})};
function EventDisposeNode(){this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,NodesHelper.slots.output.position));this.size=[NodesHelper.sizes.small[0],NodesHelper.sizes.small[1]]}EventDisposeNode.title="On Dispose";EventDisposeNode.title_color=NodesHelper.titles.event;EventDisposeNode.collapsable=!1;EventDisposeNode.blocks="Blocks";EventDisposeNode.prototype.resizable=!1;EventDisposeNode.prototype.onDispose=function(){this.triggerSlot(0)};
function EventListenerNode(){this.addProperty("event","event");this.addInput("",LiteGraph.ACTION,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Object","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.input.position.pos[1]+18]}));this.addInput("Data","",{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.input.position.pos[1]+36]});this.addInput("Event",
"string",Object.assign({},NodesHelper.slots.string,{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.input.position.pos[1]+54]}));this.event_widget=this.addWidget("text","",this.properties.event,"event");this.event_widget.width=110;this.addOutput("On Fired",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.output.position.pos[0]+60,NodesHelper.slots.output.position.pos[1]]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+56]}
EventListenerNode.title="Event Listener";EventListenerNode.title_color=NodesHelper.titles.event;EventListenerNode.collapsable=!1;EventListenerNode.blocks="Blocks";EventListenerNode.prototype.resizable=!1;EventListenerNode.prototype.onStart=function(){null===this.inputs[0].link&&this.addListener()};EventListenerNode.prototype.onAction=function(c,h){this.addListener()};
EventListenerNode.prototype.addListener=function(){this.object=this.getInputData(1);this.data=this.getInputData(2);this.event=this.getInputData(3);void 0===this.object&&(this.object=this.graph.config.self);void 0===this.data&&(this.data={});void 0===this.event&&(this.event=this.properties.event);if(""!==this.event){var c=this;this.object.addEventListener(this.event,()=>{c.listen()})}};EventListenerNode.prototype.listen=function(){this.triggerSlot(0,this.data)};
EventListenerNode.prototype.onDispose=function(){void 0!==this.object&&this.object.removeEventListener(this.event,this.listen)};
function FireEventNode(){this.addProperty("event","event");this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Object","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.position.y_second]}));this.addInput("Event","string",Object.assign({},NodesHelper.slots.string,{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.position.y_third]}));this.event_widget=this.addWidget("text","",this.properties.event,
"event");this.event_widget.width=110;this.size=[NodesHelper.sizes.medium[0]-40,NodesHelper.sizes.medium[1]+40]}FireEventNode.title="Fire Event";FireEventNode.title_color=NodesHelper.titles.event;FireEventNode.collapsable=!1;FireEventNode.blocks="Blocks";FireEventNode.prototype.resizable=!1;
FireEventNode.prototype.onAction=function(c,h){this.object=this.getInputData(1);this.event=this.getInputData(2);void 0===this.object&&(this.object=this.graph.config.self);void 0===this.event&&(this.event=this.properties.event);""!==this.event&&this.object.dispatchEvent({type:this.event})};
function TimeOutEvent(){this.addProperty("time","100");this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Time","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.position.y_second]}));this.addWidget("text","Time",this.properties.time,"time").width=140;this.addOutput("On TimeOut",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.output.position.pos[0]+20,NodesHelper.slots.output.position.pos[1]]}));
this.size=[NodesHelper.sizes.medium[0]-40,NodesHelper.sizes.medium[1]+18]}TimeOutEvent.title="Time Out";TimeOutEvent.title_color=NodesHelper.titles.event;TimeOutEvent.collapsable=!1;TimeOutEvent.blocks="Blocks";TimeOutEvent.prototype.resizable=!1;TimeOutEvent.prototype.onStart=function(){null===this.inputs[0].link&&this.addTimeout()};TimeOutEvent.prototype.onAction=function(c,h){this.addTimeout()};TimeOutEvent.prototype.addTimeout=function(){var c=this;setTimeout(()=>{c.triggerSlot(0)},parseInt(this.properties.time))};
function TestEvent(){this.addInput("Event",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Input")}TestEvent.title="Test";TestEvent.blocks="Blocks";TestEvent.prototype.onAction=function(c,h){console.log(c,h);console.log(this.getInputData(1))};
function registerEvents(){LiteGraph.registerNodeType("Events/BeginPlay",BeginPlayNode);LiteGraph.registerNodeType("Events/EventTick",EventTickNode);LiteGraph.registerNodeType("Events/OnGameStart",OnGameStartNode);LiteGraph.registerNodeType("Events/EventDestroyed",EventDestroyedNode);LiteGraph.registerNodeType("Events/EventDispose",EventDisposeNode);LiteGraph.registerNodeType("Events/EventListener",EventListenerNode);LiteGraph.registerNodeType("Events/FireEvent",FireEventNode);LiteGraph.registerNodeType("Events/TimeOut",
TimeOutEvent);LiteGraph.registerNodeType("Events/TestEvent",TestEvent)}
function ArrayNode(){this.addInput("",LiteGraph.EVENT,NodesHelper.slots.event);this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event));this.addOutput("Array","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x1,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.small[0],NodesHelper.sizes.small[1]+16]}ArrayNode.title="Array";
ArrayNode.title_color=NodesHelper.titles.array;ArrayNode.collapsable=!1;ArrayNode.prototype.resizable=!1;ArrayNode.prototype.onGetInputs=function(){return[["Item",null,Object.assign({},NodesHelper.slots.array)]]};ArrayNode.prototype.onInputAdded=function(){this.size[0]=NodesHelper.sizes.small[0]};ArrayNode.prototype.onInputRemoved=function(){this.size[0]=NodesHelper.sizes.small[0]};ArrayNode.prototype.onOutputRemoved=function(){this.size[0]=NodesHelper.sizes.small[0]};
ArrayNode.prototype.onExecute=function(){this.isInputConnected(0)||this.setOutputData(2,this.createArray())};ArrayNode.prototype.onAction=function(){var c=this.createArray();this.setOutputData(2,c);this.triggerSlot(0,c);this.triggerSlot(1)};ArrayNode.prototype.createArray=function(){var c=[];if(this.inputs)for(var h=0;h<this.inputs.length;h++){var n=this.getInputData(h);void 0!==n&&c.push(n)}return c};
function ArrayPushNode(){this.addInput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Array","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Element","",{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]});this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1,
NodesHelper.slots.position.y]}));this.size=[NodesHelper.sizes.small[0],NodesHelper.sizes.small[1]+36]}ArrayPushNode.title="Push";ArrayPushNode.title_color=NodesHelper.titles.array;ArrayPushNode.collapsable=!1;ArrayPushNode.prototype.resizable=!1;ArrayPushNode.prototype.onAction=function(){void 0!==this.getInputData(2)&&(this.getInputData(1).push(this.getInputData(2)),this.triggerSlot(0))};
function registerArray(){LiteGraph.registerNodeType("Lists/Arrays/Array",ArrayNode);LiteGraph.registerNodeType("Lists/Arrays/Push",ArrayPushNode)}function WidgetFloatNode(){this.properties={value:1};this.addOutput("Value","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x1+50,NodesHelper.slots.position.y]}));this.addWidget("number","Value",this.properties.value,"value");this.size=[NodesHelper.sizes.small[0]+50,NodesHelper.sizes.small[1]+26]}
WidgetFloatNode.title="Float";WidgetFloatNode.title_color=NodesHelper.titles.widget;WidgetFloatNode.collapsable=!1;WidgetFloatNode.prototype.resizable=!1;WidgetFloatNode.prototype.onStart=function(){void 0!==this.properties.value&&this.setOutputData(0,this.properties.value)};WidgetFloatNode.prototype.onPropertyChanged=function(){this.setOutputData(0,this.properties.value);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function registerWidgets(){LiteGraph.registerNodeType("Base/Widgets/Float",WidgetFloatNode)}
function ThisNode(){this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1-20,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1-20,NodesHelper.slots.position.y]}));this.addOutput("This","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x1-20,NodesHelper.slots.position.y_second]}));this.size=
[NodesHelper.sizes.small[0]-20,NodesHelper.sizes.small[1]+20]}ThisNode.title="This";ThisNode.title_color=NodesHelper.titles.object;ThisNode.collapsable=!0;ThisNode.blocks="Blocks";ThisNode.prototype.resizable=!1;ThisNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ThisNode.prototype.onStart=function(){this.setOutputData(2,this.graph.config.self);this.triggerSlot(0,this.graph.config.self);this.triggerSlot(1)};
function GetPositionNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Position","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}GetPositionNode.title="Get Position";GetPositionNode.title_color=NodesHelper.titles.object;GetPositionNode.collapsable=!0;GetPositionNode.blocks="Blocks";GetPositionNode.prototype.resizable=!1;GetPositionNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetPositionNode.prototype.onAction=function(c,h){c=this.getInputData(1);void 0===c&&void 0!==h&&h instanceof THREE.Object3D&&(c=h);void 0===c&&(c=this.graph.config.self);h=c.position;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function GetRotationNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Rotation","euler",Object.assign({},NodesHelper.slots.euler,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}GetRotationNode.title="Get Rotation";GetRotationNode.title_color=NodesHelper.titles.object;GetRotationNode.collapsable=!0;GetRotationNode.blocks="Blocks";GetRotationNode.prototype.resizable=!1;GetRotationNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetRotationNode.prototype.onAction=function(c,h){c=this.getInputData(1);void 0===c&&void 0!==h&&h instanceof THREE.Object3D&&(c=h);void 0===c&&(c=this.graph.config.self);h=c.rotation;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function GetScaleNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Scale","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}GetScaleNode.title="Get Scale";GetScaleNode.title_color=NodesHelper.titles.object;GetScaleNode.collapsable=!0;GetScaleNode.blocks="Blocks";GetScaleNode.prototype.resizable=!1;GetScaleNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetScaleNode.prototype.onAction=function(c,h){c=this.getInputData(1);void 0===c&&void 0!==h&&h instanceof THREE.Object3D&&(c=h);void 0===c&&(c=this.graph.config.self);h=c.scale;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function SetPositionNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Position","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("New Position","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+18]}SetPositionNode.title="Set Position";SetPositionNode.title_color=NodesHelper.titles.object;
SetPositionNode.collapsable=!0;SetPositionNode.blocks="Blocks";SetPositionNode.prototype.resizable=!1;SetPositionNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SetPositionNode.prototype.onAction=function(c,h){c=this.getInputData(1);var n=this.getInputData(2);void 0===c&&void 0!==h&&h instanceof THREE.Object3D&&(c=h);void 0===c&&(c=this.graph.config.self);void 0===n&&void 0!==h&&h instanceof THREE.Vector3&&(n=h);void 0===n&&(n=new THREE.Vector3(0,0,0));c.position.copy(n);this.setOutputData(2,n);this.triggerSlot(0,n);this.triggerSlot(1)};
function SetRotationNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Rotation","euler",Object.assign({},NodesHelper.slots.euler,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("New Rotation","euler",Object.assign({},NodesHelper.slots.euler,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}))}SetRotationNode.title="Set Rotation";SetRotationNode.title_color=NodesHelper.titles.object;SetRotationNode.collapsable=!0;
SetRotationNode.blocks="Blocks";SetRotationNode.prototype.resizable=!1;SetRotationNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SetRotationNode.prototype.onAction=function(c,h){c=this.getInputData(1);var n=this.getInputData(2);void 0===c&&void 0!==h&&h instanceof THREE.Object3D&&(c=h);void 0===c&&(c=this.graph.config.self);void 0===n&&void 0!==h&&h instanceof THREE.Euler&&(n=h);void 0===n&&(n=new THREE.Euler(0,0,0,"XYZ"));c.rotation.copy(n);this.setOutputData(2,n);this.triggerSlot(0,n);this.triggerSlot(1)};
function SetScaleNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Scale","vector",Object.assign({},NodesHelper.slots.euler,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("New Scale","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+18]}SetScaleNode.title="Set Scale";SetScaleNode.title_color=NodesHelper.titles.object;
SetScaleNode.collapsable=!0;SetScaleNode.blocks="Blocks";SetScaleNode.prototype.resizable=!1;SetScaleNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SetScaleNode.prototype.onAction=function(c,h){c=this.getInputData(1);var n=this.getInputData(2);void 0===c&&void 0!==h&&h instanceof THREE.Object3D&&(c=h);void 0===c&&(c=this.graph.config.self);void 0===n&&void 0!==h&&h instanceof THREE.Vector3&&(n=h);void 0===n&&(n=new THREE.Vector3(1,1,1));c.scale.copy(n);this.setOutputData(2,n);this.triggerSlot(0,n);this.triggerSlot(1)};
function registerObjects(){LiteGraph.registerNodeType("Objects/This",ThisNode);LiteGraph.registerNodeType("Objects/GetPosition",GetPositionNode);LiteGraph.registerNodeType("Objects/GetRotation",GetRotationNode);LiteGraph.registerNodeType("Objects/GetScale",GetScaleNode);LiteGraph.registerNodeType("Objects/SetPosition",SetPositionNode);LiteGraph.registerNodeType("Objects/SetRotation",SetRotationNode);LiteGraph.registerNodeType("Objects/SetScale",SetScaleNode)}
function GetAllChildrenNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Children","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.output.position.pos[0]+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}GetAllChildrenNode.title="Get All Children";GetAllChildrenNode.title_color=NodesHelper.titles.hierarchy;GetAllChildrenNode.collapsable=!1;GetAllChildrenNode.blocks="Blocks";GetAllChildrenNode.prototype.resizable=!1;
GetAllChildrenNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;GetAllChildrenNode.prototype.onAction=function(c,h){c=this.getInputData(1);void 0===c&&void 0!==h&&h instanceof THREE.Object3D&&(c=h);void 0===c&&(c=this.graph.config.self);h=c.children;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function GetChildByNameNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Name","string",Object.assign({},NodesHelper.slots.string,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("Child","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.output.position.pos[0]+60,NodesHelper.slots.position.y_second]}));this.addProperty("name","");this.name_widget=this.addWidget("text","","","name");this.name_widget.width=120;this.size=[NodesHelper.sizes.medium[0],
NodesHelper.sizes.medium[1]+40]}GetChildByNameNode.title="Get Child By Name";GetChildByNameNode.title_color=NodesHelper.titles.hierarchy;GetChildByNameNode.collapsable=!1;GetChildByNameNode.blocks="Blocks";GetChildByNameNode.prototype.resizable=!1;GetChildByNameNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetChildByNameNode.prototype.onAction=function(c,h){c=this.getInputData(1);var n=this.getInputData(2);void 0===c&&void 0!==h&&h instanceof THREE.Object3D&&(c=h);void 0===n&&void 0!==h&&h instanceof String&&(n=h);void 0===c&&(c=this.graph.config.self);void 0===n&&(n=this.properties.name);h=c.getObjectByName(n);this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function GetParentNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Parent","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}GetParentNode.title="Get Parent";GetParentNode.title_color=NodesHelper.titles.hierarchy;GetParentNode.collapsable=!1;GetParentNode.blocks="Blocks";GetParentNode.resizable=!1;GetParentNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetParentNode.prototype.onAction=function(c,h){c=this.getInputData(1);void 0===c&&void 0!==h&&h instanceof THREE.Object3D&&(c=h);void 0===c&&(c=this.graph.config.self);h=c.parent;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function IsChildNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Is Child?","bool",Object.assign({},NodesHelper.slots.bool,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}IsChildNode.title="Is Child";IsChildNode.title_color=NodesHelper.titles.hierarchy;IsChildNode.collapsable=!1;IsChildNode.blocks="Blocks";IsChildNode.resizable=!1;IsChildNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
IsChildNode.prototype.onAction=function(c,h){c=this.getInputData(1);void 0===c&&void 0!==h&&h instanceof THREE.Object3D&&(c=h);void 0===c&&(c=this.graph.config.self);h=c.parent instanceof THREE.Scene?!1:!0;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function registerHierarchy(){LiteGraph.registerNodeType("Hierarchy/GetAllChildNode",GetAllChildrenNode);LiteGraph.registerNodeType("Hierarchy/GetChildByName",GetChildByNameNode);LiteGraph.registerNodeType("Hierarchy/GetParent",GetParentNode);LiteGraph.registerNodeType("Hierarchy/IsChild",IsChildNode)}
function ColourNode(){this.properties={r:0,g:0,b:0};this.addWidget("number","R",this.properties.r,"r");this.addWidget("number","G",this.properties.g,"g");this.addWidget("number","B",this.properties.b,"b");this.addOutput("Colour","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+52]}ColourNode.title="Colour";ColourNode.title_color=NodesHelper.titles.color;
ColourNode.collapsable=!1;ColourNode.prototype.resizable=!1;ColourNode.prototype.onStart=function(){this.setOutputData(0,new THREE.Color(this.properties.r,this.properties.g,this.properties.b))};ColourNode.prototype.onPropertyChanged=function(){this.setOutputData(0,new THREE.Color(this.properties.r,this.properties.g,this.properties.b));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function registerColour(){LiteGraph.registerNodeType("Math/Colour/Colour",ColourNode)}
function VectorNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("X","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Y","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addInput("Z","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_fourth]}));
this.properties={x:0,y:0,z:0};this.addWidget("number","X",this.properties.x,"x");this.addWidget("number","Y",this.properties.y,"y");this.addWidget("number","Z",this.properties.z,"z");this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("Vector",
"vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+106]}VectorNode.title="Vector";VectorNode.title_color=NodesHelper.titles.vector;VectorNode.collapsable=!0;VectorNode.prototype.resizable=!1;VectorNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;VectorNode.prototype.onAction=function(){this.createVector()};
VectorNode.prototype.onStart=function(){this.isInputConnected(0)||this.createVector()};VectorNode.prototype.createVector=function(){var c=this.getInputData(1),h=this.getInputData(2),n=this.getInputData(3);void 0===c&&(c=this.properties.x);void 0===h&&(h=this.properties.y);void 0===n&&(n=this.properties.z);c=new THREE.Vector3(c,h,n);this.setOutputData(2,c);this.triggerSlot(0,c);this.triggerSlot(1)};
function VectorThreeToTwoNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Vector","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Vector","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}VectorThreeToTwoNode.title="Vector3 To Vector2";VectorThreeToTwoNode.title_color=NodesHelper.titles.vector;VectorThreeToTwoNode.collapsable=!0;VectorThreeToTwoNode.prototype.resizable=!1;VectorThreeToTwoNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
VectorThreeToTwoNode.prototype.onAction=function(c,h){c=this.getInputData(1);void 0===c&&void 0!==h&&h instanceof THREE.Vector3&&(c=h);h=new THREE.Vector2(c.x,c.y);this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function VectorAddNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Vector 1","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Vector 2","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("Out","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+18]}VectorAddNode.title="Add";VectorAddNode.title_color=NodesHelper.titles.vector;
VectorAddNode.collapsable=!0;VectorAddNode.prototype.resizable=!1;VectorAddNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;VectorAddNode.prototype.onAction=function(c,h){c=this.getInputData(1);h=this.getInputData(2);void 0===c||void 0===h?console.log("An undefined parameter: ",c,h):(c=c.add(h),this.setOutputData(2,c),this.triggerSlot(0,c),this.triggerSlot(1))};
function registerVectorNode(){LiteGraph.registerNodeType("Math/Vector/Vector",VectorNode);LiteGraph.registerNodeType("Math/Vector/VectorThreeToTwo",VectorThreeToTwoNode);LiteGraph.registerNodeType("Math/Vector/VectorAdd",VectorAddNode)}function registerEulerNodes(){}
function ANode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}ANode.title="A";ANode.title_color=NodesHelper.titles.input;ANode.collapsable=!0;ANode.blocks="Blocks";ANode.prototype.resizable=!1;ANode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ANode.prototype.onStart=function(){this.setOutputData(3,Keyboard.A)};
ANode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.A)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.A)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.A)&&this.triggerSlot(2,"Released")};
function AltNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}AltNode.title="Alt";AltNode.title_color=NodesHelper.titles.input;AltNode.collapsable=!0;AltNode.blocks="Blocks";AltNode.prototype.resizable=!1;AltNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;AltNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.ALT)};
AltNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.ALT)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.ALT)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.ALT)&&this.triggerSlot(2,"Released")};
function BNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}BNode.title="B";BNode.title_color=NodesHelper.titles.input;BNode.collapsable=!0;BNode.blocks="Blocks";BNode.prototype.resizable=!1;BNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;BNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.B)};
BNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.B)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.B)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.B)&&this.triggerSlot(2,"Released")};
function BackspaceNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}BackspaceNode.title="Backspace";BackspaceNode.title_color=NodesHelper.titles.input;BackspaceNode.collapsable=!0;BackspaceNode.blocks="Blocks";BackspaceNode.prototype.resizable=!1;BackspaceNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
BackspaceNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.BACKSPACE)};BackspaceNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.BACKSPACE)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.BACKSPACE)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.BACKSPACE)&&this.triggerSlot(2,"Released")};
function CNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}CNode.title="C";CNode.title_color=NodesHelper.titles.input;CNode.collapsable=!0;CNode.blocks="Blocks";CNode.prototype.resizable=!1;CNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;CNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.C)};
CNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.C)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.C)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.C)&&this.triggerSlot(2,"Released")};
function CapsLockNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}CapsLockNode.title="CapsLock";CapsLockNode.title_color=NodesHelper.titles.input;CapsLockNode.collapsable=!0;CapsLockNode.blocks="Blocks";CapsLockNode.prototype.resizable=!1;CapsLockNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
CapsLockNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.CAPS_LOCK)};CapsLockNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.CAPS_LOCK)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.CAPS_LOCK)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.CAPS_LOCK)&&this.triggerSlot(2,"Released")};
function CtrlNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}CtrlNode.title="Ctrl";CtrlNode.title_color=NodesHelper.titles.input;CtrlNode.collapsable=!0;CtrlNode.blocks="Blocks";CtrlNode.prototype.resizable=!1;CtrlNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;CtrlNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.CTRL)};
CtrlNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.CTRL)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.CTRL)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.CTRL)&&this.triggerSlot(2,"Released")};
function DNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}DNode.title="D";DNode.title_color=NodesHelper.titles.input;DNode.collapsable=!0;DNode.blocks="Blocks";DNode.prototype.resizable=!1;DNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;DNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.D)};
DNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.D)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.D)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.D)&&this.triggerSlot(2,"Released")};
function DelNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}DelNode.title="Del";DelNode.title_color=NodesHelper.titles.input;DelNode.collapsable=!0;DelNode.blocks="Blocks";DelNode.prototype.resizable=!1;DelNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;DelNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.DEL)};
DelNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.DEL)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.DEL)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.DEL)&&this.triggerSlot(2,"Released")};
function DownNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}DownNode.title="Down";DownNode.title_color=NodesHelper.titles.input;DownNode.collapsable=!0;DownNode.blocks="Blocks";DownNode.prototype.resizable=!1;DownNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;DownNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.DOWN)};
DownNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.DOWN)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.DOWN)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.DOWN)&&this.triggerSlot(2,"Released")};
function ENode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}ENode.title="E";ENode.title_color=NodesHelper.titles.input;ENode.collapsable=!0;ENode.blocks="Blocks";ENode.prototype.resizable=!1;ENode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ENode.prototype.onStart=function(){this.setOutputData(3,Keyboard.E)};
ENode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.E)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.E)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.E)&&this.triggerSlot(2,"Released")};
function EndNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}EndNode.title="End";EndNode.title_color=NodesHelper.titles.input;EndNode.collapsable=!0;EndNode.blocks="Blocks";EndNode.prototype.resizable=!1;EndNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;EndNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.END)};
EndNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.END)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.END)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.END)&&this.triggerSlot(2,"Released")};
function EnterNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}EnterNode.title="Enter";EnterNode.title_color=NodesHelper.titles.input;EnterNode.collapsable=!0;EnterNode.blocks="Blocks";EnterNode.prototype.resizable=!1;EnterNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;EnterNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.ENTER)};
EnterNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.ENTER)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.ENTER)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.ENTER)&&this.triggerSlot(2,"Released")};
function EscNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}EscNode.title="Esc";EscNode.title_color=NodesHelper.titles.input;EscNode.collapsable=!0;EscNode.blocks="Blocks";EscNode.prototype.resizable=!1;EscNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;EscNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.ESC)};
EscNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.ESC)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.ESC)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.ESC)&&this.triggerSlot(2,"Released")};
function FNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}FNode.title="F";FNode.title_color=NodesHelper.titles.input;FNode.collapsable=!0;FNode.blocks="Blocks";FNode.prototype.resizable=!1;FNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;FNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.F)};
FNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F)&&this.triggerSlot(2,"Released")};
function F1Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F1Node.title="F1";F1Node.title_color=NodesHelper.titles.input;F1Node.collapsable=!0;F1Node.blocks="Blocks";F1Node.prototype.resizable=!1;F1Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F1Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F1)};
F1Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F1)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F1)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F1)&&this.triggerSlot(2,"Released")};
function F2Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F2Node.title="F2";F2Node.title_color=NodesHelper.titles.input;F2Node.collapsable=!0;F2Node.blocks="Blocks";F2Node.prototype.resizable=!1;F2Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F2Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F2)};
F2Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F2)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F2)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F2)&&this.triggerSlot(2,"Released")};
function F3Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F3Node.title="F3";F3Node.title_color=NodesHelper.titles.input;F3Node.collapsable=!0;F3Node.blocks="Blocks";F3Node.prototype.resizable=!1;F3Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F3Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F3)};
F3Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F3)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F3)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F3)&&this.triggerSlot(2,"Released")};
function F4Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F4Node.title="F4";F4Node.title_color=NodesHelper.titles.input;F4Node.collapsable=!0;F4Node.blocks="Blocks";F4Node.prototype.resizable=!1;F4Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F4Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F4)};
F4Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F4)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F4)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F4)&&this.triggerSlot(2,"Released")};
function F5Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F5Node.title="F5";F5Node.title_color=NodesHelper.titles.input;F5Node.collapsable=!0;F5Node.blocks="Blocks";F5Node.prototype.resizable=!1;F5Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F5Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F5)};
F5Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F5)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F5)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F5)&&this.triggerSlot(2,"Released")};
function F6Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F6Node.title="F6";F6Node.title_color=NodesHelper.titles.input;F6Node.collapsable=!0;F6Node.blocks="Blocks";F6Node.prototype.resizable=!1;F6Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F6Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F6)};
F6Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F6)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F6)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F6)&&this.triggerSlot(2,"Released")};
function F7Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F7Node.title="F7";F7Node.title_color=NodesHelper.titles.input;F7Node.collapsable=!0;F7Node.blocks="Blocks";F7Node.prototype.resizable=!1;F7Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F7Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F7)};
F7Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F7)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F7)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F7)&&this.triggerSlot(2,"Released")};
function F8Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F8Node.title="F8";F8Node.title_color=NodesHelper.titles.input;F8Node.collapsable=!0;F8Node.blocks="Blocks";F8Node.prototype.resizable=!1;F8Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F8Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F8)};
F8Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F8)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F8)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F8)&&this.triggerSlot(2,"Released")};
function F9Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F9Node.title="F9";F9Node.title_color=NodesHelper.titles.input;F9Node.collapsable=!0;F9Node.blocks="Blocks";F9Node.prototype.resizable=!1;F9Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F9Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F9)};
F9Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F9)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F9)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F9)&&this.triggerSlot(2,"Released")};
function F10Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F10Node.title="F10";F10Node.title_color=NodesHelper.titles.input;F10Node.collapsable=!0;F10Node.blocks="Blocks";F10Node.prototype.resizable=!1;F10Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F10Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F10)};
F10Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F10)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F10)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F10)&&this.triggerSlot(2,"Released")};
function F11Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F11Node.title="F11";F11Node.title_color=NodesHelper.titles.input;F11Node.collapsable=!0;F11Node.blocks="Blocks";F11Node.prototype.resizable=!1;F11Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F11Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F11)};
F11Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F11)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F11)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F11)&&this.triggerSlot(2,"Released")};
function F12Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F12Node.title="F12";F12Node.title_color=NodesHelper.titles.input;F12Node.collapsable=!0;F12Node.blocks="Blocks";F12Node.prototype.resizable=!1;F12Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F12Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F12)};
F12Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F12)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F12)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F12)&&this.triggerSlot(2,"Released")};
function GNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}GNode.title="G";GNode.title_color=NodesHelper.titles.input;GNode.collapsable=!0;GNode.blocks="Blocks";GNode.prototype.resizable=!1;GNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;GNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.G)};
GNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.G)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.G)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.G)&&this.triggerSlot(2,"Released")};
function HNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}HNode.title="H";HNode.title_color=NodesHelper.titles.input;HNode.collapsable=!0;HNode.blocks="Blocks";HNode.prototype.resizable=!1;HNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;HNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.H)};
HNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.H)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.H)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.H)&&this.triggerSlot(2,"Released")};
function HomeNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}HomeNode.title="Home";HomeNode.title_color=NodesHelper.titles.input;HomeNode.collapsable=!0;HomeNode.blocks="Blocks";HomeNode.prototype.resizable=!1;HomeNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;HomeNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.HOME)};
HomeNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.HOME)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.HOME)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.HOME)&&this.triggerSlot(2,"Released")};
function INode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}INode.title="I";INode.title_color=NodesHelper.titles.input;INode.collapsable=!0;INode.blocks="Blocks";INode.prototype.resizable=!1;INode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;INode.prototype.onStart=function(){this.setOutputData(3,Keyboard.I)};
INode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.I)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.I)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.I)&&this.triggerSlot(2,"Released")};
function InsertNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}InsertNode.title="Insert";InsertNode.title_color=NodesHelper.titles.input;InsertNode.collapsable=!0;InsertNode.blocks="Blocks";InsertNode.prototype.resizable=!1;InsertNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;InsertNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.INSERT)};
InsertNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.INSERT)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.INSERT)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.INSERT)&&this.triggerSlot(2,"Released")};
function JNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}JNode.title="J";JNode.title_color=NodesHelper.titles.input;JNode.collapsable=!0;JNode.blocks="Blocks";JNode.prototype.resizable=!1;JNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;JNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.J)};
JNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.J)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.J)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.J)&&this.triggerSlot(2,"Released")};
function KNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}KNode.title="K";KNode.title_color=NodesHelper.titles.input;KNode.collapsable=!0;KNode.blocks="Blocks";KNode.prototype.resizable=!1;KNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;KNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.K)};
KNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.K)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.K)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.K)&&this.triggerSlot(2,"Released")};
function LNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}LNode.title="L";LNode.title_color=NodesHelper.titles.input;LNode.collapsable=!0;LNode.blocks="Blocks";LNode.prototype.resizable=!1;LNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;LNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.L)};
LNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.L)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.L)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.L)&&this.triggerSlot(2,"Released")};
function LeftNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}LeftNode.title="Left";LeftNode.title_color=NodesHelper.titles.input;LeftNode.collapsable=!0;LeftNode.blocks="Blocks";LeftNode.prototype.resizable=!1;LeftNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;LeftNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.LEFT)};
LeftNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.LEFT)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.LEFT)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.LEFT)&&this.triggerSlot(2,"Released")};
function MNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}MNode.title="M";MNode.title_color=NodesHelper.titles.input;MNode.collapsable=!0;MNode.blocks="Blocks";MNode.prototype.resizable=!1;MNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;MNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.M)};
MNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.M)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.M)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.M)&&this.triggerSlot(2,"Released")};
function NNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}NNode.title="N";NNode.title_color=NodesHelper.titles.input;NNode.collapsable=!0;NNode.blocks="Blocks";NNode.prototype.resizable=!1;NNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;NNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.N)};
NNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.N)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.N)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.N)&&this.triggerSlot(2,"Released")};
function ONode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}ONode.title="O";ONode.title_color=NodesHelper.titles.input;ONode.collapsable=!0;ONode.blocks="Blocks";ONode.prototype.resizable=!1;ONode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ONode.prototype.onStart=function(){this.setOutputData(3,Keyboard.O)};
ONode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.O)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.O)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.O)&&this.triggerSlot(2,"Released")};
function PNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}PNode.title="P";PNode.title_color=NodesHelper.titles.input;PNode.collapsable=!0;PNode.blocks="Blocks";PNode.prototype.resizable=!1;PNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;PNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.P)};
PNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.P)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.P)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.P)&&this.triggerSlot(2,"Released")};
function PageUpNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}PageUpNode.title="PageUp";PageUpNode.title_color=NodesHelper.titles.input;PageUpNode.collapsable=!0;PageUpNode.blocks="Blocks";PageUpNode.prototype.resizable=!1;PageUpNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;PageUpNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.PAGE_UP)};
PageUpNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.PAGE_UP)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.PAGE_UP)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.PAGE_UP)&&this.triggerSlot(2,"Released")};
function PageDownNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}PageDownNode.title="PageDown";PageDownNode.title_color=NodesHelper.titles.input;PageDownNode.collapsable=!0;PageDownNode.blocks="Blocks";PageDownNode.prototype.resizable=!1;PageDownNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
PageDownNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.PAGE_DOWN)};PageDownNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.PAGE_DOWN)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.PAGE_DOWN)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.PAGE_DOWN)&&this.triggerSlot(2,"Released")};
function QNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}QNode.title="Q";QNode.title_color=NodesHelper.titles.input;QNode.collapsable=!0;QNode.blocks="Blocks";QNode.prototype.resizable=!1;QNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;QNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.Q)};
QNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.Q)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.Q)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.Q)&&this.triggerSlot(2,"Released")};
function RNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}RNode.title="R";RNode.title_color=NodesHelper.titles.input;RNode.collapsable=!0;RNode.blocks="Blocks";RNode.prototype.resizable=!1;RNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;RNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.R)};
RNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.R)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.R)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.R)&&this.triggerSlot(2,"Released")};
function RightNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}RightNode.title="Right";RightNode.title_color=NodesHelper.titles.input;RightNode.collapsable=!0;RightNode.blocks="Blocks";RightNode.prototype.resizable=!1;RightNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;RightNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.RIGHT)};
RightNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.RIGHT)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.RIGHT)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.RIGHT)&&this.triggerSlot(2,"Released")};
function SNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}SNode.title="S";SNode.title_color=NodesHelper.titles.input;SNode.collapsable=!0;SNode.blocks="Blocks";SNode.prototype.resizable=!1;SNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;SNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.S)};
SNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.S)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.S)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.S)&&this.triggerSlot(2,"Released")};
function ShiftNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}ShiftNode.title="Shift";ShiftNode.title_color=NodesHelper.titles.input;ShiftNode.collapsable=!0;ShiftNode.blocks="Blocks";ShiftNode.prototype.resizable=!1;ShiftNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ShiftNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.SHIFT)};
ShiftNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.SHIFT)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.SHIFT)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.SHIFT)&&this.triggerSlot(2,"Released")};
function SpacebarNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}SpacebarNode.title="Spacebar";SpacebarNode.title_color=NodesHelper.titles.input;SpacebarNode.collapsable=!0;SpacebarNode.blocks="Blocks";SpacebarNode.prototype.resizable=!1;SpacebarNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SpacebarNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.SPACEBAR)};SpacebarNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.SPACEBAR)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.SPACEBAR)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.SPACEBAR)&&this.triggerSlot(2,"Released")};
function TNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}TNode.title="T";TNode.title_color=NodesHelper.titles.input;TNode.collapsable=!0;TNode.blocks="Blocks";TNode.prototype.resizable=!1;TNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;TNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.T)};
TNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.T)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.T)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.T)&&this.triggerSlot(2,"Released")};
function TabNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}TabNode.title="Tab";TabNode.title_color=NodesHelper.titles.input;TabNode.collapsable=!0;TabNode.blocks="Blocks";TabNode.prototype.resizable=!1;TabNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;TabNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.TAB)};
TabNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.TAB)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.TAB)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.TAB)&&this.triggerSlot(2,"Released")};
function UNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}UNode.title="U";UNode.title_color=NodesHelper.titles.input;UNode.collapsable=!0;UNode.blocks="Blocks";UNode.prototype.resizable=!1;UNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;UNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.U)};
UNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.U)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.U)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.U)&&this.triggerSlot(2,"Released")};
function UpNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}UpNode.title="Up";UpNode.title_color=NodesHelper.titles.input;UpNode.collapsable=!0;UpNode.blocks="Blocks";UpNode.prototype.resizable=!1;UpNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;UpNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.UP)};
UpNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.UP)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.UP)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.UP)&&this.triggerSlot(2,"Released")};
function VNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}VNode.title="V";VNode.title_color=NodesHelper.titles.input;VNode.collapsable=!0;VNode.blocks="Blocks";VNode.prototype.resizable=!1;VNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;VNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.V)};
VNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.V)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.V)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.V)&&this.triggerSlot(2,"Released")};
function WNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}WNode.title="W";WNode.title_color=NodesHelper.titles.input;WNode.collapsable=!0;WNode.blocks="Blocks";WNode.prototype.resizable=!1;WNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;WNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.W)};
WNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.W)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.W)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.W)&&this.triggerSlot(2,"Released")};
function XNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}XNode.title="X";XNode.title_color=NodesHelper.titles.input;XNode.collapsable=!0;XNode.blocks="Blocks";XNode.prototype.resizable=!1;XNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;XNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.X)};
XNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.X)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.X)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.X)&&this.triggerSlot(2,"Released")};
function YNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}YNode.title="Y";YNode.title_color=NodesHelper.titles.input;YNode.collapsable=!0;YNode.blocks="Blocks";YNode.prototype.resizable=!1;YNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;YNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.Y)};
YNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.Y)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.Y)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.Y)&&this.triggerSlot(2,"Released")};
function ZNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}ZNode.title="Z";ZNode.title_color=NodesHelper.titles.input;ZNode.collapsable=!0;ZNode.blocks="Blocks";ZNode.prototype.resizable=!1;ZNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ZNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.Z)};
ZNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.Z)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.Z)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.Z)&&this.triggerSlot(2,"Released")};
function registerKeyboardNodes(){LiteGraph.registerNodeType("Input/Keyboard/A",ANode);LiteGraph.registerNodeType("Input/Keyboard/Alt",AltNode);LiteGraph.registerNodeType("Input/Keyboard/B",BNode);LiteGraph.registerNodeType("Input/Keyboard/Backspace",BackspaceNode);LiteGraph.registerNodeType("Input/Keyboard/C",CNode);LiteGraph.registerNodeType("Input/Keyboard/CapsLock",CapsLockNode);LiteGraph.registerNodeType("Input/Keyboard/Ctrl",CtrlNode);LiteGraph.registerNodeType("Input/Keyboard/D",DNode);LiteGraph.registerNodeType("Input/Keyboard/Del",
DelNode);LiteGraph.registerNodeType("Input/Keyboard/Down",DownNode);LiteGraph.registerNodeType("Input/Keyboard/E",ENode);LiteGraph.registerNodeType("Input/Keyboard/End",EndNode);LiteGraph.registerNodeType("Input/Keyboard/Enter",EnterNode);LiteGraph.registerNodeType("Input/Keyboard/Esc",EscNode);LiteGraph.registerNodeType("Input/Keyboard/F",FNode);LiteGraph.registerNodeType("Input/Keyboard/F1",F1Node);LiteGraph.registerNodeType("Input/Keyboard/F2",F2Node);LiteGraph.registerNodeType("Input/Keyboard/F3",
F3Node);LiteGraph.registerNodeType("Input/Keyboard/F4",F4Node);LiteGraph.registerNodeType("Input/Keyboard/F5",F5Node);LiteGraph.registerNodeType("Input/Keyboard/F6",F6Node);LiteGraph.registerNodeType("Input/Keyboard/F7",F7Node);LiteGraph.registerNodeType("Input/Keyboard/F8",F8Node);LiteGraph.registerNodeType("Input/Keyboard/F9",F9Node);LiteGraph.registerNodeType("Input/Keyboard/F10",F10Node);LiteGraph.registerNodeType("Input/Keyboard/F11",F11Node);LiteGraph.registerNodeType("Input/Keyboard/F12",F12Node);
LiteGraph.registerNodeType("Input/Keyboard/G",GNode);LiteGraph.registerNodeType("Input/Keyboard/H",HNode);LiteGraph.registerNodeType("Input/Keyboard/Home",HomeNode);LiteGraph.registerNodeType("Input/Keyboard/I",INode);LiteGraph.registerNodeType("Input/Keyboard/Insert",InsertNode);LiteGraph.registerNodeType("Input/Keyboard/J",JNode);LiteGraph.registerNodeType("Input/Keyboard/K",KNode);LiteGraph.registerNodeType("Input/Keyboard/L",LNode);LiteGraph.registerNodeType("Input/Keyboard/Left",LeftNode);LiteGraph.registerNodeType("Input/Keyboard/M",
MNode);LiteGraph.registerNodeType("Input/Keyboard/N",NNode);LiteGraph.registerNodeType("Input/Keyboard/O",ONode);LiteGraph.registerNodeType("Input/Keyboard/P",PNode);LiteGraph.registerNodeType("Input/Keyboard/PageUp",PageUpNode);LiteGraph.registerNodeType("Input/Keyboard/PageDown",PageDownNode);LiteGraph.registerNodeType("Input/Keyboard/Q",QNode);LiteGraph.registerNodeType("Input/Keyboard/R",RNode);LiteGraph.registerNodeType("Input/Keyboard/Right",RightNode);LiteGraph.registerNodeType("Input/Keyboard/S",
SNode);LiteGraph.registerNodeType("Input/Keyboard/Shift",ShiftNode);LiteGraph.registerNodeType("Input/Keyboard/Spacebar",SpacebarNode);LiteGraph.registerNodeType("Input/Keyboard/T",TNode);LiteGraph.registerNodeType("Input/Keyboard/Tab",TabNode);LiteGraph.registerNodeType("Input/Keyboard/U",UNode);LiteGraph.registerNodeType("Input/Keyboard/Up",UpNode);LiteGraph.registerNodeType("Input/Keyboard/V",VNode);LiteGraph.registerNodeType("Input/Keyboard/W",WNode);LiteGraph.registerNodeType("Input/Keyboard/X",
XNode);LiteGraph.registerNodeType("Input/Keyboard/Y",YNode);LiteGraph.registerNodeType("Input/Keyboard/Z",ZNode)}
function MaterialNode(){this.addInput("Colour","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Emissive","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Reflectivity","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addInput("Shininess","number",
Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_fourth]}));this.addInput("Specular","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_fifth]}));this.addInput("Wireframe","bool",Object.assign({},NodesHelper.slots.bool,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_sixth]}));this.addInput("Transparent","bool",Object.assign({},NodesHelper.slots.bool,{pos:[NodesHelper.slots.position.x,
NodesHelper.slots.position.y_seventh]}));this.addInput("Opacity","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_eighth]}));this.addInput("Affected By Fog","bool",Object.assign({},NodesHelper.slots.bool,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_ninth]}));this.serialize_widgets=!0;this.properties={reflectivity:1,shininess:30,wireframe:!1,depthwrite:!1,transparent:!1,opacity:1,abf:!0};var c=this;this.widget1=this.addWidget("slider",
"Reflectivity",this.properties.reflectivity,h=>{c.properties.reflectivity=h},{value:this.properties.reflectivity,min:0,max:1,text:"R"});this.widget2=this.addWidget("slider","Shininess",this.properties.shininess,h=>{c.properties.shininess=h},{value:this.properties.shininess,min:0,max:100,text:"S"});this.addWidget("toggle","Wireframe",this.properties.wireframe,"wireframe");this.addWidget("toggle","Depth Write",this.properties.depthwrite,"depthwrite");this.addWidget("toggle","Transparent",this.properties.transparent,
"transparent");this.widget3=this.addWidget("slider","Opacity",this.properties.opacity,h=>{c.properties.opacity=h},{value:this.properties.opacity,min:0,max:1});this.addWidget("toggle","Affected By Fog",this.properties.abf,"abf")}MaterialNode.title="Material";MaterialNode.title_color=NodesHelper.titles.material;MaterialNode.collapsable=!1;MaterialNode.skip_list=!0;MaterialNode.prototype.resizable=!1;
MaterialNode.prototype.onPropertyChanged=function(c,h){if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange();"reflectivity"===c?void 0!==this.widget1&&(this.widget1.value=h):"shininess"===c?void 0!==this.widget2&&(this.widget2.value=h):"opacity"===c&&void 0!==this.widget3&&(this.widget3.value=h)};
MaterialNode.prototype.onExecute=function(){if(void 0!==this.graph.extra){var c=this.graph.extra.material;c.nodes}if(void 0!==c){var h=this.getInputData(0),n=this.getInputData(1),f=this.getInputData(2),q=this.getInputData(3),l=this.getInputData(4),k=this.getInputData(5),u=this.getInputData(6),r=this.getInputData(7),z=this.getInputData(8),C=this.getInputData(9);void 0!==h&&(c.color=h);void 0!==n&&(c.emissive=n);c.reflectivity=void 0!==f?f:this.properties.reflectivity;c.shininess=void 0!==q?q:this.properties.shininess;
void 0!==l&&(c.specular=l);c.wireframe=void 0!==k?k:this.properties.wireframe;c.depthWrite=void 0!==u?u:this.properties.depthwrite;c.transparent=void 0!==r?r:this.properties.transparent;c.opacity=void 0!==z?z:this.properties.opacity;c.fog=void 0!==C?C:this.properties.abf}};function MaterialSideNode(){this.serialize_widgets=!0;this.properties={side:THREE.FontSide,sides:"Front;Back;Double",sideStr:""};this.side="";this.sides=this.properties.sides.split(";")}MaterialSideNode.title="Side";
MaterialSideNode.title_color=NodesHelper.titles.material;MaterialSideNode.collapsable=!0;MaterialSideNode.prototype.resizable=!1;
MaterialSideNode.prototype.onAdded=function(){var c=this;this.properties.side=this.graph.extra.material.side;this.properties.side===THREE.FrontSide?this.side="Front":this.properties.side===THREE.BackSide?this.side="Back":this.properties.side===THREE.DoubleSide&&(this.side="Double");this.combo=this.addWidget("combo","Side",this.side,h=>{c.properties.sideStr=h},{values:this.sides,property:"sideStr"});this.combo.width=160;this.size=[160,30]};
MaterialSideNode.prototype.onPropertyChanged=function(c,h){var n=this.graph.extra.material;"sideStr"===c&&("Front"===h?n.side=THREE.FrontSide:"Back"===h?n.side=THREE.BackSide:"Double"===h&&(n.side=THREE.DoubleSide));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialDepthTestNode(){this.serialize_widgets=!0;this.properties={test:!1}}MaterialDepthTestNode.title="Depth Test";MaterialDepthTestNode.title_color=NodesHelper.titles.material;
MaterialDepthTestNode.collapsable=!0;MaterialDepthTestNode.prototype.resizable=!1;MaterialDepthTestNode.prototype.onAdded=function(){this.properties.test=this.graph.extra.material.depthTest;this.addWidget("toggle","Depth Test",this.properties.test,"test").width=160;this.size=[160,30]};MaterialDepthTestNode.prototype.onPropertyChanged=function(c,h){this.graph.extra.material.depthTest=h;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialAlphaTestNode(){this.serialize_widgets=!0;this.properties={test:!1}}MaterialAlphaTestNode.title="Alpha Test";MaterialAlphaTestNode.title_color=NodesHelper.titles.material;MaterialAlphaTestNode.collapsable=!0;MaterialAlphaTestNode.prototype.resizable=!1;MaterialAlphaTestNode.prototype.onAdded=function(){this.properties.test=this.graph.extra.material.alphaTest;this.addWidget("toggle","Alpha Test",this.properties.test,"test").width=160;this.size=[160,30]};
MaterialAlphaTestNode.prototype.onPropertyChanged=function(c,h){this.graph.extra.material.alphaTest=h;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialBlendingModeNode(){this.serialize_widgets=!0;this.properties={blending:THREE.NoBlending,modes:"None;Normal;Additive;Subtractive;Multiply",blendingStr:""};this.blending="";this.modes=this.properties.modes.split(";")}MaterialBlendingModeNode.title="Blending Mode";
MaterialBlendingModeNode.title_color=NodesHelper.titles.material;MaterialBlendingModeNode.collapsable=!0;MaterialBlendingModeNode.prototype.resizable=!1;
MaterialBlendingModeNode.prototype.onAdded=function(){var c=this;this.properties.blending=this.graph.extra.material.blending;this.properties.blending===THREE.NoBlending?this.blending="None":this.properties.blending===THREE.NormalBlending?this.blending="Normal":this.properties.blending===THREE.AdditiveBlending?this.blending="Additive":this.properties.blending===THREE.SubtractiveBlending?this.blending="Subtractive":this.properties.blending===THREE.MultiplyBlending&&(this.blending="Multiply");this.combo=
this.addWidget("combo","Blending",this.blending,h=>{c.properties.blendingStr=h},{values:this.modes,property:"blendingStr"});this.combo.width=200;this.size=[200,30]};
MaterialBlendingModeNode.prototype.onPropertyChanged=function(c,h){var n=this.graph.extra.material;"blendingStr"===c&&("None"===h?n.blending=THREE.NoBlending:"Normal"===h?n.blending=THREE.NormalBlending:"Additive"===h?n.blending=THREE.AdditiveBlending:"Subtractive"===h?n.blending=THREE.SubtractiveBlending:"Multiply"===h&&(n.blending=THREE.MultiplyBlending));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialSkinningNode(){this.serialize_widgets=!0;this.properties={skinning:!1}}MaterialSkinningNode.title="Skinning";MaterialSkinningNode.title_color=NodesHelper.titles.material;MaterialSkinningNode.collapsable=!0;MaterialSkinningNode.prototype.resizable=!1;MaterialSkinningNode.prototype.onAdded=function(){this.properties.skinning=this.graph.extra.material.skinning;this.addWidget("toggle","Skinning",this.properties.skinning,"skinning").width=160;this.size=[160,30]};
MaterialSkinningNode.prototype.onPropertyChanged=function(){if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialMorphTargetsNode(){this.serialize_widgets=!0;this.properties={morphTargets:!1}}MaterialMorphTargetsNode.title="Morph Targets";MaterialMorphTargetsNode.title_color=NodesHelper.titles.material;MaterialMorphTargetsNode.collapsable=!0;MaterialMorphTargetsNode.prototype.resizable=!1;
MaterialMorphTargetsNode.prototype.onAdded=function(){this.properties.morphTargets=this.graph.extra.material.morphTargets;this.addWidget("toggle","Morph Targets",this.properties.morphTargets,"morphTargets").width=180;this.size=[180,30]};MaterialMorphTargetsNode.prototype.onPropertyChanged=function(){if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialColourNode(){this.addInput("Colour","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.size=[120,26]}MaterialColourNode.title="Colour";MaterialColourNode.title_color=NodesHelper.titles.material;MaterialColourNode.collapsable=!0;MaterialColourNode.prototype.resizable=!1;MaterialColourNode.prototype.onAdded=function(){this.mat=this.graph.extra.material};
MaterialColourNode.prototype.onExecute=function(){var c=this.getInputData(0);void 0!==c&&(this.mat.color=c)};function MaterialMapNode(){this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.size=[120,26]}MaterialMapNode.title="Map";MaterialMapNode.title_color=NodesHelper.titles.material;MaterialMapNode.collapsable=!0;MaterialMapNode.prototype.resizable=!1;
MaterialMapNode.prototype.onAdded=function(){this.mat=this.graph.extra.material};MaterialMapNode.prototype.onExecute=function(){var c=this.getInputData(0);void 0!==c&&(this.mat.map=c)};function MaterialAlphaMapNode(){this.addInput("Alpha","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.size=[120,26]}MaterialAlphaMapNode.title="Alpha Map";MaterialAlphaMapNode.title_color=NodesHelper.titles.material;
MaterialAlphaMapNode.collapsable=!0;MaterialAlphaMapNode.prototype.resizable=!1;MaterialAlphaMapNode.prototype.onAdded=function(){this.mat=this.graph.extra.material};MaterialAlphaMapNode.prototype.onExecute=function(){var c=this.getInputData(0);void 0!==c&&(this.mat.alphaMap=c)};
function MaterialShadingNode(){this.serialize_widgets=!0;this.properties={shading:THREE.SmoothShading,shadings:"Smooth;Flat",shadingStr:""};this.shading="";this.shadings=this.properties.shadings.split(";");this.serialize_widgets=!0}MaterialShadingNode.title="Shading";MaterialShadingNode.title_color=NodesHelper.titles.material;MaterialShadingNode.collapsable=!0;MaterialShadingNode.prototype.resizable=!1;
MaterialShadingNode.prototype.onAdded=function(){var c=this;this.properties.shading=this.graph.extra.material.shading;this.properties.shading===THREE.SmoothShading?this.shading="Smooth":this.properties.shading===THREE.FlatShading&&(this.shading="Flat");this.combo=this.addWidget("combo","Shading",this.shading,h=>{c.properties.shadingStr=h},{values:this.shadings,property:"shadingStr"});this.combo.width=180;this.size=[180,30]};
MaterialShadingNode.prototype.onPropertyChanged=function(c,h){var n=this.graph.extra.material;"shadingStr"===c&&("Smooth"===h?n.shading=THREE.SmoothShading:"Flat"===h&&(n.shading=THREE.FlatShading));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialBumpMapNode(){this.properties={scale:0};this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.serialize_widgets=!0}MaterialBumpMapNode.title="Bump";MaterialBumpMapNode.title_color=NodesHelper.titles.material;MaterialBumpMapNode.collapsable=!0;MaterialBumpMapNode.prototype.resizable=!1;
MaterialBumpMapNode.prototype.onAdded=function(){var c=this;this.material=this.graph.extra.material;this.properties.scale=void 0!==this.material.bumpScale?this.material.bumpScale:0;this.addWidget("slider","Scale",this.properties.scale,h=>{c.properties.scale=h},{min:0,max:1,property:"scale"})};MaterialBumpMapNode.prototype.onExecute=function(){var c=this.getInputData(0);void 0!==c&&(this.material.bumpMap=c)};
MaterialBumpMapNode.prototype.onPropertyChanged=function(){this.material.bumpScale=this.properties.scale;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialNormalNode(){this.properties={scalex:1,scaley:1};this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.serialize_widgets=!0}MaterialNormalNode.title="Normal";MaterialNormalNode.title_color=NodesHelper.titles.material;
MaterialNormalNode.collapsable=!0;MaterialNormalNode.prototype.resizable=!1;MaterialNormalNode.prototype.onAdded=function(){this.material=this.graph.extra.material;this.properties.scalex=this.material.normalScale.x;this.properties.scaley=this.material.normalScale.y;this.addWidget("number","Scale X",this.properties.scalex,"scalex");this.addWidget("number","Scale Y",this.properties.scaley,"scaley")};
MaterialNormalNode.prototype.onExecute=function(){var c=this.getInputData(0);void 0!==c&&(this.material.normalMap=c)};MaterialNormalNode.prototype.onPropertyChanged=function(){this.material.normalScale=new THREE.Vector2(this.properties.scalex,this.properties.scaley);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialDisplacementMapNode(){this.properties={scalex:0,bias:0};this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.serialize_widgets=!0}MaterialDisplacementMapNode.title="Displacement";MaterialDisplacementMapNode.title_color=NodesHelper.titles.material;MaterialDisplacementMapNode.collapsable=!0;MaterialDisplacementMapNode.prototype.resizable=!1;
MaterialDisplacementMapNode.prototype.onAdded=function(){this.material=this.graph.extra.material;this.properties.scale=void 0!==this.material.displacementScale?this.material.displacementScale:0;this.properties.bias=void 0!==this.material.displacementBias?this.material.displacementBias:0;this.addWidget("number","Scale",this.properties.scale,"scale");this.addWidget("number","Bias",this.properties.bias,"bias")};
MaterialDisplacementMapNode.prototype.onExecute=function(){var c=this.getInputData(0);void 0!==c&&(this.material.displacementMap=c)};MaterialDisplacementMapNode.prototype.onPropertyChanged=function(c,h){"scale"===c?this.material.displacementScale=new this.properties.scale:"bias"===c&&(this.material.displacementBias=this.properties.bias)};
function MaterialSpecularMapNode(){this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}))}MaterialSpecularMapNode.title="Specular";MaterialSpecularMapNode.title_color=NodesHelper.titles.material;MaterialSpecularMapNode.collapsable=!0;MaterialSpecularMapNode.prototype.resizable=!1;MaterialSpecularMapNode.prototype.onAdded=function(){this.material=this.graph.extra.material};
MaterialSpecularMapNode.prototype.onExecute=function(){var c=this.getInputData(0);void 0!==c&&(this.material.specularMap=c)};
function MaterialEmissiveMapNode(){this.properties={intensity:0};this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Colour","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.serialize_widgets=!0}MaterialEmissiveMapNode.title="Emissive";MaterialEmissiveMapNode.title_color=NodesHelper.titles.material;
MaterialEmissiveMapNode.collapsable=!0;MaterialEmissiveMapNode.prototype.resizable=!1;MaterialEmissiveMapNode.prototype.onAdded=function(){this.material=this.graph.extra.material;this.properties.intensity=void 0!==this.material.emissiveIntensity?this.material.emissiveIntensity:0;this.addWidget("number","Intensity",this.properties.intensity,"intensity")};
MaterialEmissiveMapNode.prototype.onExecute=function(){var c=this.getInputData(0),h=this.getInputData(1);void 0!==c&&(this.material.emissiveMap=c);void 0!==h&&this.material.emissive.copy(h)};MaterialEmissiveMapNode.prototype.onPropertyChanged=function(c,h){"intensity"===c&&(this.material.emissiveIntensity=h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialShaderNode(){this.properties={mat:null};this.addInput("Uniforms","json",Object.assign({},NodesHelper.slots.json,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}))}MaterialShaderNode.title="Shader";MaterialShaderNode.title_color=NodesHelper.titles.material;MaterialShaderNode.collapsable=!0;MaterialShaderNode.skip_list=!0;MaterialShaderNode.prototype.resizable=!1;
MaterialShaderNode.prototype.onDblClick=function(){var c=this.graph.extra.material,h=this.graph.extra.file;if(c instanceof THREE.ShaderMaterial){for(var n=!1,f=0;f<Interface.tab.options.length;f++)if(Interface.tab.options[f].component instanceof ShaderMaterialEditor&&Interface.tab.options[f].component.material===c){n=!0;Interface.tab.selectTab(f);break}n||(n=Interface.tab.addTab(c.name,Interface.file_dir+"Icons/Misc/material.png",!0),f=new ShaderMaterialEditor,f.attachMaterial(c,h),n.attachComponent(f),
n.select())}};
function registerMaterialNodes(){LiteGraph.registerNodeType("Material/Material",MaterialNode);LiteGraph.registerNodeType("Material/Shader",MaterialShaderNode);LiteGraph.registerNodeType("Material/Side",MaterialSideNode);LiteGraph.registerNodeType("Material/DepthTest",MaterialDepthTestNode);LiteGraph.registerNodeType("Material/AlphaTest",MaterialAlphaTestNode);LiteGraph.registerNodeType("Material/BlendingMode",MaterialBlendingModeNode);LiteGraph.registerNodeType("Material/Skinning",MaterialSkinningNode);LiteGraph.registerNodeType("Material/MorphTargets",
MaterialMorphTargetsNode);LiteGraph.registerNodeType("Material/Colour",MaterialColourNode);LiteGraph.registerNodeType("Material/Map",MaterialMapNode);LiteGraph.registerNodeType("Material/AlphaMap",MaterialAlphaMapNode);LiteGraph.registerNodeType("Material/Shading",MaterialShadingNode);LiteGraph.registerNodeType("Material/BumpMap",MaterialBumpMapNode);LiteGraph.registerNodeType("Material/NormalMap",MaterialNormalNode);LiteGraph.registerNodeType("Material/DisplacementMap",MaterialDisplacementMapNode);
LiteGraph.registerNodeType("Material/SpecularMap",MaterialSpecularMapNode);LiteGraph.registerNodeType("Material/EmissiveMap",MaterialEmissiveMapNode)}
function ParticlesNode(){this.addInput("Direction","string",Object.assign({},NodesHelper.slots.string,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Count","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Rate","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addInput("Duration","number",Object.assign({},
NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_fourth]}));this.addInput("Wiggle","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_fifth]}));this.serialize_widgets=!0;this.properties={direction:"Forward",directions:"Forward;Backward",count:2E3,rate:2E3,duration:0,wiggle:0}}ParticlesNode.title="Particles";ParticlesNode.title_color=NodesHelper.titles.particles;ParticlesNode.skip_list=!0;
ParticlesNode.collapsable=!1;ParticlesNode.prototype.resizable=!1;
ParticlesNode.prototype.onAdded=function(){var c=this,h=this.graph.extra.particles.emitter,n=this.graph.extra.particles.group;this.emitter=h;this.group=n;this.properties.direction=1===h.direction?"Forward":"Backward";this.properties.count=n.maxParticleCount;this.properties.rate=h.particleCount;this.properties.duration=h.duration;this.properties.wiggle=h.wiggle.value;this.dir=this.addWidget("combo","Direction",this.properties.direction,f=>{c.properties.direction=f},{property:"direction",values:this.properties.directions.split(";")});
this.count=this.addWidget("number","Max Count",this.properties.count,"count");this.rate=this.addWidget("slider","Rate",this.properties.rate,f=>{c.properties.rate=f},{value:this.properties.rate,min:0,max:this.properties.count,property:"rate"});this.duration=this.addWidget("number","Duration",this.properties.duration,"duration");this.wiggle=this.addWidget("number","Wiggle",this.properties.wiggle,"wiggle")};
ParticlesNode.prototype.onPropertyChanged=function(c,h){"direction"===c&&("Forward"===h?this.emitter.direction=1:"Backward"===h&&(this.emitter.direction=-1));"count"===c&&(this.group.maxParticleCount=parseInt(h),this.rate.options.max=parseInt(h),this.rate.value>parseInt(h)&&(this.emitter.particleCount=parseInt(h),this.rate.value=parseInt(h)));"rate"===c&&(this.emitter.particleCount=parseInt(h));"duration"===c&&(this.emitter.duration=.01>h?null:h);"wiggle"===c&&(this.emitter.wiggle.value=parseInt(h));
if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function ParticlesTextureNode(){this.serialize_widgets=!0;this.addInput("Texture","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.size=[120,26]}ParticlesTextureNode.title="Texture";ParticlesTextureNode.title_color=NodesHelper.titles.particles;ParticlesTextureNode.collapsable=!0;ParticlesTextureNode.prototype.resizable=!1;
ParticlesTextureNode.prototype.onAdded=function(){this.group=this.graph.extra.particles.group};ParticlesTextureNode.prototype.onExecute=function(){var c=this.getInputData(0);void 0!==c&&(this.group.texture=c)};function ParticlesBlendingModeNode(){this.serialize_widgets=!0;this.properties={blending:"NaN",modes:"None;Normal;Additive;Subtractive;Multiply"}}ParticlesBlendingModeNode.title="Blending";ParticlesBlendingModeNode.title_color=NodesHelper.titles.particles;
ParticlesBlendingModeNode.collapsable=!0;ParticlesBlendingModeNode.prototype.resizable=!1;
ParticlesBlendingModeNode.prototype.onAdded=function(){this.group=this.graph.extra.particles.group;this.blending=this.group.blending;var c="",h=this;this.blending===THREE.NoBlending?c="None":this.blending===THREE.NormalBlending?c="Normal":this.blending===THREE.AdditiveBlending?c="Additive":this.blending===THREE.SubtractiveBlending?c="Subtractive":this.blending===THREE.MultiplyBlending&&(c="Multiply");this.properties.blending=c;this.addWidget("combo","Blending",c,n=>{h.properties.blending=n},{property:"blending",
values:this.properties.modes.split(";"),width:200});this.size=[200,26]};ParticlesBlendingModeNode.prototype.onPropertyChanged=function(c,h){"blending"===c&&(console.log(h),"None"===h?this.group.blending=THREE.NoBlending:"Normal"===h?this.group.blending=THREE.NormalBlending:"Additive"===h?this.group.blending=THREE.AdditiveBlending:"Subtractive"===h?this.group.blending=THREE.SubtractiveBlending:"Multiply"===h&&(this.group.blending=THREE.MultiplyBlending));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesEmitterTypeNode(){this.serialize_widgets=!0;this.properties={type:"NaN",types:"Box;Sphere;Disc"}}ParticlesEmitterTypeNode.title="Emitter Type";ParticlesEmitterTypeNode.title_color=NodesHelper.titles.particles;ParticlesEmitterTypeNode.collapsable=!0;ParticlesEmitterTypeNode.prototype.resizable=!1;
ParticlesEmitterTypeNode.prototype.onAdded=function(){this.emitter=this.graph.extra.particles.emitter;var c="",h=this;this.emitter.type===SPE.distributions.BOX?c="Box":this.emitter.type===SPE.distributions.SPHERE?c="Sphere":this.emitter.type===SPE.distributions.DISC&&(c="Disc");this.properties.type=c;this.addWidget("combo","Type",c,n=>{h.properties.type=n},{property:"type",values:this.properties.types.split(";"),width:180});this.size=[180,26]};
ParticlesEmitterTypeNode.prototype.onPropertyChanged=function(c,h){"type"===c&&("Box"===h?this.emitter.type=SPE.distributions.BOX:"Sphere"===h?this.emitter.type=SPE.distributions.SPHERE:"Disc"===h&&(this.emitter.type=SPE.distributions.DISC));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function ParticlesMaxAgeNode(){this.serialize_widgets=!0;this.properties={value:0,spread:0}}ParticlesMaxAgeNode.title="Max Age";ParticlesMaxAgeNode.title_color=NodesHelper.titles.particles;
ParticlesMaxAgeNode.collapsable=!0;ParticlesMaxAgeNode.prototype.resizable=!1;ParticlesMaxAgeNode.prototype.onAdded=function(){this.maxAge=this.graph.extra.particles.emitter.maxAge;this.value=this.maxAge.value;this.spread=this.maxAge.spread;this.properties.value=this.value;this.properties.spread=this.spread;this.addWidget("number","Value",this.properties.value,"value");this.addWidget("number","Spread",this.properties.spread,"spread");this.size=[160,52]};
ParticlesMaxAgeNode.prototype.onPropertyChanged=function(c,h){"value"===c?this.value=h:"spread"===c&&(this.spread=h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function ParticlesPositionNode(){this.serialize_widgets=!0;this.properties={x:0,y:0,z:0,spreadx:0,spready:0,spreadz:0}}ParticlesPositionNode.title="Position";ParticlesPositionNode.title_color=NodesHelper.titles.particles;ParticlesPositionNode.collapsable=!0;
ParticlesPositionNode.prototype.resizable=!1;
ParticlesPositionNode.prototype.onAdded=function(){this.position=this.graph.extra.particles.emitter.position;this.value=this.position.value;this.spread=this.position.spread;this.addWidget("number","Value X",this.value.x,"x");this.addWidget("number","Value Y",this.value.y,"y");this.addWidget("number","Value Z",this.value.z,"z");this.addWidget("number","Spread X",this.spread.x,"spreadx");this.addWidget("number","Spread Y",this.spread.y,"spready");this.addWidget("number","Spread Z",this.spread.z,"spreadz");
this.size=[180,150]};ParticlesPositionNode.prototype.onPropertyChanged=function(c,h){if("x"===c||"y"===c||"z"===c)this.value.x=this.properties.x,this.value.y=this.properties.y,this.value.z=this.properties.z;else if("spreadx"===c||"spready"===c||"spreadz"===c)this.spread.x=this.properties.spreadx,this.spread.y=this.properties.spready,this.spread.z=this.properties.spreadz;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesVelocityNode(){this.serialize_widgets=!0;this.properties={x:0,y:0,z:0,spreadx:0,spready:0,spreadz:0}}ParticlesVelocityNode.title="Velocity";ParticlesVelocityNode.title_color=NodesHelper.titles.particles;ParticlesVelocityNode.collapsable=!0;ParticlesVelocityNode.prototype.resizable=!1;
ParticlesVelocityNode.prototype.onAdded=function(){this.velocity=this.graph.extra.particles.emitter.velocity;this.value=this.velocity.value;this.spread=this.velocity.spread;this.addWidget("number","Value X",this.value.x,"x");this.addWidget("number","Value Y",this.value.y,"y");this.addWidget("number","Value Z",this.value.z,"z");this.addWidget("number","Spread X",this.spread.x,"spreadx");this.addWidget("number","Spread Y",this.spread.y,"spready");this.addWidget("number","Spread Z",this.spread.z,"spreadz");
this.size=[180,150]};ParticlesVelocityNode.prototype.onPropertyChanged=function(c,h){if("x"===c||"y"===c||"z"===c)this.value.x=this.properties.x,this.value.y=this.properties.y,this.value.z=this.properties.z;else if("spreadx"===c||"spready"===c||"spreadz"===c)this.spread.x=this.properties.spreadx,this.spread.y=this.properties.spready,this.spread.z=this.properties.spreadz;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesAccelerationNode(){this.serialize_widgets=!0;this.properties={x:0,y:0,z:0,spreadx:0,spready:0,spreadz:0}}ParticlesAccelerationNode.title="Acceleration";ParticlesAccelerationNode.title_color=NodesHelper.titles.particles;ParticlesAccelerationNode.collapsable=!0;ParticlesAccelerationNode.prototype.resizable=!1;
ParticlesAccelerationNode.prototype.onAdded=function(){this.acceleration=this.graph.extra.particles.emitter.velocity;this.value=this.acceleration.value;this.spread=this.acceleration.spread;this.addWidget("number","Value X",this.value.x,"x");this.addWidget("number","Value Y",this.value.y,"y");this.addWidget("number","Value Z",this.value.z,"z");this.addWidget("number","Spread X",this.spread.x,"spreadx");this.addWidget("number","Spread Y",this.spread.y,"spready");this.addWidget("number","Spread Z",this.spread.z,
"spreadz");this.size=[180,150]};ParticlesAccelerationNode.prototype.onPropertyChanged=function(c,h){if("x"===c||"y"===c||"z"===c)this.value.x=this.properties.x,this.value.y=this.properties.y,this.value.z=this.properties.z;else if("spreadx"===c||"spready"===c||"spreadz"===c)this.spread.x=this.properties.spreadx,this.spread.y=this.properties.spready,this.spread.z=this.properties.spreadz;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesWiggleNode(){this.serialize_widgets=!0;this.properties={wiggle:0,spread:0}}ParticlesWiggleNode.title="Wiggle";ParticlesWiggleNode.title_color=NodesHelper.titles.particles;ParticlesWiggleNode.collapsable=!0;ParticlesWiggleNode.prototype.resizable=!1;
ParticlesWiggleNode.prototype.onAdded=function(){this.wiggle=this.graph.extra.particles.emitter.wiggle;this.value=this.wiggle.value;this.spread=this.wiggle.spread;this.addWidget("number","Value",this.value,"wiggle");this.addWidget("number","Spread",this.spread,"spread")};ParticlesWiggleNode.prototype.onPropertyChanged=function(c,h){"wiggle"===c?this.value=h:"spread"===c&&(this.spread=h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesOpacityNode(){this.addInput("Value","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Spread","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}))}ParticlesOpacityNode.title="Opacity";ParticlesOpacityNode.title_color=NodesHelper.titles.particles;ParticlesOpacityNode.collapsable=!0;ParticlesOpacityNode.prototype.resizable=!1;
ParticlesOpacityNode.prototype.onAdded=function(){this.opacity=this.graph.extra.particles.emitter.opacity};ParticlesOpacityNode.prototype.onExecute=function(){var c=this.getInputData(0),h=this.getInputData(1);void 0===c||4>c.length||(void 0!==h&&4<h.length&&(this.opacity.spread=h),this.opacity.value=c)};
function ParticlesScaleNode(){this.addInput("Value","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Spread","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}))}ParticlesScaleNode.title="Scale";ParticlesScaleNode.title_color=NodesHelper.titles.particles;ParticlesScaleNode.collapsable=!0;ParticlesScaleNode.prototype.resizable=!1;
ParticlesScaleNode.prototype.onAdded=function(){this.scale=this.graph.extra.particles.emitter.size};ParticlesScaleNode.prototype.onExecute=function(){var c=this.getInputData(0),h=this.getInputData(1);void 0===c||4>c.length||(void 0!==h&&4<h.length&&(this.scale.spread=h),this.scale.value=c)};
function ParticlesRotationNode(){this.addInput("Value","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Spread","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}))}ParticlesRotationNode.title="Rotation";ParticlesRotationNode.title_color=NodesHelper.titles.particles;ParticlesRotationNode.collapsable=!0;ParticlesRotationNode.prototype.resizable=!1;
ParticlesRotationNode.prototype.onAdded=function(){this.rotation=this.graph.extra.particles.emitter.angle};ParticlesRotationNode.prototype.onExecute=function(){var c=this.getInputData(0),h=this.getInputData(1);void 0===c||4>c.length||(void 0!==h&&4<h.length&&(this.rotation.spread=h),this.rotation.value=c)};
function ParticlesColourNode(){this.addInput("Value","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Spread","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}))}ParticlesColourNode.title="Colour";ParticlesColourNode.title_color=NodesHelper.titles.particles;ParticlesColourNode.collapsable=!0;ParticlesColourNode.prototype.resizable=!1;
ParticlesColourNode.prototype.onAdded=function(){this.colour=this.graph.extra.particles.emitter.color};ParticlesColourNode.prototype.onExecute=function(){var c=this.getInputData(0),h=this.getInputData(1);void 0===c||4>c.length||(void 0!==h&&4<h.length&&(this.colour.spread=h),this.colour.value=c)};
function registerParticlesNodes(){LiteGraph.registerNodeType("Particles/Particles",ParticlesNode);LiteGraph.registerNodeType("Particles/ParticlesTexture",ParticlesTextureNode);LiteGraph.registerNodeType("Particles/ParticlesBlending",ParticlesBlendingModeNode);LiteGraph.registerNodeType("Particles/ParticlesEmitterType",ParticlesEmitterTypeNode);LiteGraph.registerNodeType("Particles/ParticlesMaxAge",ParticlesMaxAgeNode);LiteGraph.registerNodeType("Particles/ParticlesPosition",ParticlesPositionNode);
LiteGraph.registerNodeType("Particles/ParticlesVelocity",ParticlesVelocityNode);LiteGraph.registerNodeType("Particles/ParticlesAcceleration",ParticlesAccelerationNode);LiteGraph.registerNodeType("Particles/ParticlesWiggle",ParticlesWiggleNode);LiteGraph.registerNodeType("Particles/ParticlesOpacity",ParticlesOpacityNode);LiteGraph.registerNodeType("Particles/ParticlesScale",ParticlesScaleNode);LiteGraph.registerNodeType("Particles/ParticlesRotation",ParticlesRotationNode);LiteGraph.registerNodeType("Particles/ParticlesColour",
ParticlesColourNode)}function FileSystem(){}try{FileSystem.fs=require("fs")}catch(c){}FileSystem.readFile=function(c,h,n){void 0===h&&(h=!0);if(void 0!==FileSystem.fs){if(h)return FileSystem.fs.readFileSync(c,"utf8");FileSystem.fs.readFile(c,"utf8",n)}else{var f=new XMLHttpRequest;f.overrideMimeType("text/plain");f.open("GET",c,!h);f.onreadystatechange=function(){200!==f.status&&0!==f.status||void 0===n||n(f.responseText)};f.send(null);return f.responseText}};
FileSystem.readFileArrayBuffer=function(c){if(void 0!==FileSystem.fs){c=FileSystem.fs.readFileSync(c);for(var h=c.length,n=new ArrayBuffer(h),f=new Uint8Array(n),q=0;q<h;q++)f[q]=c[q];return n}h=new XMLHttpRequest;h.open("GET",c,!1);h.overrideMimeType("text/plain; charset=x-user-defined");h.send(null);return ArraybufferUtils.fromBinaryString(h.response)};
FileSystem.readFileBase64=function(c){if(void 0!==FileSystem.fs)return c=FileSystem.fs.readFileSync(c),(new Buffer(c)).toString("base64");var h=new XMLHttpRequest;h.open("GET",c,!1);h.overrideMimeType("text/plain; charset=x-user-defined");h.send(null);return Base64Utils.fromBinaryString(h.response)};FileSystem.writeFile=function(c,h){void 0!==FileSystem.fs&&(c=FileSystem.fs.createWriteStream(c,"utf8"),c.write(h),c.end())};FileSystem.copyFile=function(c,h){void 0!==FileSystem.fs&&FileSystem.fs.createReadStream(c).pipe(FileSystem.fs.createWriteStream(h))};
FileSystem.makeDirectory=function(c){if(void 0!==FileSystem.fs)try{FileSystem.fs.mkdirSync(c)}catch(h){}};FileSystem.getFilesDirectory=function(c){if(void 0!==FileSystem.fs)try{return FileSystem.fs.readdirSync(c)}catch(h){}return[]};
FileSystem.copyFolder=function(c,h){if(void 0!==FileSystem.fs){FileSystem.makeDirectory(h);for(var n=FileSystem.fs.readdirSync(c),f=0;f<n.length;f++){var q=c+"/"+n[f],l=h+"/"+n[f],k=FileSystem.fs.statSync(q);k.isDirectory()?FileSystem.copyFolder(q,l):k.isSymbolicLink()?FileSystem.fs.symlinkSync(FileSystem.fs.readlinkSync(q),l):FileSystem.copyFile(q,l)}}};
FileSystem.chooseFile=function(c,h,n){var f=document.createElement("input");f.type="file";f.accept=void 0!==h?h:"";void 0!==n&&(f.nwsaveas=!0!==n?n:"file");f.onchange=function(q){void 0!==c&&c(f.files)};f.click()};FileSystem.getFileName=function(c){return c.substring(c.lastIndexOf("/")+1,c.lastIndexOf("."))};FileSystem.getFileExtension=function(c){return c.substring(c.lastIndexOf(".")+1,c.length)};
function Runtime(c){this.program=null;void 0===c?(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0px",this.canvas.style.top="0px",this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,document.body.appendChild(this.canvas),this.canvas_resize=!0):(this.canvas=c,this.canvas_resize=!1);this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,
antialias:!0});this.renderer.autoClear=!1;this.renderer.shadowMap.enabled=!0;this.renderer.shadowMap.type=THREE.PCFShadowMap;this.renderer.setPixelRatio(window.devicePixelRatio||1);this.renderer.setSize(this.canvas.width,this.canvas.height)}Runtime.fullscreen=!1;
Runtime.prototype.run=function(){if(null===this.program)console.warn("Runtime: No program is loaded");else{Keyboard.initialize();Mouse.initialize();Mouse.setCanvas(this.canvas);this.program.vr&&(this.vr_controls=new VRControls,this.vr_effect=new THREE.VREffect(this.renderer));this.program.default_camera=new PerspectiveCamera(60,this.canvas.width/this.canvas.height,.1,1E6);this.program.default_camera.position.set(0,10,30);this.program.renderer=this.renderer;this.program.initialize();this.program.resize(this.canvas.width,
this.canvas.height);var c=this,h=function(){requestAnimationFrame(h);c.update()};h()}};Runtime.prototype.update=function(){Mouse.update();Keyboard.update();this.program.update();this.program.render(this.renderer)};Runtime.prototype.exit=function(){null!==this.program&&(this.program.dispose(),this.program=null);if(void 0!==this.onExit)this.onExit();void 0!==Runtime.gui&&(Runtime.gui.App.closeAllWindows(),Runtime.gui.App.quit())};
Runtime.prototype.resize=function(){null!==this.canvas&&this.canvas_resize&&(this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight);void 0!==this.renderer&&(this.renderer.setSize(this.canvas.width,this.canvas.height),this.program.resize(this.canvas.width,this.canvas.height))};
Runtime.prototype.loadProgram=function(c){var h=new ObjectLoader;c=JSON.parse(FileSystem.readFile(c));this.program=h.parse(c)};Runtime.prototype.setOnExit=function(c){this.onExit=c};
Runtime.setFullscreen=function(c,h){(Runtime.fullscreen=c)?(void 0===h&&(h=document.body),h.requestFullscreen=h.requestFullscreen||h.mozRequestFullScreen||h.webkitRequestFullscreen||h.msRequestFullscreen,h.requestFullscreen&&h.requestFullscreen()):(document.exitFullscreen=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen,document.exitFullscreen&&document.exitFullscreen())};Runtime.webvravailable=function(){return void 0!==navigator.getVRDisplays};
